var ut=Object.defineProperty;var k=Object.getOwnPropertySymbols;var ct=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var q=s=>{throw TypeError(s)};var P=(s,t,i)=>t in s?ut(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,M=(s,t)=>{for(var i in t||(t={}))ct.call(t,i)&&P(s,i,t[i]);if(k)for(var i of k(t))lt.call(t,i)&&P(s,i,t[i]);return s};var H=(s,t,i)=>P(s,typeof t!="symbol"?t+"":t,i),V=(s,t,i)=>t.has(s)||q("Cannot "+i);var e=(s,t,i)=>(V(s,t,"read from private field"),i?i.call(s):t.get(s)),f=(s,t,i)=>t.has(s)?q("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,i),v=(s,t,i,n)=>(V(s,t,"write to private field"),n?n.call(s,i):t.set(s,i),i),d=(s,t,i)=>(V(s,t,"access private method"),i);var I=(s,t,i)=>new Promise((n,u)=>{var p=l=>{try{c(i.next(l))}catch(y){u(y)}},a=l=>{try{c(i.throw(l))}catch(y){u(y)}},c=l=>l.done?n(l.value):Promise.resolve(l.value).then(p,a);c((i=i.apply(s,t)).next())});import{V as pt,i as ft,b as A,p as vt,c as N,Q as U,l as F,e as yt,D,d as gt,R as Lt,T as St,f as Q,L as R,I as Et,g as K,h as Tt,j as mt,k as wt}from"./index-nv6x9H9a.js";const xt=s=>gt(s);var w,h,o,b,C,r,m,W,B,J,X,Y,z,G,Z,tt,it,et,st,nt,rt;class Dt{constructor(t,i){f(this,r);f(this,w);f(this,h);f(this,o,null);f(this,b,null);H(this,"config",{});f(this,C,new Set);v(this,w,t),v(this,h,i)}get instance(){return e(this,o)}setup(t){const{streamType:i}=e(this,h).$state,n=N(i).includes("live"),u=N(i).includes("ll-");v(this,o,new t(M({lowLatencyMode:u,backBufferLength:u?4:n?8:void 0,renderTextTracksNatively:!1},this.config)));const p=d(this,r,J).bind(this);for(const a of Object.values(t.Events))e(this,o).on(a,p);e(this,o).on(t.Events.ERROR,d(this,r,it).bind(this));for(const a of e(this,C))a(e(this,o));e(this,h).player.dispatch("hls-instance",{detail:e(this,o)}),e(this,o).attachMedia(e(this,w)),e(this,o).on(t.Events.AUDIO_TRACK_SWITCHED,d(this,r,z).bind(this)),e(this,o).on(t.Events.LEVEL_SWITCHED,d(this,r,G).bind(this)),e(this,o).on(t.Events.LEVEL_LOADED,d(this,r,tt).bind(this)),e(this,o).on(t.Events.LEVEL_UPDATED,d(this,r,Z).bind(this)),e(this,o).on(t.Events.NON_NATIVE_TEXT_TRACKS_FOUND,d(this,r,X).bind(this)),e(this,o).on(t.Events.CUES_PARSED,d(this,r,Y).bind(this)),e(this,h).qualities[U.enableAuto]=d(this,r,st).bind(this),F(e(this,h).qualities,"change",d(this,r,nt).bind(this)),F(e(this,h).audioTracks,"change",d(this,r,rt).bind(this)),v(this,b,yt(d(this,r,W).bind(this)))}onInstance(t){return e(this,C).add(t),()=>e(this,C).delete(t)}loadSource(t){var i;A(t.src)&&((i=e(this,o))==null||i.loadSource(t.src))}destroy(){var t,i;(t=e(this,o))==null||t.destroy(),v(this,o,null),(i=e(this,b))==null||i.call(this),v(this,b,null)}}w=new WeakMap,h=new WeakMap,o=new WeakMap,b=new WeakMap,C=new WeakMap,r=new WeakSet,m=function(t,i){return new D(xt(t),{detail:i})},W=function(){if(!e(this,h).$state.live())return;const t=new Lt(d(this,r,B).bind(this));return t.start(),t.stop.bind(t)},B=function(){var t,i;e(this,h).$state.liveSyncPosition.set((i=(t=e(this,o))==null?void 0:t.liveSyncPosition)!=null?i:1/0)},J=function(t,i){var n;(n=e(this,h).player)==null||n.dispatch(d(this,r,m).call(this,t,i))},X=function(t,i){var p;const n=d(this,r,m).call(this,t,i);let u=-1;for(let a=0;a<i.tracks.length;a++){const c=i.tracks[a],l=(p=c.subtitleTrack)!=null?p:c.closedCaptions,y=new St({id:`hls-${c.kind}-${a}`,src:l==null?void 0:l.url,label:c.label,language:l==null?void 0:l.lang,kind:c.kind,default:c.default});y[Q.readyState]=2,y[Q.onModeChange]=()=>{y.mode==="showing"?(e(this,o).subtitleTrack=a,u=a):u===a&&(e(this,o).subtitleTrack=-1,u=-1)},e(this,h).textTracks.add(y,n)}},Y=function(t,i){var a;const n=(a=e(this,o))==null?void 0:a.subtitleTrack,u=e(this,h).textTracks.getById(`hls-${i.type}-${n}`);if(!u)return;const p=d(this,r,m).call(this,t,i);for(const c of i.cues)c.positionAlign="auto",u.addCue(c,p)},z=function(t,i){const n=e(this,h).audioTracks[i.id];if(n){const u=d(this,r,m).call(this,t,i);e(this,h).audioTracks[R.select](n,!0,u)}},G=function(t,i){const n=e(this,h).qualities[i.level];if(n){const u=d(this,r,m).call(this,t,i);e(this,h).qualities[R.select](n,!0,u)}},Z=function(t,i){i.details.totalduration>0&&e(this,h).$state.inferredLiveDVRWindow.set(i.details.totalduration)},tt=function(t,i){var y,j;if(e(this,h).$state.canPlay())return;const{type:n,live:u,totalduration:p,targetduration:a}=i.details,c=d(this,r,m).call(this,t,i);e(this,h).notify("stream-type-change",u?n==="EVENT"&&Number.isFinite(p)&&a>=10?"live:dvr":"live":"on-demand",c),e(this,h).notify("duration-change",p,c);const l=e(this,o).media;e(this,o).currentLevel===-1&&e(this,h).qualities[U.setAuto](!0,c);for(const L of e(this,o).audioTracks){const O={id:L.id.toString(),label:L.name,language:L.lang||"",kind:"main"};e(this,h).audioTracks[R.add](O,c)}for(const L of e(this,o).levels){const O={id:(j=(y=L.id)==null?void 0:y.toString())!=null?j:L.height+"p",width:L.width,height:L.height,codec:L.codecSet,bitrate:L.bitrate};e(this,h).qualities[R.add](O,c)}l.dispatchEvent(new D("canplay",{trigger:c}))},it=function(t,i){var n;if(i.fatal)switch(i.type){case"mediaError":(n=e(this,o))==null||n.recoverMediaError();break;default:d(this,r,et).call(this,i.error);break}},et=function(t){e(this,h).notify("error",{message:t.message,code:1,error:t})},st=function(){e(this,o)&&(e(this,o).currentLevel=-1)},nt=function(){const{qualities:t}=e(this,h);!e(this,o)||t.auto||(e(this,o)[t.switch+"Level"]=t.selectedIndex,Et&&(e(this,w).currentTime=e(this,w).currentTime))},rt=function(){const{audioTracks:t}=e(this,h);e(this,o)&&e(this,o).audioTrack!==t.selectedIndex&&(e(this,o).audioTrack=t.selectedIndex)};var x,S,_,E,ot,ht,at,dt;class bt{constructor(t,i,n){f(this,E);f(this,x);f(this,S);f(this,_);v(this,x,t),v(this,S,i),v(this,_,n),d(this,E,ot).call(this)}}x=new WeakMap,S=new WeakMap,_=new WeakMap,E=new WeakSet,ot=function(){return I(this,null,function*(){const t={onLoadStart:d(this,E,ht).bind(this),onLoaded:d(this,E,at).bind(this),onLoadError:d(this,E,dt).bind(this)};let i=yield It(e(this,x),t);if(K(i)&&!A(e(this,x))&&(i=yield Ct(e(this,x),t)),!i)return null;if(!i.isSupported()){const n="[vidstack] `hls.js` is not supported in this environment";return e(this,S).player.dispatch(new D("hls-unsupported")),e(this,S).notify("error",{message:n,code:4}),null}return i})},ht=function(){e(this,S).player.dispatch(new D("hls-lib-load-start"))},at=function(t){e(this,S).player.dispatch(new D("hls-lib-loaded",{detail:t})),e(this,_).call(this,t)},dt=function(t){const i=Tt(t);e(this,S).player.dispatch(new D("hls-lib-load-error",{detail:i})),e(this,S).notify("error",{message:i.message,code:4,error:i})};function Ct(i){return I(this,arguments,function*(s,t={}){var n,u,p,a,c;if(!K(s)){if((n=t.onLoadStart)==null||n.call(t),s.prototype&&s.prototype!==Function)return(u=t.onLoaded)==null||u.call(t,s),s;try{const l=(p=yield s())==null?void 0:p.default;if(l&&l.isSupported)(a=t.onLoaded)==null||a.call(t,l);else throw Error("");return l}catch(l){(c=t.onLoadError)==null||c.call(t,l)}}})}function It(i){return I(this,arguments,function*(s,t={}){var n,u,p;if(A(s)){(n=t.onLoadStart)==null||n.call(t);try{if(yield mt(s),!wt(window.Hls))throw Error("");const a=window.Hls;return(u=t.onLoaded)==null||u.call(t,a),a}catch(a){(p=t.onLoadError)==null||p.call(t,a)}}})}const At="https://cdn.jsdelivr.net";var $,g,T;class _t extends pt{constructor(){super(...arguments);H(this,"$$PROVIDER_TYPE","HLS");f(this,$,null);f(this,g,new Dt(this.video,this.ctx));f(this,T,`${At}/npm/hls.js@^1.5.0/dist/hls.min.js`)}get ctor(){return e(this,$)}get instance(){return e(this,g).instance}get type(){return"hls"}get canLiveSync(){return!0}get config(){return e(this,g).config}set config(i){e(this,g).config=i}get library(){return e(this,T)}set library(i){v(this,T,i)}preconnect(){A(e(this,T))&&vt(e(this,T))}setup(){super.setup(),new bt(e(this,T),this.ctx,i=>{v(this,$,i),e(this,g).setup(i),this.ctx.notify("provider-setup",this);const n=N(this.ctx.$state.source);n&&this.loadSource(n)})}loadSource(i,n){return I(this,null,function*(){if(!A(i.src)){this.removeSource();return}this.media.preload=n||"",this.appendSource(i,"application/x-mpegurl"),e(this,g).loadSource(i),this.currentSrc=i})}onInstance(i){const n=e(this,g).instance;return n&&i(n),e(this,g).onInstance(i)}destroy(){e(this,g).destroy()}}$=new WeakMap,g=new WeakMap,T=new WeakMap,H(_t,"supported",ft());export{_t as HLSProvider};
