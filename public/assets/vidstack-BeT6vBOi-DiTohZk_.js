var St=Object.defineProperty;var tt=h=>{throw TypeError(h)};var At=(h,t,s)=>t in h?St(h,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):h[t]=s;var V=(h,t,s)=>At(h,typeof t!="symbol"?t+"":t,s),$=(h,t,s)=>t.has(h)||tt("Cannot "+s);var e=(h,t,s)=>($(h,t,"read from private field"),s?s.call(h):t.get(h)),T=(h,t,s)=>t.has(h)?tt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(h):t.set(h,s),l=(h,t,s,i)=>($(h,t,"write to private field"),i?i.call(h,s):t.set(h,s),s),r=(h,t,s)=>($(h,t,"access private method"),s);var N=(h,t,s)=>new Promise((i,n)=>{var d=g=>{try{m(s.next(g))}catch(p){n(p)}},f=g=>{try{m(s.throw(g))}catch(p){n(p)}},m=g=>g.done?i(g.value):Promise.resolve(g.value).then(d,f);m((s=s.apply(h,t)).next())});import{m as It,o as A,R as Rt,A as et,B as bt,D as st,c as H,l as it,e as wt,C as Mt,L as Dt}from"./index-nv6x9H9a.js";import{getCastContext as Nt,getCastSession as Pt,getCastSessionMedia as rt,hasActiveCastSession as at,listenCastContextEvent as _t,getCastErrorMessage as xt}from"./vidstack-CQQ1xKSy-Bw2fsQ-n.js";var y,O,nt;class Gt{constructor(t){T(this,O);T(this,y);l(this,y,new chrome.cast.media.MediaInfo(t.src,t.type))}build(){return e(this,y)}setStreamType(t){return t.includes("live")?e(this,y).streamType=chrome.cast.media.StreamType.LIVE:e(this,y).streamType=chrome.cast.media.StreamType.BUFFERED,this}setTracks(t){return e(this,y).tracks=t.map(r(this,O,nt)),this}setMetadata(t,s){return e(this,y).metadata=new chrome.cast.media.GenericMediaMetadata,e(this,y).metadata.title=t,e(this,y).metadata.images=[{url:s}],this}}y=new WeakMap,O=new WeakSet,nt=function(t,s){const i=new chrome.cast.media.Track(s,chrome.cast.media.TrackType.TEXT);return i.name=t.label,i.trackContentId=t.src,i.trackContentType="text/vtt",i.language=t.language,i.subtype=t.kind.toUpperCase(),i};var L,C,P,u,U,b,ot,ct,ht,F,G,q;class Ot{constructor(t,s,i){T(this,u);T(this,L);T(this,C);T(this,P);l(this,L,t),l(this,C,s),l(this,P,i)}setup(){const t=this.syncRemoteActiveIds.bind(this);it(e(this,C).audioTracks,"change",t),it(e(this,C).textTracks,"mode-change",t),wt(r(this,u,ct).bind(this))}getLocalTextTracks(){return e(this,C).$state.textTracks().filter(t=>t.src&&t.type==="vtt")}syncRemoteTracks(t){var f;if(!e(this,L).isMediaLoaded)return;const s=r(this,u,U).call(this),i=this.getLocalTextTracks(),n=r(this,u,b).call(this,chrome.cast.media.TrackType.AUDIO),d=r(this,u,b).call(this,chrome.cast.media.TrackType.TEXT);for(const m of n){if(r(this,u,F).call(this,s,m))continue;const p={id:m.trackId.toString(),label:m.name,language:m.language,kind:(f=m.subtype)!=null?f:"main",selected:!1};e(this,C).audioTracks[Dt.add](p,t)}for(const m of d){if(r(this,u,F).call(this,i,m))continue;const p={id:m.trackId.toString(),src:m.trackContentId,label:m.name,language:m.language,kind:m.subtype.toLowerCase()};e(this,C).textTracks.add(p,t)}}syncRemoteActiveIds(t){if(!e(this,L).isMediaLoaded)return;const s=r(this,u,ot).call(this),i=new chrome.cast.media.EditTracksInfoRequest(s);r(this,u,ht).call(this,i).catch(n=>{})}}L=new WeakMap,C=new WeakMap,P=new WeakMap,u=new WeakSet,U=function(){return e(this,C).$state.audioTracks()},b=function(t){var i,n;const s=(n=(i=e(this,L).mediaInfo)==null?void 0:i.tracks)!=null?n:[];return t?s.filter(d=>d.type===t):s},ot=function(){const t=[],s=r(this,u,U).call(this).find(n=>n.selected),i=this.getLocalTextTracks().filter(n=>n.mode==="showing");if(s){const n=r(this,u,b).call(this,chrome.cast.media.TrackType.AUDIO),d=r(this,u,G).call(this,n,s);d&&t.push(d.trackId)}if(i!=null&&i.length){const n=r(this,u,b).call(this,chrome.cast.media.TrackType.TEXT);if(n.length)for(const d of i){const f=r(this,u,G).call(this,n,d);f&&t.push(f.trackId)}}return t},ct=function(){const t=this.getLocalTextTracks();if(!e(this,L).isMediaLoaded)return;const s=r(this,u,b).call(this,chrome.cast.media.TrackType.TEXT);for(const i of t)if(!r(this,u,G).call(this,s,i)){Mt(()=>{var d;return(d=e(this,P))==null?void 0:d.call(this)});break}},ht=function(t){const s=rt();return new Promise((i,n)=>s==null?void 0:s.editTracksInfo(t,i,n))},F=function(t,s){return t.find(i=>r(this,u,q).call(this,i,s))},G=function(t,s){return t.find(i=>r(this,u,q).call(this,s,i))},q=function(t,s){return s.name===t.label&&s.language===t.language&&s.subtype.toLowerCase()===t.kind.toLowerCase()};var o,c,v,S,_,w,I,R,M,x,k,D,a,dt,ut,B,lt,X,mt,Tt,ft,Y,K,j,z,gt,kt,yt,J,pt,Q,Ct,W,E,Et,Lt,Z,vt;class Ut{constructor(t,s){T(this,a);V(this,"$$PROVIDER_TYPE","GOOGLE_CAST");V(this,"scope",It());T(this,o);T(this,c);T(this,v);T(this,S,null);T(this,_,"disconnected");T(this,w,0);T(this,I,0);T(this,R,new A(0,0));T(this,M,new Rt(r(this,a,Tt).bind(this)));T(this,x);T(this,k,null);T(this,D,!1);l(this,o,t),l(this,c,s),l(this,v,new Ot(t,s,r(this,a,vt).bind(this)))}get type(){return"google-cast"}get currentSrc(){return e(this,S)}get player(){return e(this,o)}get cast(){return Nt()}get session(){return Pt()}get media(){return rt()}get hasActiveSession(){return at(e(this,S))}setup(){r(this,a,dt).call(this),r(this,a,ut).call(this),e(this,v).setup(),e(this,c).notify("provider-setup",this)}play(){return N(this,null,function*(){var t;if(!(!e(this,o).isPaused&&!e(this,D))){if(e(this,D)){yield r(this,a,Z).call(this,!1,0);return}(t=e(this,o).controller)==null||t.playOrPause()}})}pause(){return N(this,null,function*(){var t;e(this,o).isPaused||(t=e(this,o).controller)==null||t.playOrPause()})}getMediaStatus(t){return new Promise((s,i)=>{var n;(n=this.media)==null||n.getStatus(t,s,i)})}setMuted(t){var i;(t&&!e(this,o).isMuted||!t&&e(this,o).isMuted)&&((i=e(this,o).controller)==null||i.muteOrUnmute())}setCurrentTime(t){var s;e(this,o).currentTime=t,e(this,c).notify("seeking",t),(s=e(this,o).controller)==null||s.seek()}setVolume(t){var s;e(this,o).volumeLevel=t,(s=e(this,o).controller)==null||s.setVolumeLevel()}loadSource(t){return N(this,null,function*(){var n;if(((n=e(this,k))==null?void 0:n.src)!==t&&l(this,k,null),at(t)){r(this,a,lt).call(this),l(this,S,t);return}e(this,c).notify("load-start");const s=r(this,a,Lt).call(this,t),i=yield this.session.loadMedia(s);if(i){l(this,S,null),e(this,c).notify("error",Error(xt(i)));return}l(this,S,t)})}destroy(){r(this,a,B).call(this),r(this,a,X).call(this)}}o=new WeakMap,c=new WeakMap,v=new WeakMap,S=new WeakMap,_=new WeakMap,w=new WeakMap,I=new WeakMap,R=new WeakMap,M=new WeakMap,x=new WeakMap,k=new WeakMap,D=new WeakMap,a=new WeakSet,dt=function(){_t(cast.framework.CastContextEventType.CAST_STATE_CHANGED,r(this,a,Y).bind(this))},ut=function(){const t=cast.framework.RemotePlayerEventType,s={[t.IS_CONNECTED_CHANGED]:r(this,a,Y),[t.IS_MEDIA_LOADED_CHANGED]:r(this,a,K),[t.CAN_CONTROL_VOLUME_CHANGED]:r(this,a,j),[t.CAN_SEEK_CHANGED]:r(this,a,z),[t.DURATION_CHANGED]:r(this,a,yt),[t.IS_MUTED_CHANGED]:r(this,a,J),[t.VOLUME_LEVEL_CHANGED]:r(this,a,J),[t.IS_PAUSED_CHANGED]:r(this,a,pt),[t.LIVE_SEEKABLE_RANGE_CHANGED]:r(this,a,Q),[t.PLAYER_STATE_CHANGED]:r(this,a,Ct)};l(this,x,s);const i=r(this,a,ft).bind(this);for(const n of et(s))e(this,o).controller.addEventListener(n,i);bt(()=>{for(const n of et(s))e(this,o).controller.removeEventListener(n,i)})},B=function(){e(this,k)||(l(this,I,0),l(this,R,new A(0,0))),e(this,M).stop(),l(this,w,0),l(this,k,null)},lt=function(){var f;const t=new st("resume-session",{detail:this.session});r(this,a,K).call(this,t);const{muted:s,volume:i,savedState:n}=e(this,c).$state,d=n();this.setCurrentTime(Math.max(e(this,o).currentTime,(f=d==null?void 0:d.currentTime)!=null?f:0)),this.setMuted(s()),this.setVolume(i()),(d==null?void 0:d.paused)===!1&&this.play()},X=function(){this.cast.endCurrentSession(!0);const{remotePlaybackLoader:t}=e(this,c).$state;t.set(null)},mt=function(){const{savedState:t}=e(this,c).$state;t.set({paused:e(this,o).isPaused,currentTime:e(this,o).currentTime}),r(this,a,X).call(this)},Tt=function(){r(this,a,kt).call(this)},ft=function(t){e(this,x)[t.type].call(this,t)},Y=function(t){const s=this.cast.getCastState(),i=s===cast.framework.CastState.CONNECTED?"connected":s===cast.framework.CastState.CONNECTING?"connecting":"disconnected";if(e(this,_)===i)return;const n={type:"google-cast",state:i},d=r(this,a,E).call(this,t);l(this,_,i),e(this,c).notify("remote-playback-change",n,d),i==="disconnected"&&r(this,a,mt).call(this)},K=function(t){if(!!!e(this,o).isMediaLoaded)return;const i=H(e(this,c).$state.source);Promise.resolve().then(()=>{if(i!==H(e(this,c).$state.source)||!e(this,o).isMediaLoaded)return;r(this,a,B).call(this);const n=e(this,o).duration;l(this,R,new A(0,n));const d={provider:this,duration:n,buffered:new A(0,0),seekable:r(this,a,W).call(this)},f=r(this,a,E).call(this,t);e(this,c).notify("loaded-metadata",void 0,f),e(this,c).notify("loaded-data",void 0,f),e(this,c).notify("can-play",d,f),r(this,a,j).call(this),r(this,a,z).call(this,t);const{volume:m,muted:g}=e(this,c).$state;this.setVolume(m()),this.setMuted(g()),e(this,M).start(),e(this,v).syncRemoteTracks(f),e(this,v).syncRemoteActiveIds(f)})},j=function(){e(this,c).$state.canSetVolume.set(e(this,o).canControlVolume)},z=function(t){const s=r(this,a,E).call(this,t);e(this,c).notify("stream-type-change",r(this,a,gt).call(this),s)},gt=function(){var s;return((s=e(this,o).mediaInfo)==null?void 0:s.streamType)===chrome.cast.media.StreamType.LIVE?e(this,o).canSeek?"live:dvr":"live":"on-demand"},kt=function(){if(e(this,k))return;const t=e(this,o).currentTime;t!==e(this,w)&&(e(this,c).notify("time-change",t),t>e(this,I)&&(l(this,I,t),r(this,a,Q).call(this)),e(this,c).$state.seeking()&&e(this,c).notify("seeked",t),l(this,w,t))},yt=function(t){if(!e(this,o).isMediaLoaded||e(this,k))return;const s=e(this,o).duration,i=r(this,a,E).call(this,t);l(this,R,new A(0,s)),e(this,c).notify("duration-change",s,i)},J=function(t){if(!e(this,o).isMediaLoaded)return;const s={muted:e(this,o).isMuted,volume:e(this,o).volumeLevel},i=r(this,a,E).call(this,t);e(this,c).notify("volume-change",s,i)},pt=function(t){const s=r(this,a,E).call(this,t);e(this,o).isPaused?e(this,c).notify("pause",void 0,s):e(this,c).notify("play",void 0,s)},Q=function(t){const s={seekable:r(this,a,W).call(this),buffered:new A(0,e(this,I))},i=t?r(this,a,E).call(this,t):void 0;e(this,c).notify("progress",s,i)},Ct=function(t){const s=e(this,o).playerState,i=chrome.cast.media.PlayerState;if(l(this,D,s===i.IDLE),s===i.PAUSED)return;const n=r(this,a,E).call(this,t);switch(s){case i.PLAYING:e(this,c).notify("playing",void 0,n);break;case i.BUFFERING:e(this,c).notify("waiting",void 0,n);break;case i.IDLE:e(this,M).stop(),e(this,c).notify("pause"),e(this,c).notify("end");break}},W=function(){return e(this,o).liveSeekableRange?new A(e(this,o).liveSeekableRange.start,e(this,o).liveSeekableRange.end):e(this,R)},E=function(t){return t instanceof Event?t:new st(t.type,{detail:t})},Et=function(t){const{streamType:s,title:i,poster:n}=e(this,c).$state;return new Gt(t).setMetadata(i(),n()).setStreamType(s()).setTracks(e(this,v).getLocalTextTracks()).build()},Lt=function(t){var d,f,m,g,p;const s=r(this,a,Et).call(this,t),i=new chrome.cast.media.LoadRequest(s),n=e(this,c).$state.savedState();return i.autoplay=((f=(d=e(this,k))==null?void 0:d.paused)!=null?f:n==null?void 0:n.paused)===!1,i.currentTime=(p=(g=(m=e(this,k))==null?void 0:m.time)!=null?g:n==null?void 0:n.currentTime)!=null?p:0,i},Z=function(t,s){return N(this,null,function*(){const i=H(e(this,c).$state.source);l(this,k,{src:i,paused:t,time:s}),yield this.loadSource(i)})},vt=function(){r(this,a,Z).call(this,e(this,o).isPaused,e(this,o).currentTime).catch(t=>{})};export{Ut as GoogleCastProvider};
