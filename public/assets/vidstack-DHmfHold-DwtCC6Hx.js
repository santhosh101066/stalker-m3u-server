var A=Object.defineProperty;var O=o=>{throw TypeError(o)};var G=(o,r,e)=>r in o?A(o,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[r]=e;var S=(o,r,e)=>G(o,typeof r!="symbol"?r+"":r,e),M=(o,r,e)=>r.has(o)||O("Cannot "+e);var s=(o,r,e)=>(M(o,r,"read from private field"),e?e.call(o):r.get(o)),m=(o,r,e)=>r.has(o)?O("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(o):r.set(o,e),y=(o,r,e,t)=>(M(o,r,"write to private field"),t?t.call(o,e):r.set(o,e),e),n=(o,r,e)=>(M(o,r,"access private method"),e);var R=(o,r,e)=>new Promise((t,d)=>{var u=c=>{try{l(e.next(c))}catch(p){d(p)}},h=c=>{try{l(e.throw(c))}catch(p){d(p)}},l=c=>c.done?t(c.value):Promise.resolve(c.value).then(u,h);l((e=e.apply(o,r)).next())});import{m as H,n as J,p as K,e as Q,b as W,q as X,o as _,t as Z,u as V,v as ee}from"./index-nv6x9H9a.js";import{E as te}from"./vidstack-FldwQc2Q-BhlLhKYf.js";import{resolveYouTubeVideoId as se}from"./vidstack-Dm1xEU9Q-BUQBRUjU.js";const k={Ended:0,Playing:1,Paused:2,Buffering:3,Cued:5};var a,v,P,$,w,b,f,i,ie,ae,j,g,Y,F,x,B,C,L,U,D,E,q;class he extends te{constructor(e,t){super(e);m(this,i);S(this,"$$PROVIDER_TYPE","YOUTUBE");S(this,"scope",H());m(this,a);m(this,v,J(""));m(this,P,-1);m(this,$,null);m(this,w,-1);m(this,b,!1);m(this,f,new Map);S(this,"language","en");S(this,"color","red");S(this,"cookies",!1);y(this,a,t)}get currentSrc(){return s(this,$)}get type(){return"youtube"}get videoId(){return s(this,v).call(this)}preconnect(){K(this.getOrigin())}setup(){super.setup(),Q(n(this,i,j).bind(this)),s(this,a).notify("provider-setup",this)}destroy(){n(this,i,D).call(this);const e="provider destroyed";for(const t of s(this,f).values())for(const{reject:d}of t)d(e);s(this,f).clear()}play(){return R(this,null,function*(){return n(this,i,g).call(this,"playVideo")})}pause(){return R(this,null,function*(){return n(this,i,g).call(this,"pauseVideo")})}setMuted(e){e?n(this,i,g).call(this,"mute"):n(this,i,g).call(this,"unMute")}setCurrentTime(e){n(this,i,g).call(this,"seekTo",e),s(this,a).notify("seeking",e)}setVolume(e){n(this,i,g).call(this,"setVolume",e*100)}setPlaybackRate(e){n(this,i,g).call(this,"setPlaybackRate",e)}loadSource(e){return R(this,null,function*(){if(!W(e.src)){y(this,$,null),s(this,v).set("");return}const t=se(e.src);s(this,v).set(t!=null?t:""),y(this,$,e)})}getOrigin(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}buildParams(){const{keyDisabled:e}=s(this,a).$props,{muted:t,playsInline:d,nativeControls:u}=s(this,a).$state,h=u();return{rel:0,autoplay:0,cc_lang_pref:this.language,cc_load_policy:h?1:void 0,color:this.color,controls:h?1:0,disablekb:!h||e()?1:0,enablejsapi:1,fs:1,hl:this.language,iv_load_policy:h?1:3,mute:t()?1:0,playsinline:d()?1:0}}onLoad(){window.setTimeout(()=>this.postMessage({event:"listening"}),100)}onMessage({info:e},t){var l,c;if(!e)return;const{title:d,intrinsicDuration:u,playbackRate:h}=s(this,a).$state;if(Z(e.videoData)&&e.videoData.title!==d()&&s(this,a).notify("title-change",e.videoData.title,t),V(e.duration)&&e.duration!==u()){if(V(e.videoLoadedFraction)){const p=(c=(l=e.progressState)==null?void 0:l.loaded)!=null?c:e.videoLoadedFraction*e.duration,T=new _(0,e.duration);n(this,i,B).call(this,p,T,t)}s(this,a).notify("duration-change",e.duration,t)}if(V(e.playbackRate)&&e.playbackRate!==h()&&s(this,a).notify("rate-change",e.playbackRate,t),e.progressState){const{current:p,seekableStart:T,seekableEnd:N,loaded:z,duration:I}=e.progressState;n(this,i,x).call(this,p,t),n(this,i,B).call(this,z,new _(T,N),t),I!==u()&&s(this,a).notify("duration-change",I,t)}if(V(e.volume)&&ee(e.muted)&&!s(this,b)){const p={muted:e.muted,volume:e.volume/100};s(this,a).notify("volume-change",p,t)}V(e.playerState)&&e.playerState!==s(this,P)&&n(this,i,U).call(this,e.playerState,t)}}a=new WeakMap,v=new WeakMap,P=new WeakMap,$=new WeakMap,w=new WeakMap,b=new WeakMap,f=new WeakMap,i=new WeakSet,ie=function(e){var t;(t=n(this,i,E).call(this,"playVideo"))==null||t.reject(e)},ae=function(e){var t;(t=n(this,i,E).call(this,"pauseVideo"))==null||t.reject(e)},j=function(){n(this,i,D).call(this);const e=s(this,v).call(this);if(!e){this.src.set("");return}this.src.set(`${this.getOrigin()}/embed/${e}`),s(this,a).notify("load-start")},g=function(e,t){let d=X(),u=s(this,f).get(e);return u||s(this,f).set(e,u=[]),u.push(d),this.postMessage({event:"command",func:e,args:t?[t]:void 0}),d.promise},Y=function(e){s(this,a).notify("loaded-metadata"),s(this,a).notify("loaded-data"),s(this,a).delegate.ready(void 0,e)},F=function(e){var t;(t=n(this,i,E).call(this,"pauseVideo"))==null||t.resolve(),s(this,a).notify("pause",void 0,e)},x=function(e,t){const{duration:d,realCurrentTime:u}=s(this,a).$state,h=s(this,P)===k.Ended,l=h?d():e;s(this,a).notify("time-change",l,t),!h&&Math.abs(l-u())>1&&s(this,a).notify("seeking",l,t)},B=function(e,t,d){const u={buffered:new _(0,e),seekable:t};s(this,a).notify("progress",u,d);const{seeking:h,realCurrentTime:l}=s(this,a).$state;h()&&e>l()&&n(this,i,C).call(this,d)},C=function(e){const{paused:t,realCurrentTime:d}=s(this,a).$state;window.clearTimeout(s(this,w)),y(this,w,window.setTimeout(()=>{s(this,a).notify("seeked",d(),e),y(this,w,-1)},t()?100:0))},L=function(e){const{seeking:t}=s(this,a).$state;t()&&n(this,i,C).call(this,e),s(this,a).notify("pause",void 0,e),s(this,a).notify("end",void 0,e)},U=function(e,t){var T;const{paused:d,seeking:u}=s(this,a).$state,h=e===k.Playing,l=e===k.Buffering,c=n(this,i,q).call(this,"playVideo"),p=d()&&(l||h);if(l&&s(this,a).notify("waiting",void 0,t),u()&&h&&n(this,i,C).call(this,t),s(this,b)&&h){this.pause(),y(this,b,!1),this.setMuted(s(this,a).$state.muted());return}if(!c&&p){y(this,b,!0),this.setMuted(!0);return}switch(p&&((T=n(this,i,E).call(this,"playVideo"))==null||T.resolve(),s(this,a).notify("play",void 0,t)),e){case k.Cued:n(this,i,Y).call(this,t);break;case k.Playing:s(this,a).notify("playing",void 0,t);break;case k.Paused:n(this,i,F).call(this,t);break;case k.Ended:n(this,i,L).call(this,t);break}y(this,P,e)},D=function(){y(this,P,-1),y(this,w,-1),y(this,b,!1)},E=function(e){var t;return(t=s(this,f).get(e))==null?void 0:t.shift()},q=function(e){var t;return!!((t=s(this,f).get(e))!=null&&t.length)};export{he as YouTubeProvider};
