var de=Object.defineProperty;var U=h=>{throw TypeError(h)};var fe=(h,c,e)=>c in h?de(h,c,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[c]=e;var k=(h,c,e)=>fe(h,typeof c!="symbol"?c+"":c,e),S=(h,c,e)=>c.has(h)||U("Cannot "+e);var s=(h,c,e)=>(S(h,c,"read from private field"),e?e.call(h):c.get(h)),p=(h,c,e)=>c.has(h)?U("Cannot add the same private member more than once"):c instanceof WeakSet?c.add(h):c.set(h,e),d=(h,c,e,t)=>(S(h,c,"write to private field"),t?t.call(h,e):c.set(h,e),e),o=(h,c,e)=>(S(h,c,"access private method"),e);var I=(h,c,e)=>new Promise((t,n)=>{var r=f=>{try{y(e.next(f))}catch(P){n(P)}},l=f=>{try{y(e.throw(f))}catch(P){n(P)}},y=f=>f.done?t(f.value):Promise.resolve(f.value).then(r,l);y((e=e.apply(h,c)).next())});import{m as pe,n as _,o as $,R as ye,p as be,e as L,c as x,b as ke,q as W,L as A,l as ve,r as me,T as we,Q as Y}from"./index-DEKsqTM_.js";import{E as Pe}from"./vidstack-FldwQc2Q-BlO7Xz6p.js";import{resolveVimeoVideoId as Te,getVimeoVideoInfo as Ce}from"./vidstack-krOAtKMi-CYa3UPC7.js";const ge=["bufferend","bufferstart","durationchange","ended","enterpictureinpicture","error","fullscreenchange","leavepictureinpicture","loaded","playProgress","loadProgress","pause","play","playbackratechange","qualitychange","seeked","seeking","timeupdate","volumechange","waiting"];var a,b,v,T,E,q,m,V,M,C,w,R,i,z,G,H,J,g,K,X,Z,Q,ee,te,se,ie,ne,F,ae,oe,re,O,he,D,ce,j,le,ue,u,B,N;class Ie extends Pe{constructor(e,t){super(e);p(this,i);k(this,"$$PROVIDER_TYPE","VIMEO");k(this,"scope",pe());k(this,"fullscreen");p(this,a);p(this,b,_(""));p(this,v,_(!1));p(this,T,null);p(this,E,null);p(this,q,!1);p(this,m,new $(0,0));p(this,V,new ye(o(this,i,J).bind(this)));p(this,M,null);p(this,C,null);p(this,w,new Map);p(this,R,null);k(this,"cookies",!1);k(this,"title",!0);k(this,"byline",!0);k(this,"portrait",!0);k(this,"color","00ADEF");p(this,g,!1);d(this,a,t);const n=this;this.fullscreen={get active(){return s(n,q)},supported:!0,enter:()=>o(this,i,u).call(this,"requestFullscreen"),exit:()=>o(this,i,u).call(this,"exitFullscreen")}}get type(){return"vimeo"}get currentSrc(){return s(this,E)}get videoId(){return s(this,b).call(this)}get hash(){return s(this,T)}get isPro(){return s(this,v).call(this)}preconnect(){be(this.getOrigin())}setup(){super.setup(),L(o(this,i,z).bind(this)),L(o(this,i,G).bind(this)),L(o(this,i,H).bind(this)),s(this,a).notify("provider-setup",this)}destroy(){o(this,i,B).call(this),this.fullscreen=void 0;const e="provider destroyed";for(const t of s(this,w).values())for(const{reject:n}of t)n(e);s(this,w).clear(),o(this,i,u).call(this,"destroy")}play(){return I(this,null,function*(){return o(this,i,u).call(this,"play")})}pause(){return I(this,null,function*(){return o(this,i,u).call(this,"pause")})}setMuted(e){o(this,i,u).call(this,"setMuted",e)}setCurrentTime(e){o(this,i,u).call(this,"seekTo",e),s(this,a).notify("seeking",e)}setVolume(e){o(this,i,u).call(this,"setVolume",e),o(this,i,u).call(this,"setMuted",x(s(this,a).$state.muted))}setPlaybackRate(e){o(this,i,u).call(this,"setPlaybackRate",e)}loadSource(e){return I(this,null,function*(){if(!ke(e.src)){d(this,E,null),d(this,T,null),s(this,b).set("");return}const{videoId:t,hash:n}=Te(e.src);s(this,b).set(t!=null?t:""),d(this,T,n!=null?n:null),d(this,E,e)})}getOrigin(){return"https://player.vimeo.com"}buildParams(){const{keyDisabled:e}=s(this,a).$props,{playsInline:t,nativeControls:n}=s(this,a).$state,r=n();return{title:this.title,byline:this.byline,color:this.color,portrait:this.portrait,controls:r,h:this.hash,keyboard:r&&!e(),transparent:!0,playsinline:t(),dnt:!this.cookies}}onMessage(e,t){e.event?o(this,i,le).call(this,e.event,e.data,t):e.method&&o(this,i,ee).call(this,e.method,e.value,t)}onLoad(){}}a=new WeakMap,b=new WeakMap,v=new WeakMap,T=new WeakMap,E=new WeakMap,q=new WeakMap,m=new WeakMap,V=new WeakMap,M=new WeakMap,C=new WeakMap,w=new WeakMap,R=new WeakMap,i=new WeakSet,z=function(){o(this,i,B).call(this);const e=s(this,b).call(this);if(!e){this.src.set("");return}this.src.set(`${this.getOrigin()}/video/${e}`),s(this,a).notify("load-start")},G=function(){const e=s(this,b).call(this);if(!e)return;const t=W(),n=new AbortController;return d(this,R,t),Ce(e,n,s(this,T)).then(r=>{t.resolve(r)}).catch(r=>{t.reject()}),()=>{t.reject(),n.abort()}},H=function(){const e=s(this,v).call(this),{$state:t,qualities:n}=s(this,a);if(t.canSetPlaybackRate.set(e),n[A.setReadonly](!e),e)return ve(n,"change",()=>{var l;if(n.auto)return;const r=(l=n.selected)==null?void 0:l.id;r&&o(this,i,u).call(this,"setQuality",r)})},J=function(){o(this,i,u).call(this,"getCurrentTime")},g=new WeakMap,K=function(e,t){if(s(this,g)&&e===0)return;const{realCurrentTime:n,paused:r,bufferedEnd:l,seekableEnd:y,live:f}=s(this,a).$state;if(n()===e)return;const P=n();s(this,a).notify("time-change",e,t),Math.abs(P-e)>1.5&&(s(this,a).notify("seeking",e,t),!r()&&l()<e&&s(this,a).notify("waiting",void 0,t)),!f()&&y()-e<.01&&(s(this,a).notify("end",void 0,t),d(this,g,!0),setTimeout(()=>{d(this,g,!1)},500))},X=function(e,t){s(this,a).notify("seeked",e,t)},Z=function(e){var n;const t=s(this,b).call(this);(n=s(this,R))==null||n.promise.then(r=>{if(!r)return;const{title:l,poster:y,duration:f,pro:P}=r;s(this,v).set(P),s(this,a).notify("title-change",l,e),s(this,a).notify("poster-change",y,e),s(this,a).notify("duration-change",f,e),o(this,i,Q).call(this,f,e)}).catch(()=>{t===s(this,b).call(this)&&(o(this,i,u).call(this,"getVideoTitle"),o(this,i,u).call(this,"getDuration"))})},Q=function(e,t){const{nativeControls:n}=s(this,a).$state,r=n();d(this,m,new $(0,e));const l={buffered:new $(0,0),seekable:s(this,m),duration:e};s(this,a).delegate.ready(l,t),r||o(this,i,u).call(this,"_hideOverlay"),o(this,i,u).call(this,"getQualities"),o(this,i,u).call(this,"getChapters")},ee=function(e,t,n){var r;switch(e){case"getVideoTitle":const l=t;s(this,a).notify("title-change",l,n);break;case"getDuration":const y=t;s(this,a).$state.canPlay()?s(this,a).notify("duration-change",y,n):o(this,i,Q).call(this,y,n);break;case"getCurrentTime":o(this,i,K).call(this,t,n);break;case"getBuffered":me(t)&&t.length&&o(this,i,F).call(this,t[t.length-1][1],n);break;case"setMuted":o(this,i,O).call(this,x(s(this,a).$state.volume),t,n);break;case"getChapters":o(this,i,he).call(this,t);break;case"getQualities":o(this,i,ce).call(this,t,n);break}(r=o(this,i,N).call(this,e))==null||r.resolve()},te=function(){for(const e of ge)o(this,i,u).call(this,"addEventListener",e)},se=function(e){s(this,V).stop(),s(this,a).notify("pause",void 0,e)},ie=function(e){s(this,V).start(),s(this,a).notify("play",void 0,e)},ne=function(e){const{paused:t}=s(this,a).$state;!t()&&!s(this,g)&&s(this,a).notify("playing",void 0,e)},F=function(e,t){const n={buffered:new $(0,e),seekable:s(this,m)};s(this,a).notify("progress",n,t)},ae=function(e){s(this,a).notify("waiting",void 0,e)},oe=function(e){const{paused:t}=s(this,a).$state;t()||s(this,a).notify("playing",void 0,e)},re=function(e){const{paused:t}=s(this,a).$state;t()&&s(this,a).notify("play",void 0,e),s(this,a).notify("waiting",void 0,e)},O=function(e,t,n){const r={volume:e,muted:t};s(this,a).notify("volume-change",r,n)},he=function(e){var r;if(o(this,i,D).call(this),!e.length)return;const t=new we({kind:"chapters",default:!0}),{seekableEnd:n}=s(this,a).$state;for(let l=0;l<e.length;l++){const y=e[l],f=e[l+1];t.addCue(new window.VTTCue(y.startTime,(r=f==null?void 0:f.startTime)!=null?r:n(),y.title))}d(this,C,t),s(this,a).textTracks.add(t)},D=function(){s(this,C)&&(s(this,a).textTracks.remove(s(this,C)),d(this,C,null))},ce=function(e,t){s(this,a).qualities[Y.enableAuto]=e.some(n=>n.id==="auto")?()=>o(this,i,u).call(this,"setQuality","auto"):void 0;for(const n of e){if(n.id==="auto")continue;const r=+n.id.slice(0,-1);isNaN(r)||s(this,a).qualities[A.add]({id:n.id,width:r*(16/9),height:r,codec:"avc1,h.264",bitrate:-1},t)}o(this,i,j).call(this,e.find(n=>n.active),t)},j=function({id:e}={},t){if(!e)return;const n=e==="auto",r=s(this,a).qualities.getById(e);n?(s(this,a).qualities[Y.setAuto](n,t),s(this,a).qualities[A.select](void 0,!0,t)):s(this,a).qualities[A.select](r!=null?r:void 0,!0,t)},le=function(e,t,n){switch(e){case"ready":o(this,i,te).call(this);break;case"loaded":o(this,i,Z).call(this,n);break;case"play":o(this,i,ie).call(this,n);break;case"playProgress":o(this,i,ne).call(this,n);break;case"pause":o(this,i,se).call(this,n);break;case"loadProgress":o(this,i,F).call(this,t.seconds,n);break;case"waiting":o(this,i,re).call(this,n);break;case"bufferstart":o(this,i,ae).call(this,n);break;case"bufferend":o(this,i,oe).call(this,n);break;case"volumechange":o(this,i,O).call(this,t.volume,x(s(this,a).$state.muted),n);break;case"durationchange":d(this,m,new $(0,t.duration)),s(this,a).notify("duration-change",t.duration,n);break;case"playbackratechange":s(this,a).notify("rate-change",t.playbackRate,n);break;case"qualitychange":o(this,i,j).call(this,t,n);break;case"fullscreenchange":d(this,q,t.fullscreen),s(this,a).notify("fullscreen-change",t.fullscreen,n);break;case"enterpictureinpicture":s(this,a).notify("picture-in-picture-change",!0,n);break;case"leavepictureinpicture":s(this,a).notify("picture-in-picture-change",!1,n);break;case"ended":s(this,a).notify("end",void 0,n);break;case"error":o(this,i,ue).call(this,t,n);break;case"seek":case"seeked":o(this,i,X).call(this,t.seconds,n);break}},ue=function(e,t){var l;const{message:n,method:r}=e;r==="setPlaybackRate"&&s(this,v).set(!1),r&&((l=o(this,i,N).call(this,r))==null||l.reject(n))},u=function(e,t){return I(this,null,function*(){let n=W(),r=s(this,w).get(e);return r||s(this,w).set(e,r=[]),r.push(n),this.postMessage({method:e,value:t}),n.promise})},B=function(){s(this,V).stop(),d(this,m,new $(0,0)),d(this,R,null),d(this,M,null),s(this,v).set(!1),o(this,i,D).call(this)},N=function(e){var t;return(t=s(this,w).get(e))==null?void 0:t.shift()};export{Ie as VimeoProvider};
