var zT=Object.defineProperty,YT=Object.defineProperties;var qT=Object.getOwnPropertyDescriptors;var _o=Object.getOwnPropertySymbols;var Lm=Object.prototype.hasOwnProperty,Rm=Object.prototype.propertyIsEnumerable;var _m=Math.pow,Am=(l,e,t)=>e in l?zT(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,ke=(l,e)=>{for(var t in e||(e={}))Lm.call(e,t)&&Am(l,t,e[t]);if(_o)for(var t of _o(e))Rm.call(e,t)&&Am(l,t,e[t]);return l},St=(l,e)=>YT(l,qT(e));var Im=(l,e)=>{var t={};for(var s in l)Lm.call(l,s)&&e.indexOf(s)<0&&(t[s]=l[s]);if(l!=null&&_o)for(var s of _o(l))e.indexOf(s)<0&&Rm.call(l,s)&&(t[s]=l[s]);return t};var XT=(l,e)=>()=>(e||l((e={exports:{}}).exports,e),e.exports);var et=(l,e,t)=>new Promise((s,r)=>{var a=h=>{try{c(t.next(h))}catch(d){r(d)}},u=h=>{try{c(t.throw(h))}catch(d){r(d)}},c=h=>h.done?s(h.value):Promise.resolve(h.value).then(a,u);c((t=t.apply(l,e)).next())});var OL=XT(mt=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();function QT(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var bf={exports:{}},Qa={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dm;function WT(){if(Dm)return Qa;Dm=1;var l=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,r,a){var u=null;if(a!==void 0&&(u=""+a),r.key!==void 0&&(u=""+r.key),"key"in r){a={};for(var c in r)c!=="key"&&(a[c]=r[c])}else a=r;return r=a.ref,{$$typeof:l,type:s,key:u,ref:r!==void 0?r:null,props:a}}return Qa.Fragment=e,Qa.jsx=t,Qa.jsxs=t,Qa}var Cm;function ZT(){return Cm||(Cm=1,bf.exports=WT()),bf.exports}var I=ZT(),Af={exports:{}},Be={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var km;function JT(){if(km)return Be;km=1;var l=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),p=Symbol.iterator;function y(O){return O===null||typeof O!="object"?null:(O=p&&O[p]||O["@@iterator"],typeof O=="function"?O:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,x={};function S(O,$,Y){this.props=O,this.context=$,this.refs=x,this.updater=Y||E}S.prototype.isReactComponent={},S.prototype.setState=function(O,$){if(typeof O!="object"&&typeof O!="function"&&O!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,O,$,"setState")},S.prototype.forceUpdate=function(O){this.updater.enqueueForceUpdate(this,O,"forceUpdate")};function R(){}R.prototype=S.prototype;function _(O,$,Y){this.props=O,this.context=$,this.refs=x,this.updater=Y||E}var A=_.prototype=new R;A.constructor=_,T(A,S.prototype),A.isPureReactComponent=!0;var C=Array.isArray,k={H:null,A:null,T:null,S:null,V:null},G=Object.prototype.hasOwnProperty;function w(O,$,Y,ie,fe,ge){return Y=ge.ref,{$$typeof:l,type:O,key:$,ref:Y!==void 0?Y:null,props:ge}}function P(O,$){return w(O.type,$,void 0,void 0,void 0,O.props)}function B(O){return typeof O=="object"&&O!==null&&O.$$typeof===l}function M(O){var $={"=":"=0",":":"=2"};return"$"+O.replace(/[=:]/g,function(Y){return $[Y]})}var j=/\/+/g;function ee(O,$){return typeof O=="object"&&O!==null&&O.key!=null?M(""+O.key):$.toString(36)}function oe(){}function de(O){switch(O.status){case"fulfilled":return O.value;case"rejected":throw O.reason;default:switch(typeof O.status=="string"?O.then(oe,oe):(O.status="pending",O.then(function($){O.status==="pending"&&(O.status="fulfilled",O.value=$)},function($){O.status==="pending"&&(O.status="rejected",O.reason=$)})),O.status){case"fulfilled":return O.value;case"rejected":throw O.reason}}throw O}function ce(O,$,Y,ie,fe){var ge=typeof O;(ge==="undefined"||ge==="boolean")&&(O=null);var he=!1;if(O===null)he=!0;else switch(ge){case"bigint":case"string":case"number":he=!0;break;case"object":switch(O.$$typeof){case l:case e:he=!0;break;case g:return he=O._init,ce(he(O._payload),$,Y,ie,fe)}}if(he)return fe=fe(O),he=ie===""?"."+ee(O,0):ie,C(fe)?(Y="",he!=null&&(Y=he.replace(j,"$&/")+"/"),ce(fe,$,Y,"",function(ht){return ht})):fe!=null&&(B(fe)&&(fe=P(fe,Y+(fe.key==null||O&&O.key===fe.key?"":(""+fe.key).replace(j,"$&/")+"/")+he)),$.push(fe)),1;he=0;var Pe=ie===""?".":ie+":";if(C(O))for(var be=0;be<O.length;be++)ie=O[be],ge=Pe+ee(ie,be),he+=ce(ie,$,Y,ge,fe);else if(be=y(O),typeof be=="function")for(O=be.call(O),be=0;!(ie=O.next()).done;)ie=ie.value,ge=Pe+ee(ie,be++),he+=ce(ie,$,Y,ge,fe);else if(ge==="object"){if(typeof O.then=="function")return ce(de(O),$,Y,ie,fe);throw $=String(O),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return he}function U(O,$,Y){if(O==null)return O;var ie=[],fe=0;return ce(O,ie,"","",function(ge){return $.call(Y,ge,fe++)}),ie}function X(O){if(O._status===-1){var $=O._result;$=$(),$.then(function(Y){(O._status===0||O._status===-1)&&(O._status=1,O._result=Y)},function(Y){(O._status===0||O._status===-1)&&(O._status=2,O._result=Y)}),O._status===-1&&(O._status=0,O._result=$)}if(O._status===1)return O._result.default;throw O._result}var te=typeof reportError=="function"?reportError:function(O){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof O=="object"&&O!==null&&typeof O.message=="string"?String(O.message):String(O),error:O});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",O);return}console.error(O)};function ue(){}return Be.Children={map:U,forEach:function(O,$,Y){U(O,function(){$.apply(this,arguments)},Y)},count:function(O){var $=0;return U(O,function(){$++}),$},toArray:function(O){return U(O,function($){return $})||[]},only:function(O){if(!B(O))throw Error("React.Children.only expected to receive a single React element child.");return O}},Be.Component=S,Be.Fragment=t,Be.Profiler=r,Be.PureComponent=_,Be.StrictMode=s,Be.Suspense=h,Be.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,Be.__COMPILER_RUNTIME={__proto__:null,c:function(O){return k.H.useMemoCache(O)}},Be.cache=function(O){return function(){return O.apply(null,arguments)}},Be.cloneElement=function(O,$,Y){if(O==null)throw Error("The argument must be a React element, but you passed "+O+".");var ie=T({},O.props),fe=O.key,ge=void 0;if($!=null)for(he in $.ref!==void 0&&(ge=void 0),$.key!==void 0&&(fe=""+$.key),$)!G.call($,he)||he==="key"||he==="__self"||he==="__source"||he==="ref"&&$.ref===void 0||(ie[he]=$[he]);var he=arguments.length-2;if(he===1)ie.children=Y;else if(1<he){for(var Pe=Array(he),be=0;be<he;be++)Pe[be]=arguments[be+2];ie.children=Pe}return w(O.type,fe,void 0,void 0,ge,ie)},Be.createContext=function(O){return O={$$typeof:u,_currentValue:O,_currentValue2:O,_threadCount:0,Provider:null,Consumer:null},O.Provider=O,O.Consumer={$$typeof:a,_context:O},O},Be.createElement=function(O,$,Y){var ie,fe={},ge=null;if($!=null)for(ie in $.key!==void 0&&(ge=""+$.key),$)G.call($,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(fe[ie]=$[ie]);var he=arguments.length-2;if(he===1)fe.children=Y;else if(1<he){for(var Pe=Array(he),be=0;be<he;be++)Pe[be]=arguments[be+2];fe.children=Pe}if(O&&O.defaultProps)for(ie in he=O.defaultProps,he)fe[ie]===void 0&&(fe[ie]=he[ie]);return w(O,ge,void 0,void 0,null,fe)},Be.createRef=function(){return{current:null}},Be.forwardRef=function(O){return{$$typeof:c,render:O}},Be.isValidElement=B,Be.lazy=function(O){return{$$typeof:g,_payload:{_status:-1,_result:O},_init:X}},Be.memo=function(O,$){return{$$typeof:d,type:O,compare:$===void 0?null:$}},Be.startTransition=function(O){var $=k.T,Y={};k.T=Y;try{var ie=O(),fe=k.S;fe!==null&&fe(Y,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then(ue,te)}catch(ge){te(ge)}finally{k.T=$}},Be.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},Be.use=function(O){return k.H.use(O)},Be.useActionState=function(O,$,Y){return k.H.useActionState(O,$,Y)},Be.useCallback=function(O,$){return k.H.useCallback(O,$)},Be.useContext=function(O){return k.H.useContext(O)},Be.useDebugValue=function(){},Be.useDeferredValue=function(O,$){return k.H.useDeferredValue(O,$)},Be.useEffect=function(O,$,Y){var ie=k.H;if(typeof Y=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ie.useEffect(O,$)},Be.useId=function(){return k.H.useId()},Be.useImperativeHandle=function(O,$,Y){return k.H.useImperativeHandle(O,$,Y)},Be.useInsertionEffect=function(O,$){return k.H.useInsertionEffect(O,$)},Be.useLayoutEffect=function(O,$){return k.H.useLayoutEffect(O,$)},Be.useMemo=function(O,$){return k.H.useMemo(O,$)},Be.useOptimistic=function(O,$){return k.H.useOptimistic(O,$)},Be.useReducer=function(O,$,Y){return k.H.useReducer(O,$,Y)},Be.useRef=function(O){return k.H.useRef(O)},Be.useState=function(O){return k.H.useState(O)},Be.useSyncExternalStore=function(O,$,Y){return k.H.useSyncExternalStore(O,$,Y)},Be.useTransition=function(){return k.H.useTransition()},Be.version="19.1.1",Be}var wm;function Ld(){return wm||(wm=1,Af.exports=JT()),Af.exports}var K=Ld();const pt=QT(K);var Lf={exports:{}},Wa={},Rf={exports:{}},_f={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Om;function eS(){return Om||(Om=1,(function(l){function e(U,X){var te=U.length;U.push(X);e:for(;0<te;){var ue=te-1>>>1,O=U[ue];if(0<r(O,X))U[ue]=X,U[te]=O,te=ue;else break e}}function t(U){return U.length===0?null:U[0]}function s(U){if(U.length===0)return null;var X=U[0],te=U.pop();if(te!==X){U[0]=te;e:for(var ue=0,O=U.length,$=O>>>1;ue<$;){var Y=2*(ue+1)-1,ie=U[Y],fe=Y+1,ge=U[fe];if(0>r(ie,te))fe<O&&0>r(ge,ie)?(U[ue]=ge,U[fe]=te,ue=fe):(U[ue]=ie,U[Y]=te,ue=Y);else if(fe<O&&0>r(ge,te))U[ue]=ge,U[fe]=te,ue=fe;else break e}}return X}function r(U,X){var te=U.sortIndex-X.sortIndex;return te!==0?te:U.id-X.id}if(l.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;l.unstable_now=function(){return a.now()}}else{var u=Date,c=u.now();l.unstable_now=function(){return u.now()-c}}var h=[],d=[],g=1,p=null,y=3,E=!1,T=!1,x=!1,S=!1,R=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate!="undefined"?setImmediate:null;function C(U){for(var X=t(d);X!==null;){if(X.callback===null)s(d);else if(X.startTime<=U)s(d),X.sortIndex=X.expirationTime,e(h,X);else break;X=t(d)}}function k(U){if(x=!1,C(U),!T)if(t(h)!==null)T=!0,G||(G=!0,ee());else{var X=t(d);X!==null&&ce(k,X.startTime-U)}}var G=!1,w=-1,P=5,B=-1;function M(){return S?!0:!(l.unstable_now()-B<P)}function j(){if(S=!1,G){var U=l.unstable_now();B=U;var X=!0;try{e:{T=!1,x&&(x=!1,_(w),w=-1),E=!0;var te=y;try{t:{for(C(U),p=t(h);p!==null&&!(p.expirationTime>U&&M());){var ue=p.callback;if(typeof ue=="function"){p.callback=null,y=p.priorityLevel;var O=ue(p.expirationTime<=U);if(U=l.unstable_now(),typeof O=="function"){p.callback=O,C(U),X=!0;break t}p===t(h)&&s(h),C(U)}else s(h);p=t(h)}if(p!==null)X=!0;else{var $=t(d);$!==null&&ce(k,$.startTime-U),X=!1}}break e}finally{p=null,y=te,E=!1}X=void 0}}finally{X?ee():G=!1}}}var ee;if(typeof A=="function")ee=function(){A(j)};else if(typeof MessageChannel!="undefined"){var oe=new MessageChannel,de=oe.port2;oe.port1.onmessage=j,ee=function(){de.postMessage(null)}}else ee=function(){R(j,0)};function ce(U,X){w=R(function(){U(l.unstable_now())},X)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(U){U.callback=null},l.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<U?Math.floor(1e3/U):5},l.unstable_getCurrentPriorityLevel=function(){return y},l.unstable_next=function(U){switch(y){case 1:case 2:case 3:var X=3;break;default:X=y}var te=y;y=X;try{return U()}finally{y=te}},l.unstable_requestPaint=function(){S=!0},l.unstable_runWithPriority=function(U,X){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var te=y;y=U;try{return X()}finally{y=te}},l.unstable_scheduleCallback=function(U,X,te){var ue=l.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?ue+te:ue):te=ue,U){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=te+O,U={id:g++,callback:X,priorityLevel:U,startTime:te,expirationTime:O,sortIndex:-1},te>ue?(U.sortIndex=te,e(d,U),t(h)===null&&U===t(d)&&(x?(_(w),w=-1):x=!0,ce(k,te-ue))):(U.sortIndex=O,e(h,U),T||E||(T=!0,G||(G=!0,ee()))),U},l.unstable_shouldYield=M,l.unstable_wrapCallback=function(U){var X=y;return function(){var te=y;y=X;try{return U.apply(this,arguments)}finally{y=te}}}})(_f)),_f}var Mm;function tS(){return Mm||(Mm=1,Rf.exports=eS()),Rf.exports}var If={exports:{}},rs={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nm;function sS(){if(Nm)return rs;Nm=1;var l=Ld();function e(h){var d="https://react.dev/errors/"+h;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)d+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+h+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function a(h,d,g){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:p==null?null:""+p,children:h,containerInfo:d,implementation:g}}var u=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(h,d){if(h==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return rs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,rs.createPortal=function(h,d){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return a(h,d,null,g)},rs.flushSync=function(h){var d=u.T,g=s.p;try{if(u.T=null,s.p=2,h)return h()}finally{u.T=d,s.p=g,s.d.f()}},rs.preconnect=function(h,d){typeof h=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,s.d.C(h,d))},rs.prefetchDNS=function(h){typeof h=="string"&&s.d.D(h)},rs.preinit=function(h,d){if(typeof h=="string"&&d&&typeof d.as=="string"){var g=d.as,p=c(g,d.crossOrigin),y=typeof d.integrity=="string"?d.integrity:void 0,E=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;g==="style"?s.d.S(h,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:p,integrity:y,fetchPriority:E}):g==="script"&&s.d.X(h,{crossOrigin:p,integrity:y,fetchPriority:E,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},rs.preinitModule=function(h,d){if(typeof h=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var g=c(d.as,d.crossOrigin);s.d.M(h,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&s.d.M(h)},rs.preload=function(h,d){if(typeof h=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var g=d.as,p=c(g,d.crossOrigin);s.d.L(h,g,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},rs.preloadModule=function(h,d){if(typeof h=="string")if(d){var g=c(d.as,d.crossOrigin);s.d.m(h,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else s.d.m(h)},rs.requestFormReset=function(h){s.d.r(h)},rs.unstable_batchedUpdates=function(h,d){return h(d)},rs.useFormState=function(h,d,g){return u.H.useFormState(h,d,g)},rs.useFormStatus=function(){return u.H.useHostTransitionStatus()},rs.version="19.1.1",rs}var Pm;function iS(){if(Pm)return If.exports;Pm=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(e){console.error(e)}}return l(),If.exports=sS(),If.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Um;function nS(){if(Um)return Wa;Um=1;var l=tS(),e=Ld(),t=iS();function s(i){var n="https://react.dev/errors/"+i;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)n+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+i+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function a(i){var n=i,o=i;if(i.alternate)for(;n.return;)n=n.return;else{i=n;do n=i,(n.flags&4098)!==0&&(o=n.return),i=n.return;while(i)}return n.tag===3?o:null}function u(i){if(i.tag===13){var n=i.memoizedState;if(n===null&&(i=i.alternate,i!==null&&(n=i.memoizedState)),n!==null)return n.dehydrated}return null}function c(i){if(a(i)!==i)throw Error(s(188))}function h(i){var n=i.alternate;if(!n){if(n=a(i),n===null)throw Error(s(188));return n!==i?null:i}for(var o=i,f=n;;){var m=o.return;if(m===null)break;var v=m.alternate;if(v===null){if(f=m.return,f!==null){o=f;continue}break}if(m.child===v.child){for(v=m.child;v;){if(v===o)return c(m),i;if(v===f)return c(m),n;v=v.sibling}throw Error(s(188))}if(o.return!==f.return)o=m,f=v;else{for(var L=!1,D=m.child;D;){if(D===o){L=!0,o=m,f=v;break}if(D===f){L=!0,f=m,o=v;break}D=D.sibling}if(!L){for(D=v.child;D;){if(D===o){L=!0,o=v,f=m;break}if(D===f){L=!0,f=v,o=m;break}D=D.sibling}if(!L)throw Error(s(189))}}if(o.alternate!==f)throw Error(s(190))}if(o.tag!==3)throw Error(s(188));return o.stateNode.current===o?i:n}function d(i){var n=i.tag;if(n===5||n===26||n===27||n===6)return i;for(i=i.child;i!==null;){if(n=d(i),n!==null)return n;i=i.sibling}return null}var g=Object.assign,p=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),_=Symbol.for("react.consumer"),A=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),w=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),B=Symbol.for("react.activity"),M=Symbol.for("react.memo_cache_sentinel"),j=Symbol.iterator;function ee(i){return i===null||typeof i!="object"?null:(i=j&&i[j]||i["@@iterator"],typeof i=="function"?i:null)}var oe=Symbol.for("react.client.reference");function de(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===oe?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case T:return"Fragment";case S:return"Profiler";case x:return"StrictMode";case k:return"Suspense";case G:return"SuspenseList";case B:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case E:return"Portal";case A:return(i.displayName||"Context")+".Provider";case _:return(i._context.displayName||"Context")+".Consumer";case C:var n=i.render;return i=i.displayName,i||(i=n.displayName||n.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case w:return n=i.displayName||null,n!==null?n:de(i.type)||"Memo";case P:n=i._payload,i=i._init;try{return de(i(n))}catch(o){}}return null}var ce=Array.isArray,U=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},ue=[],O=-1;function $(i){return{current:i}}function Y(i){0>O||(i.current=ue[O],ue[O]=null,O--)}function ie(i,n){O++,ue[O]=i.current,i.current=n}var fe=$(null),ge=$(null),he=$(null),Pe=$(null);function be(i,n){switch(ie(he,n),ie(ge,i),ie(fe,null),n.nodeType){case 9:case 11:i=(i=n.documentElement)&&(i=i.namespaceURI)?Z0(i):0;break;default:if(i=n.tagName,n=n.namespaceURI)n=Z0(n),i=J0(n,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}Y(fe),ie(fe,i)}function ht(){Y(fe),Y(ge),Y(he)}function tt(i){i.memoizedState!==null&&ie(Pe,i);var n=fe.current,o=J0(n,i.type);n!==o&&(ie(ge,i),ie(fe,o))}function Pt(i){ge.current===i&&(Y(fe),Y(ge)),Pe.current===i&&(Y(Pe),Ka._currentValue=te)}var xs=Object.prototype.hasOwnProperty,fs=l.unstable_scheduleCallback,Ut=l.unstable_cancelCallback,Wn=l.unstable_shouldYield,Fe=l.unstable_requestPaint,We=l.unstable_now,It=l.unstable_getCurrentPriorityLevel,ss=l.unstable_ImmediatePriority,st=l.unstable_UserBlockingPriority,as=l.unstable_NormalPriority,Wt=l.unstable_LowPriority,bs=l.unstable_IdlePriority,se=l.log,ye=l.unstable_setDisableYieldValue,Ae=null,pe=null;function _e(i){if(typeof se=="function"&&ye(i),pe&&typeof pe.setStrictMode=="function")try{pe.setStrictMode(Ae,i)}catch(n){}}var Oe=Math.clz32?Math.clz32:ni,Ze=Math.log,xt=Math.LN2;function ni(i){return i>>>=0,i===0?32:31-(Ze(i)/xt|0)|0}var Zn=256,ri=4194304;function xi(i){var n=i&42;if(n!==0)return n;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function ai(i,n,o){var f=i.pendingLanes;if(f===0)return 0;var m=0,v=i.suspendedLanes,L=i.pingedLanes;i=i.warmLanes;var D=f&134217727;return D!==0?(f=D&~v,f!==0?m=xi(f):(L&=D,L!==0?m=xi(L):o||(o=D&~i,o!==0&&(m=xi(o))))):(D=f&~v,D!==0?m=xi(D):L!==0?m=xi(L):o||(o=f&~i,o!==0&&(m=xi(o)))),m===0?0:n!==0&&n!==m&&(n&v)===0&&(v=m&-m,o=n&-n,v>=o||v===32&&(o&4194048)!==0)?n:m}function Rn(i,n){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&n)===0}function Jn(i,n){switch(i){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Jr(){var i=Zn;return Zn<<=1,(Zn&4194048)===0&&(Zn=256),i}function ea(){var i=ri;return ri<<=1,(ri&62914560)===0&&(ri=4194304),i}function er(i){for(var n=[],o=0;31>o;o++)n.push(i);return n}function li(i,n){i.pendingLanes|=n,n!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function gl(i,n,o,f,m,v){var L=i.pendingLanes;i.pendingLanes=o,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=o,i.entangledLanes&=o,i.errorRecoveryDisabledLanes&=o,i.shellSuspendCounter=0;var D=i.entanglements,N=i.expirationTimes,Q=i.hiddenUpdates;for(o=L&~o;0<o;){var ne=31-Oe(o),le=1<<ne;D[ne]=0,N[ne]=-1;var W=Q[ne];if(W!==null)for(Q[ne]=null,ne=0;ne<W.length;ne++){var Z=W[ne];Z!==null&&(Z.lane&=-536870913)}o&=~le}f!==0&&Bs(i,f,0),v!==0&&m===0&&i.tag!==0&&(i.suspendedLanes|=v&~(L&~n))}function Bs(i,n,o){i.pendingLanes|=n,i.suspendedLanes&=~n;var f=31-Oe(n);i.entangledLanes|=n,i.entanglements[f]=i.entanglements[f]|1073741824|o&4194090}function Vi(i,n){var o=i.entangledLanes|=n;for(i=i.entanglements;o;){var f=31-Oe(o),m=1<<f;m&n|i[f]&n&&(i[f]|=n),o&=~m}}function ds(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function hs(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Ki(){var i=X.p;return i!==0?i:(i=window.event,i===void 0?32:vm(i.type))}function tr(i,n){var o=X.p;try{return X.p=i,n()}finally{X.p=o}}var As=Math.random().toString(36).slice(2),wt="__reactFiber$"+As,is="__reactProps$"+As,Fs="__reactContainer$"+As,gs="__reactEvents$"+As,vu="__reactListeners$"+As,Eu="__reactHandles$"+As,ml="__reactResources$"+As,zi="__reactMarker$"+As;function Yi(i){delete i[wt],delete i[is],delete i[gs],delete i[vu],delete i[Eu]}function Ls(i){var n=i[wt];if(n)return n;for(var o=i.parentNode;o;){if(n=o[Fs]||o[wt]){if(o=n.alternate,n.child!==null||o!==null&&o.child!==null)for(i=im(i);i!==null;){if(o=i[wt])return o;i=im(i)}return n}i=o,o=i.parentNode}return null}function $s(i){if(i=i[wt]||i[Fs]){var n=i.tag;if(n===5||n===6||n===13||n===26||n===27||n===3)return i}return null}function Gt(i){var n=i.tag;if(n===5||n===26||n===27||n===6)return i.stateNode;throw Error(s(33))}function oi(i){var n=i[ml];return n||(n=i[ml]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function bt(i){i[zi]=!0}var pl=new Set,yl={};function bi(i,n){qi(i,n),qi(i+"Capture",n)}function qi(i,n){for(yl[i]=n,i=0;i<n.length;i++)pl.add(n[i])}var Tu=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ta={},vl={};function sr(i){return xs.call(vl,i)?!0:xs.call(ta,i)?!1:Tu.test(i)?vl[i]=!0:(ta[i]=!0,!1)}function _n(i,n,o){if(sr(n))if(o===null)i.removeAttribute(n);else{switch(typeof o){case"undefined":case"function":case"symbol":i.removeAttribute(n);return;case"boolean":var f=n.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){i.removeAttribute(n);return}}i.setAttribute(n,""+o)}}function ir(i,n,o){if(o===null)i.removeAttribute(n);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(n);return}i.setAttribute(n,""+o)}}function Zs(i,n,o,f){if(f===null)i.removeAttribute(o);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(o);return}i.setAttributeNS(n,o,""+f)}}var nr,In;function Ai(i){if(nr===void 0)try{throw Error()}catch(o){var n=o.stack.trim().match(/\n( *(at )?)/);nr=n&&n[1]||"",In=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+nr+i+In}var Xi=!1;function sa(i,n){if(!i||Xi)return"";Xi=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(n){var le=function(){throw Error()};if(Object.defineProperty(le.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(le,[])}catch(Z){var W=Z}Reflect.construct(i,[],le)}else{try{le.call()}catch(Z){W=Z}i.call(le.prototype)}}else{try{throw Error()}catch(Z){W=Z}(le=i())&&typeof le.catch=="function"&&le.catch(function(){})}}catch(Z){if(Z&&W&&typeof Z.stack=="string")return[Z.stack,W.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=f.DetermineComponentFrameRoot(),L=v[0],D=v[1];if(L&&D){var N=L.split(`
`),Q=D.split(`
`);for(m=f=0;f<N.length&&!N[f].includes("DetermineComponentFrameRoot");)f++;for(;m<Q.length&&!Q[m].includes("DetermineComponentFrameRoot");)m++;if(f===N.length||m===Q.length)for(f=N.length-1,m=Q.length-1;1<=f&&0<=m&&N[f]!==Q[m];)m--;for(;1<=f&&0<=m;f--,m--)if(N[f]!==Q[m]){if(f!==1||m!==1)do if(f--,m--,0>m||N[f]!==Q[m]){var ne=`
`+N[f].replace(" at new "," at ");return i.displayName&&ne.includes("<anonymous>")&&(ne=ne.replace("<anonymous>",i.displayName)),ne}while(1<=f&&0<=m);break}}}finally{Xi=!1,Error.prepareStackTrace=o}return(o=i?i.displayName||i.name:"")?Ai(o):""}function El(i){switch(i.tag){case 26:case 27:case 5:return Ai(i.type);case 16:return Ai("Lazy");case 13:return Ai("Suspense");case 19:return Ai("SuspenseList");case 0:case 15:return sa(i.type,!1);case 11:return sa(i.type.render,!1);case 1:return sa(i.type,!0);case 31:return Ai("Activity");default:return""}}function ia(i){try{var n="";do n+=El(i),i=i.return;while(i);return n}catch(o){return`
Error generating stack: `+o.message+`
`+o.stack}}function J(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Se(i){var n=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function $e(i){var n=Se(i)?"checked":"value",o=Object.getOwnPropertyDescriptor(i.constructor.prototype,n),f=""+i[n];if(!i.hasOwnProperty(n)&&typeof o!="undefined"&&typeof o.get=="function"&&typeof o.set=="function"){var m=o.get,v=o.set;return Object.defineProperty(i,n,{configurable:!0,get:function(){return m.call(this)},set:function(L){f=""+L,v.call(this,L)}}),Object.defineProperty(i,n,{enumerable:o.enumerable}),{getValue:function(){return f},setValue:function(L){f=""+L},stopTracking:function(){i._valueTracker=null,delete i[n]}}}}function me(i){i._valueTracker||(i._valueTracker=$e(i))}function Ue(i){if(!i)return!1;var n=i._valueTracker;if(!n)return!0;var o=n.getValue(),f="";return i&&(f=Se(i)?i.checked?"true":"false":i.value),i=f,i!==o?(n.setValue(i),!0):!1}function Ie(i){if(i=i||(typeof document!="undefined"?document:void 0),typeof i=="undefined")return null;try{return i.activeElement||i.body}catch(n){return i.body}}var qe=/[\n"\\]/g;function Ke(i){return i.replace(qe,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function Gs(i,n,o,f,m,v,L,D){i.name="",L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?i.type=L:i.removeAttribute("type"),n!=null?L==="number"?(n===0&&i.value===""||i.value!=n)&&(i.value=""+J(n)):i.value!==""+J(n)&&(i.value=""+J(n)):L!=="submit"&&L!=="reset"||i.removeAttribute("value"),n!=null?nt(i,L,J(n)):o!=null?nt(i,L,J(o)):f!=null&&i.removeAttribute("value"),m==null&&v!=null&&(i.defaultChecked=!!v),m!=null&&(i.checked=m&&typeof m!="function"&&typeof m!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?i.name=""+J(D):i.removeAttribute("name")}function it(i,n,o,f,m,v,L,D){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(i.type=v),n!=null||o!=null){if(!(v!=="submit"&&v!=="reset"||n!=null))return;o=o!=null?""+J(o):"",n=n!=null?""+J(n):o,D||n===i.value||(i.value=n),i.defaultValue=n}f=f!=null?f:m,f=typeof f!="function"&&typeof f!="symbol"&&!!f,i.checked=D?i.checked:!!f,i.defaultChecked=!!f,L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(i.name=L)}function nt(i,n,o){n==="number"&&Ie(i.ownerDocument)===i||i.defaultValue===""+o||(i.defaultValue=""+o)}function Et(i,n,o,f){if(i=i.options,n){n={};for(var m=0;m<o.length;m++)n["$"+o[m]]=!0;for(o=0;o<i.length;o++)m=n.hasOwnProperty("$"+i[o].value),i[o].selected!==m&&(i[o].selected=m),m&&f&&(i[o].defaultSelected=!0)}else{for(o=""+J(o),n=null,m=0;m<i.length;m++){if(i[m].value===o){i[m].selected=!0,f&&(i[m].defaultSelected=!0);return}n!==null||i[m].disabled||(n=i[m])}n!==null&&(n.selected=!0)}}function rr(i,n,o){if(n!=null&&(n=""+J(n),n!==i.value&&(i.value=n),o==null)){i.defaultValue!==n&&(i.defaultValue=n);return}i.defaultValue=o!=null?""+J(o):""}function Wd(i,n,o,f){if(n==null){if(f!=null){if(o!=null)throw Error(s(92));if(ce(f)){if(1<f.length)throw Error(s(93));f=f[0]}o=f}o==null&&(o=""),n=o}o=J(n),i.defaultValue=o,f=i.textContent,f===o&&f!==""&&f!==null&&(i.value=f)}function ar(i,n){if(n){var o=i.firstChild;if(o&&o===i.lastChild&&o.nodeType===3){o.nodeValue=n;return}}i.textContent=n}var Hv=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Zd(i,n,o){var f=n.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?f?i.setProperty(n,""):n==="float"?i.cssFloat="":i[n]="":f?i.setProperty(n,o):typeof o!="number"||o===0||Hv.has(n)?n==="float"?i.cssFloat=o:i[n]=(""+o).trim():i[n]=o+"px"}function Jd(i,n,o){if(n!=null&&typeof n!="object")throw Error(s(62));if(i=i.style,o!=null){for(var f in o)!o.hasOwnProperty(f)||n!=null&&n.hasOwnProperty(f)||(f.indexOf("--")===0?i.setProperty(f,""):f==="float"?i.cssFloat="":i[f]="");for(var m in n)f=n[m],n.hasOwnProperty(m)&&o[m]!==f&&Zd(i,m,f)}else for(var v in n)n.hasOwnProperty(v)&&Zd(i,v,n[v])}function Su(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Vv=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Kv=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Tl(i){return Kv.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var xu=null;function bu(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var lr=null,or=null;function eh(i){var n=$s(i);if(n&&(i=n.stateNode)){var o=i[is]||null;e:switch(i=n.stateNode,n.type){case"input":if(Gs(i,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),n=o.name,o.type==="radio"&&n!=null){for(o=i;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+Ke(""+n)+'"][type="radio"]'),n=0;n<o.length;n++){var f=o[n];if(f!==i&&f.form===i.form){var m=f[is]||null;if(!m)throw Error(s(90));Gs(f,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(n=0;n<o.length;n++)f=o[n],f.form===i.form&&Ue(f)}break e;case"textarea":rr(i,o.value,o.defaultValue);break e;case"select":n=o.value,n!=null&&Et(i,!!o.multiple,n,!1)}}}var Au=!1;function th(i,n,o){if(Au)return i(n,o);Au=!0;try{var f=i(n);return f}finally{if(Au=!1,(lr!==null||or!==null)&&(ro(),lr&&(n=lr,i=or,or=lr=null,eh(n),i)))for(n=0;n<i.length;n++)eh(i[n])}}function na(i,n){var o=i.stateNode;if(o===null)return null;var f=o[is]||null;if(f===null)return null;o=f[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(i=i.type,f=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!f;break e;default:i=!1}if(i)return null;if(o&&typeof o!="function")throw Error(s(231,n,typeof o));return o}var Li=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),Lu=!1;if(Li)try{var ra={};Object.defineProperty(ra,"passive",{get:function(){Lu=!0}}),window.addEventListener("test",ra,ra),window.removeEventListener("test",ra,ra)}catch(i){Lu=!1}var Qi=null,Ru=null,Sl=null;function sh(){if(Sl)return Sl;var i,n=Ru,o=n.length,f,m="value"in Qi?Qi.value:Qi.textContent,v=m.length;for(i=0;i<o&&n[i]===m[i];i++);var L=o-i;for(f=1;f<=L&&n[o-f]===m[v-f];f++);return Sl=m.slice(i,1<f?1-f:void 0)}function xl(i){var n=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&n===13&&(i=13)):i=n,i===10&&(i=13),32<=i||i===13?i:0}function bl(){return!0}function ih(){return!1}function ms(i){function n(o,f,m,v,L){this._reactName=o,this._targetInst=m,this.type=f,this.nativeEvent=v,this.target=L,this.currentTarget=null;for(var D in i)i.hasOwnProperty(D)&&(o=i[D],this[D]=o?o(v):v[D]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?bl:ih,this.isPropagationStopped=ih,this}return g(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=bl)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=bl)},persist:function(){},isPersistent:bl}),n}var Dn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Al=ms(Dn),aa=g({},Dn,{view:0,detail:0}),zv=ms(aa),_u,Iu,la,Ll=g({},aa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cu,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==la&&(la&&i.type==="mousemove"?(_u=i.screenX-la.screenX,Iu=i.screenY-la.screenY):Iu=_u=0,la=i),_u)},movementY:function(i){return"movementY"in i?i.movementY:Iu}}),nh=ms(Ll),Yv=g({},Ll,{dataTransfer:0}),qv=ms(Yv),Xv=g({},aa,{relatedTarget:0}),Du=ms(Xv),Qv=g({},Dn,{animationName:0,elapsedTime:0,pseudoElement:0}),Wv=ms(Qv),Zv=g({},Dn,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Jv=ms(Zv),eE=g({},Dn,{data:0}),rh=ms(eE),tE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},sE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},iE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function nE(i){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(i):(i=iE[i])?!!n[i]:!1}function Cu(){return nE}var rE=g({},aa,{key:function(i){if(i.key){var n=tE[i.key]||i.key;if(n!=="Unidentified")return n}return i.type==="keypress"?(i=xl(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?sE[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cu,charCode:function(i){return i.type==="keypress"?xl(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?xl(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),aE=ms(rE),lE=g({},Ll,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ah=ms(lE),oE=g({},aa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cu}),uE=ms(oE),cE=g({},Dn,{propertyName:0,elapsedTime:0,pseudoElement:0}),fE=ms(cE),dE=g({},Ll,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),hE=ms(dE),gE=g({},Dn,{newState:0,oldState:0}),mE=ms(gE),pE=[9,13,27,32],ku=Li&&"CompositionEvent"in window,oa=null;Li&&"documentMode"in document&&(oa=document.documentMode);var yE=Li&&"TextEvent"in window&&!oa,lh=Li&&(!ku||oa&&8<oa&&11>=oa),oh=" ",uh=!1;function ch(i,n){switch(i){case"keyup":return pE.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fh(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var ur=!1;function vE(i,n){switch(i){case"compositionend":return fh(n);case"keypress":return n.which!==32?null:(uh=!0,oh);case"textInput":return i=n.data,i===oh&&uh?null:i;default:return null}}function EE(i,n){if(ur)return i==="compositionend"||!ku&&ch(i,n)?(i=sh(),Sl=Ru=Qi=null,ur=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return lh&&n.locale!=="ko"?null:n.data;default:return null}}var TE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function dh(i){var n=i&&i.nodeName&&i.nodeName.toLowerCase();return n==="input"?!!TE[i.type]:n==="textarea"}function hh(i,n,o,f){lr?or?or.push(f):or=[f]:lr=f,n=fo(n,"onChange"),0<n.length&&(o=new Al("onChange","change",null,o,f),i.push({event:o,listeners:n}))}var ua=null,ca=null;function SE(i){Y0(i,0)}function Rl(i){var n=Gt(i);if(Ue(n))return i}function gh(i,n){if(i==="change")return n}var mh=!1;if(Li){var wu;if(Li){var Ou="oninput"in document;if(!Ou){var ph=document.createElement("div");ph.setAttribute("oninput","return;"),Ou=typeof ph.oninput=="function"}wu=Ou}else wu=!1;mh=wu&&(!document.documentMode||9<document.documentMode)}function yh(){ua&&(ua.detachEvent("onpropertychange",vh),ca=ua=null)}function vh(i){if(i.propertyName==="value"&&Rl(ca)){var n=[];hh(n,ca,i,bu(i)),th(SE,n)}}function xE(i,n,o){i==="focusin"?(yh(),ua=n,ca=o,ua.attachEvent("onpropertychange",vh)):i==="focusout"&&yh()}function bE(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Rl(ca)}function AE(i,n){if(i==="click")return Rl(n)}function LE(i,n){if(i==="input"||i==="change")return Rl(n)}function RE(i,n){return i===n&&(i!==0||1/i===1/n)||i!==i&&n!==n}var Rs=typeof Object.is=="function"?Object.is:RE;function fa(i,n){if(Rs(i,n))return!0;if(typeof i!="object"||i===null||typeof n!="object"||n===null)return!1;var o=Object.keys(i),f=Object.keys(n);if(o.length!==f.length)return!1;for(f=0;f<o.length;f++){var m=o[f];if(!xs.call(n,m)||!Rs(i[m],n[m]))return!1}return!0}function Eh(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Th(i,n){var o=Eh(i);i=0;for(var f;o;){if(o.nodeType===3){if(f=i+o.textContent.length,i<=n&&f>=n)return{node:o,offset:n-i};i=f}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Eh(o)}}function Sh(i,n){return i&&n?i===n?!0:i&&i.nodeType===3?!1:n&&n.nodeType===3?Sh(i,n.parentNode):"contains"in i?i.contains(n):i.compareDocumentPosition?!!(i.compareDocumentPosition(n)&16):!1:!1}function xh(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var n=Ie(i.document);n instanceof i.HTMLIFrameElement;){try{var o=typeof n.contentWindow.location.href=="string"}catch(f){o=!1}if(o)i=n.contentWindow;else break;n=Ie(i.document)}return n}function Mu(i){var n=i&&i.nodeName&&i.nodeName.toLowerCase();return n&&(n==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||n==="textarea"||i.contentEditable==="true")}var _E=Li&&"documentMode"in document&&11>=document.documentMode,cr=null,Nu=null,da=null,Pu=!1;function bh(i,n,o){var f=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Pu||cr==null||cr!==Ie(f)||(f=cr,"selectionStart"in f&&Mu(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),da&&fa(da,f)||(da=f,f=fo(Nu,"onSelect"),0<f.length&&(n=new Al("onSelect","select",null,n,o),i.push({event:n,listeners:f}),n.target=cr)))}function Cn(i,n){var o={};return o[i.toLowerCase()]=n.toLowerCase(),o["Webkit"+i]="webkit"+n,o["Moz"+i]="moz"+n,o}var fr={animationend:Cn("Animation","AnimationEnd"),animationiteration:Cn("Animation","AnimationIteration"),animationstart:Cn("Animation","AnimationStart"),transitionrun:Cn("Transition","TransitionRun"),transitionstart:Cn("Transition","TransitionStart"),transitioncancel:Cn("Transition","TransitionCancel"),transitionend:Cn("Transition","TransitionEnd")},Uu={},Ah={};Li&&(Ah=document.createElement("div").style,"AnimationEvent"in window||(delete fr.animationend.animation,delete fr.animationiteration.animation,delete fr.animationstart.animation),"TransitionEvent"in window||delete fr.transitionend.transition);function kn(i){if(Uu[i])return Uu[i];if(!fr[i])return i;var n=fr[i],o;for(o in n)if(n.hasOwnProperty(o)&&o in Ah)return Uu[i]=n[o];return i}var Lh=kn("animationend"),Rh=kn("animationiteration"),_h=kn("animationstart"),IE=kn("transitionrun"),DE=kn("transitionstart"),CE=kn("transitioncancel"),Ih=kn("transitionend"),Dh=new Map,Bu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Bu.push("scrollEnd");function Js(i,n){Dh.set(i,n),bi(n,[i])}var Ch=new WeakMap;function js(i,n){if(typeof i=="object"&&i!==null){var o=Ch.get(i);return o!==void 0?o:(n={value:i,source:n,stack:ia(n)},Ch.set(i,n),n)}return{value:i,source:n,stack:ia(n)}}var Hs=[],dr=0,Fu=0;function _l(){for(var i=dr,n=Fu=dr=0;n<i;){var o=Hs[n];Hs[n++]=null;var f=Hs[n];Hs[n++]=null;var m=Hs[n];Hs[n++]=null;var v=Hs[n];if(Hs[n++]=null,f!==null&&m!==null){var L=f.pending;L===null?m.next=m:(m.next=L.next,L.next=m),f.pending=m}v!==0&&kh(o,m,v)}}function Il(i,n,o,f){Hs[dr++]=i,Hs[dr++]=n,Hs[dr++]=o,Hs[dr++]=f,Fu|=f,i.lanes|=f,i=i.alternate,i!==null&&(i.lanes|=f)}function $u(i,n,o,f){return Il(i,n,o,f),Dl(i)}function hr(i,n){return Il(i,null,null,n),Dl(i)}function kh(i,n,o){i.lanes|=o;var f=i.alternate;f!==null&&(f.lanes|=o);for(var m=!1,v=i.return;v!==null;)v.childLanes|=o,f=v.alternate,f!==null&&(f.childLanes|=o),v.tag===22&&(i=v.stateNode,i===null||i._visibility&1||(m=!0)),i=v,v=v.return;return i.tag===3?(v=i.stateNode,m&&n!==null&&(m=31-Oe(o),i=v.hiddenUpdates,f=i[m],f===null?i[m]=[n]:f.push(n),n.lane=o|536870912),v):null}function Dl(i){if(50<Ua)throw Ua=0,zc=null,Error(s(185));for(var n=i.return;n!==null;)i=n,n=i.return;return i.tag===3?i.stateNode:null}var gr={};function kE(i,n,o,f){this.tag=i,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _s(i,n,o,f){return new kE(i,n,o,f)}function Gu(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Ri(i,n){var o=i.alternate;return o===null?(o=_s(i.tag,n,i.key,i.mode),o.elementType=i.elementType,o.type=i.type,o.stateNode=i.stateNode,o.alternate=i,i.alternate=o):(o.pendingProps=n,o.type=i.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=i.flags&65011712,o.childLanes=i.childLanes,o.lanes=i.lanes,o.child=i.child,o.memoizedProps=i.memoizedProps,o.memoizedState=i.memoizedState,o.updateQueue=i.updateQueue,n=i.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},o.sibling=i.sibling,o.index=i.index,o.ref=i.ref,o.refCleanup=i.refCleanup,o}function wh(i,n){i.flags&=65011714;var o=i.alternate;return o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),i}function Cl(i,n,o,f,m,v){var L=0;if(f=i,typeof i=="function")Gu(i)&&(L=1);else if(typeof i=="string")L=OT(i,o,fe.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case B:return i=_s(31,o,n,m),i.elementType=B,i.lanes=v,i;case T:return wn(o.children,m,v,n);case x:L=8,m|=24;break;case S:return i=_s(12,o,n,m|2),i.elementType=S,i.lanes=v,i;case k:return i=_s(13,o,n,m),i.elementType=k,i.lanes=v,i;case G:return i=_s(19,o,n,m),i.elementType=G,i.lanes=v,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case R:case A:L=10;break e;case _:L=9;break e;case C:L=11;break e;case w:L=14;break e;case P:L=16,f=null;break e}L=29,o=Error(s(130,i===null?"null":typeof i,"")),f=null}return n=_s(L,o,n,m),n.elementType=i,n.type=f,n.lanes=v,n}function wn(i,n,o,f){return i=_s(7,i,f,n),i.lanes=o,i}function ju(i,n,o){return i=_s(6,i,null,n),i.lanes=o,i}function Hu(i,n,o){return n=_s(4,i.children!==null?i.children:[],i.key,n),n.lanes=o,n.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},n}var mr=[],pr=0,kl=null,wl=0,Vs=[],Ks=0,On=null,_i=1,Ii="";function Mn(i,n){mr[pr++]=wl,mr[pr++]=kl,kl=i,wl=n}function Oh(i,n,o){Vs[Ks++]=_i,Vs[Ks++]=Ii,Vs[Ks++]=On,On=i;var f=_i;i=Ii;var m=32-Oe(f)-1;f&=~(1<<m),o+=1;var v=32-Oe(n)+m;if(30<v){var L=m-m%5;v=(f&(1<<L)-1).toString(32),f>>=L,m-=L,_i=1<<32-Oe(n)+m|o<<m|f,Ii=v+i}else _i=1<<v|o<<m|f,Ii=i}function Vu(i){i.return!==null&&(Mn(i,1),Oh(i,1,0))}function Ku(i){for(;i===kl;)kl=mr[--pr],mr[pr]=null,wl=mr[--pr],mr[pr]=null;for(;i===On;)On=Vs[--Ks],Vs[Ks]=null,Ii=Vs[--Ks],Vs[Ks]=null,_i=Vs[--Ks],Vs[Ks]=null}var ls=null,Dt=null,Je=!1,Nn=null,ui=!1,zu=Error(s(519));function Pn(i){var n=Error(s(418,""));throw ma(js(n,i)),zu}function Mh(i){var n=i.stateNode,o=i.type,f=i.memoizedProps;switch(n[wt]=i,n[is]=f,o){case"dialog":Ye("cancel",n),Ye("close",n);break;case"iframe":case"object":case"embed":Ye("load",n);break;case"video":case"audio":for(o=0;o<Fa.length;o++)Ye(Fa[o],n);break;case"source":Ye("error",n);break;case"img":case"image":case"link":Ye("error",n),Ye("load",n);break;case"details":Ye("toggle",n);break;case"input":Ye("invalid",n),it(n,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0),me(n);break;case"select":Ye("invalid",n);break;case"textarea":Ye("invalid",n),Wd(n,f.value,f.defaultValue,f.children),me(n)}o=f.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||n.textContent===""+o||f.suppressHydrationWarning===!0||W0(n.textContent,o)?(f.popover!=null&&(Ye("beforetoggle",n),Ye("toggle",n)),f.onScroll!=null&&Ye("scroll",n),f.onScrollEnd!=null&&Ye("scrollend",n),f.onClick!=null&&(n.onclick=ho),n=!0):n=!1,n||Pn(i)}function Nh(i){for(ls=i.return;ls;)switch(ls.tag){case 5:case 13:ui=!1;return;case 27:case 3:ui=!0;return;default:ls=ls.return}}function ha(i){if(i!==ls)return!1;if(!Je)return Nh(i),Je=!0,!1;var n=i.tag,o;if((o=n!==3&&n!==27)&&((o=n===5)&&(o=i.type,o=!(o!=="form"&&o!=="button")||uf(i.type,i.memoizedProps)),o=!o),o&&Dt&&Pn(i),Nh(i),n===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(317));e:{for(i=i.nextSibling,n=0;i;){if(i.nodeType===8)if(o=i.data,o==="/$"){if(n===0){Dt=ti(i.nextSibling);break e}n--}else o!=="$"&&o!=="$!"&&o!=="$?"||n++;i=i.nextSibling}Dt=null}}else n===27?(n=Dt,hn(i.type)?(i=hf,hf=null,Dt=i):Dt=n):Dt=ls?ti(i.stateNode.nextSibling):null;return!0}function ga(){Dt=ls=null,Je=!1}function Ph(){var i=Nn;return i!==null&&(vs===null?vs=i:vs.push.apply(vs,i),Nn=null),i}function ma(i){Nn===null?Nn=[i]:Nn.push(i)}var Yu=$(null),Un=null,Di=null;function Wi(i,n,o){ie(Yu,n._currentValue),n._currentValue=o}function Ci(i){i._currentValue=Yu.current,Y(Yu)}function qu(i,n,o){for(;i!==null;){var f=i.alternate;if((i.childLanes&n)!==n?(i.childLanes|=n,f!==null&&(f.childLanes|=n)):f!==null&&(f.childLanes&n)!==n&&(f.childLanes|=n),i===o)break;i=i.return}}function Xu(i,n,o,f){var m=i.child;for(m!==null&&(m.return=i);m!==null;){var v=m.dependencies;if(v!==null){var L=m.child;v=v.firstContext;e:for(;v!==null;){var D=v;v=m;for(var N=0;N<n.length;N++)if(D.context===n[N]){v.lanes|=o,D=v.alternate,D!==null&&(D.lanes|=o),qu(v.return,o,i),f||(L=null);break e}v=D.next}}else if(m.tag===18){if(L=m.return,L===null)throw Error(s(341));L.lanes|=o,v=L.alternate,v!==null&&(v.lanes|=o),qu(L,o,i),L=null}else L=m.child;if(L!==null)L.return=m;else for(L=m;L!==null;){if(L===i){L=null;break}if(m=L.sibling,m!==null){m.return=L.return,L=m;break}L=L.return}m=L}}function pa(i,n,o,f){i=null;for(var m=n,v=!1;m!==null;){if(!v){if((m.flags&524288)!==0)v=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var L=m.alternate;if(L===null)throw Error(s(387));if(L=L.memoizedProps,L!==null){var D=m.type;Rs(m.pendingProps.value,L.value)||(i!==null?i.push(D):i=[D])}}else if(m===Pe.current){if(L=m.alternate,L===null)throw Error(s(387));L.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(i!==null?i.push(Ka):i=[Ka])}m=m.return}i!==null&&Xu(n,i,o,f),n.flags|=262144}function Ol(i){for(i=i.firstContext;i!==null;){if(!Rs(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Bn(i){Un=i,Di=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function ns(i){return Uh(Un,i)}function Ml(i,n){return Un===null&&Bn(i),Uh(i,n)}function Uh(i,n){var o=n._currentValue;if(n={context:n,memoizedValue:o,next:null},Di===null){if(i===null)throw Error(s(308));Di=n,i.dependencies={lanes:0,firstContext:n},i.flags|=524288}else Di=Di.next=n;return o}var wE=typeof AbortController!="undefined"?AbortController:function(){var i=[],n=this.signal={aborted:!1,addEventListener:function(o,f){i.push(f)}};this.abort=function(){n.aborted=!0,i.forEach(function(o){return o()})}},OE=l.unstable_scheduleCallback,ME=l.unstable_NormalPriority,jt={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Qu(){return{controller:new wE,data:new Map,refCount:0}}function ya(i){i.refCount--,i.refCount===0&&OE(ME,function(){i.controller.abort()})}var va=null,Wu=0,yr=0,vr=null;function NE(i,n){if(va===null){var o=va=[];Wu=0,yr=Jc(),vr={status:"pending",value:void 0,then:function(f){o.push(f)}}}return Wu++,n.then(Bh,Bh),n}function Bh(){if(--Wu===0&&va!==null){vr!==null&&(vr.status="fulfilled");var i=va;va=null,yr=0,vr=null;for(var n=0;n<i.length;n++)(0,i[n])()}}function PE(i,n){var o=[],f={status:"pending",value:null,reason:null,then:function(m){o.push(m)}};return i.then(function(){f.status="fulfilled",f.value=n;for(var m=0;m<o.length;m++)(0,o[m])(n)},function(m){for(f.status="rejected",f.reason=m,m=0;m<o.length;m++)(0,o[m])(void 0)}),f}var Fh=U.S;U.S=function(i,n){typeof n=="object"&&n!==null&&typeof n.then=="function"&&NE(i,n),Fh!==null&&Fh(i,n)};var Fn=$(null);function Zu(){var i=Fn.current;return i!==null?i:Tt.pooledCache}function Nl(i,n){n===null?ie(Fn,Fn.current):ie(Fn,n.pool)}function $h(){var i=Zu();return i===null?null:{parent:jt._currentValue,pool:i}}var Ea=Error(s(460)),Gh=Error(s(474)),Pl=Error(s(542)),Ju={then:function(){}};function jh(i){return i=i.status,i==="fulfilled"||i==="rejected"}function Ul(){}function Hh(i,n,o){switch(o=i[o],o===void 0?i.push(n):o!==n&&(n.then(Ul,Ul),n=o),n.status){case"fulfilled":return n.value;case"rejected":throw i=n.reason,Kh(i),i;default:if(typeof n.status=="string")n.then(Ul,Ul);else{if(i=Tt,i!==null&&100<i.shellSuspendCounter)throw Error(s(482));i=n,i.status="pending",i.then(function(f){if(n.status==="pending"){var m=n;m.status="fulfilled",m.value=f}},function(f){if(n.status==="pending"){var m=n;m.status="rejected",m.reason=f}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw i=n.reason,Kh(i),i}throw Ta=n,Ea}}var Ta=null;function Vh(){if(Ta===null)throw Error(s(459));var i=Ta;return Ta=null,i}function Kh(i){if(i===Ea||i===Pl)throw Error(s(483))}var Zi=!1;function ec(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function tc(i,n){i=i.updateQueue,n.updateQueue===i&&(n.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Ji(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function en(i,n,o){var f=i.updateQueue;if(f===null)return null;if(f=f.shared,(rt&2)!==0){var m=f.pending;return m===null?n.next=n:(n.next=m.next,m.next=n),f.pending=n,n=Dl(i),kh(i,null,o),n}return Il(i,f,n,o),Dl(i)}function Sa(i,n,o){if(n=n.updateQueue,n!==null&&(n=n.shared,(o&4194048)!==0)){var f=n.lanes;f&=i.pendingLanes,o|=f,n.lanes=o,Vi(i,o)}}function sc(i,n){var o=i.updateQueue,f=i.alternate;if(f!==null&&(f=f.updateQueue,o===f)){var m=null,v=null;if(o=o.firstBaseUpdate,o!==null){do{var L={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};v===null?m=v=L:v=v.next=L,o=o.next}while(o!==null);v===null?m=v=n:v=v.next=n}else m=v=n;o={baseState:f.baseState,firstBaseUpdate:m,lastBaseUpdate:v,shared:f.shared,callbacks:f.callbacks},i.updateQueue=o;return}i=o.lastBaseUpdate,i===null?o.firstBaseUpdate=n:i.next=n,o.lastBaseUpdate=n}var ic=!1;function xa(){if(ic){var i=vr;if(i!==null)throw i}}function ba(i,n,o,f){ic=!1;var m=i.updateQueue;Zi=!1;var v=m.firstBaseUpdate,L=m.lastBaseUpdate,D=m.shared.pending;if(D!==null){m.shared.pending=null;var N=D,Q=N.next;N.next=null,L===null?v=Q:L.next=Q,L=N;var ne=i.alternate;ne!==null&&(ne=ne.updateQueue,D=ne.lastBaseUpdate,D!==L&&(D===null?ne.firstBaseUpdate=Q:D.next=Q,ne.lastBaseUpdate=N))}if(v!==null){var le=m.baseState;L=0,ne=Q=N=null,D=v;do{var W=D.lane&-536870913,Z=W!==D.lane;if(Z?(Xe&W)===W:(f&W)===W){W!==0&&W===yr&&(ic=!0),ne!==null&&(ne=ne.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});e:{var we=i,De=D;W=n;var ft=o;switch(De.tag){case 1:if(we=De.payload,typeof we=="function"){le=we.call(ft,le,W);break e}le=we;break e;case 3:we.flags=we.flags&-65537|128;case 0:if(we=De.payload,W=typeof we=="function"?we.call(ft,le,W):we,W==null)break e;le=g({},le,W);break e;case 2:Zi=!0}}W=D.callback,W!==null&&(i.flags|=64,Z&&(i.flags|=8192),Z=m.callbacks,Z===null?m.callbacks=[W]:Z.push(W))}else Z={lane:W,tag:D.tag,payload:D.payload,callback:D.callback,next:null},ne===null?(Q=ne=Z,N=le):ne=ne.next=Z,L|=W;if(D=D.next,D===null){if(D=m.shared.pending,D===null)break;Z=D,D=Z.next,Z.next=null,m.lastBaseUpdate=Z,m.shared.pending=null}}while(!0);ne===null&&(N=le),m.baseState=N,m.firstBaseUpdate=Q,m.lastBaseUpdate=ne,v===null&&(m.shared.lanes=0),un|=L,i.lanes=L,i.memoizedState=le}}function zh(i,n){if(typeof i!="function")throw Error(s(191,i));i.call(n)}function Yh(i,n){var o=i.callbacks;if(o!==null)for(i.callbacks=null,i=0;i<o.length;i++)zh(o[i],n)}var Er=$(null),Bl=$(0);function qh(i,n){i=Ui,ie(Bl,i),ie(Er,n),Ui=i|n.baseLanes}function nc(){ie(Bl,Ui),ie(Er,Er.current)}function rc(){Ui=Bl.current,Y(Er),Y(Bl)}var tn=0,Ge=null,ut=null,Bt=null,Fl=!1,Tr=!1,$n=!1,$l=0,Aa=0,Sr=null,UE=0;function Ot(){throw Error(s(321))}function ac(i,n){if(n===null)return!1;for(var o=0;o<n.length&&o<i.length;o++)if(!Rs(i[o],n[o]))return!1;return!0}function lc(i,n,o,f,m,v){return tn=v,Ge=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,U.H=i===null||i.memoizedState===null?kg:wg,$n=!1,v=o(f,m),$n=!1,Tr&&(v=Qh(n,o,f,m)),Xh(i),v}function Xh(i){U.H=zl;var n=ut!==null&&ut.next!==null;if(tn=0,Bt=ut=Ge=null,Fl=!1,Aa=0,Sr=null,n)throw Error(s(300));i===null||zt||(i=i.dependencies,i!==null&&Ol(i)&&(zt=!0))}function Qh(i,n,o,f){Ge=i;var m=0;do{if(Tr&&(Sr=null),Aa=0,Tr=!1,25<=m)throw Error(s(301));if(m+=1,Bt=ut=null,i.updateQueue!=null){var v=i.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}U.H=VE,v=n(o,f)}while(Tr);return v}function BE(){var i=U.H,n=i.useState()[0];return n=typeof n.then=="function"?La(n):n,i=i.useState()[0],(ut!==null?ut.memoizedState:null)!==i&&(Ge.flags|=1024),n}function oc(){var i=$l!==0;return $l=0,i}function uc(i,n,o){n.updateQueue=i.updateQueue,n.flags&=-2053,i.lanes&=~o}function cc(i){if(Fl){for(i=i.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}Fl=!1}tn=0,Bt=ut=Ge=null,Tr=!1,Aa=$l=0,Sr=null}function ps(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Bt===null?Ge.memoizedState=Bt=i:Bt=Bt.next=i,Bt}function Ft(){if(ut===null){var i=Ge.alternate;i=i!==null?i.memoizedState:null}else i=ut.next;var n=Bt===null?Ge.memoizedState:Bt.next;if(n!==null)Bt=n,ut=i;else{if(i===null)throw Ge.alternate===null?Error(s(467)):Error(s(310));ut=i,i={memoizedState:ut.memoizedState,baseState:ut.baseState,baseQueue:ut.baseQueue,queue:ut.queue,next:null},Bt===null?Ge.memoizedState=Bt=i:Bt=Bt.next=i}return Bt}function fc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function La(i){var n=Aa;return Aa+=1,Sr===null&&(Sr=[]),i=Hh(Sr,i,n),n=Ge,(Bt===null?n.memoizedState:Bt.next)===null&&(n=n.alternate,U.H=n===null||n.memoizedState===null?kg:wg),i}function Gl(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return La(i);if(i.$$typeof===A)return ns(i)}throw Error(s(438,String(i)))}function dc(i){var n=null,o=Ge.updateQueue;if(o!==null&&(n=o.memoCache),n==null){var f=Ge.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(n={data:f.data.map(function(m){return m.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),o===null&&(o=fc(),Ge.updateQueue=o),o.memoCache=n,o=n.data[n.index],o===void 0)for(o=n.data[n.index]=Array(i),f=0;f<i;f++)o[f]=M;return n.index++,o}function ki(i,n){return typeof n=="function"?n(i):n}function jl(i){var n=Ft();return hc(n,ut,i)}function hc(i,n,o){var f=i.queue;if(f===null)throw Error(s(311));f.lastRenderedReducer=o;var m=i.baseQueue,v=f.pending;if(v!==null){if(m!==null){var L=m.next;m.next=v.next,v.next=L}n.baseQueue=m=v,f.pending=null}if(v=i.baseState,m===null)i.memoizedState=v;else{n=m.next;var D=L=null,N=null,Q=n,ne=!1;do{var le=Q.lane&-536870913;if(le!==Q.lane?(Xe&le)===le:(tn&le)===le){var W=Q.revertLane;if(W===0)N!==null&&(N=N.next={lane:0,revertLane:0,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null}),le===yr&&(ne=!0);else if((tn&W)===W){Q=Q.next,W===yr&&(ne=!0);continue}else le={lane:0,revertLane:Q.revertLane,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},N===null?(D=N=le,L=v):N=N.next=le,Ge.lanes|=W,un|=W;le=Q.action,$n&&o(v,le),v=Q.hasEagerState?Q.eagerState:o(v,le)}else W={lane:le,revertLane:Q.revertLane,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},N===null?(D=N=W,L=v):N=N.next=W,Ge.lanes|=le,un|=le;Q=Q.next}while(Q!==null&&Q!==n);if(N===null?L=v:N.next=D,!Rs(v,i.memoizedState)&&(zt=!0,ne&&(o=vr,o!==null)))throw o;i.memoizedState=v,i.baseState=L,i.baseQueue=N,f.lastRenderedState=v}return m===null&&(f.lanes=0),[i.memoizedState,f.dispatch]}function gc(i){var n=Ft(),o=n.queue;if(o===null)throw Error(s(311));o.lastRenderedReducer=i;var f=o.dispatch,m=o.pending,v=n.memoizedState;if(m!==null){o.pending=null;var L=m=m.next;do v=i(v,L.action),L=L.next;while(L!==m);Rs(v,n.memoizedState)||(zt=!0),n.memoizedState=v,n.baseQueue===null&&(n.baseState=v),o.lastRenderedState=v}return[v,f]}function Wh(i,n,o){var f=Ge,m=Ft(),v=Je;if(v){if(o===void 0)throw Error(s(407));o=o()}else o=n();var L=!Rs((ut||m).memoizedState,o);L&&(m.memoizedState=o,zt=!0),m=m.queue;var D=eg.bind(null,f,m,i);if(Ra(2048,8,D,[i]),m.getSnapshot!==n||L||Bt!==null&&Bt.memoizedState.tag&1){if(f.flags|=2048,xr(9,Hl(),Jh.bind(null,f,m,o,n),null),Tt===null)throw Error(s(349));v||(tn&124)!==0||Zh(f,n,o)}return o}function Zh(i,n,o){i.flags|=16384,i={getSnapshot:n,value:o},n=Ge.updateQueue,n===null?(n=fc(),Ge.updateQueue=n,n.stores=[i]):(o=n.stores,o===null?n.stores=[i]:o.push(i))}function Jh(i,n,o,f){n.value=o,n.getSnapshot=f,tg(n)&&sg(i)}function eg(i,n,o){return o(function(){tg(n)&&sg(i)})}function tg(i){var n=i.getSnapshot;i=i.value;try{var o=n();return!Rs(i,o)}catch(f){return!0}}function sg(i){var n=hr(i,2);n!==null&&ws(n,i,2)}function mc(i){var n=ps();if(typeof i=="function"){var o=i;if(i=o(),$n){_e(!0);try{o()}finally{_e(!1)}}}return n.memoizedState=n.baseState=i,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ki,lastRenderedState:i},n}function ig(i,n,o,f){return i.baseState=o,hc(i,ut,typeof f=="function"?f:ki)}function FE(i,n,o,f,m){if(Kl(i))throw Error(s(485));if(i=n.action,i!==null){var v={payload:m,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(L){v.listeners.push(L)}};U.T!==null?o(!0):v.isTransition=!1,f(v),o=n.pending,o===null?(v.next=n.pending=v,ng(n,v)):(v.next=o.next,n.pending=o.next=v)}}function ng(i,n){var o=n.action,f=n.payload,m=i.state;if(n.isTransition){var v=U.T,L={};U.T=L;try{var D=o(m,f),N=U.S;N!==null&&N(L,D),rg(i,n,D)}catch(Q){pc(i,n,Q)}finally{U.T=v}}else try{v=o(m,f),rg(i,n,v)}catch(Q){pc(i,n,Q)}}function rg(i,n,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(f){ag(i,n,f)},function(f){return pc(i,n,f)}):ag(i,n,o)}function ag(i,n,o){n.status="fulfilled",n.value=o,lg(n),i.state=o,n=i.pending,n!==null&&(o=n.next,o===n?i.pending=null:(o=o.next,n.next=o,ng(i,o)))}function pc(i,n,o){var f=i.pending;if(i.pending=null,f!==null){f=f.next;do n.status="rejected",n.reason=o,lg(n),n=n.next;while(n!==f)}i.action=null}function lg(i){i=i.listeners;for(var n=0;n<i.length;n++)(0,i[n])()}function og(i,n){return n}function ug(i,n){if(Je){var o=Tt.formState;if(o!==null){e:{var f=Ge;if(Je){if(Dt){t:{for(var m=Dt,v=ui;m.nodeType!==8;){if(!v){m=null;break t}if(m=ti(m.nextSibling),m===null){m=null;break t}}v=m.data,m=v==="F!"||v==="F"?m:null}if(m){Dt=ti(m.nextSibling),f=m.data==="F!";break e}}Pn(f)}f=!1}f&&(n=o[0])}}return o=ps(),o.memoizedState=o.baseState=n,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:og,lastRenderedState:n},o.queue=f,o=Ig.bind(null,Ge,f),f.dispatch=o,f=mc(!1),v=Sc.bind(null,Ge,!1,f.queue),f=ps(),m={state:n,dispatch:null,action:i,pending:null},f.queue=m,o=FE.bind(null,Ge,m,v,o),m.dispatch=o,f.memoizedState=i,[n,o,!1]}function cg(i){var n=Ft();return fg(n,ut,i)}function fg(i,n,o){if(n=hc(i,n,og)[0],i=jl(ki)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var f=La(n)}catch(L){throw L===Ea?Pl:L}else f=n;n=Ft();var m=n.queue,v=m.dispatch;return o!==n.memoizedState&&(Ge.flags|=2048,xr(9,Hl(),$E.bind(null,m,o),null)),[f,v,i]}function $E(i,n){i.action=n}function dg(i){var n=Ft(),o=ut;if(o!==null)return fg(n,o,i);Ft(),n=n.memoizedState,o=Ft();var f=o.queue.dispatch;return o.memoizedState=i,[n,f,!1]}function xr(i,n,o,f){return i={tag:i,create:o,deps:f,inst:n,next:null},n=Ge.updateQueue,n===null&&(n=fc(),Ge.updateQueue=n),o=n.lastEffect,o===null?n.lastEffect=i.next=i:(f=o.next,o.next=i,i.next=f,n.lastEffect=i),i}function Hl(){return{destroy:void 0,resource:void 0}}function hg(){return Ft().memoizedState}function Vl(i,n,o,f){var m=ps();f=f===void 0?null:f,Ge.flags|=i,m.memoizedState=xr(1|n,Hl(),o,f)}function Ra(i,n,o,f){var m=Ft();f=f===void 0?null:f;var v=m.memoizedState.inst;ut!==null&&f!==null&&ac(f,ut.memoizedState.deps)?m.memoizedState=xr(n,v,o,f):(Ge.flags|=i,m.memoizedState=xr(1|n,v,o,f))}function gg(i,n){Vl(8390656,8,i,n)}function mg(i,n){Ra(2048,8,i,n)}function pg(i,n){return Ra(4,2,i,n)}function yg(i,n){return Ra(4,4,i,n)}function vg(i,n){if(typeof n=="function"){i=i();var o=n(i);return function(){typeof o=="function"?o():n(null)}}if(n!=null)return i=i(),n.current=i,function(){n.current=null}}function Eg(i,n,o){o=o!=null?o.concat([i]):null,Ra(4,4,vg.bind(null,n,i),o)}function yc(){}function Tg(i,n){var o=Ft();n=n===void 0?null:n;var f=o.memoizedState;return n!==null&&ac(n,f[1])?f[0]:(o.memoizedState=[i,n],i)}function Sg(i,n){var o=Ft();n=n===void 0?null:n;var f=o.memoizedState;if(n!==null&&ac(n,f[1]))return f[0];if(f=i(),$n){_e(!0);try{i()}finally{_e(!1)}}return o.memoizedState=[f,n],f}function vc(i,n,o){return o===void 0||(tn&1073741824)!==0?i.memoizedState=n:(i.memoizedState=o,i=A0(),Ge.lanes|=i,un|=i,o)}function xg(i,n,o,f){return Rs(o,n)?o:Er.current!==null?(i=vc(i,o,f),Rs(i,n)||(zt=!0),i):(tn&42)===0?(zt=!0,i.memoizedState=o):(i=A0(),Ge.lanes|=i,un|=i,n)}function bg(i,n,o,f,m){var v=X.p;X.p=v!==0&&8>v?v:8;var L=U.T,D={};U.T=D,Sc(i,!1,n,o);try{var N=m(),Q=U.S;if(Q!==null&&Q(D,N),N!==null&&typeof N=="object"&&typeof N.then=="function"){var ne=PE(N,f);_a(i,n,ne,ks(i))}else _a(i,n,f,ks(i))}catch(le){_a(i,n,{then:function(){},status:"rejected",reason:le},ks())}finally{X.p=v,U.T=L}}function GE(){}function Ec(i,n,o,f){if(i.tag!==5)throw Error(s(476));var m=Ag(i).queue;bg(i,m,n,te,o===null?GE:function(){return Lg(i),o(f)})}function Ag(i){var n=i.memoizedState;if(n!==null)return n;n={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ki,lastRenderedState:te},next:null};var o={};return n.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ki,lastRenderedState:o},next:null},i.memoizedState=n,i=i.alternate,i!==null&&(i.memoizedState=n),n}function Lg(i){var n=Ag(i).next.queue;_a(i,n,{},ks())}function Tc(){return ns(Ka)}function Rg(){return Ft().memoizedState}function _g(){return Ft().memoizedState}function jE(i){for(var n=i.return;n!==null;){switch(n.tag){case 24:case 3:var o=ks();i=Ji(o);var f=en(n,i,o);f!==null&&(ws(f,n,o),Sa(f,n,o)),n={cache:Qu()},i.payload=n;return}n=n.return}}function HE(i,n,o){var f=ks();o={lane:f,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null},Kl(i)?Dg(n,o):(o=$u(i,n,o,f),o!==null&&(ws(o,i,f),Cg(o,n,f)))}function Ig(i,n,o){var f=ks();_a(i,n,o,f)}function _a(i,n,o,f){var m={lane:f,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null};if(Kl(i))Dg(n,m);else{var v=i.alternate;if(i.lanes===0&&(v===null||v.lanes===0)&&(v=n.lastRenderedReducer,v!==null))try{var L=n.lastRenderedState,D=v(L,o);if(m.hasEagerState=!0,m.eagerState=D,Rs(D,L))return Il(i,n,m,0),Tt===null&&_l(),!1}catch(N){}finally{}if(o=$u(i,n,m,f),o!==null)return ws(o,i,f),Cg(o,n,f),!0}return!1}function Sc(i,n,o,f){if(f={lane:2,revertLane:Jc(),action:f,hasEagerState:!1,eagerState:null,next:null},Kl(i)){if(n)throw Error(s(479))}else n=$u(i,o,f,2),n!==null&&ws(n,i,2)}function Kl(i){var n=i.alternate;return i===Ge||n!==null&&n===Ge}function Dg(i,n){Tr=Fl=!0;var o=i.pending;o===null?n.next=n:(n.next=o.next,o.next=n),i.pending=n}function Cg(i,n,o){if((o&4194048)!==0){var f=n.lanes;f&=i.pendingLanes,o|=f,n.lanes=o,Vi(i,o)}}var zl={readContext:ns,use:Gl,useCallback:Ot,useContext:Ot,useEffect:Ot,useImperativeHandle:Ot,useLayoutEffect:Ot,useInsertionEffect:Ot,useMemo:Ot,useReducer:Ot,useRef:Ot,useState:Ot,useDebugValue:Ot,useDeferredValue:Ot,useTransition:Ot,useSyncExternalStore:Ot,useId:Ot,useHostTransitionStatus:Ot,useFormState:Ot,useActionState:Ot,useOptimistic:Ot,useMemoCache:Ot,useCacheRefresh:Ot},kg={readContext:ns,use:Gl,useCallback:function(i,n){return ps().memoizedState=[i,n===void 0?null:n],i},useContext:ns,useEffect:gg,useImperativeHandle:function(i,n,o){o=o!=null?o.concat([i]):null,Vl(4194308,4,vg.bind(null,n,i),o)},useLayoutEffect:function(i,n){return Vl(4194308,4,i,n)},useInsertionEffect:function(i,n){Vl(4,2,i,n)},useMemo:function(i,n){var o=ps();n=n===void 0?null:n;var f=i();if($n){_e(!0);try{i()}finally{_e(!1)}}return o.memoizedState=[f,n],f},useReducer:function(i,n,o){var f=ps();if(o!==void 0){var m=o(n);if($n){_e(!0);try{o(n)}finally{_e(!1)}}}else m=n;return f.memoizedState=f.baseState=m,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:m},f.queue=i,i=i.dispatch=HE.bind(null,Ge,i),[f.memoizedState,i]},useRef:function(i){var n=ps();return i={current:i},n.memoizedState=i},useState:function(i){i=mc(i);var n=i.queue,o=Ig.bind(null,Ge,n);return n.dispatch=o,[i.memoizedState,o]},useDebugValue:yc,useDeferredValue:function(i,n){var o=ps();return vc(o,i,n)},useTransition:function(){var i=mc(!1);return i=bg.bind(null,Ge,i.queue,!0,!1),ps().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,n,o){var f=Ge,m=ps();if(Je){if(o===void 0)throw Error(s(407));o=o()}else{if(o=n(),Tt===null)throw Error(s(349));(Xe&124)!==0||Zh(f,n,o)}m.memoizedState=o;var v={value:o,getSnapshot:n};return m.queue=v,gg(eg.bind(null,f,v,i),[i]),f.flags|=2048,xr(9,Hl(),Jh.bind(null,f,v,o,n),null),o},useId:function(){var i=ps(),n=Tt.identifierPrefix;if(Je){var o=Ii,f=_i;o=(f&~(1<<32-Oe(f)-1)).toString(32)+o,n=""+n+"R"+o,o=$l++,0<o&&(n+="H"+o.toString(32)),n+=""}else o=UE++,n=""+n+"r"+o.toString(32)+"";return i.memoizedState=n},useHostTransitionStatus:Tc,useFormState:ug,useActionState:ug,useOptimistic:function(i){var n=ps();n.memoizedState=n.baseState=i;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=o,n=Sc.bind(null,Ge,!0,o),o.dispatch=n,[i,n]},useMemoCache:dc,useCacheRefresh:function(){return ps().memoizedState=jE.bind(null,Ge)}},wg={readContext:ns,use:Gl,useCallback:Tg,useContext:ns,useEffect:mg,useImperativeHandle:Eg,useInsertionEffect:pg,useLayoutEffect:yg,useMemo:Sg,useReducer:jl,useRef:hg,useState:function(){return jl(ki)},useDebugValue:yc,useDeferredValue:function(i,n){var o=Ft();return xg(o,ut.memoizedState,i,n)},useTransition:function(){var i=jl(ki)[0],n=Ft().memoizedState;return[typeof i=="boolean"?i:La(i),n]},useSyncExternalStore:Wh,useId:Rg,useHostTransitionStatus:Tc,useFormState:cg,useActionState:cg,useOptimistic:function(i,n){var o=Ft();return ig(o,ut,i,n)},useMemoCache:dc,useCacheRefresh:_g},VE={readContext:ns,use:Gl,useCallback:Tg,useContext:ns,useEffect:mg,useImperativeHandle:Eg,useInsertionEffect:pg,useLayoutEffect:yg,useMemo:Sg,useReducer:gc,useRef:hg,useState:function(){return gc(ki)},useDebugValue:yc,useDeferredValue:function(i,n){var o=Ft();return ut===null?vc(o,i,n):xg(o,ut.memoizedState,i,n)},useTransition:function(){var i=gc(ki)[0],n=Ft().memoizedState;return[typeof i=="boolean"?i:La(i),n]},useSyncExternalStore:Wh,useId:Rg,useHostTransitionStatus:Tc,useFormState:dg,useActionState:dg,useOptimistic:function(i,n){var o=Ft();return ut!==null?ig(o,ut,i,n):(o.baseState=i,[i,o.queue.dispatch])},useMemoCache:dc,useCacheRefresh:_g},br=null,Ia=0;function Yl(i){var n=Ia;return Ia+=1,br===null&&(br=[]),Hh(br,i,n)}function Da(i,n){n=n.props.ref,i.ref=n!==void 0?n:null}function ql(i,n){throw n.$$typeof===p?Error(s(525)):(i=Object.prototype.toString.call(n),Error(s(31,i==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":i)))}function Og(i){var n=i._init;return n(i._payload)}function Mg(i){function n(H,F){if(i){var q=H.deletions;q===null?(H.deletions=[F],H.flags|=16):q.push(F)}}function o(H,F){if(!i)return null;for(;F!==null;)n(H,F),F=F.sibling;return null}function f(H){for(var F=new Map;H!==null;)H.key!==null?F.set(H.key,H):F.set(H.index,H),H=H.sibling;return F}function m(H,F){return H=Ri(H,F),H.index=0,H.sibling=null,H}function v(H,F,q){return H.index=q,i?(q=H.alternate,q!==null?(q=q.index,q<F?(H.flags|=67108866,F):q):(H.flags|=67108866,F)):(H.flags|=1048576,F)}function L(H){return i&&H.alternate===null&&(H.flags|=67108866),H}function D(H,F,q,ae){return F===null||F.tag!==6?(F=ju(q,H.mode,ae),F.return=H,F):(F=m(F,q),F.return=H,F)}function N(H,F,q,ae){var xe=q.type;return xe===T?ne(H,F,q.props.children,ae,q.key):F!==null&&(F.elementType===xe||typeof xe=="object"&&xe!==null&&xe.$$typeof===P&&Og(xe)===F.type)?(F=m(F,q.props),Da(F,q),F.return=H,F):(F=Cl(q.type,q.key,q.props,null,H.mode,ae),Da(F,q),F.return=H,F)}function Q(H,F,q,ae){return F===null||F.tag!==4||F.stateNode.containerInfo!==q.containerInfo||F.stateNode.implementation!==q.implementation?(F=Hu(q,H.mode,ae),F.return=H,F):(F=m(F,q.children||[]),F.return=H,F)}function ne(H,F,q,ae,xe){return F===null||F.tag!==7?(F=wn(q,H.mode,ae,xe),F.return=H,F):(F=m(F,q),F.return=H,F)}function le(H,F,q){if(typeof F=="string"&&F!==""||typeof F=="number"||typeof F=="bigint")return F=ju(""+F,H.mode,q),F.return=H,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case y:return q=Cl(F.type,F.key,F.props,null,H.mode,q),Da(q,F),q.return=H,q;case E:return F=Hu(F,H.mode,q),F.return=H,F;case P:var ae=F._init;return F=ae(F._payload),le(H,F,q)}if(ce(F)||ee(F))return F=wn(F,H.mode,q,null),F.return=H,F;if(typeof F.then=="function")return le(H,Yl(F),q);if(F.$$typeof===A)return le(H,Ml(H,F),q);ql(H,F)}return null}function W(H,F,q,ae){var xe=F!==null?F.key:null;if(typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint")return xe!==null?null:D(H,F,""+q,ae);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case y:return q.key===xe?N(H,F,q,ae):null;case E:return q.key===xe?Q(H,F,q,ae):null;case P:return xe=q._init,q=xe(q._payload),W(H,F,q,ae)}if(ce(q)||ee(q))return xe!==null?null:ne(H,F,q,ae,null);if(typeof q.then=="function")return W(H,F,Yl(q),ae);if(q.$$typeof===A)return W(H,F,Ml(H,q),ae);ql(H,q)}return null}function Z(H,F,q,ae,xe){if(typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint")return H=H.get(q)||null,D(F,H,""+ae,xe);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case y:return H=H.get(ae.key===null?q:ae.key)||null,N(F,H,ae,xe);case E:return H=H.get(ae.key===null?q:ae.key)||null,Q(F,H,ae,xe);case P:var He=ae._init;return ae=He(ae._payload),Z(H,F,q,ae,xe)}if(ce(ae)||ee(ae))return H=H.get(q)||null,ne(F,H,ae,xe,null);if(typeof ae.then=="function")return Z(H,F,q,Yl(ae),xe);if(ae.$$typeof===A)return Z(H,F,q,Ml(F,ae),xe);ql(F,ae)}return null}function we(H,F,q,ae){for(var xe=null,He=null,Re=F,Ce=F=0,qt=null;Re!==null&&Ce<q.length;Ce++){Re.index>Ce?(qt=Re,Re=null):qt=Re.sibling;var Qe=W(H,Re,q[Ce],ae);if(Qe===null){Re===null&&(Re=qt);break}i&&Re&&Qe.alternate===null&&n(H,Re),F=v(Qe,F,Ce),He===null?xe=Qe:He.sibling=Qe,He=Qe,Re=qt}if(Ce===q.length)return o(H,Re),Je&&Mn(H,Ce),xe;if(Re===null){for(;Ce<q.length;Ce++)Re=le(H,q[Ce],ae),Re!==null&&(F=v(Re,F,Ce),He===null?xe=Re:He.sibling=Re,He=Re);return Je&&Mn(H,Ce),xe}for(Re=f(Re);Ce<q.length;Ce++)qt=Z(Re,H,Ce,q[Ce],ae),qt!==null&&(i&&qt.alternate!==null&&Re.delete(qt.key===null?Ce:qt.key),F=v(qt,F,Ce),He===null?xe=qt:He.sibling=qt,He=qt);return i&&Re.forEach(function(vn){return n(H,vn)}),Je&&Mn(H,Ce),xe}function De(H,F,q,ae){if(q==null)throw Error(s(151));for(var xe=null,He=null,Re=F,Ce=F=0,qt=null,Qe=q.next();Re!==null&&!Qe.done;Ce++,Qe=q.next()){Re.index>Ce?(qt=Re,Re=null):qt=Re.sibling;var vn=W(H,Re,Qe.value,ae);if(vn===null){Re===null&&(Re=qt);break}i&&Re&&vn.alternate===null&&n(H,Re),F=v(vn,F,Ce),He===null?xe=vn:He.sibling=vn,He=vn,Re=qt}if(Qe.done)return o(H,Re),Je&&Mn(H,Ce),xe;if(Re===null){for(;!Qe.done;Ce++,Qe=q.next())Qe=le(H,Qe.value,ae),Qe!==null&&(F=v(Qe,F,Ce),He===null?xe=Qe:He.sibling=Qe,He=Qe);return Je&&Mn(H,Ce),xe}for(Re=f(Re);!Qe.done;Ce++,Qe=q.next())Qe=Z(Re,H,Ce,Qe.value,ae),Qe!==null&&(i&&Qe.alternate!==null&&Re.delete(Qe.key===null?Ce:Qe.key),F=v(Qe,F,Ce),He===null?xe=Qe:He.sibling=Qe,He=Qe);return i&&Re.forEach(function(KT){return n(H,KT)}),Je&&Mn(H,Ce),xe}function ft(H,F,q,ae){if(typeof q=="object"&&q!==null&&q.type===T&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case y:e:{for(var xe=q.key;F!==null;){if(F.key===xe){if(xe=q.type,xe===T){if(F.tag===7){o(H,F.sibling),ae=m(F,q.props.children),ae.return=H,H=ae;break e}}else if(F.elementType===xe||typeof xe=="object"&&xe!==null&&xe.$$typeof===P&&Og(xe)===F.type){o(H,F.sibling),ae=m(F,q.props),Da(ae,q),ae.return=H,H=ae;break e}o(H,F);break}else n(H,F);F=F.sibling}q.type===T?(ae=wn(q.props.children,H.mode,ae,q.key),ae.return=H,H=ae):(ae=Cl(q.type,q.key,q.props,null,H.mode,ae),Da(ae,q),ae.return=H,H=ae)}return L(H);case E:e:{for(xe=q.key;F!==null;){if(F.key===xe)if(F.tag===4&&F.stateNode.containerInfo===q.containerInfo&&F.stateNode.implementation===q.implementation){o(H,F.sibling),ae=m(F,q.children||[]),ae.return=H,H=ae;break e}else{o(H,F);break}else n(H,F);F=F.sibling}ae=Hu(q,H.mode,ae),ae.return=H,H=ae}return L(H);case P:return xe=q._init,q=xe(q._payload),ft(H,F,q,ae)}if(ce(q))return we(H,F,q,ae);if(ee(q)){if(xe=ee(q),typeof xe!="function")throw Error(s(150));return q=xe.call(q),De(H,F,q,ae)}if(typeof q.then=="function")return ft(H,F,Yl(q),ae);if(q.$$typeof===A)return ft(H,F,Ml(H,q),ae);ql(H,q)}return typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint"?(q=""+q,F!==null&&F.tag===6?(o(H,F.sibling),ae=m(F,q),ae.return=H,H=ae):(o(H,F),ae=ju(q,H.mode,ae),ae.return=H,H=ae),L(H)):o(H,F)}return function(H,F,q,ae){try{Ia=0;var xe=ft(H,F,q,ae);return br=null,xe}catch(Re){if(Re===Ea||Re===Pl)throw Re;var He=_s(29,Re,null,H.mode);return He.lanes=ae,He.return=H,He}finally{}}}var Ar=Mg(!0),Ng=Mg(!1),zs=$(null),ci=null;function sn(i){var n=i.alternate;ie(Ht,Ht.current&1),ie(zs,i),ci===null&&(n===null||Er.current!==null||n.memoizedState!==null)&&(ci=i)}function Pg(i){if(i.tag===22){if(ie(Ht,Ht.current),ie(zs,i),ci===null){var n=i.alternate;n!==null&&n.memoizedState!==null&&(ci=i)}}else nn()}function nn(){ie(Ht,Ht.current),ie(zs,zs.current)}function wi(i){Y(zs),ci===i&&(ci=null),Y(Ht)}var Ht=$(0);function Xl(i){for(var n=i;n!==null;){if(n.tag===13){var o=n.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||df(o)))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break;for(;n.sibling===null;){if(n.return===null||n.return===i)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}function xc(i,n,o,f){n=i.memoizedState,o=o(f,n),o=o==null?n:g({},n,o),i.memoizedState=o,i.lanes===0&&(i.updateQueue.baseState=o)}var bc={enqueueSetState:function(i,n,o){i=i._reactInternals;var f=ks(),m=Ji(f);m.payload=n,o!=null&&(m.callback=o),n=en(i,m,f),n!==null&&(ws(n,i,f),Sa(n,i,f))},enqueueReplaceState:function(i,n,o){i=i._reactInternals;var f=ks(),m=Ji(f);m.tag=1,m.payload=n,o!=null&&(m.callback=o),n=en(i,m,f),n!==null&&(ws(n,i,f),Sa(n,i,f))},enqueueForceUpdate:function(i,n){i=i._reactInternals;var o=ks(),f=Ji(o);f.tag=2,n!=null&&(f.callback=n),n=en(i,f,o),n!==null&&(ws(n,i,o),Sa(n,i,o))}};function Ug(i,n,o,f,m,v,L){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(f,v,L):n.prototype&&n.prototype.isPureReactComponent?!fa(o,f)||!fa(m,v):!0}function Bg(i,n,o,f){i=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(o,f),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(o,f),n.state!==i&&bc.enqueueReplaceState(n,n.state,null)}function Gn(i,n){var o=n;if("ref"in n){o={};for(var f in n)f!=="ref"&&(o[f]=n[f])}if(i=i.defaultProps){o===n&&(o=g({},o));for(var m in i)o[m]===void 0&&(o[m]=i[m])}return o}var Ql=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function Fg(i){Ql(i)}function $g(i){console.error(i)}function Gg(i){Ql(i)}function Wl(i,n){try{var o=i.onUncaughtError;o(n.value,{componentStack:n.stack})}catch(f){setTimeout(function(){throw f})}}function jg(i,n,o){try{var f=i.onCaughtError;f(o.value,{componentStack:o.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function Ac(i,n,o){return o=Ji(o),o.tag=3,o.payload={element:null},o.callback=function(){Wl(i,n)},o}function Hg(i){return i=Ji(i),i.tag=3,i}function Vg(i,n,o,f){var m=o.type.getDerivedStateFromError;if(typeof m=="function"){var v=f.value;i.payload=function(){return m(v)},i.callback=function(){jg(n,o,f)}}var L=o.stateNode;L!==null&&typeof L.componentDidCatch=="function"&&(i.callback=function(){jg(n,o,f),typeof m!="function"&&(cn===null?cn=new Set([this]):cn.add(this));var D=f.stack;this.componentDidCatch(f.value,{componentStack:D!==null?D:""})})}function KE(i,n,o,f,m){if(o.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(n=o.alternate,n!==null&&pa(n,o,m,!0),o=zs.current,o!==null){switch(o.tag){case 13:return ci===null?qc():o.alternate===null&&Ct===0&&(Ct=3),o.flags&=-257,o.flags|=65536,o.lanes=m,f===Ju?o.flags|=16384:(n=o.updateQueue,n===null?o.updateQueue=new Set([f]):n.add(f),Qc(i,f,m)),!1;case 22:return o.flags|=65536,f===Ju?o.flags|=16384:(n=o.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([f])},o.updateQueue=n):(o=n.retryQueue,o===null?n.retryQueue=new Set([f]):o.add(f)),Qc(i,f,m)),!1}throw Error(s(435,o.tag))}return Qc(i,f,m),qc(),!1}if(Je)return n=zs.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=m,f!==zu&&(i=Error(s(422),{cause:f}),ma(js(i,o)))):(f!==zu&&(n=Error(s(423),{cause:f}),ma(js(n,o))),i=i.current.alternate,i.flags|=65536,m&=-m,i.lanes|=m,f=js(f,o),m=Ac(i.stateNode,f,m),sc(i,m),Ct!==4&&(Ct=2)),!1;var v=Error(s(520),{cause:f});if(v=js(v,o),Pa===null?Pa=[v]:Pa.push(v),Ct!==4&&(Ct=2),n===null)return!0;f=js(f,o),o=n;do{switch(o.tag){case 3:return o.flags|=65536,i=m&-m,o.lanes|=i,i=Ac(o.stateNode,f,i),sc(o,i),!1;case 1:if(n=o.type,v=o.stateNode,(o.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(cn===null||!cn.has(v))))return o.flags|=65536,m&=-m,o.lanes|=m,m=Hg(m),Vg(m,i,o,f),sc(o,m),!1}o=o.return}while(o!==null);return!1}var Kg=Error(s(461)),zt=!1;function Zt(i,n,o,f){n.child=i===null?Ng(n,null,o,f):Ar(n,i.child,o,f)}function zg(i,n,o,f,m){o=o.render;var v=n.ref;if("ref"in f){var L={};for(var D in f)D!=="ref"&&(L[D]=f[D])}else L=f;return Bn(n),f=lc(i,n,o,L,v,m),D=oc(),i!==null&&!zt?(uc(i,n,m),Oi(i,n,m)):(Je&&D&&Vu(n),n.flags|=1,Zt(i,n,f,m),n.child)}function Yg(i,n,o,f,m){if(i===null){var v=o.type;return typeof v=="function"&&!Gu(v)&&v.defaultProps===void 0&&o.compare===null?(n.tag=15,n.type=v,qg(i,n,v,f,m)):(i=Cl(o.type,null,f,n,n.mode,m),i.ref=n.ref,i.return=n,n.child=i)}if(v=i.child,!wc(i,m)){var L=v.memoizedProps;if(o=o.compare,o=o!==null?o:fa,o(L,f)&&i.ref===n.ref)return Oi(i,n,m)}return n.flags|=1,i=Ri(v,f),i.ref=n.ref,i.return=n,n.child=i}function qg(i,n,o,f,m){if(i!==null){var v=i.memoizedProps;if(fa(v,f)&&i.ref===n.ref)if(zt=!1,n.pendingProps=f=v,wc(i,m))(i.flags&131072)!==0&&(zt=!0);else return n.lanes=i.lanes,Oi(i,n,m)}return Lc(i,n,o,f,m)}function Xg(i,n,o){var f=n.pendingProps,m=f.children,v=i!==null?i.memoizedState:null;if(f.mode==="hidden"){if((n.flags&128)!==0){if(f=v!==null?v.baseLanes|o:o,i!==null){for(m=n.child=i.child,v=0;m!==null;)v=v|m.lanes|m.childLanes,m=m.sibling;n.childLanes=v&~f}else n.childLanes=0,n.child=null;return Qg(i,n,f,o)}if((o&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},i!==null&&Nl(n,v!==null?v.cachePool:null),v!==null?qh(n,v):nc(),Pg(n);else return n.lanes=n.childLanes=536870912,Qg(i,n,v!==null?v.baseLanes|o:o,o)}else v!==null?(Nl(n,v.cachePool),qh(n,v),nn(),n.memoizedState=null):(i!==null&&Nl(n,null),nc(),nn());return Zt(i,n,m,o),n.child}function Qg(i,n,o,f){var m=Zu();return m=m===null?null:{parent:jt._currentValue,pool:m},n.memoizedState={baseLanes:o,cachePool:m},i!==null&&Nl(n,null),nc(),Pg(n),i!==null&&pa(i,n,f,!0),null}function Zl(i,n){var o=n.ref;if(o===null)i!==null&&i.ref!==null&&(n.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(s(284));(i===null||i.ref!==o)&&(n.flags|=4194816)}}function Lc(i,n,o,f,m){return Bn(n),o=lc(i,n,o,f,void 0,m),f=oc(),i!==null&&!zt?(uc(i,n,m),Oi(i,n,m)):(Je&&f&&Vu(n),n.flags|=1,Zt(i,n,o,m),n.child)}function Wg(i,n,o,f,m,v){return Bn(n),n.updateQueue=null,o=Qh(n,f,o,m),Xh(i),f=oc(),i!==null&&!zt?(uc(i,n,v),Oi(i,n,v)):(Je&&f&&Vu(n),n.flags|=1,Zt(i,n,o,v),n.child)}function Zg(i,n,o,f,m){if(Bn(n),n.stateNode===null){var v=gr,L=o.contextType;typeof L=="object"&&L!==null&&(v=ns(L)),v=new o(f,v),n.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=bc,n.stateNode=v,v._reactInternals=n,v=n.stateNode,v.props=f,v.state=n.memoizedState,v.refs={},ec(n),L=o.contextType,v.context=typeof L=="object"&&L!==null?ns(L):gr,v.state=n.memoizedState,L=o.getDerivedStateFromProps,typeof L=="function"&&(xc(n,o,L,f),v.state=n.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(L=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),L!==v.state&&bc.enqueueReplaceState(v,v.state,null),ba(n,f,v,m),xa(),v.state=n.memoizedState),typeof v.componentDidMount=="function"&&(n.flags|=4194308),f=!0}else if(i===null){v=n.stateNode;var D=n.memoizedProps,N=Gn(o,D);v.props=N;var Q=v.context,ne=o.contextType;L=gr,typeof ne=="object"&&ne!==null&&(L=ns(ne));var le=o.getDerivedStateFromProps;ne=typeof le=="function"||typeof v.getSnapshotBeforeUpdate=="function",D=n.pendingProps!==D,ne||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(D||Q!==L)&&Bg(n,v,f,L),Zi=!1;var W=n.memoizedState;v.state=W,ba(n,f,v,m),xa(),Q=n.memoizedState,D||W!==Q||Zi?(typeof le=="function"&&(xc(n,o,le,f),Q=n.memoizedState),(N=Zi||Ug(n,o,N,f,W,Q,L))?(ne||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(n.flags|=4194308)):(typeof v.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=f,n.memoizedState=Q),v.props=f,v.state=Q,v.context=L,f=N):(typeof v.componentDidMount=="function"&&(n.flags|=4194308),f=!1)}else{v=n.stateNode,tc(i,n),L=n.memoizedProps,ne=Gn(o,L),v.props=ne,le=n.pendingProps,W=v.context,Q=o.contextType,N=gr,typeof Q=="object"&&Q!==null&&(N=ns(Q)),D=o.getDerivedStateFromProps,(Q=typeof D=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(L!==le||W!==N)&&Bg(n,v,f,N),Zi=!1,W=n.memoizedState,v.state=W,ba(n,f,v,m),xa();var Z=n.memoizedState;L!==le||W!==Z||Zi||i!==null&&i.dependencies!==null&&Ol(i.dependencies)?(typeof D=="function"&&(xc(n,o,D,f),Z=n.memoizedState),(ne=Zi||Ug(n,o,ne,f,W,Z,N)||i!==null&&i.dependencies!==null&&Ol(i.dependencies))?(Q||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(f,Z,N),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(f,Z,N)),typeof v.componentDidUpdate=="function"&&(n.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof v.componentDidUpdate!="function"||L===i.memoizedProps&&W===i.memoizedState||(n.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||L===i.memoizedProps&&W===i.memoizedState||(n.flags|=1024),n.memoizedProps=f,n.memoizedState=Z),v.props=f,v.state=Z,v.context=N,f=ne):(typeof v.componentDidUpdate!="function"||L===i.memoizedProps&&W===i.memoizedState||(n.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||L===i.memoizedProps&&W===i.memoizedState||(n.flags|=1024),f=!1)}return v=f,Zl(i,n),f=(n.flags&128)!==0,v||f?(v=n.stateNode,o=f&&typeof o.getDerivedStateFromError!="function"?null:v.render(),n.flags|=1,i!==null&&f?(n.child=Ar(n,i.child,null,m),n.child=Ar(n,null,o,m)):Zt(i,n,o,m),n.memoizedState=v.state,i=n.child):i=Oi(i,n,m),i}function Jg(i,n,o,f){return ga(),n.flags|=256,Zt(i,n,o,f),n.child}var Rc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function _c(i){return{baseLanes:i,cachePool:$h()}}function Ic(i,n,o){return i=i!==null?i.childLanes&~o:0,n&&(i|=Ys),i}function e0(i,n,o){var f=n.pendingProps,m=!1,v=(n.flags&128)!==0,L;if((L=v)||(L=i!==null&&i.memoizedState===null?!1:(Ht.current&2)!==0),L&&(m=!0,n.flags&=-129),L=(n.flags&32)!==0,n.flags&=-33,i===null){if(Je){if(m?sn(n):nn(),Je){var D=Dt,N;if(N=D){e:{for(N=D,D=ui;N.nodeType!==8;){if(!D){D=null;break e}if(N=ti(N.nextSibling),N===null){D=null;break e}}D=N}D!==null?(n.memoizedState={dehydrated:D,treeContext:On!==null?{id:_i,overflow:Ii}:null,retryLane:536870912,hydrationErrors:null},N=_s(18,null,null,0),N.stateNode=D,N.return=n,n.child=N,ls=n,Dt=null,N=!0):N=!1}N||Pn(n)}if(D=n.memoizedState,D!==null&&(D=D.dehydrated,D!==null))return df(D)?n.lanes=32:n.lanes=536870912,null;wi(n)}return D=f.children,f=f.fallback,m?(nn(),m=n.mode,D=Jl({mode:"hidden",children:D},m),f=wn(f,m,o,null),D.return=n,f.return=n,D.sibling=f,n.child=D,m=n.child,m.memoizedState=_c(o),m.childLanes=Ic(i,L,o),n.memoizedState=Rc,f):(sn(n),Dc(n,D))}if(N=i.memoizedState,N!==null&&(D=N.dehydrated,D!==null)){if(v)n.flags&256?(sn(n),n.flags&=-257,n=Cc(i,n,o)):n.memoizedState!==null?(nn(),n.child=i.child,n.flags|=128,n=null):(nn(),m=f.fallback,D=n.mode,f=Jl({mode:"visible",children:f.children},D),m=wn(m,D,o,null),m.flags|=2,f.return=n,m.return=n,f.sibling=m,n.child=f,Ar(n,i.child,null,o),f=n.child,f.memoizedState=_c(o),f.childLanes=Ic(i,L,o),n.memoizedState=Rc,n=m);else if(sn(n),df(D)){if(L=D.nextSibling&&D.nextSibling.dataset,L)var Q=L.dgst;L=Q,f=Error(s(419)),f.stack="",f.digest=L,ma({value:f,source:null,stack:null}),n=Cc(i,n,o)}else if(zt||pa(i,n,o,!1),L=(o&i.childLanes)!==0,zt||L){if(L=Tt,L!==null&&(f=o&-o,f=(f&42)!==0?1:ds(f),f=(f&(L.suspendedLanes|o))!==0?0:f,f!==0&&f!==N.retryLane))throw N.retryLane=f,hr(i,f),ws(L,i,f),Kg;D.data==="$?"||qc(),n=Cc(i,n,o)}else D.data==="$?"?(n.flags|=192,n.child=i.child,n=null):(i=N.treeContext,Dt=ti(D.nextSibling),ls=n,Je=!0,Nn=null,ui=!1,i!==null&&(Vs[Ks++]=_i,Vs[Ks++]=Ii,Vs[Ks++]=On,_i=i.id,Ii=i.overflow,On=n),n=Dc(n,f.children),n.flags|=4096);return n}return m?(nn(),m=f.fallback,D=n.mode,N=i.child,Q=N.sibling,f=Ri(N,{mode:"hidden",children:f.children}),f.subtreeFlags=N.subtreeFlags&65011712,Q!==null?m=Ri(Q,m):(m=wn(m,D,o,null),m.flags|=2),m.return=n,f.return=n,f.sibling=m,n.child=f,f=m,m=n.child,D=i.child.memoizedState,D===null?D=_c(o):(N=D.cachePool,N!==null?(Q=jt._currentValue,N=N.parent!==Q?{parent:Q,pool:Q}:N):N=$h(),D={baseLanes:D.baseLanes|o,cachePool:N}),m.memoizedState=D,m.childLanes=Ic(i,L,o),n.memoizedState=Rc,f):(sn(n),o=i.child,i=o.sibling,o=Ri(o,{mode:"visible",children:f.children}),o.return=n,o.sibling=null,i!==null&&(L=n.deletions,L===null?(n.deletions=[i],n.flags|=16):L.push(i)),n.child=o,n.memoizedState=null,o)}function Dc(i,n){return n=Jl({mode:"visible",children:n},i.mode),n.return=i,i.child=n}function Jl(i,n){return i=_s(22,i,null,n),i.lanes=0,i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},i}function Cc(i,n,o){return Ar(n,i.child,null,o),i=Dc(n,n.pendingProps.children),i.flags|=2,n.memoizedState=null,i}function t0(i,n,o){i.lanes|=n;var f=i.alternate;f!==null&&(f.lanes|=n),qu(i.return,n,o)}function kc(i,n,o,f,m){var v=i.memoizedState;v===null?i.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:f,tail:o,tailMode:m}:(v.isBackwards=n,v.rendering=null,v.renderingStartTime=0,v.last=f,v.tail=o,v.tailMode=m)}function s0(i,n,o){var f=n.pendingProps,m=f.revealOrder,v=f.tail;if(Zt(i,n,f.children,o),f=Ht.current,(f&2)!==0)f=f&1|2,n.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=n.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&t0(i,o,n);else if(i.tag===19)t0(i,o,n);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break e;for(;i.sibling===null;){if(i.return===null||i.return===n)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}f&=1}switch(ie(Ht,f),m){case"forwards":for(o=n.child,m=null;o!==null;)i=o.alternate,i!==null&&Xl(i)===null&&(m=o),o=o.sibling;o=m,o===null?(m=n.child,n.child=null):(m=o.sibling,o.sibling=null),kc(n,!1,m,o,v);break;case"backwards":for(o=null,m=n.child,n.child=null;m!==null;){if(i=m.alternate,i!==null&&Xl(i)===null){n.child=m;break}i=m.sibling,m.sibling=o,o=m,m=i}kc(n,!0,o,null,v);break;case"together":kc(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function Oi(i,n,o){if(i!==null&&(n.dependencies=i.dependencies),un|=n.lanes,(o&n.childLanes)===0)if(i!==null){if(pa(i,n,o,!1),(o&n.childLanes)===0)return null}else return null;if(i!==null&&n.child!==i.child)throw Error(s(153));if(n.child!==null){for(i=n.child,o=Ri(i,i.pendingProps),n.child=o,o.return=n;i.sibling!==null;)i=i.sibling,o=o.sibling=Ri(i,i.pendingProps),o.return=n;o.sibling=null}return n.child}function wc(i,n){return(i.lanes&n)!==0?!0:(i=i.dependencies,!!(i!==null&&Ol(i)))}function zE(i,n,o){switch(n.tag){case 3:be(n,n.stateNode.containerInfo),Wi(n,jt,i.memoizedState.cache),ga();break;case 27:case 5:tt(n);break;case 4:be(n,n.stateNode.containerInfo);break;case 10:Wi(n,n.type,n.memoizedProps.value);break;case 13:var f=n.memoizedState;if(f!==null)return f.dehydrated!==null?(sn(n),n.flags|=128,null):(o&n.child.childLanes)!==0?e0(i,n,o):(sn(n),i=Oi(i,n,o),i!==null?i.sibling:null);sn(n);break;case 19:var m=(i.flags&128)!==0;if(f=(o&n.childLanes)!==0,f||(pa(i,n,o,!1),f=(o&n.childLanes)!==0),m){if(f)return s0(i,n,o);n.flags|=128}if(m=n.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),ie(Ht,Ht.current),f)break;return null;case 22:case 23:return n.lanes=0,Xg(i,n,o);case 24:Wi(n,jt,i.memoizedState.cache)}return Oi(i,n,o)}function i0(i,n,o){if(i!==null)if(i.memoizedProps!==n.pendingProps)zt=!0;else{if(!wc(i,o)&&(n.flags&128)===0)return zt=!1,zE(i,n,o);zt=(i.flags&131072)!==0}else zt=!1,Je&&(n.flags&1048576)!==0&&Oh(n,wl,n.index);switch(n.lanes=0,n.tag){case 16:e:{i=n.pendingProps;var f=n.elementType,m=f._init;if(f=m(f._payload),n.type=f,typeof f=="function")Gu(f)?(i=Gn(f,i),n.tag=1,n=Zg(null,n,f,i,o)):(n.tag=0,n=Lc(null,n,f,i,o));else{if(f!=null){if(m=f.$$typeof,m===C){n.tag=11,n=zg(null,n,f,i,o);break e}else if(m===w){n.tag=14,n=Yg(null,n,f,i,o);break e}}throw n=de(f)||f,Error(s(306,n,""))}}return n;case 0:return Lc(i,n,n.type,n.pendingProps,o);case 1:return f=n.type,m=Gn(f,n.pendingProps),Zg(i,n,f,m,o);case 3:e:{if(be(n,n.stateNode.containerInfo),i===null)throw Error(s(387));f=n.pendingProps;var v=n.memoizedState;m=v.element,tc(i,n),ba(n,f,null,o);var L=n.memoizedState;if(f=L.cache,Wi(n,jt,f),f!==v.cache&&Xu(n,[jt],o,!0),xa(),f=L.element,v.isDehydrated)if(v={element:f,isDehydrated:!1,cache:L.cache},n.updateQueue.baseState=v,n.memoizedState=v,n.flags&256){n=Jg(i,n,f,o);break e}else if(f!==m){m=js(Error(s(424)),n),ma(m),n=Jg(i,n,f,o);break e}else{switch(i=n.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(Dt=ti(i.firstChild),ls=n,Je=!0,Nn=null,ui=!0,o=Ng(n,null,f,o),n.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling}else{if(ga(),f===m){n=Oi(i,n,o);break e}Zt(i,n,f,o)}n=n.child}return n;case 26:return Zl(i,n),i===null?(o=lm(n.type,null,n.pendingProps,null))?n.memoizedState=o:Je||(o=n.type,i=n.pendingProps,f=go(he.current).createElement(o),f[wt]=n,f[is]=i,es(f,o,i),bt(f),n.stateNode=f):n.memoizedState=lm(n.type,i.memoizedProps,n.pendingProps,i.memoizedState),null;case 27:return tt(n),i===null&&Je&&(f=n.stateNode=nm(n.type,n.pendingProps,he.current),ls=n,ui=!0,m=Dt,hn(n.type)?(hf=m,Dt=ti(f.firstChild)):Dt=m),Zt(i,n,n.pendingProps.children,o),Zl(i,n),i===null&&(n.flags|=4194304),n.child;case 5:return i===null&&Je&&((m=f=Dt)&&(f=TT(f,n.type,n.pendingProps,ui),f!==null?(n.stateNode=f,ls=n,Dt=ti(f.firstChild),ui=!1,m=!0):m=!1),m||Pn(n)),tt(n),m=n.type,v=n.pendingProps,L=i!==null?i.memoizedProps:null,f=v.children,uf(m,v)?f=null:L!==null&&uf(m,L)&&(n.flags|=32),n.memoizedState!==null&&(m=lc(i,n,BE,null,null,o),Ka._currentValue=m),Zl(i,n),Zt(i,n,f,o),n.child;case 6:return i===null&&Je&&((i=o=Dt)&&(o=ST(o,n.pendingProps,ui),o!==null?(n.stateNode=o,ls=n,Dt=null,i=!0):i=!1),i||Pn(n)),null;case 13:return e0(i,n,o);case 4:return be(n,n.stateNode.containerInfo),f=n.pendingProps,i===null?n.child=Ar(n,null,f,o):Zt(i,n,f,o),n.child;case 11:return zg(i,n,n.type,n.pendingProps,o);case 7:return Zt(i,n,n.pendingProps,o),n.child;case 8:return Zt(i,n,n.pendingProps.children,o),n.child;case 12:return Zt(i,n,n.pendingProps.children,o),n.child;case 10:return f=n.pendingProps,Wi(n,n.type,f.value),Zt(i,n,f.children,o),n.child;case 9:return m=n.type._context,f=n.pendingProps.children,Bn(n),m=ns(m),f=f(m),n.flags|=1,Zt(i,n,f,o),n.child;case 14:return Yg(i,n,n.type,n.pendingProps,o);case 15:return qg(i,n,n.type,n.pendingProps,o);case 19:return s0(i,n,o);case 31:return f=n.pendingProps,o=n.mode,f={mode:f.mode,children:f.children},i===null?(o=Jl(f,o),o.ref=n.ref,n.child=o,o.return=n,n=o):(o=Ri(i.child,f),o.ref=n.ref,n.child=o,o.return=n,n=o),n;case 22:return Xg(i,n,o);case 24:return Bn(n),f=ns(jt),i===null?(m=Zu(),m===null&&(m=Tt,v=Qu(),m.pooledCache=v,v.refCount++,v!==null&&(m.pooledCacheLanes|=o),m=v),n.memoizedState={parent:f,cache:m},ec(n),Wi(n,jt,m)):((i.lanes&o)!==0&&(tc(i,n),ba(n,null,null,o),xa()),m=i.memoizedState,v=n.memoizedState,m.parent!==f?(m={parent:f,cache:f},n.memoizedState=m,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=m),Wi(n,jt,f)):(f=v.cache,Wi(n,jt,f),f!==m.cache&&Xu(n,[jt],o,!0))),Zt(i,n,n.pendingProps.children,o),n.child;case 29:throw n.pendingProps}throw Error(s(156,n.tag))}function Mi(i){i.flags|=4}function n0(i,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!dm(n)){if(n=zs.current,n!==null&&((Xe&4194048)===Xe?ci!==null:(Xe&62914560)!==Xe&&(Xe&536870912)===0||n!==ci))throw Ta=Ju,Gh;i.flags|=8192}}function eo(i,n){n!==null&&(i.flags|=4),i.flags&16384&&(n=i.tag!==22?ea():536870912,i.lanes|=n,Ir|=n)}function Ca(i,n){if(!Je)switch(i.tailMode){case"hidden":n=i.tail;for(var o=null;n!==null;)n.alternate!==null&&(o=n),n=n.sibling;o===null?i.tail=null:o.sibling=null;break;case"collapsed":o=i.tail;for(var f=null;o!==null;)o.alternate!==null&&(f=o),o=o.sibling;f===null?n||i.tail===null?i.tail=null:i.tail.sibling=null:f.sibling=null}}function Lt(i){var n=i.alternate!==null&&i.alternate.child===i.child,o=0,f=0;if(n)for(var m=i.child;m!==null;)o|=m.lanes|m.childLanes,f|=m.subtreeFlags&65011712,f|=m.flags&65011712,m.return=i,m=m.sibling;else for(m=i.child;m!==null;)o|=m.lanes|m.childLanes,f|=m.subtreeFlags,f|=m.flags,m.return=i,m=m.sibling;return i.subtreeFlags|=f,i.childLanes=o,n}function YE(i,n,o){var f=n.pendingProps;switch(Ku(n),n.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Lt(n),null;case 1:return Lt(n),null;case 3:return o=n.stateNode,f=null,i!==null&&(f=i.memoizedState.cache),n.memoizedState.cache!==f&&(n.flags|=2048),Ci(jt),ht(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(i===null||i.child===null)&&(ha(n)?Mi(n):i===null||i.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,Ph())),Lt(n),null;case 26:return o=n.memoizedState,i===null?(Mi(n),o!==null?(Lt(n),n0(n,o)):(Lt(n),n.flags&=-16777217)):o?o!==i.memoizedState?(Mi(n),Lt(n),n0(n,o)):(Lt(n),n.flags&=-16777217):(i.memoizedProps!==f&&Mi(n),Lt(n),n.flags&=-16777217),null;case 27:Pt(n),o=he.current;var m=n.type;if(i!==null&&n.stateNode!=null)i.memoizedProps!==f&&Mi(n);else{if(!f){if(n.stateNode===null)throw Error(s(166));return Lt(n),null}i=fe.current,ha(n)?Mh(n):(i=nm(m,f,o),n.stateNode=i,Mi(n))}return Lt(n),null;case 5:if(Pt(n),o=n.type,i!==null&&n.stateNode!=null)i.memoizedProps!==f&&Mi(n);else{if(!f){if(n.stateNode===null)throw Error(s(166));return Lt(n),null}if(i=fe.current,ha(n))Mh(n);else{switch(m=go(he.current),i){case 1:i=m.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:i=m.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":i=m.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":i=m.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":i=m.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof f.is=="string"?m.createElement("select",{is:f.is}):m.createElement("select"),f.multiple?i.multiple=!0:f.size&&(i.size=f.size);break;default:i=typeof f.is=="string"?m.createElement(o,{is:f.is}):m.createElement(o)}}i[wt]=n,i[is]=f;e:for(m=n.child;m!==null;){if(m.tag===5||m.tag===6)i.appendChild(m.stateNode);else if(m.tag!==4&&m.tag!==27&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===n)break e;for(;m.sibling===null;){if(m.return===null||m.return===n)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}n.stateNode=i;e:switch(es(i,o,f),o){case"button":case"input":case"select":case"textarea":i=!!f.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&Mi(n)}}return Lt(n),n.flags&=-16777217,null;case 6:if(i&&n.stateNode!=null)i.memoizedProps!==f&&Mi(n);else{if(typeof f!="string"&&n.stateNode===null)throw Error(s(166));if(i=he.current,ha(n)){if(i=n.stateNode,o=n.memoizedProps,f=null,m=ls,m!==null)switch(m.tag){case 27:case 5:f=m.memoizedProps}i[wt]=n,i=!!(i.nodeValue===o||f!==null&&f.suppressHydrationWarning===!0||W0(i.nodeValue,o)),i||Pn(n)}else i=go(i).createTextNode(f),i[wt]=n,n.stateNode=i}return Lt(n),null;case 13:if(f=n.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(m=ha(n),f!==null&&f.dehydrated!==null){if(i===null){if(!m)throw Error(s(318));if(m=n.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(s(317));m[wt]=n}else ga(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Lt(n),m=!1}else m=Ph(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=m),m=!0;if(!m)return n.flags&256?(wi(n),n):(wi(n),null)}if(wi(n),(n.flags&128)!==0)return n.lanes=o,n;if(o=f!==null,i=i!==null&&i.memoizedState!==null,o){f=n.child,m=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(m=f.alternate.memoizedState.cachePool.pool);var v=null;f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(v=f.memoizedState.cachePool.pool),v!==m&&(f.flags|=2048)}return o!==i&&o&&(n.child.flags|=8192),eo(n,n.updateQueue),Lt(n),null;case 4:return ht(),i===null&&nf(n.stateNode.containerInfo),Lt(n),null;case 10:return Ci(n.type),Lt(n),null;case 19:if(Y(Ht),m=n.memoizedState,m===null)return Lt(n),null;if(f=(n.flags&128)!==0,v=m.rendering,v===null)if(f)Ca(m,!1);else{if(Ct!==0||i!==null&&(i.flags&128)!==0)for(i=n.child;i!==null;){if(v=Xl(i),v!==null){for(n.flags|=128,Ca(m,!1),i=v.updateQueue,n.updateQueue=i,eo(n,i),n.subtreeFlags=0,i=o,o=n.child;o!==null;)wh(o,i),o=o.sibling;return ie(Ht,Ht.current&1|2),n.child}i=i.sibling}m.tail!==null&&We()>io&&(n.flags|=128,f=!0,Ca(m,!1),n.lanes=4194304)}else{if(!f)if(i=Xl(v),i!==null){if(n.flags|=128,f=!0,i=i.updateQueue,n.updateQueue=i,eo(n,i),Ca(m,!0),m.tail===null&&m.tailMode==="hidden"&&!v.alternate&&!Je)return Lt(n),null}else 2*We()-m.renderingStartTime>io&&o!==536870912&&(n.flags|=128,f=!0,Ca(m,!1),n.lanes=4194304);m.isBackwards?(v.sibling=n.child,n.child=v):(i=m.last,i!==null?i.sibling=v:n.child=v,m.last=v)}return m.tail!==null?(n=m.tail,m.rendering=n,m.tail=n.sibling,m.renderingStartTime=We(),n.sibling=null,i=Ht.current,ie(Ht,f?i&1|2:i&1),n):(Lt(n),null);case 22:case 23:return wi(n),rc(),f=n.memoizedState!==null,i!==null?i.memoizedState!==null!==f&&(n.flags|=8192):f&&(n.flags|=8192),f?(o&536870912)!==0&&(n.flags&128)===0&&(Lt(n),n.subtreeFlags&6&&(n.flags|=8192)):Lt(n),o=n.updateQueue,o!==null&&eo(n,o.retryQueue),o=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(o=i.memoizedState.cachePool.pool),f=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(f=n.memoizedState.cachePool.pool),f!==o&&(n.flags|=2048),i!==null&&Y(Fn),null;case 24:return o=null,i!==null&&(o=i.memoizedState.cache),n.memoizedState.cache!==o&&(n.flags|=2048),Ci(jt),Lt(n),null;case 25:return null;case 30:return null}throw Error(s(156,n.tag))}function qE(i,n){switch(Ku(n),n.tag){case 1:return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 3:return Ci(jt),ht(),i=n.flags,(i&65536)!==0&&(i&128)===0?(n.flags=i&-65537|128,n):null;case 26:case 27:case 5:return Pt(n),null;case 13:if(wi(n),i=n.memoizedState,i!==null&&i.dehydrated!==null){if(n.alternate===null)throw Error(s(340));ga()}return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 19:return Y(Ht),null;case 4:return ht(),null;case 10:return Ci(n.type),null;case 22:case 23:return wi(n),rc(),i!==null&&Y(Fn),i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 24:return Ci(jt),null;case 25:return null;default:return null}}function r0(i,n){switch(Ku(n),n.tag){case 3:Ci(jt),ht();break;case 26:case 27:case 5:Pt(n);break;case 4:ht();break;case 13:wi(n);break;case 19:Y(Ht);break;case 10:Ci(n.type);break;case 22:case 23:wi(n),rc(),i!==null&&Y(Fn);break;case 24:Ci(jt)}}function ka(i,n){try{var o=n.updateQueue,f=o!==null?o.lastEffect:null;if(f!==null){var m=f.next;o=m;do{if((o.tag&i)===i){f=void 0;var v=o.create,L=o.inst;f=v(),L.destroy=f}o=o.next}while(o!==m)}}catch(D){gt(n,n.return,D)}}function rn(i,n,o){try{var f=n.updateQueue,m=f!==null?f.lastEffect:null;if(m!==null){var v=m.next;f=v;do{if((f.tag&i)===i){var L=f.inst,D=L.destroy;if(D!==void 0){L.destroy=void 0,m=n;var N=o,Q=D;try{Q()}catch(ne){gt(m,N,ne)}}}f=f.next}while(f!==v)}}catch(ne){gt(n,n.return,ne)}}function a0(i){var n=i.updateQueue;if(n!==null){var o=i.stateNode;try{Yh(n,o)}catch(f){gt(i,i.return,f)}}}function l0(i,n,o){o.props=Gn(i.type,i.memoizedProps),o.state=i.memoizedState;try{o.componentWillUnmount()}catch(f){gt(i,n,f)}}function wa(i,n){try{var o=i.ref;if(o!==null){switch(i.tag){case 26:case 27:case 5:var f=i.stateNode;break;case 30:f=i.stateNode;break;default:f=i.stateNode}typeof o=="function"?i.refCleanup=o(f):o.current=f}}catch(m){gt(i,n,m)}}function fi(i,n){var o=i.ref,f=i.refCleanup;if(o!==null)if(typeof f=="function")try{f()}catch(m){gt(i,n,m)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(m){gt(i,n,m)}else o.current=null}function o0(i){var n=i.type,o=i.memoizedProps,f=i.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":o.autoFocus&&f.focus();break e;case"img":o.src?f.src=o.src:o.srcSet&&(f.srcset=o.srcSet)}}catch(m){gt(i,i.return,m)}}function Oc(i,n,o){try{var f=i.stateNode;mT(f,i.type,o,n),f[is]=n}catch(m){gt(i,i.return,m)}}function u0(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&hn(i.type)||i.tag===4}function Mc(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||u0(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&hn(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Nc(i,n,o){var f=i.tag;if(f===5||f===6)i=i.stateNode,n?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(i,n):(n=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,n.appendChild(i),o=o._reactRootContainer,o!=null||n.onclick!==null||(n.onclick=ho));else if(f!==4&&(f===27&&hn(i.type)&&(o=i.stateNode,n=null),i=i.child,i!==null))for(Nc(i,n,o),i=i.sibling;i!==null;)Nc(i,n,o),i=i.sibling}function to(i,n,o){var f=i.tag;if(f===5||f===6)i=i.stateNode,n?o.insertBefore(i,n):o.appendChild(i);else if(f!==4&&(f===27&&hn(i.type)&&(o=i.stateNode),i=i.child,i!==null))for(to(i,n,o),i=i.sibling;i!==null;)to(i,n,o),i=i.sibling}function c0(i){var n=i.stateNode,o=i.memoizedProps;try{for(var f=i.type,m=n.attributes;m.length;)n.removeAttributeNode(m[0]);es(n,f,o),n[wt]=i,n[is]=o}catch(v){gt(i,i.return,v)}}var Ni=!1,Mt=!1,Pc=!1,f0=typeof WeakSet=="function"?WeakSet:Set,Yt=null;function XE(i,n){if(i=i.containerInfo,lf=To,i=xh(i),Mu(i)){if("selectionStart"in i)var o={start:i.selectionStart,end:i.selectionEnd};else e:{o=(o=i.ownerDocument)&&o.defaultView||window;var f=o.getSelection&&o.getSelection();if(f&&f.rangeCount!==0){o=f.anchorNode;var m=f.anchorOffset,v=f.focusNode;f=f.focusOffset;try{o.nodeType,v.nodeType}catch(De){o=null;break e}var L=0,D=-1,N=-1,Q=0,ne=0,le=i,W=null;t:for(;;){for(var Z;le!==o||m!==0&&le.nodeType!==3||(D=L+m),le!==v||f!==0&&le.nodeType!==3||(N=L+f),le.nodeType===3&&(L+=le.nodeValue.length),(Z=le.firstChild)!==null;)W=le,le=Z;for(;;){if(le===i)break t;if(W===o&&++Q===m&&(D=L),W===v&&++ne===f&&(N=L),(Z=le.nextSibling)!==null)break;le=W,W=le.parentNode}le=Z}o=D===-1||N===-1?null:{start:D,end:N}}else o=null}o=o||{start:0,end:0}}else o=null;for(of={focusedElem:i,selectionRange:o},To=!1,Yt=n;Yt!==null;)if(n=Yt,i=n.child,(n.subtreeFlags&1024)!==0&&i!==null)i.return=n,Yt=i;else for(;Yt!==null;){switch(n=Yt,v=n.alternate,i=n.flags,n.tag){case 0:break;case 11:case 15:break;case 1:if((i&1024)!==0&&v!==null){i=void 0,o=n,m=v.memoizedProps,v=v.memoizedState,f=o.stateNode;try{var we=Gn(o.type,m,o.elementType===o.type);i=f.getSnapshotBeforeUpdate(we,v),f.__reactInternalSnapshotBeforeUpdate=i}catch(De){gt(o,o.return,De)}}break;case 3:if((i&1024)!==0){if(i=n.stateNode.containerInfo,o=i.nodeType,o===9)ff(i);else if(o===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":ff(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(s(163))}if(i=n.sibling,i!==null){i.return=n.return,Yt=i;break}Yt=n.return}}function d0(i,n,o){var f=o.flags;switch(o.tag){case 0:case 11:case 15:an(i,o),f&4&&ka(5,o);break;case 1:if(an(i,o),f&4)if(i=o.stateNode,n===null)try{i.componentDidMount()}catch(L){gt(o,o.return,L)}else{var m=Gn(o.type,n.memoizedProps);n=n.memoizedState;try{i.componentDidUpdate(m,n,i.__reactInternalSnapshotBeforeUpdate)}catch(L){gt(o,o.return,L)}}f&64&&a0(o),f&512&&wa(o,o.return);break;case 3:if(an(i,o),f&64&&(i=o.updateQueue,i!==null)){if(n=null,o.child!==null)switch(o.child.tag){case 27:case 5:n=o.child.stateNode;break;case 1:n=o.child.stateNode}try{Yh(i,n)}catch(L){gt(o,o.return,L)}}break;case 27:n===null&&f&4&&c0(o);case 26:case 5:an(i,o),n===null&&f&4&&o0(o),f&512&&wa(o,o.return);break;case 12:an(i,o);break;case 13:an(i,o),f&4&&m0(i,o),f&64&&(i=o.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(o=nT.bind(null,o),xT(i,o))));break;case 22:if(f=o.memoizedState!==null||Ni,!f){n=n!==null&&n.memoizedState!==null||Mt,m=Ni;var v=Mt;Ni=f,(Mt=n)&&!v?ln(i,o,(o.subtreeFlags&8772)!==0):an(i,o),Ni=m,Mt=v}break;case 30:break;default:an(i,o)}}function h0(i){var n=i.alternate;n!==null&&(i.alternate=null,h0(n)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(n=i.stateNode,n!==null&&Yi(n)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var At=null,ys=!1;function Pi(i,n,o){for(o=o.child;o!==null;)g0(i,n,o),o=o.sibling}function g0(i,n,o){if(pe&&typeof pe.onCommitFiberUnmount=="function")try{pe.onCommitFiberUnmount(Ae,o)}catch(v){}switch(o.tag){case 26:Mt||fi(o,n),Pi(i,n,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:Mt||fi(o,n);var f=At,m=ys;hn(o.type)&&(At=o.stateNode,ys=!1),Pi(i,n,o),Ga(o.stateNode),At=f,ys=m;break;case 5:Mt||fi(o,n);case 6:if(f=At,m=ys,At=null,Pi(i,n,o),At=f,ys=m,At!==null)if(ys)try{(At.nodeType===9?At.body:At.nodeName==="HTML"?At.ownerDocument.body:At).removeChild(o.stateNode)}catch(v){gt(o,n,v)}else try{At.removeChild(o.stateNode)}catch(v){gt(o,n,v)}break;case 18:At!==null&&(ys?(i=At,sm(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,o.stateNode),Xa(i)):sm(At,o.stateNode));break;case 4:f=At,m=ys,At=o.stateNode.containerInfo,ys=!0,Pi(i,n,o),At=f,ys=m;break;case 0:case 11:case 14:case 15:Mt||rn(2,o,n),Mt||rn(4,o,n),Pi(i,n,o);break;case 1:Mt||(fi(o,n),f=o.stateNode,typeof f.componentWillUnmount=="function"&&l0(o,n,f)),Pi(i,n,o);break;case 21:Pi(i,n,o);break;case 22:Mt=(f=Mt)||o.memoizedState!==null,Pi(i,n,o),Mt=f;break;default:Pi(i,n,o)}}function m0(i,n){if(n.memoizedState===null&&(i=n.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Xa(i)}catch(o){gt(n,n.return,o)}}function QE(i){switch(i.tag){case 13:case 19:var n=i.stateNode;return n===null&&(n=i.stateNode=new f0),n;case 22:return i=i.stateNode,n=i._retryCache,n===null&&(n=i._retryCache=new f0),n;default:throw Error(s(435,i.tag))}}function Uc(i,n){var o=QE(i);n.forEach(function(f){var m=rT.bind(null,i,f);o.has(f)||(o.add(f),f.then(m,m))})}function Is(i,n){var o=n.deletions;if(o!==null)for(var f=0;f<o.length;f++){var m=o[f],v=i,L=n,D=L;e:for(;D!==null;){switch(D.tag){case 27:if(hn(D.type)){At=D.stateNode,ys=!1;break e}break;case 5:At=D.stateNode,ys=!1;break e;case 3:case 4:At=D.stateNode.containerInfo,ys=!0;break e}D=D.return}if(At===null)throw Error(s(160));g0(v,L,m),At=null,ys=!1,v=m.alternate,v!==null&&(v.return=null),m.return=null}if(n.subtreeFlags&13878)for(n=n.child;n!==null;)p0(n,i),n=n.sibling}var ei=null;function p0(i,n){var o=i.alternate,f=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:Is(n,i),Ds(i),f&4&&(rn(3,i,i.return),ka(3,i),rn(5,i,i.return));break;case 1:Is(n,i),Ds(i),f&512&&(Mt||o===null||fi(o,o.return)),f&64&&Ni&&(i=i.updateQueue,i!==null&&(f=i.callbacks,f!==null&&(o=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=o===null?f:o.concat(f))));break;case 26:var m=ei;if(Is(n,i),Ds(i),f&512&&(Mt||o===null||fi(o,o.return)),f&4){var v=o!==null?o.memoizedState:null;if(f=i.memoizedState,o===null)if(f===null)if(i.stateNode===null){e:{f=i.type,o=i.memoizedProps,m=m.ownerDocument||m;t:switch(f){case"title":v=m.getElementsByTagName("title")[0],(!v||v[zi]||v[wt]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=m.createElement(f),m.head.insertBefore(v,m.querySelector("head > title"))),es(v,f,o),v[wt]=i,bt(v),f=v;break e;case"link":var L=cm("link","href",m).get(f+(o.href||""));if(L){for(var D=0;D<L.length;D++)if(v=L[D],v.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&v.getAttribute("rel")===(o.rel==null?null:o.rel)&&v.getAttribute("title")===(o.title==null?null:o.title)&&v.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){L.splice(D,1);break t}}v=m.createElement(f),es(v,f,o),m.head.appendChild(v);break;case"meta":if(L=cm("meta","content",m).get(f+(o.content||""))){for(D=0;D<L.length;D++)if(v=L[D],v.getAttribute("content")===(o.content==null?null:""+o.content)&&v.getAttribute("name")===(o.name==null?null:o.name)&&v.getAttribute("property")===(o.property==null?null:o.property)&&v.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&v.getAttribute("charset")===(o.charSet==null?null:o.charSet)){L.splice(D,1);break t}}v=m.createElement(f),es(v,f,o),m.head.appendChild(v);break;default:throw Error(s(468,f))}v[wt]=i,bt(v),f=v}i.stateNode=f}else fm(m,i.type,i.stateNode);else i.stateNode=um(m,f,i.memoizedProps);else v!==f?(v===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):v.count--,f===null?fm(m,i.type,i.stateNode):um(m,f,i.memoizedProps)):f===null&&i.stateNode!==null&&Oc(i,i.memoizedProps,o.memoizedProps)}break;case 27:Is(n,i),Ds(i),f&512&&(Mt||o===null||fi(o,o.return)),o!==null&&f&4&&Oc(i,i.memoizedProps,o.memoizedProps);break;case 5:if(Is(n,i),Ds(i),f&512&&(Mt||o===null||fi(o,o.return)),i.flags&32){m=i.stateNode;try{ar(m,"")}catch(Z){gt(i,i.return,Z)}}f&4&&i.stateNode!=null&&(m=i.memoizedProps,Oc(i,m,o!==null?o.memoizedProps:m)),f&1024&&(Pc=!0);break;case 6:if(Is(n,i),Ds(i),f&4){if(i.stateNode===null)throw Error(s(162));f=i.memoizedProps,o=i.stateNode;try{o.nodeValue=f}catch(Z){gt(i,i.return,Z)}}break;case 3:if(yo=null,m=ei,ei=mo(n.containerInfo),Is(n,i),ei=m,Ds(i),f&4&&o!==null&&o.memoizedState.isDehydrated)try{Xa(n.containerInfo)}catch(Z){gt(i,i.return,Z)}Pc&&(Pc=!1,y0(i));break;case 4:f=ei,ei=mo(i.stateNode.containerInfo),Is(n,i),Ds(i),ei=f;break;case 12:Is(n,i),Ds(i);break;case 13:Is(n,i),Ds(i),i.child.flags&8192&&i.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(Hc=We()),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,Uc(i,f)));break;case 22:m=i.memoizedState!==null;var N=o!==null&&o.memoizedState!==null,Q=Ni,ne=Mt;if(Ni=Q||m,Mt=ne||N,Is(n,i),Mt=ne,Ni=Q,Ds(i),f&8192)e:for(n=i.stateNode,n._visibility=m?n._visibility&-2:n._visibility|1,m&&(o===null||N||Ni||Mt||jn(i)),o=null,n=i;;){if(n.tag===5||n.tag===26){if(o===null){N=o=n;try{if(v=N.stateNode,m)L=v.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none";else{D=N.stateNode;var le=N.memoizedProps.style,W=le!=null&&le.hasOwnProperty("display")?le.display:null;D.style.display=W==null||typeof W=="boolean"?"":(""+W).trim()}}catch(Z){gt(N,N.return,Z)}}}else if(n.tag===6){if(o===null){N=n;try{N.stateNode.nodeValue=m?"":N.memoizedProps}catch(Z){gt(N,N.return,Z)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===i)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break e;for(;n.sibling===null;){if(n.return===null||n.return===i)break e;o===n&&(o=null),n=n.return}o===n&&(o=null),n.sibling.return=n.return,n=n.sibling}f&4&&(f=i.updateQueue,f!==null&&(o=f.retryQueue,o!==null&&(f.retryQueue=null,Uc(i,o))));break;case 19:Is(n,i),Ds(i),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,Uc(i,f)));break;case 30:break;case 21:break;default:Is(n,i),Ds(i)}}function Ds(i){var n=i.flags;if(n&2){try{for(var o,f=i.return;f!==null;){if(u0(f)){o=f;break}f=f.return}if(o==null)throw Error(s(160));switch(o.tag){case 27:var m=o.stateNode,v=Mc(i);to(i,v,m);break;case 5:var L=o.stateNode;o.flags&32&&(ar(L,""),o.flags&=-33);var D=Mc(i);to(i,D,L);break;case 3:case 4:var N=o.stateNode.containerInfo,Q=Mc(i);Nc(i,Q,N);break;default:throw Error(s(161))}}catch(ne){gt(i,i.return,ne)}i.flags&=-3}n&4096&&(i.flags&=-4097)}function y0(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var n=i;y0(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),i=i.sibling}}function an(i,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)d0(i,n.alternate,n),n=n.sibling}function jn(i){for(i=i.child;i!==null;){var n=i;switch(n.tag){case 0:case 11:case 14:case 15:rn(4,n,n.return),jn(n);break;case 1:fi(n,n.return);var o=n.stateNode;typeof o.componentWillUnmount=="function"&&l0(n,n.return,o),jn(n);break;case 27:Ga(n.stateNode);case 26:case 5:fi(n,n.return),jn(n);break;case 22:n.memoizedState===null&&jn(n);break;case 30:jn(n);break;default:jn(n)}i=i.sibling}}function ln(i,n,o){for(o=o&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var f=n.alternate,m=i,v=n,L=v.flags;switch(v.tag){case 0:case 11:case 15:ln(m,v,o),ka(4,v);break;case 1:if(ln(m,v,o),f=v,m=f.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(Q){gt(f,f.return,Q)}if(f=v,m=f.updateQueue,m!==null){var D=f.stateNode;try{var N=m.shared.hiddenCallbacks;if(N!==null)for(m.shared.hiddenCallbacks=null,m=0;m<N.length;m++)zh(N[m],D)}catch(Q){gt(f,f.return,Q)}}o&&L&64&&a0(v),wa(v,v.return);break;case 27:c0(v);case 26:case 5:ln(m,v,o),o&&f===null&&L&4&&o0(v),wa(v,v.return);break;case 12:ln(m,v,o);break;case 13:ln(m,v,o),o&&L&4&&m0(m,v);break;case 22:v.memoizedState===null&&ln(m,v,o),wa(v,v.return);break;case 30:break;default:ln(m,v,o)}n=n.sibling}}function Bc(i,n){var o=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(o=i.memoizedState.cachePool.pool),i=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(i=n.memoizedState.cachePool.pool),i!==o&&(i!=null&&i.refCount++,o!=null&&ya(o))}function Fc(i,n){i=null,n.alternate!==null&&(i=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==i&&(n.refCount++,i!=null&&ya(i))}function di(i,n,o,f){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)v0(i,n,o,f),n=n.sibling}function v0(i,n,o,f){var m=n.flags;switch(n.tag){case 0:case 11:case 15:di(i,n,o,f),m&2048&&ka(9,n);break;case 1:di(i,n,o,f);break;case 3:di(i,n,o,f),m&2048&&(i=null,n.alternate!==null&&(i=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==i&&(n.refCount++,i!=null&&ya(i)));break;case 12:if(m&2048){di(i,n,o,f),i=n.stateNode;try{var v=n.memoizedProps,L=v.id,D=v.onPostCommit;typeof D=="function"&&D(L,n.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(N){gt(n,n.return,N)}}else di(i,n,o,f);break;case 13:di(i,n,o,f);break;case 23:break;case 22:v=n.stateNode,L=n.alternate,n.memoizedState!==null?v._visibility&2?di(i,n,o,f):Oa(i,n):v._visibility&2?di(i,n,o,f):(v._visibility|=2,Lr(i,n,o,f,(n.subtreeFlags&10256)!==0)),m&2048&&Bc(L,n);break;case 24:di(i,n,o,f),m&2048&&Fc(n.alternate,n);break;default:di(i,n,o,f)}}function Lr(i,n,o,f,m){for(m=m&&(n.subtreeFlags&10256)!==0,n=n.child;n!==null;){var v=i,L=n,D=o,N=f,Q=L.flags;switch(L.tag){case 0:case 11:case 15:Lr(v,L,D,N,m),ka(8,L);break;case 23:break;case 22:var ne=L.stateNode;L.memoizedState!==null?ne._visibility&2?Lr(v,L,D,N,m):Oa(v,L):(ne._visibility|=2,Lr(v,L,D,N,m)),m&&Q&2048&&Bc(L.alternate,L);break;case 24:Lr(v,L,D,N,m),m&&Q&2048&&Fc(L.alternate,L);break;default:Lr(v,L,D,N,m)}n=n.sibling}}function Oa(i,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var o=i,f=n,m=f.flags;switch(f.tag){case 22:Oa(o,f),m&2048&&Bc(f.alternate,f);break;case 24:Oa(o,f),m&2048&&Fc(f.alternate,f);break;default:Oa(o,f)}n=n.sibling}}var Ma=8192;function Rr(i){if(i.subtreeFlags&Ma)for(i=i.child;i!==null;)E0(i),i=i.sibling}function E0(i){switch(i.tag){case 26:Rr(i),i.flags&Ma&&i.memoizedState!==null&&NT(ei,i.memoizedState,i.memoizedProps);break;case 5:Rr(i);break;case 3:case 4:var n=ei;ei=mo(i.stateNode.containerInfo),Rr(i),ei=n;break;case 22:i.memoizedState===null&&(n=i.alternate,n!==null&&n.memoizedState!==null?(n=Ma,Ma=16777216,Rr(i),Ma=n):Rr(i));break;default:Rr(i)}}function T0(i){var n=i.alternate;if(n!==null&&(i=n.child,i!==null)){n.child=null;do n=i.sibling,i.sibling=null,i=n;while(i!==null)}}function Na(i){var n=i.deletions;if((i.flags&16)!==0){if(n!==null)for(var o=0;o<n.length;o++){var f=n[o];Yt=f,x0(f,i)}T0(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)S0(i),i=i.sibling}function S0(i){switch(i.tag){case 0:case 11:case 15:Na(i),i.flags&2048&&rn(9,i,i.return);break;case 3:Na(i);break;case 12:Na(i);break;case 22:var n=i.stateNode;i.memoizedState!==null&&n._visibility&2&&(i.return===null||i.return.tag!==13)?(n._visibility&=-3,so(i)):Na(i);break;default:Na(i)}}function so(i){var n=i.deletions;if((i.flags&16)!==0){if(n!==null)for(var o=0;o<n.length;o++){var f=n[o];Yt=f,x0(f,i)}T0(i)}for(i=i.child;i!==null;){switch(n=i,n.tag){case 0:case 11:case 15:rn(8,n,n.return),so(n);break;case 22:o=n.stateNode,o._visibility&2&&(o._visibility&=-3,so(n));break;default:so(n)}i=i.sibling}}function x0(i,n){for(;Yt!==null;){var o=Yt;switch(o.tag){case 0:case 11:case 15:rn(8,o,n);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var f=o.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:ya(o.memoizedState.cache)}if(f=o.child,f!==null)f.return=o,Yt=f;else e:for(o=i;Yt!==null;){f=Yt;var m=f.sibling,v=f.return;if(h0(f),f===o){Yt=null;break e}if(m!==null){m.return=v,Yt=m;break e}Yt=v}}}var WE={getCacheForType:function(i){var n=ns(jt),o=n.data.get(i);return o===void 0&&(o=i(),n.data.set(i,o)),o}},ZE=typeof WeakMap=="function"?WeakMap:Map,rt=0,Tt=null,ze=null,Xe=0,at=0,Cs=null,on=!1,_r=!1,$c=!1,Ui=0,Ct=0,un=0,Hn=0,Gc=0,Ys=0,Ir=0,Pa=null,vs=null,jc=!1,Hc=0,io=1/0,no=null,cn=null,Jt=0,fn=null,Dr=null,Cr=0,Vc=0,Kc=null,b0=null,Ua=0,zc=null;function ks(){if((rt&2)!==0&&Xe!==0)return Xe&-Xe;if(U.T!==null){var i=yr;return i!==0?i:Jc()}return Ki()}function A0(){Ys===0&&(Ys=(Xe&536870912)===0||Je?Jr():536870912);var i=zs.current;return i!==null&&(i.flags|=32),Ys}function ws(i,n,o){(i===Tt&&(at===2||at===9)||i.cancelPendingCommit!==null)&&(kr(i,0),dn(i,Xe,Ys,!1)),li(i,o),((rt&2)===0||i!==Tt)&&(i===Tt&&((rt&2)===0&&(Hn|=o),Ct===4&&dn(i,Xe,Ys,!1)),hi(i))}function L0(i,n,o){if((rt&6)!==0)throw Error(s(327));var f=!o&&(n&124)===0&&(n&i.expiredLanes)===0||Rn(i,n),m=f?tT(i,n):Xc(i,n,!0),v=f;do{if(m===0){_r&&!f&&dn(i,n,0,!1);break}else{if(o=i.current.alternate,v&&!JE(o)){m=Xc(i,n,!1),v=!1;continue}if(m===2){if(v=n,i.errorRecoveryDisabledLanes&v)var L=0;else L=i.pendingLanes&-536870913,L=L!==0?L:L&536870912?536870912:0;if(L!==0){n=L;e:{var D=i;m=Pa;var N=D.current.memoizedState.isDehydrated;if(N&&(kr(D,L).flags|=256),L=Xc(D,L,!1),L!==2){if($c&&!N){D.errorRecoveryDisabledLanes|=v,Hn|=v,m=4;break e}v=vs,vs=m,v!==null&&(vs===null?vs=v:vs.push.apply(vs,v))}m=L}if(v=!1,m!==2)continue}}if(m===1){kr(i,0),dn(i,n,0,!0);break}e:{switch(f=i,v=m,v){case 0:case 1:throw Error(s(345));case 4:if((n&4194048)!==n)break;case 6:dn(f,n,Ys,!on);break e;case 2:vs=null;break;case 3:case 5:break;default:throw Error(s(329))}if((n&62914560)===n&&(m=Hc+300-We(),10<m)){if(dn(f,n,Ys,!on),ai(f,0,!0)!==0)break e;f.timeoutHandle=em(R0.bind(null,f,o,vs,no,jc,n,Ys,Hn,Ir,on,v,2,-0,0),m);break e}R0(f,o,vs,no,jc,n,Ys,Hn,Ir,on,v,0,-0,0)}}break}while(!0);hi(i)}function R0(i,n,o,f,m,v,L,D,N,Q,ne,le,W,Z){if(i.timeoutHandle=-1,le=n.subtreeFlags,(le&8192||(le&16785408)===16785408)&&(Va={stylesheets:null,count:0,unsuspend:MT},E0(n),le=PT(),le!==null)){i.cancelPendingCommit=le(O0.bind(null,i,n,v,o,f,m,L,D,N,ne,1,W,Z)),dn(i,v,L,!Q);return}O0(i,n,v,o,f,m,L,D,N)}function JE(i){for(var n=i;;){var o=n.tag;if((o===0||o===11||o===15)&&n.flags&16384&&(o=n.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var f=0;f<o.length;f++){var m=o[f],v=m.getSnapshot;m=m.value;try{if(!Rs(v(),m))return!1}catch(L){return!1}}if(o=n.child,n.subtreeFlags&16384&&o!==null)o.return=n,n=o;else{if(n===i)break;for(;n.sibling===null;){if(n.return===null||n.return===i)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function dn(i,n,o,f){n&=~Gc,n&=~Hn,i.suspendedLanes|=n,i.pingedLanes&=~n,f&&(i.warmLanes|=n),f=i.expirationTimes;for(var m=n;0<m;){var v=31-Oe(m),L=1<<v;f[v]=-1,m&=~L}o!==0&&Bs(i,o,n)}function ro(){return(rt&6)===0?(Ba(0),!1):!0}function Yc(){if(ze!==null){if(at===0)var i=ze.return;else i=ze,Di=Un=null,cc(i),br=null,Ia=0,i=ze;for(;i!==null;)r0(i.alternate,i),i=i.return;ze=null}}function kr(i,n){var o=i.timeoutHandle;o!==-1&&(i.timeoutHandle=-1,yT(o)),o=i.cancelPendingCommit,o!==null&&(i.cancelPendingCommit=null,o()),Yc(),Tt=i,ze=o=Ri(i.current,null),Xe=n,at=0,Cs=null,on=!1,_r=Rn(i,n),$c=!1,Ir=Ys=Gc=Hn=un=Ct=0,vs=Pa=null,jc=!1,(n&8)!==0&&(n|=n&32);var f=i.entangledLanes;if(f!==0)for(i=i.entanglements,f&=n;0<f;){var m=31-Oe(f),v=1<<m;n|=i[m],f&=~v}return Ui=n,_l(),o}function _0(i,n){Ge=null,U.H=zl,n===Ea||n===Pl?(n=Vh(),at=3):n===Gh?(n=Vh(),at=4):at=n===Kg?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,Cs=n,ze===null&&(Ct=1,Wl(i,js(n,i.current)))}function I0(){var i=U.H;return U.H=zl,i===null?zl:i}function D0(){var i=U.A;return U.A=WE,i}function qc(){Ct=4,on||(Xe&4194048)!==Xe&&zs.current!==null||(_r=!0),(un&134217727)===0&&(Hn&134217727)===0||Tt===null||dn(Tt,Xe,Ys,!1)}function Xc(i,n,o){var f=rt;rt|=2;var m=I0(),v=D0();(Tt!==i||Xe!==n)&&(no=null,kr(i,n)),n=!1;var L=Ct;e:do try{if(at!==0&&ze!==null){var D=ze,N=Cs;switch(at){case 8:Yc(),L=6;break e;case 3:case 2:case 9:case 6:zs.current===null&&(n=!0);var Q=at;if(at=0,Cs=null,wr(i,D,N,Q),o&&_r){L=0;break e}break;default:Q=at,at=0,Cs=null,wr(i,D,N,Q)}}eT(),L=Ct;break}catch(ne){_0(i,ne)}while(!0);return n&&i.shellSuspendCounter++,Di=Un=null,rt=f,U.H=m,U.A=v,ze===null&&(Tt=null,Xe=0,_l()),L}function eT(){for(;ze!==null;)C0(ze)}function tT(i,n){var o=rt;rt|=2;var f=I0(),m=D0();Tt!==i||Xe!==n?(no=null,io=We()+500,kr(i,n)):_r=Rn(i,n);e:do try{if(at!==0&&ze!==null){n=ze;var v=Cs;t:switch(at){case 1:at=0,Cs=null,wr(i,n,v,1);break;case 2:case 9:if(jh(v)){at=0,Cs=null,k0(n);break}n=function(){at!==2&&at!==9||Tt!==i||(at=7),hi(i)},v.then(n,n);break e;case 3:at=7;break e;case 4:at=5;break e;case 7:jh(v)?(at=0,Cs=null,k0(n)):(at=0,Cs=null,wr(i,n,v,7));break;case 5:var L=null;switch(ze.tag){case 26:L=ze.memoizedState;case 5:case 27:var D=ze;if(!L||dm(L)){at=0,Cs=null;var N=D.sibling;if(N!==null)ze=N;else{var Q=D.return;Q!==null?(ze=Q,ao(Q)):ze=null}break t}}at=0,Cs=null,wr(i,n,v,5);break;case 6:at=0,Cs=null,wr(i,n,v,6);break;case 8:Yc(),Ct=6;break e;default:throw Error(s(462))}}sT();break}catch(ne){_0(i,ne)}while(!0);return Di=Un=null,U.H=f,U.A=m,rt=o,ze!==null?0:(Tt=null,Xe=0,_l(),Ct)}function sT(){for(;ze!==null&&!Wn();)C0(ze)}function C0(i){var n=i0(i.alternate,i,Ui);i.memoizedProps=i.pendingProps,n===null?ao(i):ze=n}function k0(i){var n=i,o=n.alternate;switch(n.tag){case 15:case 0:n=Wg(o,n,n.pendingProps,n.type,void 0,Xe);break;case 11:n=Wg(o,n,n.pendingProps,n.type.render,n.ref,Xe);break;case 5:cc(n);default:r0(o,n),n=ze=wh(n,Ui),n=i0(o,n,Ui)}i.memoizedProps=i.pendingProps,n===null?ao(i):ze=n}function wr(i,n,o,f){Di=Un=null,cc(n),br=null,Ia=0;var m=n.return;try{if(KE(i,m,n,o,Xe)){Ct=1,Wl(i,js(o,i.current)),ze=null;return}}catch(v){if(m!==null)throw ze=m,v;Ct=1,Wl(i,js(o,i.current)),ze=null;return}n.flags&32768?(Je||f===1?i=!0:_r||(Xe&536870912)!==0?i=!1:(on=i=!0,(f===2||f===9||f===3||f===6)&&(f=zs.current,f!==null&&f.tag===13&&(f.flags|=16384))),w0(n,i)):ao(n)}function ao(i){var n=i;do{if((n.flags&32768)!==0){w0(n,on);return}i=n.return;var o=YE(n.alternate,n,Ui);if(o!==null){ze=o;return}if(n=n.sibling,n!==null){ze=n;return}ze=n=i}while(n!==null);Ct===0&&(Ct=5)}function w0(i,n){do{var o=qE(i.alternate,i);if(o!==null){o.flags&=32767,ze=o;return}if(o=i.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!n&&(i=i.sibling,i!==null)){ze=i;return}ze=i=o}while(i!==null);Ct=6,ze=null}function O0(i,n,o,f,m,v,L,D,N){i.cancelPendingCommit=null;do lo();while(Jt!==0);if((rt&6)!==0)throw Error(s(327));if(n!==null){if(n===i.current)throw Error(s(177));if(v=n.lanes|n.childLanes,v|=Fu,gl(i,o,v,L,D,N),i===Tt&&(ze=Tt=null,Xe=0),Dr=n,fn=i,Cr=o,Vc=v,Kc=m,b0=f,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,aT(as,function(){return B0(),null})):(i.callbackNode=null,i.callbackPriority=0),f=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||f){f=U.T,U.T=null,m=X.p,X.p=2,L=rt,rt|=4;try{XE(i,n,o)}finally{rt=L,X.p=m,U.T=f}}Jt=1,M0(),N0(),P0()}}function M0(){if(Jt===1){Jt=0;var i=fn,n=Dr,o=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||o){o=U.T,U.T=null;var f=X.p;X.p=2;var m=rt;rt|=4;try{p0(n,i);var v=of,L=xh(i.containerInfo),D=v.focusedElem,N=v.selectionRange;if(L!==D&&D&&D.ownerDocument&&Sh(D.ownerDocument.documentElement,D)){if(N!==null&&Mu(D)){var Q=N.start,ne=N.end;if(ne===void 0&&(ne=Q),"selectionStart"in D)D.selectionStart=Q,D.selectionEnd=Math.min(ne,D.value.length);else{var le=D.ownerDocument||document,W=le&&le.defaultView||window;if(W.getSelection){var Z=W.getSelection(),we=D.textContent.length,De=Math.min(N.start,we),ft=N.end===void 0?De:Math.min(N.end,we);!Z.extend&&De>ft&&(L=ft,ft=De,De=L);var H=Th(D,De),F=Th(D,ft);if(H&&F&&(Z.rangeCount!==1||Z.anchorNode!==H.node||Z.anchorOffset!==H.offset||Z.focusNode!==F.node||Z.focusOffset!==F.offset)){var q=le.createRange();q.setStart(H.node,H.offset),Z.removeAllRanges(),De>ft?(Z.addRange(q),Z.extend(F.node,F.offset)):(q.setEnd(F.node,F.offset),Z.addRange(q))}}}}for(le=[],Z=D;Z=Z.parentNode;)Z.nodeType===1&&le.push({element:Z,left:Z.scrollLeft,top:Z.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<le.length;D++){var ae=le[D];ae.element.scrollLeft=ae.left,ae.element.scrollTop=ae.top}}To=!!lf,of=lf=null}finally{rt=m,X.p=f,U.T=o}}i.current=n,Jt=2}}function N0(){if(Jt===2){Jt=0;var i=fn,n=Dr,o=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||o){o=U.T,U.T=null;var f=X.p;X.p=2;var m=rt;rt|=4;try{d0(i,n.alternate,n)}finally{rt=m,X.p=f,U.T=o}}Jt=3}}function P0(){if(Jt===4||Jt===3){Jt=0,Fe();var i=fn,n=Dr,o=Cr,f=b0;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?Jt=5:(Jt=0,Dr=fn=null,U0(i,i.pendingLanes));var m=i.pendingLanes;if(m===0&&(cn=null),hs(o),n=n.stateNode,pe&&typeof pe.onCommitFiberRoot=="function")try{pe.onCommitFiberRoot(Ae,n,void 0,(n.current.flags&128)===128)}catch(N){}if(f!==null){n=U.T,m=X.p,X.p=2,U.T=null;try{for(var v=i.onRecoverableError,L=0;L<f.length;L++){var D=f[L];v(D.value,{componentStack:D.stack})}}finally{U.T=n,X.p=m}}(Cr&3)!==0&&lo(),hi(i),m=i.pendingLanes,(o&4194090)!==0&&(m&42)!==0?i===zc?Ua++:(Ua=0,zc=i):Ua=0,Ba(0)}}function U0(i,n){(i.pooledCacheLanes&=n)===0&&(n=i.pooledCache,n!=null&&(i.pooledCache=null,ya(n)))}function lo(i){return M0(),N0(),P0(),B0()}function B0(){if(Jt!==5)return!1;var i=fn,n=Vc;Vc=0;var o=hs(Cr),f=U.T,m=X.p;try{X.p=32>o?32:o,U.T=null,o=Kc,Kc=null;var v=fn,L=Cr;if(Jt=0,Dr=fn=null,Cr=0,(rt&6)!==0)throw Error(s(331));var D=rt;if(rt|=4,S0(v.current),v0(v,v.current,L,o),rt=D,Ba(0,!1),pe&&typeof pe.onPostCommitFiberRoot=="function")try{pe.onPostCommitFiberRoot(Ae,v)}catch(N){}return!0}finally{X.p=m,U.T=f,U0(i,n)}}function F0(i,n,o){n=js(o,n),n=Ac(i.stateNode,n,2),i=en(i,n,2),i!==null&&(li(i,2),hi(i))}function gt(i,n,o){if(i.tag===3)F0(i,i,o);else for(;n!==null;){if(n.tag===3){F0(n,i,o);break}else if(n.tag===1){var f=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(cn===null||!cn.has(f))){i=js(o,i),o=Hg(2),f=en(n,o,2),f!==null&&(Vg(o,f,n,i),li(f,2),hi(f));break}}n=n.return}}function Qc(i,n,o){var f=i.pingCache;if(f===null){f=i.pingCache=new ZE;var m=new Set;f.set(n,m)}else m=f.get(n),m===void 0&&(m=new Set,f.set(n,m));m.has(o)||($c=!0,m.add(o),i=iT.bind(null,i,n,o),n.then(i,i))}function iT(i,n,o){var f=i.pingCache;f!==null&&f.delete(n),i.pingedLanes|=i.suspendedLanes&o,i.warmLanes&=~o,Tt===i&&(Xe&o)===o&&(Ct===4||Ct===3&&(Xe&62914560)===Xe&&300>We()-Hc?(rt&2)===0&&kr(i,0):Gc|=o,Ir===Xe&&(Ir=0)),hi(i)}function $0(i,n){n===0&&(n=ea()),i=hr(i,n),i!==null&&(li(i,n),hi(i))}function nT(i){var n=i.memoizedState,o=0;n!==null&&(o=n.retryLane),$0(i,o)}function rT(i,n){var o=0;switch(i.tag){case 13:var f=i.stateNode,m=i.memoizedState;m!==null&&(o=m.retryLane);break;case 19:f=i.stateNode;break;case 22:f=i.stateNode._retryCache;break;default:throw Error(s(314))}f!==null&&f.delete(n),$0(i,o)}function aT(i,n){return fs(i,n)}var oo=null,Or=null,Wc=!1,uo=!1,Zc=!1,Vn=0;function hi(i){i!==Or&&i.next===null&&(Or===null?oo=Or=i:Or=Or.next=i),uo=!0,Wc||(Wc=!0,oT())}function Ba(i,n){if(!Zc&&uo){Zc=!0;do for(var o=!1,f=oo;f!==null;){if(i!==0){var m=f.pendingLanes;if(m===0)var v=0;else{var L=f.suspendedLanes,D=f.pingedLanes;v=(1<<31-Oe(42|i)+1)-1,v&=m&~(L&~D),v=v&201326741?v&201326741|1:v?v|2:0}v!==0&&(o=!0,V0(f,v))}else v=Xe,v=ai(f,f===Tt?v:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(v&3)===0||Rn(f,v)||(o=!0,V0(f,v));f=f.next}while(o);Zc=!1}}function lT(){G0()}function G0(){uo=Wc=!1;var i=0;Vn!==0&&(pT()&&(i=Vn),Vn=0);for(var n=We(),o=null,f=oo;f!==null;){var m=f.next,v=j0(f,n);v===0?(f.next=null,o===null?oo=m:o.next=m,m===null&&(Or=o)):(o=f,(i!==0||(v&3)!==0)&&(uo=!0)),f=m}Ba(i)}function j0(i,n){for(var o=i.suspendedLanes,f=i.pingedLanes,m=i.expirationTimes,v=i.pendingLanes&-62914561;0<v;){var L=31-Oe(v),D=1<<L,N=m[L];N===-1?((D&o)===0||(D&f)!==0)&&(m[L]=Jn(D,n)):N<=n&&(i.expiredLanes|=D),v&=~D}if(n=Tt,o=Xe,o=ai(i,i===n?o:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),f=i.callbackNode,o===0||i===n&&(at===2||at===9)||i.cancelPendingCommit!==null)return f!==null&&f!==null&&Ut(f),i.callbackNode=null,i.callbackPriority=0;if((o&3)===0||Rn(i,o)){if(n=o&-o,n===i.callbackPriority)return n;switch(f!==null&&Ut(f),hs(o)){case 2:case 8:o=st;break;case 32:o=as;break;case 268435456:o=bs;break;default:o=as}return f=H0.bind(null,i),o=fs(o,f),i.callbackPriority=n,i.callbackNode=o,n}return f!==null&&f!==null&&Ut(f),i.callbackPriority=2,i.callbackNode=null,2}function H0(i,n){if(Jt!==0&&Jt!==5)return i.callbackNode=null,i.callbackPriority=0,null;var o=i.callbackNode;if(lo()&&i.callbackNode!==o)return null;var f=Xe;return f=ai(i,i===Tt?f:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),f===0?null:(L0(i,f,n),j0(i,We()),i.callbackNode!=null&&i.callbackNode===o?H0.bind(null,i):null)}function V0(i,n){if(lo())return null;L0(i,n,!0)}function oT(){vT(function(){(rt&6)!==0?fs(ss,lT):G0()})}function Jc(){return Vn===0&&(Vn=Jr()),Vn}function K0(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:Tl(""+i)}function z0(i,n){var o=n.ownerDocument.createElement("input");return o.name=n.name,o.value=n.value,i.id&&o.setAttribute("form",i.id),n.parentNode.insertBefore(o,n),i=new FormData(i),o.parentNode.removeChild(o),i}function uT(i,n,o,f,m){if(n==="submit"&&o&&o.stateNode===m){var v=K0((m[is]||null).action),L=f.submitter;L&&(n=(n=L[is]||null)?K0(n.formAction):L.getAttribute("formAction"),n!==null&&(v=n,L=null));var D=new Al("action","action",null,f,m);i.push({event:D,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Vn!==0){var N=L?z0(m,L):new FormData(m);Ec(o,{pending:!0,data:N,method:m.method,action:v},null,N)}}else typeof v=="function"&&(D.preventDefault(),N=L?z0(m,L):new FormData(m),Ec(o,{pending:!0,data:N,method:m.method,action:v},v,N))},currentTarget:m}]})}}for(var ef=0;ef<Bu.length;ef++){var tf=Bu[ef],cT=tf.toLowerCase(),fT=tf[0].toUpperCase()+tf.slice(1);Js(cT,"on"+fT)}Js(Lh,"onAnimationEnd"),Js(Rh,"onAnimationIteration"),Js(_h,"onAnimationStart"),Js("dblclick","onDoubleClick"),Js("focusin","onFocus"),Js("focusout","onBlur"),Js(IE,"onTransitionRun"),Js(DE,"onTransitionStart"),Js(CE,"onTransitionCancel"),Js(Ih,"onTransitionEnd"),qi("onMouseEnter",["mouseout","mouseover"]),qi("onMouseLeave",["mouseout","mouseover"]),qi("onPointerEnter",["pointerout","pointerover"]),qi("onPointerLeave",["pointerout","pointerover"]),bi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),bi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),bi("onBeforeInput",["compositionend","keypress","textInput","paste"]),bi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),bi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),bi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),dT=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Fa));function Y0(i,n){n=(n&4)!==0;for(var o=0;o<i.length;o++){var f=i[o],m=f.event;f=f.listeners;e:{var v=void 0;if(n)for(var L=f.length-1;0<=L;L--){var D=f[L],N=D.instance,Q=D.currentTarget;if(D=D.listener,N!==v&&m.isPropagationStopped())break e;v=D,m.currentTarget=Q;try{v(m)}catch(ne){Ql(ne)}m.currentTarget=null,v=N}else for(L=0;L<f.length;L++){if(D=f[L],N=D.instance,Q=D.currentTarget,D=D.listener,N!==v&&m.isPropagationStopped())break e;v=D,m.currentTarget=Q;try{v(m)}catch(ne){Ql(ne)}m.currentTarget=null,v=N}}}}function Ye(i,n){var o=n[gs];o===void 0&&(o=n[gs]=new Set);var f=i+"__bubble";o.has(f)||(q0(n,i,2,!1),o.add(f))}function sf(i,n,o){var f=0;n&&(f|=4),q0(o,i,f,n)}var co="_reactListening"+Math.random().toString(36).slice(2);function nf(i){if(!i[co]){i[co]=!0,pl.forEach(function(o){o!=="selectionchange"&&(dT.has(o)||sf(o,!1,i),sf(o,!0,i))});var n=i.nodeType===9?i:i.ownerDocument;n===null||n[co]||(n[co]=!0,sf("selectionchange",!1,n))}}function q0(i,n,o,f){switch(vm(n)){case 2:var m=FT;break;case 8:m=$T;break;default:m=vf}o=m.bind(null,n,o,i),m=void 0,!Lu||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(m=!0),f?m!==void 0?i.addEventListener(n,o,{capture:!0,passive:m}):i.addEventListener(n,o,!0):m!==void 0?i.addEventListener(n,o,{passive:m}):i.addEventListener(n,o,!1)}function rf(i,n,o,f,m){var v=f;if((n&1)===0&&(n&2)===0&&f!==null)e:for(;;){if(f===null)return;var L=f.tag;if(L===3||L===4){var D=f.stateNode.containerInfo;if(D===m)break;if(L===4)for(L=f.return;L!==null;){var N=L.tag;if((N===3||N===4)&&L.stateNode.containerInfo===m)return;L=L.return}for(;D!==null;){if(L=Ls(D),L===null)return;if(N=L.tag,N===5||N===6||N===26||N===27){f=v=L;continue e}D=D.parentNode}}f=f.return}th(function(){var Q=v,ne=bu(o),le=[];e:{var W=Dh.get(i);if(W!==void 0){var Z=Al,we=i;switch(i){case"keypress":if(xl(o)===0)break e;case"keydown":case"keyup":Z=aE;break;case"focusin":we="focus",Z=Du;break;case"focusout":we="blur",Z=Du;break;case"beforeblur":case"afterblur":Z=Du;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Z=nh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Z=qv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Z=uE;break;case Lh:case Rh:case _h:Z=Wv;break;case Ih:Z=fE;break;case"scroll":case"scrollend":Z=zv;break;case"wheel":Z=hE;break;case"copy":case"cut":case"paste":Z=Jv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Z=ah;break;case"toggle":case"beforetoggle":Z=mE}var De=(n&4)!==0,ft=!De&&(i==="scroll"||i==="scrollend"),H=De?W!==null?W+"Capture":null:W;De=[];for(var F=Q,q;F!==null;){var ae=F;if(q=ae.stateNode,ae=ae.tag,ae!==5&&ae!==26&&ae!==27||q===null||H===null||(ae=na(F,H),ae!=null&&De.push($a(F,ae,q))),ft)break;F=F.return}0<De.length&&(W=new Z(W,we,null,o,ne),le.push({event:W,listeners:De}))}}if((n&7)===0){e:{if(W=i==="mouseover"||i==="pointerover",Z=i==="mouseout"||i==="pointerout",W&&o!==xu&&(we=o.relatedTarget||o.fromElement)&&(Ls(we)||we[Fs]))break e;if((Z||W)&&(W=ne.window===ne?ne:(W=ne.ownerDocument)?W.defaultView||W.parentWindow:window,Z?(we=o.relatedTarget||o.toElement,Z=Q,we=we?Ls(we):null,we!==null&&(ft=a(we),De=we.tag,we!==ft||De!==5&&De!==27&&De!==6)&&(we=null)):(Z=null,we=Q),Z!==we)){if(De=nh,ae="onMouseLeave",H="onMouseEnter",F="mouse",(i==="pointerout"||i==="pointerover")&&(De=ah,ae="onPointerLeave",H="onPointerEnter",F="pointer"),ft=Z==null?W:Gt(Z),q=we==null?W:Gt(we),W=new De(ae,F+"leave",Z,o,ne),W.target=ft,W.relatedTarget=q,ae=null,Ls(ne)===Q&&(De=new De(H,F+"enter",we,o,ne),De.target=q,De.relatedTarget=ft,ae=De),ft=ae,Z&&we)t:{for(De=Z,H=we,F=0,q=De;q;q=Mr(q))F++;for(q=0,ae=H;ae;ae=Mr(ae))q++;for(;0<F-q;)De=Mr(De),F--;for(;0<q-F;)H=Mr(H),q--;for(;F--;){if(De===H||H!==null&&De===H.alternate)break t;De=Mr(De),H=Mr(H)}De=null}else De=null;Z!==null&&X0(le,W,Z,De,!1),we!==null&&ft!==null&&X0(le,ft,we,De,!0)}}e:{if(W=Q?Gt(Q):window,Z=W.nodeName&&W.nodeName.toLowerCase(),Z==="select"||Z==="input"&&W.type==="file")var xe=gh;else if(dh(W))if(mh)xe=LE;else{xe=bE;var He=xE}else Z=W.nodeName,!Z||Z.toLowerCase()!=="input"||W.type!=="checkbox"&&W.type!=="radio"?Q&&Su(Q.elementType)&&(xe=gh):xe=AE;if(xe&&(xe=xe(i,Q))){hh(le,xe,o,ne);break e}He&&He(i,W,Q),i==="focusout"&&Q&&W.type==="number"&&Q.memoizedProps.value!=null&&nt(W,"number",W.value)}switch(He=Q?Gt(Q):window,i){case"focusin":(dh(He)||He.contentEditable==="true")&&(cr=He,Nu=Q,da=null);break;case"focusout":da=Nu=cr=null;break;case"mousedown":Pu=!0;break;case"contextmenu":case"mouseup":case"dragend":Pu=!1,bh(le,o,ne);break;case"selectionchange":if(_E)break;case"keydown":case"keyup":bh(le,o,ne)}var Re;if(ku)e:{switch(i){case"compositionstart":var Ce="onCompositionStart";break e;case"compositionend":Ce="onCompositionEnd";break e;case"compositionupdate":Ce="onCompositionUpdate";break e}Ce=void 0}else ur?ch(i,o)&&(Ce="onCompositionEnd"):i==="keydown"&&o.keyCode===229&&(Ce="onCompositionStart");Ce&&(lh&&o.locale!=="ko"&&(ur||Ce!=="onCompositionStart"?Ce==="onCompositionEnd"&&ur&&(Re=sh()):(Qi=ne,Ru="value"in Qi?Qi.value:Qi.textContent,ur=!0)),He=fo(Q,Ce),0<He.length&&(Ce=new rh(Ce,i,null,o,ne),le.push({event:Ce,listeners:He}),Re?Ce.data=Re:(Re=fh(o),Re!==null&&(Ce.data=Re)))),(Re=yE?vE(i,o):EE(i,o))&&(Ce=fo(Q,"onBeforeInput"),0<Ce.length&&(He=new rh("onBeforeInput","beforeinput",null,o,ne),le.push({event:He,listeners:Ce}),He.data=Re)),uT(le,i,Q,o,ne)}Y0(le,n)})}function $a(i,n,o){return{instance:i,listener:n,currentTarget:o}}function fo(i,n){for(var o=n+"Capture",f=[];i!==null;){var m=i,v=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||v===null||(m=na(i,o),m!=null&&f.unshift($a(i,m,v)),m=na(i,n),m!=null&&f.push($a(i,m,v))),i.tag===3)return f;i=i.return}return[]}function Mr(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function X0(i,n,o,f,m){for(var v=n._reactName,L=[];o!==null&&o!==f;){var D=o,N=D.alternate,Q=D.stateNode;if(D=D.tag,N!==null&&N===f)break;D!==5&&D!==26&&D!==27||Q===null||(N=Q,m?(Q=na(o,v),Q!=null&&L.unshift($a(o,Q,N))):m||(Q=na(o,v),Q!=null&&L.push($a(o,Q,N)))),o=o.return}L.length!==0&&i.push({event:n,listeners:L})}var hT=/\r\n?/g,gT=/\u0000|\uFFFD/g;function Q0(i){return(typeof i=="string"?i:""+i).replace(hT,`
`).replace(gT,"")}function W0(i,n){return n=Q0(n),Q0(i)===n}function ho(){}function ct(i,n,o,f,m,v){switch(o){case"children":typeof f=="string"?n==="body"||n==="textarea"&&f===""||ar(i,f):(typeof f=="number"||typeof f=="bigint")&&n!=="body"&&ar(i,""+f);break;case"className":ir(i,"class",f);break;case"tabIndex":ir(i,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":ir(i,o,f);break;case"style":Jd(i,f,v);break;case"data":if(n!=="object"){ir(i,"data",f);break}case"src":case"href":if(f===""&&(n!=="a"||o!=="href")){i.removeAttribute(o);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){i.removeAttribute(o);break}f=Tl(""+f),i.setAttribute(o,f);break;case"action":case"formAction":if(typeof f=="function"){i.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(o==="formAction"?(n!=="input"&&ct(i,n,"name",m.name,m,null),ct(i,n,"formEncType",m.formEncType,m,null),ct(i,n,"formMethod",m.formMethod,m,null),ct(i,n,"formTarget",m.formTarget,m,null)):(ct(i,n,"encType",m.encType,m,null),ct(i,n,"method",m.method,m,null),ct(i,n,"target",m.target,m,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){i.removeAttribute(o);break}f=Tl(""+f),i.setAttribute(o,f);break;case"onClick":f!=null&&(i.onclick=ho);break;case"onScroll":f!=null&&Ye("scroll",i);break;case"onScrollEnd":f!=null&&Ye("scrollend",i);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(s(61));if(o=f.__html,o!=null){if(m.children!=null)throw Error(s(60));i.innerHTML=o}}break;case"multiple":i.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":i.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){i.removeAttribute("xlink:href");break}o=Tl(""+f),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(o,""+f):i.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(o,""):i.removeAttribute(o);break;case"capture":case"download":f===!0?i.setAttribute(o,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(o,f):i.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?i.setAttribute(o,f):i.removeAttribute(o);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?i.removeAttribute(o):i.setAttribute(o,f);break;case"popover":Ye("beforetoggle",i),Ye("toggle",i),_n(i,"popover",f);break;case"xlinkActuate":Zs(i,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Zs(i,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Zs(i,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Zs(i,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Zs(i,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Zs(i,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Zs(i,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Zs(i,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Zs(i,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":_n(i,"is",f);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=Vv.get(o)||o,_n(i,o,f))}}function af(i,n,o,f,m,v){switch(o){case"style":Jd(i,f,v);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(s(61));if(o=f.__html,o!=null){if(m.children!=null)throw Error(s(60));i.innerHTML=o}}break;case"children":typeof f=="string"?ar(i,f):(typeof f=="number"||typeof f=="bigint")&&ar(i,""+f);break;case"onScroll":f!=null&&Ye("scroll",i);break;case"onScrollEnd":f!=null&&Ye("scrollend",i);break;case"onClick":f!=null&&(i.onclick=ho);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!yl.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(m=o.endsWith("Capture"),n=o.slice(2,m?o.length-7:void 0),v=i[is]||null,v=v!=null?v[o]:null,typeof v=="function"&&i.removeEventListener(n,v,m),typeof f=="function")){typeof v!="function"&&v!==null&&(o in i?i[o]=null:i.hasAttribute(o)&&i.removeAttribute(o)),i.addEventListener(n,f,m);break e}o in i?i[o]=f:f===!0?i.setAttribute(o,""):_n(i,o,f)}}}function es(i,n,o){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ye("error",i),Ye("load",i);var f=!1,m=!1,v;for(v in o)if(o.hasOwnProperty(v)){var L=o[v];if(L!=null)switch(v){case"src":f=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,n));default:ct(i,n,v,L,o,null)}}m&&ct(i,n,"srcSet",o.srcSet,o,null),f&&ct(i,n,"src",o.src,o,null);return;case"input":Ye("invalid",i);var D=v=L=m=null,N=null,Q=null;for(f in o)if(o.hasOwnProperty(f)){var ne=o[f];if(ne!=null)switch(f){case"name":m=ne;break;case"type":L=ne;break;case"checked":N=ne;break;case"defaultChecked":Q=ne;break;case"value":v=ne;break;case"defaultValue":D=ne;break;case"children":case"dangerouslySetInnerHTML":if(ne!=null)throw Error(s(137,n));break;default:ct(i,n,f,ne,o,null)}}it(i,v,D,N,Q,L,m,!1),me(i);return;case"select":Ye("invalid",i),f=L=v=null;for(m in o)if(o.hasOwnProperty(m)&&(D=o[m],D!=null))switch(m){case"value":v=D;break;case"defaultValue":L=D;break;case"multiple":f=D;default:ct(i,n,m,D,o,null)}n=v,o=L,i.multiple=!!f,n!=null?Et(i,!!f,n,!1):o!=null&&Et(i,!!f,o,!0);return;case"textarea":Ye("invalid",i),v=m=f=null;for(L in o)if(o.hasOwnProperty(L)&&(D=o[L],D!=null))switch(L){case"value":f=D;break;case"defaultValue":m=D;break;case"children":v=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(s(91));break;default:ct(i,n,L,D,o,null)}Wd(i,f,m,v),me(i);return;case"option":for(N in o)if(o.hasOwnProperty(N)&&(f=o[N],f!=null))switch(N){case"selected":i.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:ct(i,n,N,f,o,null)}return;case"dialog":Ye("beforetoggle",i),Ye("toggle",i),Ye("cancel",i),Ye("close",i);break;case"iframe":case"object":Ye("load",i);break;case"video":case"audio":for(f=0;f<Fa.length;f++)Ye(Fa[f],i);break;case"image":Ye("error",i),Ye("load",i);break;case"details":Ye("toggle",i);break;case"embed":case"source":case"link":Ye("error",i),Ye("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Q in o)if(o.hasOwnProperty(Q)&&(f=o[Q],f!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,n));default:ct(i,n,Q,f,o,null)}return;default:if(Su(n)){for(ne in o)o.hasOwnProperty(ne)&&(f=o[ne],f!==void 0&&af(i,n,ne,f,o,void 0));return}}for(D in o)o.hasOwnProperty(D)&&(f=o[D],f!=null&&ct(i,n,D,f,o,null))}function mT(i,n,o,f){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,v=null,L=null,D=null,N=null,Q=null,ne=null;for(Z in o){var le=o[Z];if(o.hasOwnProperty(Z)&&le!=null)switch(Z){case"checked":break;case"value":break;case"defaultValue":N=le;default:f.hasOwnProperty(Z)||ct(i,n,Z,null,f,le)}}for(var W in f){var Z=f[W];if(le=o[W],f.hasOwnProperty(W)&&(Z!=null||le!=null))switch(W){case"type":v=Z;break;case"name":m=Z;break;case"checked":Q=Z;break;case"defaultChecked":ne=Z;break;case"value":L=Z;break;case"defaultValue":D=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(s(137,n));break;default:Z!==le&&ct(i,n,W,Z,f,le)}}Gs(i,L,D,N,Q,ne,v,m);return;case"select":Z=L=D=W=null;for(v in o)if(N=o[v],o.hasOwnProperty(v)&&N!=null)switch(v){case"value":break;case"multiple":Z=N;default:f.hasOwnProperty(v)||ct(i,n,v,null,f,N)}for(m in f)if(v=f[m],N=o[m],f.hasOwnProperty(m)&&(v!=null||N!=null))switch(m){case"value":W=v;break;case"defaultValue":D=v;break;case"multiple":L=v;default:v!==N&&ct(i,n,m,v,f,N)}n=D,o=L,f=Z,W!=null?Et(i,!!o,W,!1):!!f!=!!o&&(n!=null?Et(i,!!o,n,!0):Et(i,!!o,o?[]:"",!1));return;case"textarea":Z=W=null;for(D in o)if(m=o[D],o.hasOwnProperty(D)&&m!=null&&!f.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:ct(i,n,D,null,f,m)}for(L in f)if(m=f[L],v=o[L],f.hasOwnProperty(L)&&(m!=null||v!=null))switch(L){case"value":W=m;break;case"defaultValue":Z=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(s(91));break;default:m!==v&&ct(i,n,L,m,f,v)}rr(i,W,Z);return;case"option":for(var we in o)if(W=o[we],o.hasOwnProperty(we)&&W!=null&&!f.hasOwnProperty(we))switch(we){case"selected":i.selected=!1;break;default:ct(i,n,we,null,f,W)}for(N in f)if(W=f[N],Z=o[N],f.hasOwnProperty(N)&&W!==Z&&(W!=null||Z!=null))switch(N){case"selected":i.selected=W&&typeof W!="function"&&typeof W!="symbol";break;default:ct(i,n,N,W,f,Z)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var De in o)W=o[De],o.hasOwnProperty(De)&&W!=null&&!f.hasOwnProperty(De)&&ct(i,n,De,null,f,W);for(Q in f)if(W=f[Q],Z=o[Q],f.hasOwnProperty(Q)&&W!==Z&&(W!=null||Z!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":if(W!=null)throw Error(s(137,n));break;default:ct(i,n,Q,W,f,Z)}return;default:if(Su(n)){for(var ft in o)W=o[ft],o.hasOwnProperty(ft)&&W!==void 0&&!f.hasOwnProperty(ft)&&af(i,n,ft,void 0,f,W);for(ne in f)W=f[ne],Z=o[ne],!f.hasOwnProperty(ne)||W===Z||W===void 0&&Z===void 0||af(i,n,ne,W,f,Z);return}}for(var H in o)W=o[H],o.hasOwnProperty(H)&&W!=null&&!f.hasOwnProperty(H)&&ct(i,n,H,null,f,W);for(le in f)W=f[le],Z=o[le],!f.hasOwnProperty(le)||W===Z||W==null&&Z==null||ct(i,n,le,W,f,Z)}var lf=null,of=null;function go(i){return i.nodeType===9?i:i.ownerDocument}function Z0(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function J0(i,n){if(i===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&n==="foreignObject"?0:i}function uf(i,n){return i==="textarea"||i==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var cf=null;function pT(){var i=window.event;return i&&i.type==="popstate"?i===cf?!1:(cf=i,!0):(cf=null,!1)}var em=typeof setTimeout=="function"?setTimeout:void 0,yT=typeof clearTimeout=="function"?clearTimeout:void 0,tm=typeof Promise=="function"?Promise:void 0,vT=typeof queueMicrotask=="function"?queueMicrotask:typeof tm!="undefined"?function(i){return tm.resolve(null).then(i).catch(ET)}:em;function ET(i){setTimeout(function(){throw i})}function hn(i){return i==="head"}function sm(i,n){var o=n,f=0,m=0;do{var v=o.nextSibling;if(i.removeChild(o),v&&v.nodeType===8)if(o=v.data,o==="/$"){if(0<f&&8>f){o=f;var L=i.ownerDocument;if(o&1&&Ga(L.documentElement),o&2&&Ga(L.body),o&4)for(o=L.head,Ga(o),L=o.firstChild;L;){var D=L.nextSibling,N=L.nodeName;L[zi]||N==="SCRIPT"||N==="STYLE"||N==="LINK"&&L.rel.toLowerCase()==="stylesheet"||o.removeChild(L),L=D}}if(m===0){i.removeChild(v),Xa(n);return}m--}else o==="$"||o==="$?"||o==="$!"?m++:f=o.charCodeAt(0)-48;else f=0;o=v}while(o);Xa(n)}function ff(i){var n=i.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var o=n;switch(n=n.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":ff(o),Yi(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}i.removeChild(o)}}function TT(i,n,o,f){for(;i.nodeType===1;){var m=o;if(i.nodeName.toLowerCase()!==n.toLowerCase()){if(!f&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(f){if(!i[zi])switch(n){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(v=i.getAttribute("rel"),v==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(v!==m.rel||i.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||i.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||i.getAttribute("title")!==(m.title==null?null:m.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(v=i.getAttribute("src"),(v!==(m.src==null?null:m.src)||i.getAttribute("type")!==(m.type==null?null:m.type)||i.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&v&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(n==="input"&&i.type==="hidden"){var v=m.name==null?null:""+m.name;if(m.type==="hidden"&&i.getAttribute("name")===v)return i}else return i;if(i=ti(i.nextSibling),i===null)break}return null}function ST(i,n,o){if(n==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!o||(i=ti(i.nextSibling),i===null))return null;return i}function df(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState==="complete"}function xT(i,n){var o=i.ownerDocument;if(i.data!=="$?"||o.readyState==="complete")n();else{var f=function(){n(),o.removeEventListener("DOMContentLoaded",f)};o.addEventListener("DOMContentLoaded",f),i._reactRetry=f}}function ti(i){for(;i!=null;i=i.nextSibling){var n=i.nodeType;if(n===1||n===3)break;if(n===8){if(n=i.data,n==="$"||n==="$!"||n==="$?"||n==="F!"||n==="F")break;if(n==="/$")return null}}return i}var hf=null;function im(i){i=i.previousSibling;for(var n=0;i;){if(i.nodeType===8){var o=i.data;if(o==="$"||o==="$!"||o==="$?"){if(n===0)return i;n--}else o==="/$"&&n++}i=i.previousSibling}return null}function nm(i,n,o){switch(n=go(o),i){case"html":if(i=n.documentElement,!i)throw Error(s(452));return i;case"head":if(i=n.head,!i)throw Error(s(453));return i;case"body":if(i=n.body,!i)throw Error(s(454));return i;default:throw Error(s(451))}}function Ga(i){for(var n=i.attributes;n.length;)i.removeAttributeNode(n[0]);Yi(i)}var qs=new Map,rm=new Set;function mo(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var Bi=X.d;X.d={f:bT,r:AT,D:LT,C:RT,L:_T,m:IT,X:CT,S:DT,M:kT};function bT(){var i=Bi.f(),n=ro();return i||n}function AT(i){var n=$s(i);n!==null&&n.tag===5&&n.type==="form"?Lg(n):Bi.r(i)}var Nr=typeof document=="undefined"?null:document;function am(i,n,o){var f=Nr;if(f&&typeof n=="string"&&n){var m=Ke(n);m='link[rel="'+i+'"][href="'+m+'"]',typeof o=="string"&&(m+='[crossorigin="'+o+'"]'),rm.has(m)||(rm.add(m),i={rel:i,crossOrigin:o,href:n},f.querySelector(m)===null&&(n=f.createElement("link"),es(n,"link",i),bt(n),f.head.appendChild(n)))}}function LT(i){Bi.D(i),am("dns-prefetch",i,null)}function RT(i,n){Bi.C(i,n),am("preconnect",i,n)}function _T(i,n,o){Bi.L(i,n,o);var f=Nr;if(f&&i&&n){var m='link[rel="preload"][as="'+Ke(n)+'"]';n==="image"&&o&&o.imageSrcSet?(m+='[imagesrcset="'+Ke(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(m+='[imagesizes="'+Ke(o.imageSizes)+'"]')):m+='[href="'+Ke(i)+'"]';var v=m;switch(n){case"style":v=Pr(i);break;case"script":v=Ur(i)}qs.has(v)||(i=g({rel:"preload",href:n==="image"&&o&&o.imageSrcSet?void 0:i,as:n},o),qs.set(v,i),f.querySelector(m)!==null||n==="style"&&f.querySelector(ja(v))||n==="script"&&f.querySelector(Ha(v))||(n=f.createElement("link"),es(n,"link",i),bt(n),f.head.appendChild(n)))}}function IT(i,n){Bi.m(i,n);var o=Nr;if(o&&i){var f=n&&typeof n.as=="string"?n.as:"script",m='link[rel="modulepreload"][as="'+Ke(f)+'"][href="'+Ke(i)+'"]',v=m;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=Ur(i)}if(!qs.has(v)&&(i=g({rel:"modulepreload",href:i},n),qs.set(v,i),o.querySelector(m)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(Ha(v)))return}f=o.createElement("link"),es(f,"link",i),bt(f),o.head.appendChild(f)}}}function DT(i,n,o){Bi.S(i,n,o);var f=Nr;if(f&&i){var m=oi(f).hoistableStyles,v=Pr(i);n=n||"default";var L=m.get(v);if(!L){var D={loading:0,preload:null};if(L=f.querySelector(ja(v)))D.loading=5;else{i=g({rel:"stylesheet",href:i,"data-precedence":n},o),(o=qs.get(v))&&gf(i,o);var N=L=f.createElement("link");bt(N),es(N,"link",i),N._p=new Promise(function(Q,ne){N.onload=Q,N.onerror=ne}),N.addEventListener("load",function(){D.loading|=1}),N.addEventListener("error",function(){D.loading|=2}),D.loading|=4,po(L,n,f)}L={type:"stylesheet",instance:L,count:1,state:D},m.set(v,L)}}}function CT(i,n){Bi.X(i,n);var o=Nr;if(o&&i){var f=oi(o).hoistableScripts,m=Ur(i),v=f.get(m);v||(v=o.querySelector(Ha(m)),v||(i=g({src:i,async:!0},n),(n=qs.get(m))&&mf(i,n),v=o.createElement("script"),bt(v),es(v,"link",i),o.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},f.set(m,v))}}function kT(i,n){Bi.M(i,n);var o=Nr;if(o&&i){var f=oi(o).hoistableScripts,m=Ur(i),v=f.get(m);v||(v=o.querySelector(Ha(m)),v||(i=g({src:i,async:!0,type:"module"},n),(n=qs.get(m))&&mf(i,n),v=o.createElement("script"),bt(v),es(v,"link",i),o.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},f.set(m,v))}}function lm(i,n,o,f){var m=(m=he.current)?mo(m):null;if(!m)throw Error(s(446));switch(i){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(n=Pr(o.href),o=oi(m).hoistableStyles,f=o.get(n),f||(f={type:"style",instance:null,count:0,state:null},o.set(n,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){i=Pr(o.href);var v=oi(m).hoistableStyles,L=v.get(i);if(L||(m=m.ownerDocument||m,L={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(i,L),(v=m.querySelector(ja(i)))&&!v._p&&(L.instance=v,L.state.loading=5),qs.has(i)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},qs.set(i,o),v||wT(m,i,o,L.state))),n&&f===null)throw Error(s(528,""));return L}if(n&&f!==null)throw Error(s(529,""));return null;case"script":return n=o.async,o=o.src,typeof o=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=Ur(o),o=oi(m).hoistableScripts,f=o.get(n),f||(f={type:"script",instance:null,count:0,state:null},o.set(n,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,i))}}function Pr(i){return'href="'+Ke(i)+'"'}function ja(i){return'link[rel="stylesheet"]['+i+"]"}function om(i){return g({},i,{"data-precedence":i.precedence,precedence:null})}function wT(i,n,o,f){i.querySelector('link[rel="preload"][as="style"]['+n+"]")?f.loading=1:(n=i.createElement("link"),f.preload=n,n.addEventListener("load",function(){return f.loading|=1}),n.addEventListener("error",function(){return f.loading|=2}),es(n,"link",o),bt(n),i.head.appendChild(n))}function Ur(i){return'[src="'+Ke(i)+'"]'}function Ha(i){return"script[async]"+i}function um(i,n,o){if(n.count++,n.instance===null)switch(n.type){case"style":var f=i.querySelector('style[data-href~="'+Ke(o.href)+'"]');if(f)return n.instance=f,bt(f),f;var m=g({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return f=(i.ownerDocument||i).createElement("style"),bt(f),es(f,"style",m),po(f,o.precedence,i),n.instance=f;case"stylesheet":m=Pr(o.href);var v=i.querySelector(ja(m));if(v)return n.state.loading|=4,n.instance=v,bt(v),v;f=om(o),(m=qs.get(m))&&gf(f,m),v=(i.ownerDocument||i).createElement("link"),bt(v);var L=v;return L._p=new Promise(function(D,N){L.onload=D,L.onerror=N}),es(v,"link",f),n.state.loading|=4,po(v,o.precedence,i),n.instance=v;case"script":return v=Ur(o.src),(m=i.querySelector(Ha(v)))?(n.instance=m,bt(m),m):(f=o,(m=qs.get(v))&&(f=g({},o),mf(f,m)),i=i.ownerDocument||i,m=i.createElement("script"),bt(m),es(m,"link",f),i.head.appendChild(m),n.instance=m);case"void":return null;default:throw Error(s(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(f=n.instance,n.state.loading|=4,po(f,o.precedence,i));return n.instance}function po(i,n,o){for(var f=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=f.length?f[f.length-1]:null,v=m,L=0;L<f.length;L++){var D=f[L];if(D.dataset.precedence===n)v=D;else if(v!==m)break}v?v.parentNode.insertBefore(i,v.nextSibling):(n=o.nodeType===9?o.head:o,n.insertBefore(i,n.firstChild))}function gf(i,n){i.crossOrigin==null&&(i.crossOrigin=n.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=n.referrerPolicy),i.title==null&&(i.title=n.title)}function mf(i,n){i.crossOrigin==null&&(i.crossOrigin=n.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=n.referrerPolicy),i.integrity==null&&(i.integrity=n.integrity)}var yo=null;function cm(i,n,o){if(yo===null){var f=new Map,m=yo=new Map;m.set(o,f)}else m=yo,f=m.get(o),f||(f=new Map,m.set(o,f));if(f.has(i))return f;for(f.set(i,null),o=o.getElementsByTagName(i),m=0;m<o.length;m++){var v=o[m];if(!(v[zi]||v[wt]||i==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var L=v.getAttribute(n)||"";L=i+L;var D=f.get(L);D?D.push(v):f.set(L,[v])}}return f}function fm(i,n,o){i=i.ownerDocument||i,i.head.insertBefore(o,n==="title"?i.querySelector("head > title"):null)}function OT(i,n,o){if(o===1||n.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return i=n.disabled,typeof n.precedence=="string"&&i==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function dm(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}var Va=null;function MT(){}function NT(i,n,o){if(Va===null)throw Error(s(475));var f=Va;if(n.type==="stylesheet"&&(typeof o.media!="string"||matchMedia(o.media).matches!==!1)&&(n.state.loading&4)===0){if(n.instance===null){var m=Pr(o.href),v=i.querySelector(ja(m));if(v){i=v._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(f.count++,f=vo.bind(f),i.then(f,f)),n.state.loading|=4,n.instance=v,bt(v);return}v=i.ownerDocument||i,o=om(o),(m=qs.get(m))&&gf(o,m),v=v.createElement("link"),bt(v);var L=v;L._p=new Promise(function(D,N){L.onload=D,L.onerror=N}),es(v,"link",o),n.instance=v}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(n,i),(i=n.state.preload)&&(n.state.loading&3)===0&&(f.count++,n=vo.bind(f),i.addEventListener("load",n),i.addEventListener("error",n))}}function PT(){if(Va===null)throw Error(s(475));var i=Va;return i.stylesheets&&i.count===0&&pf(i,i.stylesheets),0<i.count?function(n){var o=setTimeout(function(){if(i.stylesheets&&pf(i,i.stylesheets),i.unsuspend){var f=i.unsuspend;i.unsuspend=null,f()}},6e4);return i.unsuspend=n,function(){i.unsuspend=null,clearTimeout(o)}}:null}function vo(){if(this.count--,this.count===0){if(this.stylesheets)pf(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var Eo=null;function pf(i,n){i.stylesheets=null,i.unsuspend!==null&&(i.count++,Eo=new Map,n.forEach(UT,i),Eo=null,vo.call(i))}function UT(i,n){if(!(n.state.loading&4)){var o=Eo.get(i);if(o)var f=o.get(null);else{o=new Map,Eo.set(i,o);for(var m=i.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<m.length;v++){var L=m[v];(L.nodeName==="LINK"||L.getAttribute("media")!=="not all")&&(o.set(L.dataset.precedence,L),f=L)}f&&o.set(null,f)}m=n.instance,L=m.getAttribute("data-precedence"),v=o.get(L)||f,v===f&&o.set(null,m),o.set(L,m),this.count++,f=vo.bind(this),m.addEventListener("load",f),m.addEventListener("error",f),v?v.parentNode.insertBefore(m,v.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(m,i.firstChild)),n.state.loading|=4}}var Ka={$$typeof:A,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function BT(i,n,o,f,m,v,L,D){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=er(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=er(0),this.hiddenUpdates=er(null),this.identifierPrefix=f,this.onUncaughtError=m,this.onCaughtError=v,this.onRecoverableError=L,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=D,this.incompleteTransitions=new Map}function hm(i,n,o,f,m,v,L,D,N,Q,ne,le){return i=new BT(i,n,o,L,D,N,Q,le),n=1,v===!0&&(n|=24),v=_s(3,null,null,n),i.current=v,v.stateNode=i,n=Qu(),n.refCount++,i.pooledCache=n,n.refCount++,v.memoizedState={element:f,isDehydrated:o,cache:n},ec(v),i}function gm(i){return i?(i=gr,i):gr}function mm(i,n,o,f,m,v){m=gm(m),f.context===null?f.context=m:f.pendingContext=m,f=Ji(n),f.payload={element:o},v=v===void 0?null:v,v!==null&&(f.callback=v),o=en(i,f,n),o!==null&&(ws(o,i,n),Sa(o,i,n))}function pm(i,n){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var o=i.retryLane;i.retryLane=o!==0&&o<n?o:n}}function yf(i,n){pm(i,n),(i=i.alternate)&&pm(i,n)}function ym(i){if(i.tag===13){var n=hr(i,67108864);n!==null&&ws(n,i,67108864),yf(i,67108864)}}var To=!0;function FT(i,n,o,f){var m=U.T;U.T=null;var v=X.p;try{X.p=2,vf(i,n,o,f)}finally{X.p=v,U.T=m}}function $T(i,n,o,f){var m=U.T;U.T=null;var v=X.p;try{X.p=8,vf(i,n,o,f)}finally{X.p=v,U.T=m}}function vf(i,n,o,f){if(To){var m=Ef(f);if(m===null)rf(i,n,f,So,o),Em(i,f);else if(jT(m,i,n,o,f))f.stopPropagation();else if(Em(i,f),n&4&&-1<GT.indexOf(i)){for(;m!==null;){var v=$s(m);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var L=xi(v.pendingLanes);if(L!==0){var D=v;for(D.pendingLanes|=2,D.entangledLanes|=2;L;){var N=1<<31-Oe(L);D.entanglements[1]|=N,L&=~N}hi(v),(rt&6)===0&&(io=We()+500,Ba(0))}}break;case 13:D=hr(v,2),D!==null&&ws(D,v,2),ro(),yf(v,2)}if(v=Ef(f),v===null&&rf(i,n,f,So,o),v===m)break;m=v}m!==null&&f.stopPropagation()}else rf(i,n,f,null,o)}}function Ef(i){return i=bu(i),Tf(i)}var So=null;function Tf(i){if(So=null,i=Ls(i),i!==null){var n=a(i);if(n===null)i=null;else{var o=n.tag;if(o===13){if(i=u(n),i!==null)return i;i=null}else if(o===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;i=null}else n!==i&&(i=null)}}return So=i,null}function vm(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(It()){case ss:return 2;case st:return 8;case as:case Wt:return 32;case bs:return 268435456;default:return 32}default:return 32}}var Sf=!1,gn=null,mn=null,pn=null,za=new Map,Ya=new Map,yn=[],GT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Em(i,n){switch(i){case"focusin":case"focusout":gn=null;break;case"dragenter":case"dragleave":mn=null;break;case"mouseover":case"mouseout":pn=null;break;case"pointerover":case"pointerout":za.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ya.delete(n.pointerId)}}function qa(i,n,o,f,m,v){return i===null||i.nativeEvent!==v?(i={blockedOn:n,domEventName:o,eventSystemFlags:f,nativeEvent:v,targetContainers:[m]},n!==null&&(n=$s(n),n!==null&&ym(n)),i):(i.eventSystemFlags|=f,n=i.targetContainers,m!==null&&n.indexOf(m)===-1&&n.push(m),i)}function jT(i,n,o,f,m){switch(n){case"focusin":return gn=qa(gn,i,n,o,f,m),!0;case"dragenter":return mn=qa(mn,i,n,o,f,m),!0;case"mouseover":return pn=qa(pn,i,n,o,f,m),!0;case"pointerover":var v=m.pointerId;return za.set(v,qa(za.get(v)||null,i,n,o,f,m)),!0;case"gotpointercapture":return v=m.pointerId,Ya.set(v,qa(Ya.get(v)||null,i,n,o,f,m)),!0}return!1}function Tm(i){var n=Ls(i.target);if(n!==null){var o=a(n);if(o!==null){if(n=o.tag,n===13){if(n=u(o),n!==null){i.blockedOn=n,tr(i.priority,function(){if(o.tag===13){var f=ks();f=ds(f);var m=hr(o,f);m!==null&&ws(m,o,f),yf(o,f)}});return}}else if(n===3&&o.stateNode.current.memoizedState.isDehydrated){i.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}i.blockedOn=null}function xo(i){if(i.blockedOn!==null)return!1;for(var n=i.targetContainers;0<n.length;){var o=Ef(i.nativeEvent);if(o===null){o=i.nativeEvent;var f=new o.constructor(o.type,o);xu=f,o.target.dispatchEvent(f),xu=null}else return n=$s(o),n!==null&&ym(n),i.blockedOn=o,!1;n.shift()}return!0}function Sm(i,n,o){xo(i)&&o.delete(n)}function HT(){Sf=!1,gn!==null&&xo(gn)&&(gn=null),mn!==null&&xo(mn)&&(mn=null),pn!==null&&xo(pn)&&(pn=null),za.forEach(Sm),Ya.forEach(Sm)}function bo(i,n){i.blockedOn===n&&(i.blockedOn=null,Sf||(Sf=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,HT)))}var Ao=null;function xm(i){Ao!==i&&(Ao=i,l.unstable_scheduleCallback(l.unstable_NormalPriority,function(){Ao===i&&(Ao=null);for(var n=0;n<i.length;n+=3){var o=i[n],f=i[n+1],m=i[n+2];if(typeof f!="function"){if(Tf(f||o)===null)continue;break}var v=$s(o);v!==null&&(i.splice(n,3),n-=3,Ec(v,{pending:!0,data:m,method:o.method,action:f},f,m))}}))}function Xa(i){function n(N){return bo(N,i)}gn!==null&&bo(gn,i),mn!==null&&bo(mn,i),pn!==null&&bo(pn,i),za.forEach(n),Ya.forEach(n);for(var o=0;o<yn.length;o++){var f=yn[o];f.blockedOn===i&&(f.blockedOn=null)}for(;0<yn.length&&(o=yn[0],o.blockedOn===null);)Tm(o),o.blockedOn===null&&yn.shift();if(o=(i.ownerDocument||i).$$reactFormReplay,o!=null)for(f=0;f<o.length;f+=3){var m=o[f],v=o[f+1],L=m[is]||null;if(typeof v=="function")L||xm(o);else if(L){var D=null;if(v&&v.hasAttribute("formAction")){if(m=v,L=v[is]||null)D=L.formAction;else if(Tf(m)!==null)continue}else D=L.action;typeof D=="function"?o[f+1]=D:(o.splice(f,3),f-=3),xm(o)}}}function xf(i){this._internalRoot=i}Lo.prototype.render=xf.prototype.render=function(i){var n=this._internalRoot;if(n===null)throw Error(s(409));var o=n.current,f=ks();mm(o,f,i,n,null,null)},Lo.prototype.unmount=xf.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var n=i.containerInfo;mm(i.current,2,null,i,null,null),ro(),n[Fs]=null}};function Lo(i){this._internalRoot=i}Lo.prototype.unstable_scheduleHydration=function(i){if(i){var n=Ki();i={blockedOn:null,target:i,priority:n};for(var o=0;o<yn.length&&n!==0&&n<yn[o].priority;o++);yn.splice(o,0,i),o===0&&Tm(i)}};var bm=e.version;if(bm!=="19.1.1")throw Error(s(527,bm,"19.1.1"));X.findDOMNode=function(i){var n=i._reactInternals;if(n===void 0)throw typeof i.render=="function"?Error(s(188)):(i=Object.keys(i).join(","),Error(s(268,i)));return i=h(n),i=i!==null?d(i):null,i=i===null?null:i.stateNode,i};var VT={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:U,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var Ro=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ro.isDisabled&&Ro.supportsFiber)try{Ae=Ro.inject(VT),pe=Ro}catch(i){}}return Wa.createRoot=function(i,n){if(!r(i))throw Error(s(299));var o=!1,f="",m=Fg,v=$g,L=Gg,D=null;return n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(f=n.identifierPrefix),n.onUncaughtError!==void 0&&(m=n.onUncaughtError),n.onCaughtError!==void 0&&(v=n.onCaughtError),n.onRecoverableError!==void 0&&(L=n.onRecoverableError),n.unstable_transitionCallbacks!==void 0&&(D=n.unstable_transitionCallbacks)),n=hm(i,1,!1,null,null,o,f,m,v,L,D,null),i[Fs]=n.current,nf(i),new xf(n)},Wa.hydrateRoot=function(i,n,o){if(!r(i))throw Error(s(299));var f=!1,m="",v=Fg,L=$g,D=Gg,N=null,Q=null;return o!=null&&(o.unstable_strictMode===!0&&(f=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onUncaughtError!==void 0&&(v=o.onUncaughtError),o.onCaughtError!==void 0&&(L=o.onCaughtError),o.onRecoverableError!==void 0&&(D=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(N=o.unstable_transitionCallbacks),o.formState!==void 0&&(Q=o.formState)),n=hm(i,1,!0,n,o!=null?o:null,f,m,v,L,D,N,Q),n.context=gm(null),o=n.current,f=ks(),f=ds(f),m=Ji(f),m.callback=null,en(o,m,f),o=f,n.current.lanes=o,li(n,o),hi(n),i[Fs]=n.current,nf(i),new Lo(n)},Wa.version="19.1.1",Wa}var Bm;function rS(){if(Bm)return Lf.exports;Bm=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(e){console.error(e)}}return l(),Lf.exports=nS(),Lf.exports}var aS=rS();const Wr={HOST:"http://192.168.0.108:3000"},Hr=`${Wr.HOST}/api`,Nt={get:(t,...s)=>et(null,[t,...s],function*(l,{params:e}={}){const r=`${Hr}${l}`,a=new URL(r);e&&Object.keys(e).forEach(u=>{e[u]!==null&&e[u]!==void 0&&a.searchParams.append(u,e[u])});try{const u=yield fetch(a.toString());if(!u.ok){const h=yield u.text();throw console.error("API Error:",u.status,h),new Error(`Request failed: ${u.status} ${u.statusText}`)}return{data:yield u.json()}}catch(u){throw console.error("Network or API error:",u),u}}),post:(t,...s)=>et(null,[t,...s],function*(l,e={}){const r=`${Hr}${l}`,a=new URL(r);try{const u=yield fetch(a.toString(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!u.ok){const h=yield u.text();throw console.error("API Error:",u.status,h),new Error(`Request failed: ${u.status} ${u.statusText}`)}return{data:yield u.json()}}catch(u){throw console.error("Network or API error:",u),u}}),put:(l,e)=>et(null,null,function*(){const t=`${Hr}${l}`,s=new URL(t);try{const r=yield fetch(s.toString(),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){const u=yield r.text();throw console.error("API Error:",r.status,u),new Error(`Request failed: ${r.status} ${r.statusText}`)}return{data:yield r.json()}}catch(r){throw console.error("Network or API error:",r),r}}),delete:l=>et(null,null,function*(){const e=`${Hr}${l}`,t=new URL(e);try{const s=yield fetch(t.toString(),{method:"DELETE"});if(!s.ok){const a=yield s.text();throw console.error("API Error:",s.status,a),new Error(`Request failed: ${s.status} ${s.statusText}`)}return{data:yield s.json()}}catch(s){throw console.error("Network or API error:",s),s}})},Zr={MOVIES:"/v2/movies",SERIES:"/v2/series",MOVIE_LINK:"/v2/movie-link",CHANNELS:"/v2/channels",EPG:"/v2/epg",CHANNEL_GROUPS:"/v2/groups"},Df=l=>et(null,null,function*(){const e=(yield Nt.get(Zr.MOVIES,{params:l})).data;if(!e)throw new Error("No response data received from media API.");return e}),Io=l=>et(null,null,function*(){const e=(yield Nt.get(Zr.SERIES,{params:l})).data;if(!e)throw new Error("No response data received from series API.");return e}),lS=()=>et(null,null,function*(){const l=(yield Nt.get(Zr.CHANNELS)).data;if(!l||!Array.isArray(l))throw new Error("No response data received from channels API.");return{data:l,page:1,total_items:l.length}}),ry=(l=!1)=>et(null,null,function*(){const e={};l&&(e.all="true");const t=(yield Nt.get(Zr.CHANNEL_GROUPS,{params:e})).data;if(!t||!Array.isArray(t))throw new Error("No response data received from channel groups API.");return{data:t,page:1,total_items:t.length}}),Fm=(...e)=>et(null,[...e],function*(l={}){return(yield Nt.get(Zr.MOVIE_LINK,{params:l})).data}),oS=()=>et(null,null,function*(){return yield Nt.get(Zr.EPG)}),$m=()=>I.jsx("div",{className:"flex h-full items-center justify-center",children:I.jsx("div",{className:"h-20 w-20 animate-spin rounded-full border-b-2 border-t-2 border-blue-500"})}),ay=({item:l,onClick:e})=>{const[t,s]=K.useState(!1),[r,a]=K.useState(!1),[u,c]=K.useState(!1),h=l.title||l.name,d=h?h.substring(0,2).toUpperCase():"??",g=l.screenshot_uri?l.screenshot_uri.startsWith("http")?l.screenshot_uri:`${Wr.HOST}/api/images${l.screenshot_uri}`:null;return K.useEffect(()=>{s(!1)},[l.screenshot_uri]),K.useEffect(()=>{const p=localStorage.getItem(`video-completed-${l.id}`);if(p)try{const y=JSON.parse(p);y&&y.mediaId===l.id&&a(!0)}catch(y){p==="true"&&a(!0),console.error(y)}else{const y=localStorage.getItem(`video-in-progress-${l.id}`);if(y)try{const E=JSON.parse(y);E&&E.mediaId===l.id?c(!0):c(!1)}catch(E){c(y==="true"),console.error(E)}else c(!1)}},[l.id]),I.jsxs("div",{className:"group relative transform cursor-pointer overflow-hidden rounded-lg border-2 border-transparent bg-gray-800 transition-all duration-300 hover:scale-105 hover:border-blue-500 hover:shadow-2xl",onClick:()=>e(l),"data-focusable":"true",tabIndex:-1,children:[r&&I.jsx("div",{className:"absolute right-2 top-2 z-10 h-3 w-3 rounded-full bg-green-500"}),!r&&u&&I.jsx("div",{className:"absolute right-2 top-2 z-10 h-3 w-3 rounded-full bg-yellow-500"}),I.jsx("div",{className:"relative flex h-48 w-full items-center justify-center overflow-hidden bg-gray-700 md:h-64",children:g&&!t?I.jsx("img",{src:g,alt:h,className:"h-full w-full object-cover transition-transform duration-300 group-hover:scale-110",onError:()=>s(!0)}):I.jsx("div",{className:"bg-linear-to-br flex h-full w-full items-center justify-center from-gray-700 to-gray-800",children:I.jsx("span",{className:"select-none text-4xl font-bold text-gray-400",children:d})})}),I.jsx("div",{className:"p-4",children:I.jsx("h3",{className:"text-md truncate font-bold text-white transition-colors duration-300 group-hover:text-blue-400",children:h})})]})},uS=({item:l,onClick:e})=>{const[t,s]=K.useState(!1),[r,a]=K.useState(!1),[u,c]=K.useState(!1),h=l.title||l.name,d=h?h.substring(0,2).toUpperCase():"??",g=l.screenshot_uri?l.screenshot_uri.startsWith("http")?l.screenshot_uri:`${Wr.HOST}/api/images${l.screenshot_uri}`:null;return K.useEffect(()=>{s(!1)},[l.screenshot_uri]),K.useEffect(()=>{const p=localStorage.getItem(`video-completed-${l.id}`);if(a(!!p),!p){const y=localStorage.getItem(`video-in-progress-${l.id}`);c(!!y)}},[l.id]),I.jsxs("div",{className:"group relative flex w-full transform cursor-pointer items-center overflow-hidden rounded-lg border-2 border-transparent bg-gray-800 transition-all duration-300 hover:border-blue-500 hover:bg-gray-700 hover:shadow-lg",onClick:()=>e(l),"data-focusable":"true",tabIndex:-1,children:[r&&I.jsx("div",{className:"absolute right-2 top-2 z-10 h-3 w-3 rounded-full bg-green-500"}),!r&&u&&I.jsx("div",{className:"absolute right-2 top-2 z-10 h-3 w-3 rounded-full bg-yellow-500"}),I.jsx("div",{className:"relative flex h-20 w-32 shrink-0 items-center justify-center overflow-hidden bg-gray-700",children:g&&!t?I.jsx("img",{src:g,alt:h,className:"h-full w-full object-contain transition-transform duration-300 group-hover:scale-110",onError:()=>s(!0)}):I.jsx("div",{className:"bg-linear-to-br flex h-full w-full items-center justify-center from-gray-700 to-gray-800",children:I.jsx("span",{className:"select-none text-2xl font-bold text-gray-400",children:d})})}),I.jsx("div",{className:"overflow-hidden p-4",children:I.jsx("h3",{className:"text-md truncate font-semibold text-white transition-colors duration-300 group-hover:text-blue-400",children:h})})]})},Cf=l=>{if(isNaN(l)||l<0)return"00:00";const e=Math.floor(l/3600),t=Math.floor(l%3600/60),r=Math.floor(l%60).toString().padStart(2,"0"),a=t.toString().padStart(2,"0");return e>0?`${e}:${a}:${r}`:`${a}:${r}`},Ee=Number.isFinite||function(l){return typeof l=="number"&&isFinite(l)},cS=Number.isSafeInteger||function(l){return typeof l=="number"&&Math.abs(l)<=fS},fS=Number.MAX_SAFE_INTEGER||9007199254740991;let Le=(function(l){return l.NETWORK_ERROR="networkError",l.MEDIA_ERROR="mediaError",l.KEY_SYSTEM_ERROR="keySystemError",l.MUX_ERROR="muxError",l.OTHER_ERROR="otherError",l})({}),z=(function(l){return l.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",l.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",l.KEY_SYSTEM_NO_SESSION="keySystemNoSession",l.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",l.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",l.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",l.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",l.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",l.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",l.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",l.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",l.MANIFEST_LOAD_ERROR="manifestLoadError",l.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",l.MANIFEST_PARSING_ERROR="manifestParsingError",l.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",l.LEVEL_EMPTY_ERROR="levelEmptyError",l.LEVEL_LOAD_ERROR="levelLoadError",l.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",l.LEVEL_PARSING_ERROR="levelParsingError",l.LEVEL_SWITCH_ERROR="levelSwitchError",l.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",l.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",l.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",l.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",l.FRAG_LOAD_ERROR="fragLoadError",l.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",l.FRAG_DECRYPT_ERROR="fragDecryptError",l.FRAG_PARSING_ERROR="fragParsingError",l.FRAG_GAP="fragGap",l.REMUX_ALLOC_ERROR="remuxAllocError",l.KEY_LOAD_ERROR="keyLoadError",l.KEY_LOAD_TIMEOUT="keyLoadTimeOut",l.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",l.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",l.BUFFER_APPEND_ERROR="bufferAppendError",l.BUFFER_APPENDING_ERROR="bufferAppendingError",l.BUFFER_STALLED_ERROR="bufferStalledError",l.BUFFER_FULL_ERROR="bufferFullError",l.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",l.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",l.ASSET_LIST_LOAD_ERROR="assetListLoadError",l.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",l.ASSET_LIST_PARSING_ERROR="assetListParsingError",l.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",l.INTERNAL_EXCEPTION="internalException",l.INTERNAL_ABORTED="aborted",l.ATTACH_MEDIA_ERROR="attachMediaError",l.UNKNOWN="unknown",l})({}),b=(function(l){return l.MEDIA_ATTACHING="hlsMediaAttaching",l.MEDIA_ATTACHED="hlsMediaAttached",l.MEDIA_DETACHING="hlsMediaDetaching",l.MEDIA_DETACHED="hlsMediaDetached",l.MEDIA_ENDED="hlsMediaEnded",l.STALL_RESOLVED="hlsStallResolved",l.BUFFER_RESET="hlsBufferReset",l.BUFFER_CODECS="hlsBufferCodecs",l.BUFFER_CREATED="hlsBufferCreated",l.BUFFER_APPENDING="hlsBufferAppending",l.BUFFER_APPENDED="hlsBufferAppended",l.BUFFER_EOS="hlsBufferEos",l.BUFFERED_TO_END="hlsBufferedToEnd",l.BUFFER_FLUSHING="hlsBufferFlushing",l.BUFFER_FLUSHED="hlsBufferFlushed",l.MANIFEST_LOADING="hlsManifestLoading",l.MANIFEST_LOADED="hlsManifestLoaded",l.MANIFEST_PARSED="hlsManifestParsed",l.LEVEL_SWITCHING="hlsLevelSwitching",l.LEVEL_SWITCHED="hlsLevelSwitched",l.LEVEL_LOADING="hlsLevelLoading",l.LEVEL_LOADED="hlsLevelLoaded",l.LEVEL_UPDATED="hlsLevelUpdated",l.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",l.LEVELS_UPDATED="hlsLevelsUpdated",l.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",l.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",l.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",l.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",l.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",l.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",l.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",l.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",l.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",l.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",l.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",l.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",l.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",l.CUES_PARSED="hlsCuesParsed",l.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",l.INIT_PTS_FOUND="hlsInitPtsFound",l.FRAG_LOADING="hlsFragLoading",l.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",l.FRAG_LOADED="hlsFragLoaded",l.FRAG_DECRYPTED="hlsFragDecrypted",l.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",l.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",l.FRAG_PARSING_METADATA="hlsFragParsingMetadata",l.FRAG_PARSED="hlsFragParsed",l.FRAG_BUFFERED="hlsFragBuffered",l.FRAG_CHANGED="hlsFragChanged",l.FPS_DROP="hlsFpsDrop",l.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",l.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",l.ERROR="hlsError",l.DESTROYING="hlsDestroying",l.KEY_LOADING="hlsKeyLoading",l.KEY_LOADED="hlsKeyLoaded",l.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",l.BACK_BUFFER_REACHED="hlsBackBufferReached",l.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",l.ASSET_LIST_LOADING="hlsAssetListLoading",l.ASSET_LIST_LOADED="hlsAssetListLoaded",l.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",l.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",l.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",l.INTERSTITIAL_STARTED="hlsInterstitialStarted",l.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",l.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",l.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",l.INTERSTITIAL_ENDED="hlsInterstitialEnded",l.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",l.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",l.EVENT_CUE_ENTER="hlsEventCueEnter",l})({});var Ve={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Te={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Br{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class dS{constructor(e,t,s,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Br(e),this.fast_=new Br(t),this.defaultTTFB_=r,this.ttfb_=new Br(e)}update(e,t){const{slow_:s,fast_:r,ttfb_:a}=this;s.halfLife!==e&&(this.slow_=new Br(e,s.getEstimate(),s.getTotalWeight())),r.halfLife!==t&&(this.fast_=new Br(t,r.getEstimate(),r.getTotalWeight())),a.halfLife!==e&&(this.ttfb_=new Br(e,a.getEstimate(),a.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,r=e/1e3,a=s/r;this.fast_.sample(r,a),this.slow_.sample(r,a)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function hS(l,e,t){return(e=mS(e))in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}function dt(){return dt=Object.assign?Object.assign.bind():function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(l[s]=t[s])}return l},dt.apply(null,arguments)}function Gm(l,e){var t=Object.keys(l);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(l);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(l,r).enumerable})),t.push.apply(t,s)}return t}function lt(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Gm(Object(t),!0).forEach(function(s){hS(l,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(t)):Gm(Object(t)).forEach(function(s){Object.defineProperty(l,s,Object.getOwnPropertyDescriptor(t,s))})}return l}function gS(l,e){if(typeof l!="object"||!l)return l;var t=l[Symbol.toPrimitive];if(t!==void 0){var s=t.call(l,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(l)}function mS(l){var e=gS(l,"string");return typeof e=="symbol"?e:e+""}class Ws{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=Sn,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const Sn=function(){},pS={trace:Sn,debug:Sn,log:Sn,warn:Sn,info:Sn,error:Sn};function nd(){return dt({},pS)}function yS(l,e){const t=self.console[l];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${l}] >`):Sn}function jm(l,e,t){return e[l]?e[l].bind(e):yS(l,t)}const rd=nd();function vS(l,e,t){const s=nd();if(typeof console=="object"&&l===!0||typeof l=="object"){const r=["debug","log","info","warn","error"];r.forEach(a=>{s[a]=jm(a,l,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.12`)}catch(a){return nd()}r.forEach(a=>{rd[a]=jm(a,l)})}else dt(rd,s);return s}const ot=rd;function An(l=!0){return typeof self=="undefined"?void 0:(l||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function ES(l){return typeof self!="undefined"&&l===self.ManagedMediaSource}function ly(l,e){const t=Object.keys(l),s=Object.keys(e),r=t.length,a=s.length;return!r||!a||r===a&&!t.some(u=>s.indexOf(u)===-1)}function Us(l,e=!1){if(typeof TextDecoder!="undefined"){const d=new TextDecoder("utf-8").decode(l);if(e){const g=d.indexOf("\0");return g!==-1?d.substring(0,g):d}return d.replace(/\0/g,"")}const t=l.length;let s,r,a,u="",c=0;for(;c<t;){if(s=l[c++],s===0&&e)return u;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(s);break;case 12:case 13:r=l[c++],u+=String.fromCharCode((s&31)<<6|r&63);break;case 14:r=l[c++],a=l[c++],u+=String.fromCharCode((s&15)<<12|(r&63)<<6|(a&63)<<0);break}}return u}function Ts(l){let e="";for(let t=0;t<l.length;t++){let s=l[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}function oy(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function TS(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var kf={exports:{}},Hm;function SS(){return Hm||(Hm=1,(function(l,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,u=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(h,d,g){if(g=g||{},h=h.trim(),d=d.trim(),!d){if(!g.alwaysNormalize)return h;var p=c.parseURL(h);if(!p)throw new Error("Error trying to parse base URL.");return p.path=c.normalizePath(p.path),c.buildURLFromParts(p)}var y=c.parseURL(d);if(!y)throw new Error("Error trying to parse relative URL.");if(y.scheme)return g.alwaysNormalize?(y.path=c.normalizePath(y.path),c.buildURLFromParts(y)):d;var E=c.parseURL(h);if(!E)throw new Error("Error trying to parse base URL.");if(!E.netLoc&&E.path&&E.path[0]!=="/"){var T=r.exec(E.path);E.netLoc=T[1],E.path=T[2]}E.netLoc&&!E.path&&(E.path="/");var x={scheme:E.scheme,netLoc:y.netLoc,path:null,params:y.params,query:y.query,fragment:y.fragment};if(!y.netLoc&&(x.netLoc=E.netLoc,y.path[0]!=="/"))if(!y.path)x.path=E.path,y.params||(x.params=E.params,y.query||(x.query=E.query));else{var S=E.path,R=S.substring(0,S.lastIndexOf("/")+1)+y.path;x.path=c.normalizePath(R)}return x.path===null&&(x.path=g.alwaysNormalize?c.normalizePath(y.path):y.path),c.buildURLFromParts(x)},parseURL:function(h){var d=s.exec(h);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(a,"");h.length!==(h=h.replace(u,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};l.exports=c})()})(kf)),kf.exports}var Rd=SS();class _d{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var yt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class uy{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,bS(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let r;s.length===1?r=(t==null?void 0:t.byteRangeEndOffset)||0:r=parseInt(s[1]),this._byteRange=[r,parseInt(s[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[yt.AUDIO]:null,[yt.VIDEO]:null,[yt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new _d),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Rd.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[yt.AUDIO]=null,e[yt.VIDEO]=null,e[yt.AUDIOVIDEO]=null}}function $t(l){return l.sn!=="initSegment"}class wf extends uy{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Ee(e)&&Ee(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const s=Object.keys(this.levelkeys);if(s.length===1){const r=this._decryptdata=this.levelkeys[s[0]]||null;if(r)return r.getDecryptData(this.sn)}}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Ee(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),r=s.length;if(r>1||r===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Ee(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return $t(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,r,a,u=!1){const{elementaryStreams:c}=this,h=c[e];if(!h){c[e]={startPTS:t,endPTS:s,startDTS:r,endDTS:a,partial:u};return}h.startPTS=Math.min(h.startPTS,t),h.endPTS=Math.max(h.endPTS,s),h.startDTS=Math.min(h.startDTS,r),h.endDTS=Math.max(h.endDTS,a)}}class xS extends uy{constructor(e,t,s,r,a){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const u=e.enumeratedString("BYTERANGE");u&&this.setByteRange(u,a),a&&(this.fragOffset=a.fragOffset+a.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function cy(l,e){const t=Object.getPrototypeOf(l);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||cy(t,e)}}function bS(l,e){const t=cy(l,e);t&&(t.enumerable=!0,Object.defineProperty(l,e,t))}const Vm=Math.pow(2,32)-1,AS=[].push,fy={video:1,audio:2,id3:3,text:4};function Vt(l){return String.fromCharCode.apply(null,l)}function dy(l,e){const t=l[e]<<8|l[e+1];return t<0?65536+t:t}function Me(l,e){const t=hy(l,e);return t<0?4294967296+t:t}function Km(l,e){let t=Me(l,e);return t*=Math.pow(2,32),t+=Me(l,e+4),t}function hy(l,e){return l[e]<<24|l[e+1]<<16|l[e+2]<<8|l[e+3]}function LS(l){const e=l.byteLength;for(let t=0;t<e;){const s=Me(l,t);if(s>8&&l[t+4]===109&&l[t+5]===111&&l[t+6]===111&&l[t+7]===102)return!0;t=s>1?t+s:e}return!1}function je(l,e){const t=[];if(!e.length)return t;const s=l.byteLength;for(let r=0;r<s;){const a=Me(l,r),u=Vt(l.subarray(r+4,r+8)),c=a>1?r+a:s;if(u===e[0])if(e.length===1)t.push(l.subarray(r+8,c));else{const h=je(l.subarray(r+8,c),e.slice(1));h.length&&AS.apply(t,h)}r=c}return t}function RS(l){const e=[],t=l[0];let s=8;const r=Me(l,s);s+=4;let a=0,u=0;t===0?(a=Me(l,s),u=Me(l,s+4),s+=8):(a=Km(l,s),u=Km(l,s+8),s+=16),s+=2;let c=l.length+u;const h=dy(l,s);s+=2;for(let d=0;d<h;d++){let g=s;const p=Me(l,g);g+=4;const y=p&2147483647;if((p&2147483648)>>>31===1)return ot.warn("SIDX has hierarchical references (not supported)"),null;const T=Me(l,g);g+=4,e.push({referenceSize:y,subsegmentDuration:T,info:{duration:T/r,start:c,end:c+y-1}}),c+=y,g+=4,s=g}return{earliestPresentationTime:a,timescale:r,version:t,referencesCount:h,references:e}}function gy(l){const e=[],t=je(l,["moov","trak"]);for(let r=0;r<t.length;r++){const a=t[r],u=je(a,["tkhd"])[0];if(u){let c=u[0];const h=Me(u,c===0?12:20),d=je(a,["mdia","mdhd"])[0];if(d){c=d[0];const g=Me(d,c===0?12:20),p=je(a,["mdia","hdlr"])[0];if(p){const y=Vt(p.subarray(8,12)),E={soun:yt.AUDIO,vide:yt.VIDEO}[y],T=je(a,["mdia","minf","stbl","stsd"])[0],x=_S(T);E?(e[h]={timescale:g,type:E,stsd:x},e[E]=lt({timescale:g,id:h},x)):e[h]={timescale:g,type:y,stsd:x}}}}}return je(l,["moov","mvex","trex"]).forEach(r=>{const a=Me(r,4),u=e[a];u&&(u.default={duration:Me(r,12),flags:Me(r,20)})}),e}function _S(l){const e=l.subarray(8),t=e.subarray(86),s=Vt(e.subarray(4,8));let r=s,a;const u=s==="enca"||s==="encv";if(u){const d=je(e,[s])[0].subarray(s==="enca"?28:78);je(d,["sinf"]).forEach(p=>{const y=je(p,["schm"])[0];if(y){const E=Vt(y.subarray(4,8));if(E==="cbcs"||E==="cenc"){const T=je(p,["frma"])[0];T&&(r=Vt(T))}}})}const c=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const h=je(t,["avcC"])[0];h&&h.length>3&&(r+="."+Co(h[1])+Co(h[2])+Co(h[3]),a=Do(c==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const h=je(e,[s])[0],d=je(h.subarray(28),["esds"])[0];if(d&&d.length>7){let g=4;if(d[g++]!==3)break;g=Of(d,g),g+=2;const p=d[g++];if(p&128&&(g+=2),p&64&&(g+=d[g++]),d[g++]!==4)break;g=Of(d,g);const y=d[g++];if(y===64)r+="."+Co(y);else break;if(g+=12,d[g++]!==5)break;g=Of(d,g);const E=d[g++];let T=(E&248)>>3;T===31&&(T+=1+((E&7)<<3)+((d[g]&224)>>5)),r+="."+T}break}case"hvc1":case"hev1":{const h=je(t,["hvcC"])[0];if(h&&h.length>12){const d=h[1],g=["","A","B","C"][d>>6],p=d&31,y=Me(h,2),E=(d&32)>>5?"H":"L",T=h[12],x=h.subarray(6,12);r+="."+g+p,r+="."+IS(y).toString(16).toUpperCase(),r+="."+E+T;let S="";for(let R=x.length;R--;){const _=x[R];(_||S)&&(S="."+_.toString(16).toUpperCase()+S)}r+=S}a=Do(c=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=Do(r,t)||r;break}case"vp09":{const h=je(t,["vpcC"])[0];if(h&&h.length>6){const d=h[4],g=h[5],p=h[6]>>4&15;r+="."+pi(d)+"."+pi(g)+"."+pi(p)}break}case"av01":{const h=je(t,["av1C"])[0];if(h&&h.length>2){const d=h[1]>>>5,g=h[1]&31,p=h[2]>>>7?"H":"M",y=(h[2]&64)>>6,E=(h[2]&32)>>5,T=d===2&&y?E?12:10:y?10:8,x=(h[2]&16)>>4,S=(h[2]&8)>>3,R=(h[2]&4)>>2,_=h[2]&3;r+="."+d+"."+pi(g)+p+"."+pi(T)+"."+x+"."+S+R+_+"."+pi(1)+"."+pi(1)+"."+pi(1)+"."+0,a=Do("dav1",t)}break}}return{codec:r,encrypted:u,supplemental:a}}function Do(l,e){const t=je(e,["dvvC"]),s=t.length?t[0]:je(e,["dvcC"])[0];if(s){const r=s[2]>>1&127,a=s[2]<<5&32|s[3]>>3&31;return l+"."+pi(r)+"."+pi(a)}}function IS(l){let e=0;for(let t=0;t<32;t++)e|=(l>>t&1)<<31-t;return e>>>0}function Of(l,e){const t=e+5;for(;l[e++]&128&&e<t;);return e}function Co(l){return("0"+l.toString(16).toUpperCase()).slice(-2)}function pi(l){return(l<10?"0":"")+l}function DS(l,e){if(!l||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&je(l,["moov","trak"]).forEach(r=>{const u=je(r,["mdia","minf","stbl","stsd"])[0].subarray(8);let c=je(u,["enca"]);const h=c.length>0;h||(c=je(u,["encv"])),c.forEach(d=>{const g=h?d.subarray(28):d.subarray(78);je(g,["sinf"]).forEach(y=>{const E=my(y);if(E){const T=E.subarray(8,24);T.some(x=>x!==0)||(ot.log(`[eme] Patching keyId in 'enc${h?"a":"v"}>sinf>>tenc' box: ${Ts(T)} -> ${Ts(t)}`),E.set(t,8))}})})})}function my(l){const e=je(l,["schm"])[0];if(e){const t=Vt(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return je(l,["schi","tenc"])[0]}return null}function CS(l,e,t){const s={},r=je(l,["moof","traf"]);for(let a=0;a<r.length;a++){const u=r[a],c=je(u,["tfhd"])[0],h=Me(c,4),d=e[h];if(!d)continue;s[h]||(s[h]={start:NaN,duration:0,sampleCount:0,timescale:d.timescale,type:d.type});const g=s[h],p=je(u,["tfdt"])[0];if(p){const A=p[0];let C=Me(p,4);A===1&&(C===Vm?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(C*=Vm+1,C+=Me(p,8))),Ee(C)&&(!Ee(g.start)||C<g.start)&&(g.start=C)}const y=d.default,E=Me(c,0)|(y==null?void 0:y.flags);let T=(y==null?void 0:y.duration)||0;E&8&&(E&2?T=Me(c,12):T=Me(c,8));const x=je(u,["trun"]);let S=g.start||0,R=0,_=T;for(let A=0;A<x.length;A++){const C=x[A],k=Me(C,4),G=g.sampleCount;g.sampleCount+=k;const w=C[3]&1,P=C[3]&4,B=C[2]&1,M=C[2]&2,j=C[2]&4,ee=C[2]&8;let oe=8,de=k;for(w&&(oe+=4),P&&k&&(!(C[oe+1]&1)&&g.keyFrameIndex===void 0&&(g.keyFrameIndex=G),oe+=4,B?(_=Me(C,oe),oe+=4):_=T,M&&(oe+=4),ee&&(oe+=4),S+=_,R+=_,de--);de--;)B?(_=Me(C,oe),oe+=4):_=T,M&&(oe+=4),j&&(C[oe+1]&1||g.keyFrameIndex===void 0&&(g.keyFrameIndex=g.sampleCount-(de+1),g.keyFrameStart=S),oe+=4),ee&&(oe+=4),S+=_,R+=_;!R&&T&&(R+=T*k)}g.duration+=R}if(!Object.keys(s).some(a=>s[a].duration)){let a=1/0,u=0;const c=je(l,["sidx"]);for(let h=0;h<c.length;h++){const d=RS(c[h]);if(d!=null&&d.references){a=Math.min(a,d.earliestPresentationTime/d.timescale);const g=d.references.reduce((p,y)=>p+y.info.duration||0,0);u=Math.max(u,g+d.earliestPresentationTime/d.timescale)}}u&&Ee(u)&&Object.keys(s).forEach(h=>{s[h].duration||(s[h].duration=u*s[h].timescale-s[h].start)})}return s}function kS(l){const e={valid:null,remainder:null},t=je(l,["moof"]);if(t.length<2)return e.remainder=l,e;const s=t[t.length-1];return e.valid=l.slice(0,s.byteOffset-8),e.remainder=l.slice(s.byteOffset-8),e}function Qs(l,e){const t=new Uint8Array(l.length+e.length);return t.set(l),t.set(e,l.length),t}function zm(l,e){const t=[],s=e.samples,r=e.timescale,a=e.id;let u=!1;return je(s,["moof"]).map(h=>{const d=h.byteOffset-8;je(h,["traf"]).map(p=>{const y=je(p,["tfdt"]).map(E=>{const T=E[0];let x=Me(E,4);return T===1&&(x*=Math.pow(2,32),x+=Me(E,8)),x/r})[0];return y!==void 0&&(l=y),je(p,["tfhd"]).map(E=>{const T=Me(E,4),x=Me(E,0)&16777215,S=(x&1)!==0,R=(x&2)!==0,_=(x&8)!==0;let A=0;const C=(x&16)!==0;let k=0;const G=(x&32)!==0;let w=8;T===a&&(S&&(w+=8),R&&(w+=4),_&&(A=Me(E,w),w+=4),C&&(k=Me(E,w),w+=4),G&&(w+=4),e.type==="video"&&(u=hu(e.codec)),je(p,["trun"]).map(P=>{const B=P[0],M=Me(P,0)&16777215,j=(M&1)!==0;let ee=0;const oe=(M&4)!==0,de=(M&256)!==0;let ce=0;const U=(M&512)!==0;let X=0;const te=(M&1024)!==0,ue=(M&2048)!==0;let O=0;const $=Me(P,4);let Y=8;j&&(ee=Me(P,Y),Y+=4),oe&&(Y+=4);let ie=ee+d;for(let fe=0;fe<$;fe++){if(de?(ce=Me(P,Y),Y+=4):ce=A,U?(X=Me(P,Y),Y+=4):X=k,te&&(Y+=4),ue&&(B===0?O=Me(P,Y):O=hy(P,Y),Y+=4),e.type===yt.VIDEO){let ge=0;for(;ge<X;){const he=Me(s,ie);if(ie+=4,wS(u,s[ie])){const Pe=s.subarray(ie,ie+he);Id(Pe,u?2:1,l+O/r,t)}ie+=he,ge+=he+4}}l+=ce/r}}))})})}),t}function hu(l){if(!l)return!1;const e=l.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function wS(l,e){if(l){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Id(l,e,t,s){const r=py(l);let a=0;a+=e;let u=0,c=0,h=0;for(;a<r.length;){u=0;do{if(a>=r.length)break;h=r[a++],u+=h}while(h===255);c=0;do{if(a>=r.length)break;h=r[a++],c+=h}while(h===255);const d=r.length-a;let g=a;if(c<d)a+=c;else if(c>d){ot.error(`Malformed SEI payload. ${c} is too small, only ${d} bytes left to parse.`);break}if(u===4){if(r[g++]===181){const y=dy(r,g);if(g+=2,y===49){const E=Me(r,g);if(g+=4,E===1195456820){const T=r[g++];if(T===3){const x=r[g++],S=31&x,R=64&x,_=R?2+S*3:0,A=new Uint8Array(_);if(R){A[0]=x;for(let C=1;C<_;C++)A[C]=r[g++]}s.push({type:T,payloadType:u,pts:t,bytes:A})}}}}}else if(u===5&&c>16){const p=[];for(let T=0;T<16;T++){const x=r[g++].toString(16);p.push(x.length==1?"0"+x:x),(T===3||T===5||T===7||T===9)&&p.push("-")}const y=c-16,E=new Uint8Array(y);for(let T=0;T<y;T++)E[T]=r[g++];s.push({payloadType:u,pts:t,uuid:p.join(""),userData:Us(E),userDataBytes:E})}}}function py(l){const e=l.byteLength,t=[];let s=1;for(;s<e-2;)l[s]===0&&l[s+1]===0&&l[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return l;const r=e-t.length,a=new Uint8Array(r);let u=0;for(s=0;s<r;u++,s++)u===t[0]&&(u++,t.shift()),a[s]=l[u];return a}function OS(l){const e=l[0];let t="",s="",r=0,a=0,u=0,c=0,h=0,d=0;if(e===0){for(;Vt(l.subarray(d,d+1))!=="\0";)t+=Vt(l.subarray(d,d+1)),d+=1;for(t+=Vt(l.subarray(d,d+1)),d+=1;Vt(l.subarray(d,d+1))!=="\0";)s+=Vt(l.subarray(d,d+1)),d+=1;s+=Vt(l.subarray(d,d+1)),d+=1,r=Me(l,12),a=Me(l,16),c=Me(l,20),h=Me(l,24),d=28}else if(e===1){d+=4,r=Me(l,d),d+=4;const p=Me(l,d);d+=4;const y=Me(l,d);for(d+=4,u=_m(2,32)*p+y,cS(u)||(u=Number.MAX_SAFE_INTEGER,ot.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=Me(l,d),d+=4,h=Me(l,d),d+=4;Vt(l.subarray(d,d+1))!=="\0";)t+=Vt(l.subarray(d,d+1)),d+=1;for(t+=Vt(l.subarray(d,d+1)),d+=1;Vt(l.subarray(d,d+1))!=="\0";)s+=Vt(l.subarray(d,d+1)),d+=1;s+=Vt(l.subarray(d,d+1)),d+=1}const g=l.subarray(d,l.byteLength);return{schemeIdUri:t,value:s,timeScale:r,presentationTime:u,presentationTimeDelta:a,eventDuration:c,id:h,payload:g}}function MS(l,...e){const t=e.length;let s=8,r=t;for(;r--;)s+=e[r].byteLength;const a=new Uint8Array(s);for(a[0]=s>>24&255,a[1]=s>>16&255,a[2]=s>>8&255,a[3]=s&255,a.set(l,4),r=0,s=8;r<t;r++)a.set(e[r],s),s+=e[r].byteLength;return a}function NS(l,e,t){if(l.byteLength!==16)throw new RangeError("Invalid system id");let s,r;s=0,r=new Uint8Array;let a;s>0?(a=new Uint8Array(4),e.length>0&&new DataView(a.buffer).setUint32(0,e.length,!1)):a=new Uint8Array;const u=new Uint8Array(4);return t.byteLength>0&&new DataView(u.buffer).setUint32(0,t.byteLength,!1),MS([112,115,115,104],new Uint8Array([s,0,0,0]),l,a,r,u,t)}function PS(l){const e=[];if(l instanceof ArrayBuffer){const t=l.byteLength;let s=0;for(;s+32<t;){const r=new DataView(l,s),a=US(r);e.push(a),s+=a.size}}return e}function US(l){const e=l.getUint32(0),t=l.byteOffset,s=l.byteLength;if(s<e)return{offset:t,size:s};if(l.getUint32(4)!==1886614376)return{offset:t,size:e};const a=l.getUint32(8)>>>24;if(a!==0&&a!==1)return{offset:t,size:e};const u=l.buffer,c=Ts(new Uint8Array(u,t+12,16));let h=null,d=null,g=0;if(a===0)g=28;else{const y=l.getUint32(28);if(!y||s<32+y*16)return{offset:t,size:e};h=[];for(let E=0;E<y;E++)h.push(new Uint8Array(u,t+32+E*16,16));g=32+y*16}if(!g)return{offset:t,size:e};const p=l.getUint32(g);return e-32<p?{offset:t,size:e}:(d=new Uint8Array(u,t+g+4,p),{version:a,systemId:c,kids:h,data:d,offset:t,size:e})}const yy=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Xr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Dd(l,e){const t=Xr[e];return!!t&&!!t[l.slice(0,4)]}function nl(l,e,t=!0){return!l.split(",").some(s=>!Cd(s,e,t))}function Cd(l,e,t=!0){var s;const r=An(t);return(s=r==null?void 0:r.isTypeSupported(rl(l,e)))!=null?s:!1}function rl(l,e){return`${e}/mp4;codecs=${l}`}function Ym(l){if(l){const e=l.substring(0,4);return Xr.video[e]}return 2}function su(l){const e=yy();return l.split(",").reduce((t,s)=>{const a=e&&hu(s)?9:Xr.video[s];return a?(a*2+t)/(t?3:2):(Xr.audio[s]+t)/(t?2:1)},0)}const Mf={};function BS(l,e=!0){if(Mf[l])return Mf[l];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[l];for(let r=0;r<t.length;r++){var s;if(Cd(t[r],"audio",e))return Mf[l]=t[r],t[r];if(t[r]==="mp3"&&(s=An(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return l}const FS=/flac|opus|mp4a\.40\.34/i;function iu(l,e=!0){return l.replace(FS,t=>BS(t.toLowerCase(),e))}function $S(l,e){const t=[];if(l){const s=l.split(",");for(let r=0;r<s.length;r++)Dd(s[r],"video")||t.push(s[r])}return e&&t.push(e),t.join(",")}function Yo(l,e){if(l&&(l.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(l)!==-1)&&(qm(l,"audio")||qm(l,"video")))return l;if(e){const t=e.split(",");if(t.length>1){if(l){for(let s=t.length;s--;)if(t[s].substring(0,4)===l.substring(0,4))return t[s]}return t[0]}}return e||l}function qm(l,e){return Dd(l,e)&&Cd(l,e)}function GS(l){const e=l.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function jS(l){if(l.startsWith("av01.")){const e=l.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return l}function Xm(l){const e=An(l)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function ad(l){return l.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const HS={supported:!0,powerEfficient:!0,smooth:!0},VS={supported:!1,smooth:!1,powerEfficient:!1},vy={supported:!0,configurations:[],decodingInfoResults:[HS]};function Ey(l,e){return{supported:!1,configurations:e,decodingInfoResults:[VS],error:l}}function KS(l,e,t,s,r,a){const u=l.videoCodec,c=l.audioCodec?l.audioGroups:null,h=a==null?void 0:a.audioCodec,d=a==null?void 0:a.channels,g=d?parseInt(d):h?1/0:2;let p=null;if(c!=null&&c.length)try{c.length===1&&c[0]?p=e.groups[c[0]].channels:p=c.reduce((y,E)=>{if(E){const T=e.groups[E];if(!T)throw new Error(`Audio track group ${E} not found`);Object.keys(T.channels).forEach(x=>{y[x]=(y[x]||0)+T.channels[x]})}return y},{2:0})}catch(y){return!0}return u!==void 0&&(u.split(",").some(y=>hu(y))||l.width>1920&&l.height>1088||l.height>1920&&l.width>1088||l.frameRate>Math.max(s,30)||l.videoRange!=="SDR"&&l.videoRange!==t||l.bitrate>Math.max(r,8e6))||!!p&&Ee(g)&&Object.keys(p).some(y=>parseInt(y)>g)}function Ty(l,e,t,s={}){const r=l.videoCodec;if(!r&&!l.audioCodec||!t)return Promise.resolve(vy);const a=[],u=zS(l),c=u.length,h=YS(l,e,c>0),d=h.length;for(let g=c||1*d||1;g--;){const p={type:"media-source"};if(c&&(p.video=u[g%c]),d){p.audio=h[g%d];const y=p.audio.bitrate;p.video&&y&&(p.video.bitrate-=y)}a.push(p)}if(r){const g=navigator.userAgent;if(r.split(",").some(p=>hu(p))&&yy())return Promise.resolve(Ey(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${g})`),a))}return Promise.all(a.map(g=>{const p=XS(g);return s[p]||(s[p]=t.decodingInfo(g))})).then(g=>({supported:!g.some(p=>!p.supported),configurations:a,decodingInfoResults:g})).catch(g=>({supported:!1,configurations:a,decodingInfoResults:[],error:g}))}function zS(l){var e;const t=(e=l.videoCodec)==null?void 0:e.split(","),s=Sy(l),r=l.width||640,a=l.height||480,u=l.frameRate||30,c=l.videoRange.toLowerCase();return t?t.map(h=>{const d={contentType:rl(jS(h),"video"),width:r,height:a,bitrate:s,framerate:u};return c!=="sdr"&&(d.transferFunction=c),d}):[]}function YS(l,e,t){var s;const r=(s=l.audioCodec)==null?void 0:s.split(","),a=Sy(l);return r&&l.audioGroups?l.audioGroups.reduce((u,c)=>{var h;const d=c?(h=e.groups[c])==null?void 0:h.tracks:null;return d?d.reduce((g,p)=>{if(p.groupId===c){const y=parseFloat(p.channels||"");r.forEach(E=>{const T={contentType:rl(E,"audio"),bitrate:t?qS(E,a):a};y&&(T.channels=""+y),g.push(T)})}return g},u):u},[]):[]}function qS(l,e){if(e<=1)return 1;let t=128e3;return l==="ec-3"?t=768e3:l==="ac-3"&&(t=64e4),Math.min(e/2,t)}function Sy(l){return Math.ceil(Math.max(l.bitrate*.9,l.averageBitrate)/1e3)*1e3||1}function XS(l){let e="";const{audio:t,video:s}=l;if(s){const r=ad(s.contentType);e+=`${r}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const r=ad(t.contentType);e+=`${s?"_":""}${r}_c${t.channels}`}return e}const ld=["NONE","TYPE-0","TYPE-1",null];function QS(l){return ld.indexOf(l)>-1}const nu=["SDR","PQ","HLG"];function WS(l){return!!l&&nu.indexOf(l)>-1}var qo={No:"",Yes:"YES",v2:"v2"};function Qm(l){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=l,r=s<e/2;return e&&r?t?qo.v2:qo.Yes:qo.No}class Wm{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class al{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Zm(this._audioGroups,e)}hasSubtitleGroup(e){return Zm(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Zm(l,e){return!e||!l?!1:l.indexOf(e)!==-1}function ZS(){if(typeof matchMedia=="function"){const l=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(l.media!==e.media)return l.matches===!0}return!1}function JS(l,e){let t=!1,s=[];if(l&&(t=l!=="SDR",s=[l]),e){s=e.allowedVideoRanges||nu.slice(0);const r=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&ZS(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const ex=l=>{const e=new WeakSet;return(t,s)=>{if(l&&(s=l(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},vt=(l,e)=>JSON.stringify(l,ex(e));function tx(l,e,t,s,r){const a=Object.keys(l),u=s==null?void 0:s.channels,c=s==null?void 0:s.audioCodec,h=r==null?void 0:r.videoCodec,d=u&&parseInt(u)===2;let g=!1,p=!1,y=1/0,E=1/0,T=1/0,x=1/0,S=0,R=[];const{preferHDR:_,allowedVideoRanges:A}=JS(e,r);for(let P=a.length;P--;){const B=l[a[P]];g||(g=B.channels[2]>0),y=Math.min(y,B.minHeight),E=Math.min(E,B.minFramerate),T=Math.min(T,B.minBitrate),A.filter(j=>B.videoRanges[j]>0).length>0&&(p=!0)}y=Ee(y)?y:0,E=Ee(E)?E:0;const C=Math.max(1080,y),k=Math.max(30,E);T=Ee(T)?T:t,t=Math.max(T,t),p||(e=void 0);const G=a.length>1;return{codecSet:a.reduce((P,B)=>{const M=l[B];if(B===P)return P;if(R=p?A.filter(j=>M.videoRanges[j]>0):[],G){if(M.minBitrate>t)return gi(B,`min bitrate of ${M.minBitrate} > current estimate of ${t}`),P;if(!M.hasDefaultAudio)return gi(B,"no renditions with default or auto-select sound found"),P;if(c&&B.indexOf(c.substring(0,4))%5!==0)return gi(B,`audio codec preference "${c}" not found`),P;if(u&&!d){if(!M.channels[u])return gi(B,`no renditions with ${u} channel sound found (channels options: ${Object.keys(M.channels)})`),P}else if((!c||d)&&g&&M.channels[2]===0)return gi(B,"no renditions with stereo sound found"),P;if(M.minHeight>C)return gi(B,`min resolution of ${M.minHeight} > maximum of ${C}`),P;if(M.minFramerate>k)return gi(B,`min framerate of ${M.minFramerate} > maximum of ${k}`),P;if(!R.some(j=>M.videoRanges[j]>0))return gi(B,`no variants with VIDEO-RANGE of ${vt(R)} found`),P;if(h&&B.indexOf(h.substring(0,4))%5!==0)return gi(B,`video codec preference "${h}" not found`),P;if(M.maxScore<S)return gi(B,`max score of ${M.maxScore} < selected max of ${S}`),P}return P&&(su(B)>=su(P)||M.fragmentError>l[P].fragmentError)?P:(x=M.minIndex,S=M.maxScore,B)},void 0),videoRanges:R,preferHDR:_,minFramerate:E,minBitrate:T,minIndex:x}}function gi(l,e){ot.log(`[abr] start candidates with "${l}" ignored because ${e}`)}function xy(l){return l.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const r=t.channels||"2";return s.channels[r]=(s.channels[r]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function sx(l,e,t,s){return l.slice(t,s+1).reduce((r,a,u)=>{if(!a.codecSet)return r;const c=a.audioGroups;let h=r[a.codecSet];h||(r[a.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:u,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!c,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,a.bitrate);const d=Math.min(a.height,a.width);return h.minHeight=Math.min(h.minHeight,d),h.minFramerate=Math.min(h.minFramerate,a.frameRate),h.minIndex=Math.min(h.minIndex,u),h.maxScore=Math.max(h.maxScore,a.score),h.fragmentError+=a.fragmentError,h.videoRanges[a.videoRange]=(h.videoRanges[a.videoRange]||0)+1,c&&c.forEach(g=>{if(!g)return;const p=e.groups[g];p&&(h.hasDefaultAudio=h.hasDefaultAudio||e.hasDefaultAudio?p.hasDefault:p.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(p.channels).forEach(y=>{h.channels[y]=(h.channels[y]||0)+p.channels[y]}))}),r},{})}function Jm(l){if(!l)return l;const{lang:e,assocLang:t,characteristics:s,channels:r,audioCodec:a}=l;return{lang:e,assocLang:t,characteristics:s,channels:r,audioCodec:a}}function vi(l,e,t){if("attrs"in l){const s=e.indexOf(l);if(s!==-1)return s}for(let s=0;s<e.length;s++){const r=e[s];if(qn(l,r,t))return s}return-1}function qn(l,e,t){const{groupId:s,name:r,lang:a,assocLang:u,default:c}=l,h=l.forced;return(s===void 0||e.groupId===s)&&(r===void 0||e.name===r)&&(a===void 0||ix(a,e.lang))&&(a===void 0||e.assocLang===u)&&(c===void 0||e.default===c)&&(h===void 0||e.forced===h)&&(!("characteristics"in l)||nx(l.characteristics||"",e.characteristics))&&(t===void 0||t(l,e))}function ix(l,e="--"){return l.length===e.length?l===e:l.startsWith(e)||e.startsWith(l)}function nx(l,e=""){const t=l.split(","),s=e.split(",");return t.length===s.length&&!t.some(r=>s.indexOf(r)===-1)}function Yn(l,e){const{audioCodec:t,channels:s}=l;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function rx(l,e,t,s,r){const a=e[s],c=e.reduce((y,E,T)=>{const x=E.uri;return(y[x]||(y[x]=[])).push(T),y},{})[a.uri];c.length>1&&(s=Math.max.apply(Math,c));const h=a.videoRange,d=a.frameRate,g=a.codecSet.substring(0,4),p=ep(e,s,y=>{if(y.videoRange!==h||y.frameRate!==d||y.codecSet.substring(0,4)!==g)return!1;const E=y.audioGroups,T=t.filter(x=>!E||E.indexOf(x.groupId)!==-1);return vi(l,T,r)>-1});return p>-1?p:ep(e,s,y=>{const E=y.audioGroups,T=t.filter(x=>!E||E.indexOf(x.groupId)!==-1);return vi(l,T,r)>-1})}function ep(l,e,t){for(let s=e;s>-1;s--)if(t(l[s]))return s;for(let s=e+1;s<l.length;s++)if(t(l[s]))return s;return-1}function ru(l,e){var t;return!!l&&l!==((t=e.loadLevelObj)==null?void 0:t.uri)}class ax extends Ws{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:r,partCurrent:a,hls:u}=this,{autoLevelEnabled:c,media:h}=u;if(!r||!h)return;const d=performance.now(),g=a?a.stats:r.stats,p=a?a.duration:r.duration,y=d-g.loading.start,E=u.minAutoLevel,T=r.level,x=this._nextAutoLevel;if(g.aborted||g.loaded&&g.loaded===g.total||T<=E){this.clearTimer(),this._nextAutoLevel=-1;return}if(!c)return;const S=x>-1&&x!==T,R=!!t||S;if(!R&&(h.paused||!h.playbackRate||!h.readyState))return;const _=u.mainForwardBufferInfo;if(!R&&_===null)return;const A=this.bwEstimator.getEstimateTTFB(),C=Math.abs(h.playbackRate);if(y<=Math.max(A,1e3*(p/(C*2))))return;const k=_?_.len/C:0,G=g.loading.first?g.loading.first-g.loading.start:-1,w=g.loaded&&G>-1,P=this.getBwEstimate(),B=u.levels,M=B[T],j=Math.max(g.loaded,Math.round(p*(r.bitrate||M.averageBitrate)/8));let ee=w?y-G:y;ee<1&&w&&(ee=Math.min(y,g.loaded*8/P));const oe=w?g.loaded*1e3/ee:0,de=A/1e3,ce=oe?(j-g.loaded)/oe:j*8/P+de;if(ce<=k)return;const U=oe?oe*8:P,X=((s=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,te=this.hls.config.abrBandWidthUpFactor;let ue=Number.POSITIVE_INFINITY,O;for(O=T-1;O>E;O--){const fe=B[O].maxBitrate,ge=!B[O].details||X;if(ue=this.getTimeToLoadFrag(de,U,p*fe,ge),ue<Math.min(k,p+de))break}if(ue>=ce||ue>p*10)return;w?this.bwEstimator.sample(y-Math.min(A,G),g.loaded):this.bwEstimator.sampleTTFB(y);const $=B[O].maxBitrate;this.getBwEstimate()*te>$&&this.resetEstimator($);const Y=this.findBestLevel($,E,O,0,k,1,1);Y>-1&&(O=Y),this.warn(`Fragment ${r.sn}${a?" part "+a.index:""} of level ${T} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${k.toFixed(3)} s
      Estimated load time for current fragment: ${ce.toFixed(3)} s
      Estimated load time for down switch fragment: ${ue.toFixed(3)} s
      TTFB estimate: ${G|0} ms
      Current BW estimate: ${Ee(P)?P|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${O} @ ${$|0} bps`),u.nextLoadLevel=u.nextAutoLevel=O,this.clearTimer();const ie=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===O&&O>0){const fe=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${O>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${fe.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,O>E){let ge=this.findBestLevel(this.hls.levels[E].bitrate,E,O,0,fe,1,1);ge===-1&&(ge=E),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ge,this.resetEstimator(this.hls.levels[ge].bitrate)}}};S||ce>ue*2?ie():this.timer=self.setInterval(ie,ue*1e3),u.trigger(b.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:a,stats:g})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new dS(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(b.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var r;this.fragCurrent=s,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case z.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:r,partCurrent:a}=this;if(s&&r&&s.sn===r.sn&&s.level===r.level){const u=performance.now(),c=a?a.stats:s.stats,h=u-c.loading.start,d=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&d>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(h-Math.min(p,d),c.loaded)}else this.bwEstimator.sampleTTFB(h)}break}}}getTimeToLoadFrag(e,t,s,r){const a=e+s/t,u=r?e+this.lastLevelLoadSec:0;return a+u}onLevelLoaded(e,t){const s=this.hls.config,{loading:r}=t.stats,a=r.end-r.first;Ee(a)&&(this.lastLevelLoadSec=a/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const r=s?s.stats:t.stats;if(t.type===Te.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const a=s?s.duration:t.duration,u=this.hls.levels[t.level],c=(u.loaded?u.loaded.bytes:0)+r.loaded,h=(u.loaded?u.loaded.duration:0)+a;u.loaded={bytes:c,duration:h},u.realBitrate=Math.round(8*c/h)}if(t.bitrateTest){const a={stats:r,frag:t,part:s,id:t.type};this.onFragBuffered(b.FRAG_BUFFERED,a),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:r}=t,a=r!=null&&r.stats.loaded?r.stats:s.stats;if(a.aborted||this.ignoreFragment(s))return;const u=a.parsing.end-a.loading.start-Math.min(a.loading.first-a.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(u,a.loaded),a.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=u/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Te.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,a=this.findBestLevel(s,t,e,0,r,1,1);if(a>-1)return a;const u=this.hls.firstLevel,c=Math.min(Math.max(u,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${u} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const a=s&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const u=this.hls.levels;if(u.length>Math.max(e,a)&&u[e].loadError<=u[a].loadError)return e}return this._nextAutoLevel=a,this.nextAutoLevelKey=this.getAutoLevelKey(),a}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:r,config:a,minAutoLevel:u}=s,c=t?t.duration:e?e.duration:0,h=this.getBwEstimate(),d=this.getStarvationDelay();let g=a.abrBandWidthFactor,p=a.abrBandWidthUpFactor;if(d){const S=this.findBestLevel(h,u,r,d,0,g,p);if(S>=0)return this.rebufferNotice=-1,S}let y=c?Math.min(c,a.maxStarvationDelay):a.maxStarvationDelay;if(!d){const S=this.bitrateTestDelay;S&&(y=(c?Math.min(c,a.maxLoadingDelay):a.maxLoadingDelay)-S,this.info(`bitrate test took ${Math.round(1e3*S)}ms, set first fragment max fetchDuration to ${Math.round(1e3*y)} ms`),g=p=1)}const E=this.findBestLevel(h,u,r,d,y,g,p);if(this.rebufferNotice!==E&&(this.rebufferNotice=E,this.info(`${d?"rebuffering expected":"buffer is empty"}, optimal quality level ${E}`)),E>-1)return E;const T=s.levels[u],x=s.loadLevelObj;return x&&(T==null?void 0:T.bitrate)<x.bitrate?u:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,r,a,u,c){var h;const d=r+a,g=this.lastLoadedFragLevel,p=g===-1?this.hls.firstLevel:g,{fragCurrent:y,partCurrent:E}=this,{levels:T,allAudioTracks:x,loadLevel:S,config:R}=this.hls;if(T.length===1)return 0;const _=T[p],A=!!((h=this.hls.latestLevelDetails)!=null&&h.live),C=S===-1||g===-1;let k,G="SDR",w=(_==null?void 0:_.frameRate)||0;const{audioPreference:P,videoPreference:B}=R,M=this.audioTracksByGroup||(this.audioTracksByGroup=xy(x));let j=-1;if(C){if(this.firstSelection!==-1)return this.firstSelection;const U=this.codecTiers||(this.codecTiers=sx(T,M,t,s)),X=tx(U,G,e,P,B),{codecSet:te,videoRanges:ue,minFramerate:O,minBitrate:$,minIndex:Y,preferHDR:ie}=X;j=Y,k=te,G=ie?ue[ue.length-1]:ue[0],w=O,e=Math.max(e,$),this.log(`picked start tier ${vt(X)}`)}else k=_==null?void 0:_.codecSet,G=_==null?void 0:_.videoRange;const ee=E?E.duration:y?y.duration:0,oe=this.bwEstimator.getEstimateTTFB()/1e3,de=[];for(let U=s;U>=t;U--){var ce;const X=T[U],te=U>p;if(!X)continue;if(R.useMediaCapabilities&&!X.supportedResult&&!X.supportedPromise){const ge=navigator.mediaCapabilities;typeof(ge==null?void 0:ge.decodingInfo)=="function"&&KS(X,M,G,w,e,P)?(X.supportedPromise=Ty(X,M,ge,this.supportedCache),X.supportedPromise.then(he=>{if(!this.hls)return;X.supportedResult=he;const Pe=this.hls.levels,be=Pe.indexOf(X);he.error?this.warn(`MediaCapabilities decodingInfo error: "${he.error}" for level ${be} ${vt(he)}`):he.supported?he.decodingInfoResults.some(ht=>ht.smooth===!1||ht.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${be} not smooth or powerEfficient: ${vt(he)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${be} ${vt(he)}`),be>-1&&Pe.length>1&&(this.log(`Removing unsupported level ${be}`),this.hls.removeLevel(be),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(he=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${he}`)})):X.supportedResult=vy}if((k&&X.codecSet!==k||G&&X.videoRange!==G||te&&w>X.frameRate||!te&&w>0&&w<X.frameRate||(ce=X.supportedResult)!=null&&(ce=ce.decodingInfoResults)!=null&&ce.some(ge=>ge.smooth===!1))&&(!C||U!==j)){de.push(U);continue}const ue=X.details,O=(E?ue==null?void 0:ue.partTarget:ue==null?void 0:ue.averagetargetduration)||ee;let $;te?$=c*e:$=u*e;const Y=ee&&r>=ee*2&&a===0?X.averageBitrate:X.maxBitrate,ie=this.getTimeToLoadFrag(oe,$,Y*O,ue===void 0);if($>=Y&&(U===g||X.loadError===0&&X.fragmentError===0)&&(ie<=oe||!Ee(ie)||A&&!this.bitrateTestDelay||ie<d)){const ge=this.forcedAutoLevel;return U!==S&&(ge===-1||ge!==S)&&(de.length&&this.trace(`Skipped level(s) ${de.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${T[de[0]].codecs}" ${T[de[0]].videoRange}; not compatible with "${k}" ${G}`),this.info(`switch candidate:${p}->${U} adjustedbw(${Math.round($)})-bitrate=${Math.round($-Y)} ttfb:${oe.toFixed(1)} avgDuration:${O.toFixed(1)} maxFetchDuration:${d.toFixed(1)} fetchDuration:${ie.toFixed(1)} firstSelection:${C} codecSet:${X.codecSet} videoRange:${X.videoRange} hls.loadLevel:${S}`)),C&&(this.firstSelection=U),U}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const by={search:function(l,e){let t=0,s=l.length-1,r=null,a=null;for(;t<=s;){r=(t+s)/2|0,a=l[r];const u=e(a);if(u>0)t=r+1;else if(u<0)s=r-1;else return a}return null}};function lx(l,e,t){if(e===null||!Array.isArray(l)||!l.length||!Ee(e))return null;const s=l[0].programDateTime;if(e<(s||0))return null;const r=l[l.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let a=0;a<l.length;++a){const u=l[a];if(ux(e,t,u))return u}return null}function Qn(l,e,t=0,s=0,r=.005){let a=null;if(l){a=e[1+l.sn-e[0].sn]||null;const c=l.endDTS-t;c>0&&c<15e-7&&(t+=15e-7),a&&l.level!==a.level&&a.end<=l.end&&(a=e[2+l.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(a=e[0]);if(a&&((!l||l.level===a.level)&&tp(t,s,a)===0||ox(a,l,Math.min(r,s))))return a;const u=by.search(e,tp.bind(null,t,s));return u&&(u!==l||!a)?u:a}function ox(l,e,t){if(e&&e.start===0&&e.level<l.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((r,a)=>(a[0]==="INF"&&(r+=parseFloat(a[1])),r),t);return l.start<=s}return!1}function tp(l=0,e=0,t){if(t.start<=l&&t.start+t.duration>l)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=l?1:t.start-s>l&&t.start?-1:0}function ux(l,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>l}function Ay(l,e,t){if(l&&l.startCC<=e&&l.endCC>=e){let s=l.fragments;const{fragmentHint:r}=l;r&&(s=s.concat(r));let a;return by.search(s,u=>u.cc<e?1:u.cc>e?-1:(a=u,u.end<=t?1:u.start>t?-1:0)),a||null}return null}function au(l){switch(l.details){case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_TIMEOUT:case z.LEVEL_LOAD_TIMEOUT:case z.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ly(l){return l.details.startsWith("key")}function Ry(l){return Ly(l)&&!!l.frag&&!l.frag.decryptdata}function sp(l,e){const t=au(e);return l.default[`${t?"timeout":"error"}Retry`]}function kd(l,e){const t=l.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*l.retryDelayMs,l.maxRetryDelayMs)}function ip(l){return lt(lt({},l),{errorRetry:null,timeoutRetry:null})}function lu(l,e,t,s){if(!l)return!1;const r=s==null?void 0:s.code,a=e<l.maxNumRetry&&(cx(r)||!!t);return l.shouldRetry?l.shouldRetry(l,e,t,s,a):a}function cx(l){return od(l)||!!l&&(l<400||l>499)}function od(l){return l===0&&navigator.onLine===!1}var ts={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Ms={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class fx extends Ws{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(b.ERROR,this.onError,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(b.ERROR,this.onError,this),e.off(b.ERROR,this.onErrorOut,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Te.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||s===-1?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if((s=e.details)!=null&&s.hasKey(t))return!0;const r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(u=>r.indexOf(u.groupId)>=0).some(u=>{var c;return(c=u.details)==null?void 0:c.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const r=this.hls,a=t.context;switch(t.details){case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case z.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=Kr();return}case z.FRAG_GAP:case z.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=ts.SendAlternateToPenaltyBox;return}case z.LEVEL_EMPTY_ERROR:case z.LEVEL_PARSING_ERROR:{var u;const h=t.parent===Te.MAIN?t.level:r.loadLevel;t.details===z.LEVEL_EMPTY_ERROR&&((u=t.context)!=null&&(u=u.levelDetails)!=null&&u.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h))}return;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:typeof(a==null?void 0:a.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level));return;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.SUBTITLE_LOAD_ERROR:case z.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const h=r.loadLevelObj;if(h&&(a.type===Ve.AUDIO_TRACK&&h.hasAudioGroup(a.groupId)||a.type===Ve.SUBTITLE_TRACK&&h.hasSubtitleGroup(a.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=ts.SendAlternateToPenaltyBox,t.errorAction.flags=Ms.MoveAllAlternatesMatchingHost;return}}return;case z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:ts.SendAlternateToPenaltyBox,flags:Ms.MoveAllAlternatesMatchingHDCP};return;case z.KEY_SYSTEM_SESSION_UPDATE_FAILED:case z.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case z.KEY_SYSTEM_NO_SESSION:t.errorAction={action:ts.SendAlternateToPenaltyBox,flags:Ms.MoveAllAlternatesMatchingKey};return;case z.BUFFER_ADD_CODEC_ERROR:case z.REMUX_ALLOC_ERROR:case z.BUFFER_APPEND_ERROR:if(!t.errorAction){var c;t.errorAction=this.getLevelSwitchAction(t,(c=t.level)!=null?c:r.loadLevel)}return;case z.INTERNAL_EXCEPTION:case z.BUFFER_APPENDING_ERROR:case z.BUFFER_FULL_ERROR:case z.LEVEL_SWITCH_ERROR:case z.BUFFER_STALLED_ERROR:case z.BUFFER_SEEK_OVER_HOLE:case z.BUFFER_NUDGE_ON_STALL:t.errorAction=Kr();return}t.type===Le.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Kr())}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,r=sp(s.config.playlistLoadPolicy,e),a=this.playlistError++;if(lu(r,a,au(e),e.response))return{action:ts.RetryRequest,flags:Ms.None,retryConfig:r,retryCount:a};const c=this.getLevelSwitchAction(e,t);return r&&(c.retryConfig=r,c.retryCount=a),c}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),r=t.levels[s],{fragLoadPolicy:a,keyLoadPolicy:u}=t.config,c=sp(Ly(e)?u:a,e),h=t.levels.reduce((g,p)=>g+p.fragmentError,0);if(r&&(e.details!==z.FRAG_GAP&&r.fragmentError++,!Ry(e)&&lu(c,h,au(e),e.response)))return{action:ts.RetryRequest,flags:Ms.None,retryConfig:c,retryCount:h};const d=this.getLevelSwitchAction(e,s);return c&&(d.retryConfig=c,d.retryCount=h),d}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const r=this.hls.levels[t];if(r){var a,u;const d=e.details;r.loadError++,d===z.BUFFER_APPEND_ERROR&&r.fragmentError++;let g=-1;const{levels:p,loadLevel:y,minAutoLevel:E,maxAutoLevel:T}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const x=(a=e.frag)==null?void 0:a.type,R=(x===Te.AUDIO&&d===z.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(d===z.BUFFER_ADD_CODEC_ERROR||d===z.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:G})=>r.audioCodec!==G),A=e.sourceBufferName==="video"&&(d===z.BUFFER_ADD_CODEC_ERROR||d===z.BUFFER_APPEND_ERROR)&&p.some(({codecSet:G,audioCodec:w})=>r.codecSet!==G&&r.audioCodec===w),{type:C,groupId:k}=(u=e.context)!=null?u:{};for(let G=p.length;G--;){const w=(G+y)%p.length;if(w!==y&&w>=E&&w<=T&&p[w].loadError===0){var c,h;const P=p[w];if(d===z.FRAG_GAP&&x===Te.MAIN&&e.frag){const B=p[w].details;if(B){const M=Qn(e.frag,B.fragments,e.frag.start);if(M!=null&&M.gap)continue}}else{if(C===Ve.AUDIO_TRACK&&P.hasAudioGroup(k)||C===Ve.SUBTITLE_TRACK&&P.hasSubtitleGroup(k))continue;if(x===Te.AUDIO&&(c=r.audioGroups)!=null&&c.some(B=>P.hasAudioGroup(B))||x===Te.SUBTITLE&&(h=r.subtitleGroups)!=null&&h.some(B=>P.hasSubtitleGroup(B))||R&&r.audioCodec===P.audioCodec||A&&r.codecSet===P.codecSet||!R&&r.codecSet!==P.codecSet)continue}g=w;break}}if(g>-1&&s.loadLevel!==g)return e.levelRetry=!0,this.playlistError=0,{action:ts.SendAlternateToPenaltyBox,flags:Ms.None,nextAutoLevel:g}}return{action:ts.SendAlternateToPenaltyBox,flags:Ms.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case ts.DoNothing:break;case ts.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==z.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:r}=s,a=s.nextAutoLevel;switch(r){case Ms.None:this.switchLevel(e,a);break;case Ms.MoveAllAlternatesMatchingHDCP:{const h=this.getVariantLevelIndex(e.frag),d=t.levels[h],g=d==null?void 0:d.attrs["HDCP-LEVEL"];if(s.hdcpLevel=g,g==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(g){t.maxHdcpLevel=ld[ld.indexOf(g)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Ms.MoveAllAlternatesMatchingKey:{const h=e.decryptdata;if(h){const d=this.hls.levels,g=d.length;for(let y=g;y--;)if(this.variantHasKey(d[y],h)){var u,c;this.log(`Banned key found in level ${y} (${d[y].bitrate}bps) or audio group "${(u=d[y].audioGroups)==null?void 0:u.join(",")}" (${(c=e.frag)==null?void 0:c.type} fragment) ${Ts(h.keyId||[])}`),d[y].fragmentError++,d[y].loadError++,this.log(`Removing level ${y} with key error (${e.error})`),this.hls.removeLevel(y)}const p=e.frag;if(this.hls.levels.length<g)s.resolved=!0;else if(p&&p.type!==Te.MAIN){const y=p.decryptdata;y&&!h.matches(y)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,a)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===z.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=ad(e.mimeType),r=this.hls.levels;for(let a=r.length;a--;)r[a][`${e.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${a} for ${e.details} ("${s}" not supported)`),this.hls.removeLevel(a))}}}function Kr(l){const e={action:ts.DoNothing,flags:Ms.None};return l&&(e.resolved=!0),e}var Kt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class dx{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.BUFFER_APPENDED,this.onBufferAppended,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.BUFFER_APPENDED,this.onBufferAppended,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let r=s.length;r--;){const a=s[r];if(!a)break;if(a.start<=e&&e<=a.end&&a.loaded)return a}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:r}=this,a=Object.keys(r);for(let u=a.length;u--;){const c=r[a[u]];if((c==null?void 0:c.body.type)===t&&(!s||c.buffered)){const h=c.body;if(h.start<=e&&e<=h.end)return h}}return null}detectEvictedFragments(e,t,s,r,a){this.timeRanges&&(this.timeRanges[e]=t);const u=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(c=>{const h=this.fragments[c];if(!h||u>=h.body.sn)return;if(!h.buffered&&(!h.loaded||a)){h.body.type===s&&this.removeFragment(h.body);return}const d=h.range[e];if(d){if(d.time.length===0){this.removeFragment(h.body);return}d.time.some(g=>{const p=!this.isTimeBuffered(g.startPTS,g.endPTS,t);return p&&this.removeFragment(h.body),p})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,r=Fr(s),a=this.fragments[r];if(!a||a.buffered&&s.gap)return;const u=!s.relurl;Object.keys(t).forEach(c=>{const h=s.elementaryStreams[c];if(!h)return;const d=t[c],g=u||h.partial===!0;a.range[c]=this.getBufferedTimes(s,e.part,g,d)}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,(a.body.endList=s.endList||a.body.endList)&&(this.endListFragments[a.body.type]=a),ko(a)||this.removeParts(s.sn-1,s.type)):this.removeFragment(a.body)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=np(s,r=>r.fragment.sn>=e))}fragBuffered(e,t){const s=Fr(e);let r=this.fragments[s];!r&&t&&(r=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,s,r){const a={time:[],partial:s},u=e.start,c=e.end,h=e.minEndPTS||c,d=e.maxStartPTS||u;for(let g=0;g<r.length;g++){const p=r.start(g)-this.bufferPadding,y=r.end(g)+this.bufferPadding;if(d>=p&&h<=y){a.time.push({startPTS:Math.max(u,r.start(g)),endPTS:Math.min(c,r.end(g))});break}else if(u<y&&c>p){const E=Math.max(u,r.start(g)),T=Math.min(c,r.end(g));T>E&&(a.partial=!0,a.time.push({startPTS:E,endPTS:T}))}else if(c<=p)break}return a}getPartialFragment(e){let t=null,s,r,a,u=0;const{bufferPadding:c,fragments:h}=this;return Object.keys(h).forEach(d=>{const g=h[d];g&&ko(g)&&(r=g.body.start-c,a=g.body.end+c,e>=r&&e<=a&&(s=Math.min(e-r,a-e),u<=s&&(t=g.body,u=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||ko(t))}getState(e){const t=Fr(e),s=this.fragments[t];return s?s.buffered?ko(s)?Kt.PARTIAL:Kt.OK:Kt.APPENDING:Kt.NOT_LOADED}isTimeBuffered(e,t,s){let r,a;for(let u=0;u<s.length;u++){if(r=s.start(u)-this.bufferPadding,a=s.end(u)+this.bufferPadding,e>=r&&t<=a)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,r=t.part?null:t,a=Fr(s);this.fragments[a]={body:s,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:r,timeRanges:a,type:u}=t;if(s.sn==="initSegment")return;const c=s.type;if(r){let d=this.activePartLists[c];d||(this.activePartLists[c]=d=[]),d.push(r)}this.timeRanges=a;const h=a[u];this.detectEvictedFragments(u,h,c,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Fr(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let r=s.length;r--;){const a=t[s[r]];if((a==null?void 0:a.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,r,a){r&&!this.hasGaps||Object.keys(this.fragments).forEach(u=>{const c=this.fragments[u];if(!c)return;const h=c.body;h.type!==s||r&&!h.gap||h.start<t&&h.end>e&&(c.buffered||a)&&this.removeFragment(h)})}removeFragment(e){const t=Fr(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const r=e.sn;this.activePartLists[e.type]=np(s,a=>a.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function ko(l){var e,t,s;return l.buffered&&!!(l.body.gap||(e=l.range.video)!=null&&e.partial||(t=l.range.audio)!=null&&t.partial||(s=l.range.audiovideo)!=null&&s.partial)}function Fr(l){return`${l.type}_${l.level}_${l.sn}`}function np(l,e){return l.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var Ln={cbc:0,ctr:1};class hx{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case Ln.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Ln.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function gx(l){const e=l.byteLength,t=e&&new DataView(l.buffer).getUint8(e-1);return t?l.slice(0,e-t):l}class mx{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let r=0;r<4;r++)s[r]=t.getUint32(r*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,r=s[0],a=s[1],u=s[2],c=s[3],h=this.invSubMix,d=h[0],g=h[1],p=h[2],y=h[3],E=new Uint32Array(256);let T=0,x=0,S=0;for(S=0;S<256;S++)S<128?E[S]=S<<1:E[S]=S<<1^283;for(S=0;S<256;S++){let R=x^x<<1^x<<2^x<<3^x<<4;R=R>>>8^R&255^99,e[T]=R,t[R]=T;const _=E[T],A=E[_],C=E[A];let k=E[R]*257^R*16843008;r[T]=k<<24|k>>>8,a[T]=k<<16|k>>>16,u[T]=k<<8|k>>>24,c[T]=k,k=C*16843009^A*65537^_*257^T*16843008,d[R]=k<<24|k>>>8,g[R]=k<<16|k>>>16,p[R]=k<<8|k>>>24,y[R]=k,T?(T=_^E[E[E[C^_]]],x^=E[E[x]]):T=x=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,r=0;for(;r<t.length&&s;)s=t[r]===this.key[r],r++;if(s)return;this.key=t;const a=this.keySize=t.length;if(a!==4&&a!==6&&a!==8)throw new Error("Invalid aes key size="+a);const u=this.ksRows=(a+6+1)*4;let c,h;const d=this.keySchedule=new Uint32Array(u),g=this.invKeySchedule=new Uint32Array(u),p=this.sBox,y=this.rcon,E=this.invSubMix,T=E[0],x=E[1],S=E[2],R=E[3];let _,A;for(c=0;c<u;c++){if(c<a){_=d[c]=t[c];continue}A=_,c%a===0?(A=A<<8|A>>>24,A=p[A>>>24]<<24|p[A>>>16&255]<<16|p[A>>>8&255]<<8|p[A&255],A^=y[c/a|0]<<24):a>6&&c%a===4&&(A=p[A>>>24]<<24|p[A>>>16&255]<<16|p[A>>>8&255]<<8|p[A&255]),d[c]=_=(d[c-a]^A)>>>0}for(h=0;h<u;h++)c=u-h,h&3?A=d[c]:A=d[c-4],h<4||c<=4?g[h]=A:g[h]=T[p[A>>>24]]^x[p[A>>>16&255]]^S[p[A>>>8&255]]^R[p[A&255]],g[h]=g[h]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const r=this.keySize+6,a=this.invKeySchedule,u=this.invSBox,c=this.invSubMix,h=c[0],d=c[1],g=c[2],p=c[3],y=this.uint8ArrayToUint32Array_(s);let E=y[0],T=y[1],x=y[2],S=y[3];const R=new Int32Array(e),_=new Int32Array(R.length);let A,C,k,G,w,P,B,M,j,ee,oe,de,ce,U;const X=this.networkToHostOrderSwap;for(;t<R.length;){for(j=X(R[t]),ee=X(R[t+1]),oe=X(R[t+2]),de=X(R[t+3]),w=j^a[0],P=de^a[1],B=oe^a[2],M=ee^a[3],ce=4,U=1;U<r;U++)A=h[w>>>24]^d[P>>16&255]^g[B>>8&255]^p[M&255]^a[ce],C=h[P>>>24]^d[B>>16&255]^g[M>>8&255]^p[w&255]^a[ce+1],k=h[B>>>24]^d[M>>16&255]^g[w>>8&255]^p[P&255]^a[ce+2],G=h[M>>>24]^d[w>>16&255]^g[P>>8&255]^p[B&255]^a[ce+3],w=A,P=C,B=k,M=G,ce=ce+4;A=u[w>>>24]<<24^u[P>>16&255]<<16^u[B>>8&255]<<8^u[M&255]^a[ce],C=u[P>>>24]<<24^u[B>>16&255]<<16^u[M>>8&255]<<8^u[w&255]^a[ce+1],k=u[B>>>24]<<24^u[M>>16&255]<<16^u[w>>8&255]<<8^u[P&255]^a[ce+2],G=u[M>>>24]<<24^u[w>>16&255]<<16^u[P>>8&255]<<8^u[B&255]^a[ce+3],_[t]=X(A^E),_[t+1]=X(G^T),_[t+2]=X(k^x),_[t+3]=X(C^S),E=j,T=ee,x=oe,S=de,t=t+4}return _.buffer}}class px{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=yx(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function yx(l){switch(l){case Ln.cbc:return"AES-CBC";case Ln.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${l}`)}}const vx=16;class wd{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch(s){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?gx(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,r){return this.useSoftware?new Promise((a,u)=>{const c=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(c,t,s,r);const h=this.flush();h?a(h.buffer):u(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,r)}softwareDecrypt(e,t,s,r){const{currentIV:a,currentResult:u,remainderData:c}=this;if(r!==Ln.cbc||t.byteLength!==16)return ot.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),c&&(e=Qs(c,e),this.remainderData=null);const h=this.getValidChunk(e);if(!h.length)return null;a&&(s=a);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new mx),d.expandKey(t);const g=u;return this.currentResult=d.decrypt(h.buffer,0,s),this.currentIV=h.slice(-16).buffer,g||null}webCryptoDecrypt(e,t,s,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,r));this.key=t,this.fastAesKey=new px(this.subtle,t,r)}return this.fastAesKey.expandKey().then(a=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new hx(this.subtle,new Uint8Array(s),r).decrypt(e.buffer,a)):Promise.reject(new Error("web crypto not initialized"))).catch(a=>(ot.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${a.name}: ${a.message}`),this.onWebCryptoError(e,t,s,r)))}onWebCryptoError(e,t,s,r){const a=this.enableSoftwareAES;if(a){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,r);const u=this.flush();if(u)return u.buffer}throw new Error("WebCrypto"+(a?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%vx;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(ot.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const rp=Math.pow(2,17);class Ex{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new ji({type:Le.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,a=r.fLoader,u=r.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(T=>T[0]==="GAP")){h(lp(e));return}else e.gap=!1;const d=this.loader=a?new a(r):new u(r),g=ap(e);e.loader=d;const p=ip(r.fragLoadPolicy.default),y={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:rp};e.stats=d.stats;const E={onSuccess:(T,x,S,R)=>{this.resetLoader(e,d);let _=T.data;S.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(_.slice(0,16)),_=_.slice(16)),c({frag:e,part:null,payload:_,networkDetails:R})},onError:(T,x,S,R)=>{this.resetLoader(e,d),h(new ji({type:Le.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:lt({url:s,data:void 0},T),error:new Error(`HTTP Error ${T.code} ${T.text}`),networkDetails:S,stats:R}))},onAbort:(T,x,S)=>{this.resetLoader(e,d),h(new ji({type:Le.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:S,stats:T}))},onTimeout:(T,x,S)=>{this.resetLoader(e,d),h(new ji({type:Le.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:S,stats:T}))}};t&&(E.onProgress=(T,x,S,R)=>t({frag:e,part:null,payload:S,networkDetails:R})),d.load(g,y,E)})}loadPart(e,t,s){this.abort();const r=this.config,a=r.fLoader,u=r.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){h(lp(e,t));return}const d=this.loader=a?new a(r):new u(r),g=ap(e,t);e.loader=d;const p=ip(r.fragLoadPolicy.default),y={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:rp};t.stats=d.stats,d.load(g,y,{onSuccess:(E,T,x,S)=>{this.resetLoader(e,d),this.updateStatsFromPart(e,t);const R={frag:e,part:t,payload:E.data,networkDetails:S};s(R),c(R)},onError:(E,T,x,S)=>{this.resetLoader(e,d),h(new ji({type:Le.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:lt({url:g.url,data:void 0},E),error:new Error(`HTTP Error ${E.code} ${E.text}`),networkDetails:x,stats:S}))},onAbort:(E,T,x)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,d),h(new ji({type:Le.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:x,stats:E}))},onTimeout:(E,T,x)=>{this.resetLoader(e,d),h(new ji({type:Le.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:x,stats:E}))}})})}updateStatsFromPart(e,t){const s=e.stats,r=t.stats,a=r.total;if(s.loaded+=r.loaded,a){const h=Math.round(e.duration/t.duration),d=Math.min(Math.round(s.loaded/a),h),p=(h-d)*Math.round(s.loaded/d);s.total=s.loaded+p}else s.total=Math.max(s.loaded,s.total);const u=s.loading,c=r.loading;u.start?u.first+=c.first-c.start:(u.start=c.start,u.first=c.first),u.end=c.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function ap(l,e=null){const t=e||l,s={frag:l,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,a=t.byteRangeEndOffset;if(Ee(r)&&Ee(a)){var u;let c=r,h=a;if(l.sn==="initSegment"&&Tx((u=l.decryptdata)==null?void 0:u.method)){const d=a-r;d%16&&(h=a+(16-d%16)),r!==0&&(s.resetIV=!0,c=r-16)}s.rangeStart=c,s.rangeEnd=h}return s}function lp(l,e){const t=new Error(`GAP ${l.gap?"tag":"attribute"} found`),s={type:Le.MEDIA_ERROR,details:z.FRAG_GAP,fatal:!1,frag:l,error:t,networkDetails:null};return e&&(s.part=e),(e||l).stats.aborted=!0,new ji(s)}function Tx(l){return l==="AES-128"||l==="AES-256"}class ji extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class _y extends Ws{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Od{constructor(e,t,s,r=0,a=-1,u=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=wo(),this.buffering={audio:wo(),video:wo(),audiovideo:wo()},this.level=e,this.sn=t,this.id=s,this.size=r,this.part=a,this.partial=u}}function wo(){return{start:0,executeStart:0,executeEnd:0,end:0}}const op={length:0,start:()=>0,end:()=>0};class Ne{static isBuffered(e,t){if(e){const s=Ne.getBuffered(e);for(let r=s.length;r--;)if(t>=s.start(r)&&t<=s.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=Ne.getBuffered(e);return Ne.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const r=Ne.bufferedRanges(e);if(r.length)return Ne.bufferedInfo(r,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((g,p)=>g.start-p.start||p.end-g.end);let r=-1,a=[];if(s)for(let g=0;g<e.length;g++){t>=e[g].start&&t<=e[g].end&&(r=g);const p=a.length;if(p){const y=a[p-1].end;e[g].start-y<s?e[g].end>y&&(a[p-1].end=e[g].end):a.push(e[g])}else a.push(e[g])}else a=e;let u=0,c,h=t,d=t;for(let g=0;g<a.length;g++){const p=a[g].start,y=a[g].end;if(r===-1&&t>=p&&t<=y&&(r=g),t+s>=p&&t<y)h=p,d=y,u=d-t;else if(t+s<p){c=p;break}}return{len:u,start:h||0,end:d||0,nextStart:c,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||op}catch(t){return ot.log("failed to get media.buffered",t),op}}}const Iy=/\{\$([a-zA-Z0-9-_]+)\}/g;function up(l){return Iy.test(l)}function ud(l,e){if(l.variableList!==null||l.hasVariableRefs){const t=l.variableList;return e.replace(Iy,s=>{const r=s.substring(2,s.length-1),a=t==null?void 0:t[r];return a===void 0?(l.playlistParsingError||(l.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),s):a})}return e}function cp(l,e,t){let s=l.variableList;s||(l.variableList=s={});let r,a;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const u=new self.URL(t).searchParams;if(u.has(r))a=u.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(u){l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${u.message}`))}}else r=e.NAME,a=e.VALUE;r in s?l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):s[r]=a||""}function Sx(l,e,t){const s=e.IMPORT;if(t&&s in t){let r=l.variableList;r||(l.variableList=r={}),r[s]=t[s]}else l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const xx=/^(\d+)x(\d+)$/,fp=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Rt{constructor(e,t){typeof e=="string"&&(e=Rt.parseAttrList(e,t)),dt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)s[r]=parseInt(t.slice(r*2,r*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((r,a)=>(r[a.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=xx.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const r={};for(fp.lastIndex=0;(s=fp.exec(e))!==null;){const u=s[1].trim();let c=s[2];const h=c.indexOf('"')===0&&c.lastIndexOf('"')===c.length-1;let d=!1;if(h)c=c.slice(1,-1);else switch(u){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(t&&(h||d))c=ud(t,c);else if(!d&&!h)switch(u){case"CLOSED-CAPTIONS":if(c==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":ot.warn(`${e}: attribute ${u} is missing quotes`)}r[u]=c}return r}}const bx="com.apple.hls.interstitial";function Ax(l){return l!=="ID"&&l!=="CLASS"&&l!=="CUE"&&l!=="START-DATE"&&l!=="DURATION"&&l!=="END-DATE"&&l!=="END-ON-NEXT"}function Lx(l){return l==="SCTE35-OUT"||l==="SCTE35-IN"||l==="SCTE35-CMD"}class Dy{constructor(e,t,s=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(r=t==null?void 0:t.tagOrder)!=null?r:s,t){const a=t.attr;for(const u in a)if(Object.prototype.hasOwnProperty.call(e,u)&&e[u]!==a[u]){ot.warn(`DATERANGE tag attribute: "${u}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=u;break}e=dt(new Rt({}),a,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const a=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Ee(a.getTime())&&(this._endDate=a)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(ot.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Ee(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===bx}get isValid(){return!!this.id&&!this._badValueForSameId&&Ee(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const Rx=10;class _x{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return this.fragments.length?Ee(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Rx}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Md(l,e){return l.length===e.length?!l.some((t,s)=>t!==e[s]):!1}function dp(l,e){return!l&&!e?!0:!l||!e?!1:Md(l,e)}function zr(l){return l==="AES-128"||l==="AES-256"||l==="AES-256-CTR"}function Nd(l){switch(l){case"AES-128":case"AES-256":return Ln.cbc;case"AES-256-CTR":return Ln.ctr;default:throw new Error(`invalid full segment method ${l}`)}}function Pd(l){return Uint8Array.from(atob(l),e=>e.charCodeAt(0))}function cd(l){return Uint8Array.from(unescape(encodeURIComponent(l)),e=>e.charCodeAt(0))}function Ix(l){const e=cd(l).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Cy(l){const e=function(s,r,a){const u=s[r];s[r]=s[a],s[a]=u};e(l,0,3),e(l,1,2),e(l,4,5),e(l,6,7)}function Dx(l){const e=l.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),r=s[s.length-1].split(",");if(r.length===2){const a=r[0]==="base64",u=r[1];a?(s.splice(-1,1),t=Pd(u)):t=Ix(u)}}return t}const ou=typeof self!="undefined"?self:void 0;var _t={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},os={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Xo(l){switch(l){case os.FAIRPLAY:return _t.FAIRPLAY;case os.PLAYREADY:return _t.PLAYREADY;case os.WIDEVINE:return _t.WIDEVINE;case os.CLEARKEY:return _t.CLEARKEY}}function Nf(l){switch(l){case _t.FAIRPLAY:return os.FAIRPLAY;case _t.PLAYREADY:return os.PLAYREADY;case _t.WIDEVINE:return os.WIDEVINE;case _t.CLEARKEY:return os.CLEARKEY}}function Ja(l){const{drmSystems:e,widevineLicenseUrl:t}=l,s=e?[_t.FAIRPLAY,_t.WIDEVINE,_t.PLAYREADY,_t.CLEARKEY].filter(r=>!!e[r]):[];return!s[_t.WIDEVINE]&&t&&s.push(_t.WIDEVINE),s}const ky=(function(l){return ou!=null&&(l=ou.navigator)!=null&&l.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function Cx(l,e,t,s){let r;switch(l){case _t.FAIRPLAY:r=["cenc","sinf"];break;case _t.WIDEVINE:case _t.PLAYREADY:r=["cenc"];break;case _t.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${l}`)}return kx(r,e,t,s)}function kx(l,e,t,s){return[{initDataTypes:l,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(a=>({contentType:`audio/mp4; codecs=${a}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(a=>({contentType:`video/mp4; codecs=${a}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function wx(l){var e;return!!l&&(l.sessionType==="persistent-license"||!!((e=l.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function Ox(l){const e=new Uint16Array(l.buffer,l.byteOffset,l.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),u=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(u){const c=u.childNodes[0]?u.childNodes[0].nodeValue:u.getAttribute("VALUE");if(c){const h=Pd(c).subarray(0,16);return Cy(h),h}}return null}let Oo={};class ll{static clearKeyUriToKeyIdMap(){Oo={}}static setKeyIdForUri(e,t){Oo[e]=t}constructor(e,t,s,r=[1],a=null,u){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=r,this.iv=a,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!zr(e),u!=null&&u.startsWith("0x")&&(this.keyId=new Uint8Array(oy(u)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Md(e.keyFormatVersions,this.keyFormatVersions)&&dp(e.iv,this.iv)&&dp(e.keyId,this.keyId)}isSupported(){if(this.method){if(zr(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case os.FAIRPLAY:case os.WIDEVINE:case os.PLAYREADY:case os.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(zr(this.method)){let r=this.iv;return r||(typeof e!="number"&&(ot.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),r=Mx(e)),new ll(this.method,this.uri,"identity",this.keyFormatVersions,r)}if(this.pssh&&this.keyId)return this;const t=Dx(this.uri);if(t)switch(this.keyFormat){case os.WIDEVINE:if(this.pssh=t,!this.keyId){const r=PS(t.buffer);if(r.length){var s;const a=r[0];this.keyId=(s=a.kids)!=null&&s.length?a.kids[0]:null}}if(!this.keyId){const r=t.length-22;this.keyId=t.subarray(r,r+16)}break;case os.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=NS(r,null,t),this.keyId=Ox(t);break}default:{let r=t.subarray(0,16);if(r.length!==16){const a=new Uint8Array(16);a.set(r,16-r.length),r=a}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r=Oo[this.uri];if(!r){const a=Object.keys(Oo).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,a),ll.setKeyIdForUri(this.uri,r)}this.keyId=r}return this}}function Mx(l){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=l>>8*(15-t)&255;return e}const hp=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,gp=/#EXT-X-MEDIA:(.*)/g,Nx=/^#EXT(?:INF|-X-TARGETDURATION):/m,Pf=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Px=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Ei{static findGroup(e,t){for(let s=0;s<e.length;s++){const r=e[s];if(r.id===t)return r}}static resolve(e,t){return Rd.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Nx.test(e)}static parseMasterPlaylist(e,t){const s=up(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},a=[];if(hp.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let u;for(;(u=hp.exec(e))!=null;)if(u[1]){var c;const d=new Rt(u[1],r),g=ud(r,u[2]),p={attrs:d,bitrate:d.decimalInteger("BANDWIDTH")||d.decimalInteger("AVERAGE-BANDWIDTH"),name:d.NAME,url:Ei.resolve(g,t)},y=d.decimalResolution("RESOLUTION");y&&(p.width=y.width,p.height=y.height),yp(d.CODECS,p);const E=d["SUPPLEMENTAL-CODECS"];E&&(p.supplemental={},yp(E,p.supplemental)),(c=p.unknownCodecs)!=null&&c.length||a.push(p),r.levels.push(p)}else if(u[3]){const d=u[3],g=u[4];switch(d){case"SESSION-DATA":{const p=new Rt(g,r),y=p["DATA-ID"];y&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[y]=p);break}case"SESSION-KEY":{const p=mp(g,t,r);p.encrypted&&p.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(p)):ot.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${g}"`);break}case"DEFINE":{{const p=new Rt(g,r);cp(r,p,t)}break}case"CONTENT-STEERING":{const p=new Rt(g,r);r.contentSteering={uri:Ei.resolve(p["SERVER-URI"],t),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=pp(g);break}}}const h=a.length>0&&a.length<r.levels.length;return r.levels=h?a:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,s){let r;const a={},u=s.levels,c={AUDIO:u.map(d=>({id:d.attrs.AUDIO,audioCodec:d.audioCodec})),SUBTITLES:u.map(d=>({id:d.attrs.SUBTITLES,textCodec:d.textCodec})),"CLOSED-CAPTIONS":[]};let h=0;for(gp.lastIndex=0;(r=gp.exec(e))!==null;){const d=new Rt(r[1],s),g=d.TYPE;if(g){const p=c[g],y=a[g]||[];a[g]=y;const E=d.LANGUAGE,T=d["ASSOC-LANGUAGE"],x=d.CHANNELS,S=d.CHARACTERISTICS,R=d["INSTREAM-ID"],_={attrs:d,bitrate:0,id:h++,groupId:d["GROUP-ID"]||"",name:d.NAME||E||"",type:g,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:E,url:d.URI?Ei.resolve(d.URI,t):""};if(T&&(_.assocLang=T),x&&(_.channels=x),S&&(_.characteristics=S),R&&(_.instreamId=R),p!=null&&p.length){const A=Ei.findGroup(p,_.groupId)||p[0];vp(_,A,"audioCodec"),vp(_,A,"textCodec")}y.push(_)}}return a}static parseLevelPlaylist(e,t,s,r,a,u){var c;const h={url:t},d=new _x(t),g=d.fragments,p=[];let y=null,E=0,T=0,x=0,S=0,R=0,_=null,A=new wf(r,h),C,k,G,w=-1,P=!1,B=null,M;if(Pf.lastIndex=0,d.m3u8=e,d.hasVariableRefs=up(e),((c=Pf.exec(e))==null?void 0:c[0])!=="#EXTM3U")return d.playlistParsingError=new Error("Missing format identifier #EXTM3U"),d;for(;(C=Pf.exec(e))!==null;){P&&(P=!1,A=new wf(r,h),A.playlistOffset=x,A.setStart(x),A.sn=E,A.cc=S,R&&(A.bitrate=R),A.level=s,y&&(A.initSegment=y,y.rawProgramDateTime&&(A.rawProgramDateTime=y.rawProgramDateTime,y.rawProgramDateTime=null),B&&(A.setByteRange(B),B=null)));const de=C[1];if(de){A.duration=parseFloat(de);const ce=(" "+C[2]).slice(1);A.title=ce||null,A.tagList.push(ce?["INF",de,ce]:["INF",de])}else if(C[3]){if(Ee(A.duration)){A.playlistOffset=x,A.setStart(x),G&&Tp(A,G,d),A.sn=E,A.level=s,A.cc=S,g.push(A);const ce=(" "+C[3]).slice(1);A.relurl=ud(d,ce),fd(A,_,p),_=A,x+=A.duration,E++,T=0,P=!0}}else{if(C=C[0].match(Px),!C){ot.warn("No matches on slow regex match for level playlist!");continue}for(k=1;k<C.length&&C[k]===void 0;k++);const ce=(" "+C[k]).slice(1),U=(" "+C[k+1]).slice(1),X=C[k+2]?(" "+C[k+2]).slice(1):null;switch(ce){case"BYTERANGE":_?A.setByteRange(U,_):A.setByteRange(U);break;case"PROGRAM-DATE-TIME":A.rawProgramDateTime=U,A.tagList.push(["PROGRAM-DATE-TIME",U]),w===-1&&(w=g.length);break;case"PLAYLIST-TYPE":d.type&&Fi(d,ce,C),d.type=U.toUpperCase();break;case"MEDIA-SEQUENCE":d.startSN!==0?Fi(d,ce,C):g.length>0&&Sp(d,ce,C),E=d.startSN=parseInt(U);break;case"SKIP":{d.skippedSegments&&Fi(d,ce,C);const te=new Rt(U,d),ue=te.decimalInteger("SKIPPED-SEGMENTS");if(Ee(ue)){d.skippedSegments+=ue;for(let $=ue;$--;)g.push(null);E+=ue}const O=te.enumeratedString("RECENTLY-REMOVED-DATERANGES");O&&(d.recentlyRemovedDateranges=(d.recentlyRemovedDateranges||[]).concat(O.split("	")));break}case"TARGETDURATION":d.targetduration!==0&&Fi(d,ce,C),d.targetduration=Math.max(parseInt(U),1);break;case"VERSION":d.version!==null&&Fi(d,ce,C),d.version=parseInt(U);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":d.live||Fi(d,ce,C),d.live=!1;break;case"#":(U||X)&&A.tagList.push(X?[U,X]:[U]);break;case"DISCONTINUITY":S++,A.tagList.push(["DIS"]);break;case"GAP":A.gap=!0,A.tagList.push([ce]);break;case"BITRATE":A.tagList.push([ce,U]),R=parseInt(U)*1e3,Ee(R)?A.bitrate=R:R=0;break;case"DATERANGE":{const te=new Rt(U,d),ue=new Dy(te,d.dateRanges[te.ID],d.dateRangeTagCount);d.dateRangeTagCount++,ue.isValid||d.skippedSegments?d.dateRanges[ue.id]=ue:ot.warn(`Ignoring invalid DATERANGE tag: "${U}"`),A.tagList.push(["EXT-X-DATERANGE",U]);break}case"DEFINE":{{const te=new Rt(U,d);"IMPORT"in te?Sx(d,te,u):cp(d,te,t)}break}case"DISCONTINUITY-SEQUENCE":d.startCC!==0?Fi(d,ce,C):g.length>0&&Sp(d,ce,C),d.startCC=S=parseInt(U);break;case"KEY":{const te=mp(U,t,d);if(te.isSupported()){if(te.method==="NONE"){G=void 0;break}G||(G={});const ue=G[te.keyFormat];ue!=null&&ue.matches(te)||(ue&&(G=dt({},G)),G[te.keyFormat]=te)}else ot.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${U}"`);break}case"START":d.startTimeOffset=pp(U);break;case"MAP":{const te=new Rt(U,d);if(A.duration){const ue=new wf(r,h);Ep(ue,te,s,G),y=ue,A.initSegment=y,y.rawProgramDateTime&&!A.rawProgramDateTime&&(A.rawProgramDateTime=y.rawProgramDateTime)}else{const ue=A.byteRangeEndOffset;if(ue){const O=A.byteRangeStartOffset;B=`${ue-O}@${O}`}else B=null;Ep(A,te,s,G),y=A,P=!0}y.cc=S;break}case"SERVER-CONTROL":{M&&Fi(d,ce,C),M=new Rt(U),d.canBlockReload=M.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=M.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&M.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=M.optionalFloat("PART-HOLD-BACK",0),d.holdBack=M.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{d.partTarget&&Fi(d,ce,C);const te=new Rt(U);d.partTarget=te.decimalFloatingPoint("PART-TARGET");break}case"PART":{let te=d.partList;te||(te=d.partList=[]);const ue=T>0?te[te.length-1]:void 0,O=T++,$=new Rt(U,d),Y=new xS($,A,h,O,ue);te.push(Y),A.duration+=Y.duration;break}case"PRELOAD-HINT":{const te=new Rt(U,d);d.preloadHint=te;break}case"RENDITION-REPORT":{const te=new Rt(U,d);d.renditionReports=d.renditionReports||[],d.renditionReports.push(te);break}default:ot.warn(`line parsed but not handled: ${C}`);break}}}_&&!_.relurl?(g.pop(),x-=_.duration,d.partList&&(d.fragmentHint=_)):d.partList&&(fd(A,_,p),A.cc=S,d.fragmentHint=A,G&&Tp(A,G,d)),d.targetduration||(d.playlistParsingError=new Error("Missing Target Duration"));const j=g.length,ee=g[0],oe=g[j-1];if(x+=d.skippedSegments*d.targetduration,x>0&&j&&oe){d.averagetargetduration=x/j;const de=oe.sn;d.endSN=de!=="initSegment"?de:0,d.live||(oe.endList=!0),w>0&&(Bx(g,w),ee&&p.unshift(ee))}return d.fragmentHint&&(x+=d.fragmentHint.duration),d.totalduration=x,p.length&&d.dateRangeTagCount&&ee&&wy(p,d),d.endCC=S,d}}function wy(l,e){let t=l.length;if(!t)if(e.hasProgramDateTime){const c=e.fragments[e.fragments.length-1];l.push(c),t++}else return;const s=l[t-1],r=e.live?1/0:e.totalduration,a=Object.keys(e.dateRanges);for(let c=a.length;c--;){const h=e.dateRanges[a[c]],d=h.startDate.getTime();h.tagAnchor=s.ref;for(let g=t;g--;){var u;if(((u=l[g])==null?void 0:u.sn)<e.startSN)break;const p=Ux(e,d,l,g,r);if(p!==-1){h.tagAnchor=e.fragments[p].ref;break}}}}function Ux(l,e,t,s,r){const a=t[s];if(a){const c=a.programDateTime;if(e>=c||s===0){var u;const h=(((u=t[s+1])==null?void 0:u.start)||r)-a.start;if(e<=c+h*1e3){const d=t[s].sn-l.startSN;if(d<0)return-1;const g=l.fragments;if(g.length>t.length){const y=(t[s+1]||g[g.length-1]).sn-l.startSN;for(let E=y;E>d;E--){const T=g[E].programDateTime;if(e>=T&&e<T+g[E].duration*1e3)return E}}return d}}}return-1}function mp(l,e,t){var s,r;const a=new Rt(l,t),u=(s=a.METHOD)!=null?s:"",c=a.URI,h=a.hexadecimalInteger("IV"),d=a.KEYFORMATVERSIONS,g=(r=a.KEYFORMAT)!=null?r:"identity";c&&a.IV&&!h&&ot.error(`Invalid IV: ${a.IV}`);const p=c?Ei.resolve(c,e):"",y=(d||"1").split("/").map(Number).filter(Number.isFinite);return new ll(u,p,g,y,h,a.KEYID)}function pp(l){const t=new Rt(l).decimalFloatingPoint("TIME-OFFSET");return Ee(t)?t:null}function yp(l,e){let t=(l||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const r=t.filter(a=>Dd(a,s));r.length&&(e[`${s}Codec`]=r.map(a=>a.split("/")[0]).join(","),t=t.filter(a=>r.indexOf(a)===-1))}),e.unknownCodecs=t}function vp(l,e,t){const s=e[t];s&&(l[t]=s)}function Bx(l,e){let t=l[e];for(let s=e;s--;){const r=l[s];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function fd(l,e,t){l.rawProgramDateTime?t.push(l):e!=null&&e.programDateTime&&(l.programDateTime=e.endProgramDateTime)}function Ep(l,e,t,s){l.relurl=e.URI,e.BYTERANGE&&l.setByteRange(e.BYTERANGE),l.level=t,l.sn="initSegment",s&&(l.levelkeys=s),l.initSegment=null}function Tp(l,e,t){l.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&s.push(l)}function Fi(l,e,t){l.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Sp(l,e,t){l.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Uf(l,e){const t=e.startPTS;if(Ee(t)){let s=0,r;e.sn>l.sn?(s=t-l.start,r=l):(s=l.start-t,r=e),r.duration!==s&&r.setDuration(s)}else e.sn>l.sn?l.cc===e.cc&&l.minEndPTS?e.setStart(l.start+(l.minEndPTS-l.start)):e.setStart(l.start+l.duration):e.setStart(Math.max(l.start-e.duration,0))}function Oy(l,e,t,s,r,a,u){s-t<=0&&(u.warn("Fragment should have a positive duration",e),s=t+e.duration,a=r+e.duration);let h=t,d=s;const g=e.startPTS,p=e.endPTS;if(Ee(g)){const R=Math.abs(g-t);l&&R>l.totalduration?u.warn(`media timestamps and playlist times differ by ${R}s for level ${e.level} ${l.url}`):Ee(e.deltaPTS)?e.deltaPTS=Math.max(R,e.deltaPTS):e.deltaPTS=R,h=Math.max(t,g),t=Math.min(t,g),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,d=Math.min(s,p),s=Math.max(s,p),a=e.endDTS!==void 0?Math.max(a,e.endDTS):a}const y=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=h,e.startDTS=r,e.endPTS=s,e.minEndPTS=d,e.endDTS=a;const E=e.sn;if(!l||E<l.startSN||E>l.endSN)return 0;let T;const x=E-l.startSN,S=l.fragments;for(S[x]=e,T=x;T>0;T--)Uf(S[T],S[T-1]);for(T=x;T<S.length-1;T++)Uf(S[T],S[T+1]);return l.fragmentHint&&Uf(S[S.length-1],l.fragmentHint),l.PTSKnown=l.alignedSliding=!0,y}function Fx(l,e,t){if(l===e)return;let s=null;const r=l.fragments;for(let g=r.length-1;g>=0;g--){const p=r[g].initSegment;if(p){s=p;break}}l.fragmentHint&&delete l.fragmentHint.endPTS;let a;jx(l,e,(g,p,y,E)=>{if((!e.startCC||e.skippedSegments)&&p.cc!==g.cc){const T=g.cc-p.cc;for(let x=y;x<E.length;x++)E[x].cc+=T;e.endCC=E[E.length-1].cc}Ee(g.startPTS)&&Ee(g.endPTS)&&(p.setStart(p.startPTS=g.startPTS),p.startDTS=g.startDTS,p.maxStartPTS=g.maxStartPTS,p.endPTS=g.endPTS,p.endDTS=g.endDTS,p.minEndPTS=g.minEndPTS,p.setDuration(g.endPTS-g.startPTS),p.duration&&(a=p),e.PTSKnown=e.alignedSliding=!0),g.hasStreams&&(p.elementaryStreams=g.elementaryStreams),p.loader=g.loader,g.hasStats&&(p.stats=g.stats),g.initSegment&&(p.initSegment=g.initSegment,s=g.initSegment)});const u=e.fragments,c=e.fragmentHint?u.concat(e.fragmentHint):u;if(s&&c.forEach(g=>{var p;g&&(!g.initSegment||g.initSegment.relurl===((p=s)==null?void 0:p.relurl))&&(g.initSegment=s)}),e.skippedSegments){if(e.deltaUpdateFailed=u.some(g=>!g),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let g=e.skippedSegments;g--;)u.shift();e.startSN=u[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=$x(l.dateRanges,e,t));const g=l.fragments.filter(p=>p.rawProgramDateTime);if(l.hasProgramDateTime&&!e.hasProgramDateTime)for(let p=1;p<c.length;p++)c[p].programDateTime===null&&fd(c[p],c[p-1],g);wy(g,e)}e.endCC=u[u.length-1].cc}if(!e.startCC){var h;const g=Py(l,e.startSN-1);e.startCC=(h=g==null?void 0:g.cc)!=null?h:u[0].cc}Gx(l.partList,e.partList,(g,p)=>{p.elementaryStreams=g.elementaryStreams,p.stats=g.stats}),a?Oy(e,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS,t):My(l,e),u.length&&(e.totalduration=e.edge-u[0].start),e.driftStartTime=l.driftStartTime,e.driftStart=l.driftStart;const d=e.advancedDateTime;if(e.advanced&&d){const g=e.edge;e.driftStart||(e.driftStartTime=d,e.driftStart=g),e.driftEndTime=d,e.driftEnd=g}else e.driftEndTime=l.driftEndTime,e.driftEnd=l.driftEnd,e.advancedDateTime=l.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=l.requestScheduled)}function $x(l,e,t){const{dateRanges:s,recentlyRemovedDateranges:r}=e,a=dt({},l);r&&r.forEach(h=>{delete a[h]});const c=Object.keys(a).length;return c?(Object.keys(s).forEach(h=>{const d=a[h],g=new Dy(s[h].attr,d);g.isValid?(a[h]=g,d||(g.tagOrder+=c)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${vt(s[h].attr)}"`)}),a):s}function Gx(l,e,t){if(l&&e){let s=0;for(let r=0,a=l.length;r<=a;r++){const u=l[r],c=e[r+s];u&&c&&u.index===c.index&&u.fragment.sn===c.fragment.sn?t(u,c):s--}}}function jx(l,e,t){const s=e.skippedSegments,r=Math.max(l.startSN,e.startSN)-e.startSN,a=(l.fragmentHint?1:0)+(s?e.endSN:Math.min(l.endSN,e.endSN))-e.startSN,u=e.startSN-l.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,h=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments;for(let d=r;d<=a;d++){const g=h[u+d];let p=c[d];if(s&&!p&&g&&(p=e.fragments[d]=g),g&&p){t(g,p,d,c);const y=g.relurl,E=p.relurl;if(y&&Hx(y,E)){e.playlistParsingError=xp(`media sequence mismatch ${p.sn}:`,l,e,g,p);return}else if(g.cc!==p.cc){e.playlistParsingError=xp(`discontinuity sequence mismatch (${g.cc}!=${p.cc})`,l,e,g,p);return}}}}function xp(l,e,t,s,r){return new Error(`${l} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function My(l,e,t=!0){const s=e.startSN+e.skippedSegments-l.startSN,r=l.fragments,a=s>=0;let u=0;if(a&&s<r.length)u=r[s].start;else if(a&&e.startSN===l.endSN+1)u=l.fragmentEnd;else if(a&&t)u=l.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)u=l.fragmentStart;else return;dd(e,u)}function dd(l,e){if(e){const t=l.fragments;for(let s=l.skippedSegments;s<t.length;s++)t[s].addStart(e);l.fragmentHint&&l.fragmentHint.addStart(e)}}function Ny(l,e=1/0){let t=1e3*l.targetduration;if(l.updated){const s=l.fragments;if(s.length&&t*4>e){const a=s[s.length-1].duration*1e3;a<t&&(t=a)}}else t/=2;return Math.round(t)}function Py(l,e,t){if(!l)return null;let s=l.fragments[e-l.startSN];return s||(s=l.fragmentHint,s&&s.sn===e)?s:e<l.startSN&&t&&t.sn===e?t:null}function bp(l,e,t){return l?Uy(l.partList,e,t):null}function Uy(l,e,t){if(l)for(let s=l.length;s--;){const r=l[s];if(r.index===t&&r.fragment.sn===e)return r}return null}function By(l){l.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function Hx(l,e){return l!==e&&e?Ap(l)!==Ap(e):!1}function Ap(l){return l.replace(/\?[^?]*$/,"")}function el(l,e){for(let s=0,r=l.length;s<r;s++){var t;if(((t=l[s])==null?void 0:t.cc)===e)return l[s]}return null}function Vx(l,e){return!!(l&&e.startCC<l.endCC&&e.endCC>l.startCC)}function Lp(l,e){const t=l.start+e;l.startPTS=t,l.setStart(t),l.endPTS=t+l.duration}function Fy(l,e){const t=e.fragments;for(let s=0,r=t.length;s<r;s++)Lp(t[s],l);e.fragmentHint&&Lp(e.fragmentHint,l),e.alignedSliding=!0}function Kx(l,e){l&&($y(e,l),e.alignedSliding||uu(e,l),!e.alignedSliding&&!e.skippedSegments&&My(l,e,!1))}function $y(l,e){if(!Vx(e,l))return;const t=Math.min(e.endCC,l.endCC),s=el(e.fragments,t),r=el(l.fragments,t);if(!s||!r)return;ot.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const a=s.start-r.start;Fy(a,l)}function uu(l,e){if(!l.hasProgramDateTime||!e.hasProgramDateTime)return;const t=l.fragments,s=e.fragments;if(!t.length||!s.length)return;let r,a;const u=Math.min(e.endCC,l.endCC);e.startCC<u&&l.startCC<u&&(r=el(s,u),a=el(t,u)),(!r||!a)&&(r=s[Math.floor(s.length/2)],a=el(t,r.cc)||t[Math.floor(t.length/2)]);const c=r.programDateTime,h=a.programDateTime;if(!c||!h)return;const d=(h-c)/1e3-(a.start-r.start);Fy(d,l)}function cs(l,e,t){Ss(l,e,t),l.addEventListener(e,t)}function Ss(l,e,t){l.removeEventListener(e,t)}const zx={toString:function(l){let e="";const t=l.length;for(let s=0;s<t;s++)e+=`[${l.start(s).toFixed(3)}-${l.end(s).toFixed(3)}]`;return e}},re={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Ud extends _y{constructor(e,t,s,r,a){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=re.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:u,fragCurrent:c,media:h,mediaBuffer:d,state:g}=this,p=h?h.currentTime:0,y=Ne.bufferInfo(d||h,p,u.maxBufferHole),E=!y.len;if(this.log(`Media seeking to ${Ee(p)?p.toFixed(3):p}, state: ${g}, ${E?"out of":"in"} buffer`),this.state===re.ENDED)this.resetLoadingState();else if(c){const T=u.maxFragLookUpTolerance,x=c.start-T,S=c.start+c.duration+T;if(E||S<y.start||x>y.end){const R=p>S;(p<x||R)&&(R&&c.loader&&(this.log(`Cancelling fragment load for seek (sn: ${c.sn})`),c.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(h){this.fragmentTracker.removeFragmentsInRange(p,1/0,this.playlistType,!0);const T=this.lastCurrentTime;if(p>T&&(this.lastCurrentTime=p),!this.loadingParts){const x=Math.max(y.end,p),S=this.shouldLoadParts(this.getLevelDetails(),x);S&&(this.log(`LL-Part loading ON after seeking to ${p.toFixed(2)} with buffer @${x.toFixed(2)}`),this.loadingParts=S)}}this.hls.hasEnoughToStart||(this.log(`Setting ${E?"startPosition":"nextLoadPosition"} to ${p} for seek without enough to start`),this.nextLoadPosition=p,E&&(this.startPosition=p)),E&&this.state===re.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=a,this.hls=e,this.fragmentLoader=new Ex(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new wd(e.config)}registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===re.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=re.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,r=this.config.timelineOffset||0;if(s<=r)return!1;const a=e.buffered;this.config.maxBufferHole&&a&&a.length>1&&(e=Ne.bufferedInfo(a,e.start,0));const u=e.nextStart;if(u&&u>r&&u<t.edge||this.media.currentTime<e.start)return!1;const h=t.partList;if(h!=null&&h.length){const g=h[h.length-1];return Ne.isBuffered(this.media,g.start+g.duration/2)}const d=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;cs(s,"seeking",this.onMediaSeeking),cs(s,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===re.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Ss(r,"seeking",this.onMediaSeeking),Ss(r,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=re.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const r=a=>{const u=a.frag;if(this.fragContextChanged(u)){this.warn(`${u.type} sn: ${u.sn}${a.part?" part: "+a.part.index:""} of ${this.fragInfo(u,!1,a.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(u);return}u.stats.chunkCount++,this._handleFragmentLoadProgress(a)};this._doFragLoad(e,t,s,r).then(a=>{if(!a)return;const u=this.state,c=a.frag;if(this.fragContextChanged(c)){(u===re.FRAG_LOADING||!this.fragCurrent&&u===re.PARSING)&&(this.fragmentTracker.removeFragment(c),this.state=re.IDLE);return}"payload"in a&&(this.log(`Loaded ${c.type} sn: ${c.sn} of ${this.playlistLabel()} ${c.level}`),this.hls.trigger(b.FRAG_LOADED,a)),this._handleFragmentLoadComplete(a)}).catch(a=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(`Frag error: ${(a==null?void 0:a.message)||a}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===Kt.APPENDING){const a=e.type,u=this.getFwdBufferInfo(this.mediaBuffer,a),c=Math.max(e.duration,u?u.len:this.config.maxBufferLength),h=this.backtrackFragment;((h?e.sn-h.sn:0)===1||this.reduceMaxBufferLength(c,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===Kt.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:s};this.hls.trigger(b.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const r=s==null?void 0:s.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:r}=this,{frag:a,payload:u}=s,c=a.decryptdata;if(u&&u.byteLength>0&&c!=null&&c.key&&c.iv&&zr(c.method)){const h=self.performance.now();return this.decrypter.decrypt(new Uint8Array(u),c.key.buffer,c.iv.buffer,Nd(c.method)).catch(d=>{throw r.trigger(b.ERROR,{type:Le.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:a}),d}).then(d=>{const g=self.performance.now();return r.trigger(b.FRAG_DECRYPTED,{frag:a,payload:d,stats:{tstart:h,tdecrypt:g}}),s.payload=d,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==re.STOPPED&&(this.state=re.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,r;const a=e.tracks;if(a&&!t.encrypted&&((s=a.audio)!=null&&s.encrypted||(r=a.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const u=this.media,c=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${u?"attached mediaKeys: "+u.mediaKeys:"detached"})`);return this.warn(c.message),!u||u.mediaKeys?!1:(this.hls.trigger(b.ERROR,{type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_KEYS,fatal:!1,error:c,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?zx.toString(Ne.getBuffered(s)):"(detached)"})`),$t(e)){var r;if(e.type!==Te.SUBTITLE){const u=e.elementaryStreams;if(!Object.keys(u).some(c=>!!u[c])){this.state=re.IDLE;return}}const a=(r=this.levels)==null?void 0:r[e.level];a!=null&&a.fragmentError&&(this.log(`Resetting level fragment error count of ${a.fragmentError} on frag buffered`),a.fragmentError=0)}this.state=re.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:r,partsLoaded:a}=e,u=!a||a.length===0||a.some(h=>!h),c=new Od(s.level,s.sn,s.stats.chunkCount+1,0,r?r.index:-1,!u);t.flush(c)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,r){var a;this.fragCurrent=e;const u=t.details;if(!this.levels||!u)throw new Error(`frag load aborted, missing level${u?"":" detail"}s`);let c=null;if(e.encrypted&&!((a=e.decryptdata)!=null&&a.key)){if(this.log(`Loading key for ${e.sn} of [${u.startSN}-${u.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=re.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(y=>{if(!this.fragContextChanged(y.frag))return this.hls.trigger(b.KEY_LOADED,y),this.state===re.KEY_LOADING&&(this.state=re.IDLE),y}),this.hls.trigger(b.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(c=this.keyLoader.loadClear(e,u.encryptedFragments,this.startFragRequested),c&&this.log("[eme] blocking frag load until media-keys acquired"));const h=this.fragPrevious;if($t(e)&&(!h||e.sn!==h.sn)){const y=this.shouldLoadParts(t.details,e.end);y!==this.loadingParts&&(this.log(`LL-Part loading ${y?"ON":"OFF"} loading sn ${h==null?void 0:h.sn}->${e.sn}`),this.loadingParts=y)}if(s=Math.max(e.start,s||0),this.loadingParts&&$t(e)){const y=u.partList;if(y&&r){s>u.fragmentEnd&&u.fragmentHint&&(e=u.fragmentHint);const E=this.getNextPart(y,e,s);if(E>-1){const T=y[E];e=this.fragCurrent=T.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${T.index} (${E}/${y.length-1}) of ${this.fragInfo(e,!1,T)}) cc: ${e.cc} [${u.startSN}-${u.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=T.start+T.duration,this.state=re.FRAG_LOADING;let x;return c?x=c.then(S=>!S||this.fragContextChanged(S.frag)?null:this.doFragPartsLoad(e,T,t,r)).catch(S=>this.handleFragLoadError(S)):x=this.doFragPartsLoad(e,T,t,r).catch(S=>this.handleFragLoadError(S)),this.hls.trigger(b.FRAG_LOADING,{frag:e,part:T,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):x}else if(!e.url||this.loadedEndOfParts(y,s))return Promise.resolve(null)}}if($t(e)&&this.loadingParts){var d;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(d=u.partList)==null?void 0:d.filter(y=>y.loaded).map(y=>`[${y.start}-${y.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+u.startSN+"-"+u.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),Ee(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=re.FRAG_LOADING;const g=this.config.progressive;let p;return g&&c?p=c.then(y=>!y||this.fragContextChanged(y.frag)?null:this.fragmentLoader.load(e,r)).catch(y=>this.handleFragLoadError(y)):p=Promise.all([this.fragmentLoader.load(e,g?r:void 0),c]).then(([y])=>(!g&&r&&r(y),y)).catch(y=>this.handleFragLoadError(y)),this.hls.trigger(b.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):p}doFragPartsLoad(e,t,s,r){return new Promise((a,u)=>{var c;const h=[],d=(c=s.details)==null?void 0:c.partList,g=p=>{this.fragmentLoader.loadPart(e,p,r).then(y=>{h[p.index]=y;const E=y.part;this.hls.trigger(b.FRAG_LOADED,y);const T=bp(s.details,e.sn,p.index+1)||Uy(d,e.sn,p.index+1);if(T)g(T);else return a({frag:e,part:E,partsLoaded:h})}).catch(u)};g(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===z.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Le.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(b.ERROR,t)}else this.hls.trigger(b.ERROR,{type:Le.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==re.PARSING){!this.fragCurrent&&this.state!==re.STOPPED&&this.state!==re.ERROR&&(this.state=re.IDLE);return}const{frag:s,part:r,level:a}=t,u=self.performance.now();s.stats.parsing.end=u,r&&(r.stats.parsing.end=u);const c=this.getLevelDetails(),d=c&&s.sn>c.endSN||this.shouldLoadParts(c,s.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=d),this.updateLevelTiming(s,r,a,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const a=e.partList[0];if(a.fragment.type===Te.SUBTITLE)return!1;const u=a.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=u){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>a.start-a.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:r,sn:a,part:u}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${a} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const c=t[r],h=c.details,d=u>-1?bp(h,a,u):null,g=d?d.fragment:Py(h,a,s);return g?(s&&s!==g&&(g.stats=s.stats),{frag:g,part:d,level:c}):null}bufferFragmentData(e,t,s,r,a){if(this.state!==re.PARSING)return;const{data1:u,data2:c}=e;let h=u;if(c&&(h=Qs(u,c)),!h.length)return;const d=this.initPTS[t.cc],g=d?-d.baseTime/d.timescale:void 0,p={type:e.type,frag:t,part:s,chunkMeta:r,offset:g,parent:t.type,data:h};if(this.hls.trigger(b.BUFFER_APPENDING,p),e.dropped&&e.independent&&!s){if(a)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ne.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,r=Ne.bufferInfo(t,s,0),a=e.duration,u=Math.min(this.config.maxFragLookUpTolerance*2,a*.25),c=Math.max(Math.min(e.start-u,r.end-u),s+u);e.start-c>u&&this.flushMainBuffer(c,e.start)}getFwdBufferInfo(e,t){var s;const r=this.getLoadPosition();if(!Ee(r))return null;const u=this.lastCurrentTime>r||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,u)}getFwdBufferInfoAtPos(e,t,s,r){const a=Ne.bufferInfo(e,t,r);if(a.len===0&&a.nextStart!==void 0){const u=this.fragmentTracker.getBufferedFrag(t,s);if(u&&(a.nextStart<=u.end||u.gap)){const c=Math.max(Math.min(a.nextStart,u.end)-t,r);return Ne.bufferInfo(e,t,c)}}return a}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,r=Math.max(Math.min(e-t,s.maxBufferLength),t),a=Math.max(e-t*3,s.maxMaxBufferLength/2,r);return a>=r?(s.maxMaxBufferLength=a,this.warn(`Reduce max buffer length to ${a}s`),!0):!1}getAppendedFrag(e,t=Te.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,r=s.length;if(!r)return null;const{config:a}=this,u=s[0].start,c=a.lowLatencyMode&&!!t.partList;let h=null;if(t.live){const p=a.initialLiveManifestSize;if(r<p)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${p})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<u){var d;c&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),h=this.getInitialLiveFragment(t);const y=this.hls.startPosition,E=this.hls.liveSyncPosition,T=h?(y!==-1&&y>=u?y:E)||h.start:e;this.log(`Setting startPosition to ${T} to match start frag at live edge. mainStart: ${y} liveSyncPosition: ${E} frag.start: ${(d=h)==null?void 0:d.start}`),this.startPosition=this.nextLoadPosition=T}}else e<=u&&(h=s[0]);if(!h){const p=this.loadingParts?t.partEnd:t.fragmentEnd;h=this.getFragmentAtPosition(e,p,t)}let g=this.filterReplacedPrimary(h,t);if(!g&&h){const p=h.sn-t.startSN;g=this.filterReplacedPrimary(s[p+1]||null,t)}return this.mapToInitFragWhenRequired(g)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===Kt.OK||s===Kt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,r,a){let u=null;if(e.gap&&(u=this.getNextFragment(this.nextLoadPosition,t),u&&!u.gap&&s.nextStart)){const c=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,r,0);if(c!==null&&s.len+c.len>=a){const h=u.sn;return this.loopSn!==h&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${h}`),this.loopSn=h),null}}return this.loopSn=void 0,u}get primaryPrefetch(){if(Rp(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Rp(this.config)&&e.type!==Te.SUBTITLE){const s=this.hls.interstitialsManager,r=s==null?void 0:s.bufferingItem;if(r){const u=r.event;if(u){if(u.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&(t==null?void 0:t.live)===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const a=s==null?void 0:s.playerQueue;if(a)for(let u=a.length;u--;){const c=a[u].interstitial;if(c.appendInPlace&&e.start>=c.startTime&&e.end<=c.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let r=-1,a=!1,u=!0;for(let c=0,h=e.length;c<h;c++){const d=e[c];if(u=u&&!d.independent,r>-1&&s<d.start)break;const g=d.loaded;g?r=-1:(a||(d.independent||u)&&d.fragment===t)&&(d.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${d.start}`),r=c),a=g}return r}loadedEndOfParts(e,t){let s;for(let r=e.length;r--;){if(s=e[r],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let r=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),r=lx(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const a=s.sn+1;if(a>=e.startSN&&a<=e.endSN){const u=t[a-e.startSN];s.cc===u.cc&&(r=u,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=Ay(e,s.cc,s.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const a=this.hls.liveSyncPosition;a!==null&&(r=this.getFragmentAtPosition(a,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,s){const{config:r}=this;let{fragPrevious:a}=this,{fragments:u,endSN:c}=s;const{fragmentHint:h}=s,{maxFragLookUpTolerance:d}=r,g=s.partList,p=!!(this.loadingParts&&g!=null&&g.length&&h);p&&!this.bitrateTest&&g[g.length-1].fragment.sn===h.sn&&(u=u.concat(h),c=h.sn);let y;if(e<t){var E;const x=e<this.lastCurrentTime||e>t-d||(E=this.media)!=null&&E.paused||!this.startFragRequested?0:d;y=Qn(a,u,e,x)}else y=u[u.length-1];if(y){const T=y.sn-s.startSN,x=this.fragmentTracker.getState(y);if((x===Kt.OK||x===Kt.PARTIAL&&y.gap)&&(a=y),a&&y.sn===a.sn&&(!p||g[0].fragment.sn>y.sn||!s.live)&&y.level===a.level){const R=u[T+1];y.sn<c&&this.fragmentTracker.getState(R)!==Kt.OK?y=R:y=null}}return y}alignPlaylists(e,t,s){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const a=e.fragmentStart,u=!t,c=e.alignedSliding&&Ee(a);if(u||!c&&!a){Kx(s,e);const h=e.fragmentStart;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),h}return a}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const r=this.timelineOffset;if(s===-1){const a=this.startTimeOffset!==null,u=a?this.startTimeOffset:e.startTimeOffset;u!==null&&Ee(u)?(s=t+u,u<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${u} found in ${a?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+r}this.nextLoadPosition=s+r}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&$t(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==re.FRAG_LOADING_WAITING_RETRY)&&(this.state=re.IDLE)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const R=this.getCurrentContext(t.chunkMeta);R&&(t.frag=R.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var a;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(a=this.fragCurrent)==null?void 0:a.url}`);return}const u=t.details===z.FRAG_GAP;u&&this.fragmentTracker.fragBuffered(r,!0);const c=t.errorAction;if(!c){this.state=re.ERROR;return}const{action:h,flags:d,retryCount:g=0,retryConfig:p}=c,y=!!p,E=y&&h===ts.RetryRequest,T=y&&!c.resolved&&d===Ms.MoveAllAlternatesMatchingHost,x=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!E&&T&&$t(r)&&!r.endList&&x&&!Ry(t))this.resetFragmentErrors(e),this.treatAsGap(r),c.resolved=!0;else if((E||T)&&g<p.maxNumRetry){var S;const R=od((S=t.response)==null?void 0:S.code),_=kd(p,g);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+_,this.state=re.FRAG_LOADING_WAITING_RETRY,c.resolved=!0,R){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${g+1}/${p.maxNumRetry} in ${_}ms`)}else if(p)if(this.resetFragmentErrors(e),g<p.maxNumRetry)!u&&h!==ts.RemoveAlternatePermanently&&(c.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${g})`);return}else h===ts.SendAlternateToPenaltyBox?this.state=re.WAITING_LEVEL:this.state=re.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!od(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=re.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===re.PARSING||this.state===re.PARSED){const t=e.frag,s=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,s),a=r&&r.len>.5;a&&this.reduceMaxBufferLength(r.len,(t==null?void 0:t.duration)||10);const u=!a;return u&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),u}return!1}resetFragmentErrors(e){e===Te.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==re.STOPPED&&(this.state=re.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const r=Ne.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,s),this.state===re.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==re.STOPPED&&(this.state=re.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,r){const a=s.details;if(!a){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((h,d)=>{const g=e.elementaryStreams[d];if(g){const p=g.endPTS-g.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${e.sn} ${d} duration reliably (${p})`),h||!1;const y=r?0:Oy(a,e,g.startPTS,g.endPTS,g.startDTS,g.endDTS,this);return this.hls.trigger(b.LEVEL_PTS_UPDATED,{details:a,level:s,drift:y,type:d,frag:e,start:g.startPTS,end:g.endPTS}),!0}return h},!1)){var c;if(s.fragmentError===0&&this.treatAsGap(e,s),((c=this.transmuxer)==null?void 0:c.error)===null){const h=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(h.message),this.hls.trigger(b.ERROR,{type:Le.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:h,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=re.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(b.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Te.MAIN?"level":"track"}fragInfo(e,t=!0,s){var r,a;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((r=t&&!s?e.startPTS:(s||e).start)!=null?r:NaN).toFixed(3)}-${((a=t&&!s?e.endPTS:(s||e).end)!=null?a:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Rp(l){return!!l.interstitialsController&&l.enableInterstitialPlayback!==!1}class Gy{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=Yx(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function Yx(l,e){const t=new Uint8Array(e);let s=0;for(let r=0;r<l.length;r++){const a=l[r];t.set(a,s),s+=a.length}return t}var Bf={exports:{}},_p;function qx(){return _p||(_p=1,(function(l){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function r(h,d,g){this.fn=h,this.context=d,this.once=g||!1}function a(h,d,g,p,y){if(typeof g!="function")throw new TypeError("The listener must be a function");var E=new r(g,p||h,y),T=t?t+d:d;return h._events[T]?h._events[T].fn?h._events[T]=[h._events[T],E]:h._events[T].push(E):(h._events[T]=E,h._eventsCount++),h}function u(h,d){--h._eventsCount===0?h._events=new s:delete h._events[d]}function c(){this._events=new s,this._eventsCount=0}c.prototype.eventNames=function(){var d=[],g,p;if(this._eventsCount===0)return d;for(p in g=this._events)e.call(g,p)&&d.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(g)):d},c.prototype.listeners=function(d){var g=t?t+d:d,p=this._events[g];if(!p)return[];if(p.fn)return[p.fn];for(var y=0,E=p.length,T=new Array(E);y<E;y++)T[y]=p[y].fn;return T},c.prototype.listenerCount=function(d){var g=t?t+d:d,p=this._events[g];return p?p.fn?1:p.length:0},c.prototype.emit=function(d,g,p,y,E,T){var x=t?t+d:d;if(!this._events[x])return!1;var S=this._events[x],R=arguments.length,_,A;if(S.fn){switch(S.once&&this.removeListener(d,S.fn,void 0,!0),R){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,g),!0;case 3:return S.fn.call(S.context,g,p),!0;case 4:return S.fn.call(S.context,g,p,y),!0;case 5:return S.fn.call(S.context,g,p,y,E),!0;case 6:return S.fn.call(S.context,g,p,y,E,T),!0}for(A=1,_=new Array(R-1);A<R;A++)_[A-1]=arguments[A];S.fn.apply(S.context,_)}else{var C=S.length,k;for(A=0;A<C;A++)switch(S[A].once&&this.removeListener(d,S[A].fn,void 0,!0),R){case 1:S[A].fn.call(S[A].context);break;case 2:S[A].fn.call(S[A].context,g);break;case 3:S[A].fn.call(S[A].context,g,p);break;case 4:S[A].fn.call(S[A].context,g,p,y);break;default:if(!_)for(k=1,_=new Array(R-1);k<R;k++)_[k-1]=arguments[k];S[A].fn.apply(S[A].context,_)}}return!0},c.prototype.on=function(d,g,p){return a(this,d,g,p,!1)},c.prototype.once=function(d,g,p){return a(this,d,g,p,!0)},c.prototype.removeListener=function(d,g,p,y){var E=t?t+d:d;if(!this._events[E])return this;if(!g)return u(this,E),this;var T=this._events[E];if(T.fn)T.fn===g&&(!y||T.once)&&(!p||T.context===p)&&u(this,E);else{for(var x=0,S=[],R=T.length;x<R;x++)(T[x].fn!==g||y&&!T[x].once||p&&T[x].context!==p)&&S.push(T[x]);S.length?this._events[E]=S.length===1?S[0]:S:u(this,E)}return this},c.prototype.removeAllListeners=function(d){var g;return d?(g=t?t+d:d,this._events[g]&&u(this,g)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,l.exports=c})(Bf)),Bf.exports}var Xx=qx(),Bd=TS(Xx);const ol="1.6.12",Qr={};function Qx(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Wx(){const l=Qr[ol];if(l)return l.clientCount++,l;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return Qr[ol]=r,r}function Zx(l){const e=Qr[l];if(e)return e.clientCount++,e;const t=new self.URL(l,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Qr[l]=r,r}function Jx(l){const e=Qr[l||ol];if(e&&e.clientCount--===1){const{worker:s,objectURL:r}=e;delete Qr[l||ol],r&&self.URL.revokeObjectURL(r),s.terminate()}}function jy(l,e){return e+10<=l.length&&l[e]===51&&l[e+1]===68&&l[e+2]===73&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128}function Fd(l,e){return e+10<=l.length&&l[e]===73&&l[e+1]===68&&l[e+2]===51&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128}function gu(l,e){let t=0;return t=(l[e]&127)<<21,t|=(l[e+1]&127)<<14,t|=(l[e+2]&127)<<7,t|=l[e+3]&127,t}function ul(l,e){const t=e;let s=0;for(;Fd(l,e);){s+=10;const r=gu(l,e+6);s+=r,jy(l,e+10)&&(s+=10),e+=s}if(s>0)return l.subarray(t,t+s)}function eb(l,e,t,s){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],a=e[t+2],u=a>>2&15;if(u>12){const E=new Error(`invalid ADTS sampling index:${u}`);l.emit(b.ERROR,b.ERROR,{type:Le.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!0,error:E,reason:E.message});return}const c=(a>>6&3)+1,h=e[t+3]>>6&3|(a&1)<<2,d="mp4a.40."+c,g=r[u];let p=u;(c===5||c===29)&&(p-=3);const y=[c<<3|(p&14)>>1,(p&1)<<7|h<<3];return ot.log(`manifest codec:${s}, parsed codec:${d}, channels:${h}, rate:${g} (ADTS object type:${c} sampling index:${u})`),{config:y,samplerate:g,channelCount:h,codec:d,parsedCodec:d,manifestCodec:s}}function Hy(l,e){return l[e]===255&&(l[e+1]&246)===240}function Vy(l,e){return l[e+1]&1?7:9}function $d(l,e){return(l[e+3]&3)<<11|l[e+4]<<3|(l[e+5]&224)>>>5}function tb(l,e){return e+5<l.length}function cu(l,e){return e+1<l.length&&Hy(l,e)}function sb(l,e){return tb(l,e)&&Hy(l,e)&&$d(l,e)<=l.length-e}function ib(l,e){if(cu(l,e)){const t=Vy(l,e);if(e+t>=l.length)return!1;const s=$d(l,e);if(s<=t)return!1;const r=e+s;return r===l.length||cu(l,r)}return!1}function Ky(l,e,t,s,r){if(!l.samplerate){const a=eb(e,t,s,r);if(!a)return;dt(l,a)}}function zy(l){return 1024*9e4/l}function nb(l,e){const t=Vy(l,e);if(e+t<=l.length){const s=$d(l,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function Yy(l,e,t,s,r){const a=zy(l.samplerate),u=s+r*a,c=nb(e,t);let h;if(c){const{frameLength:p,headerLength:y}=c,E=y+p,T=Math.max(0,t+E-e.length);T?(h=new Uint8Array(E-y),h.set(e.subarray(t+y,e.length),0)):h=e.subarray(t+y,t+E);const x={unit:h,pts:u};return T||l.samples.push(x),{sample:x,length:E,missing:T}}const d=e.length-t;return h=new Uint8Array(d),h.set(e.subarray(t,e.length),0),{sample:{unit:h,pts:u},length:d,missing:-1}}function rb(l,e){return Fd(l,e)&&gu(l,e+6)+10<=l.length-e}function ab(l){return l instanceof ArrayBuffer?l:l.byteOffset==0&&l.byteLength==l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer}function Ff(l,e=0,t=1/0){return lb(l,e,t,Uint8Array)}function lb(l,e,t,s){const r=ob(l);let a=1;"BYTES_PER_ELEMENT"in s&&(a=s.BYTES_PER_ELEMENT);const u=ub(l)?l.byteOffset:0,c=(u+l.byteLength)/a,h=(u+e)/a,d=Math.floor(Math.max(0,Math.min(h,c))),g=Math.floor(Math.min(d+Math.max(t,0),c));return new s(r,d,g-d)}function ob(l){return l instanceof ArrayBuffer?l:l.buffer}function ub(l){return l&&l.buffer instanceof ArrayBuffer&&l.byteLength!==void 0&&l.byteOffset!==void 0}function cb(l){const e={key:l.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(l.size<2)return;if(l.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=l.data.subarray(1).indexOf(0);if(s===-1)return;const r=Us(Ff(l.data,1,s)),a=l.data[2+s],u=l.data.subarray(3+s).indexOf(0);if(u===-1)return;const c=Us(Ff(l.data,3+s,u));let h;return r==="-->"?h=Us(Ff(l.data,4+s+u)):h=ab(l.data.subarray(4+s+u)),e.mimeType=r,e.pictureType=a,e.description=c,e.data=h,e}function fb(l){if(l.size<2)return;const e=Us(l.data,!0),t=new Uint8Array(l.data.subarray(e.length+1));return{key:l.type,info:e,data:t.buffer}}function db(l){if(l.size<2)return;if(l.type==="TXXX"){let t=1;const s=Us(l.data.subarray(t),!0);t+=s.length+1;const r=Us(l.data.subarray(t));return{key:l.type,info:s,data:r}}const e=Us(l.data.subarray(1));return{key:l.type,info:"",data:e}}function hb(l){if(l.type==="WXXX"){if(l.size<2)return;let t=1;const s=Us(l.data.subarray(t),!0);t+=s.length+1;const r=Us(l.data.subarray(t));return{key:l.type,info:s,data:r}}const e=Us(l.data);return{key:l.type,info:"",data:e}}function gb(l){return l.type==="PRIV"?fb(l):l.type[0]==="W"?hb(l):l.type==="APIC"?cb(l):db(l)}function mb(l){const e=String.fromCharCode(l[0],l[1],l[2],l[3]),t=gu(l,4),s=10;return{type:e,size:t,data:l.subarray(s,s+t)}}const Mo=10,pb=10;function qy(l){let e=0;const t=[];for(;Fd(l,e);){const s=gu(l,e+6);l[e+5]>>6&1&&(e+=Mo),e+=Mo;const r=e+s;for(;e+pb<r;){const a=mb(l.subarray(e)),u=gb(a);u&&t.push(u),e+=a.size+Mo}jy(l,e)&&(e+=Mo)}return t}function Xy(l){return l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp"}function yb(l){if(l.data.byteLength===8){const e=new Uint8Array(l.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function Gd(l){const e=qy(l);for(let t=0;t<e.length;t++){const s=e[t];if(Xy(s))return yb(s)}}let Ns=(function(l){return l.audioId3="org.id3",l.dateRange="com.apple.quicktime.HLS",l.emsg="https://aomedia.org/emsg/ID3",l.misbklv="urn:misb:KLV:bin:1910.1",l})({});function yi(l="",e=9e4){return{type:l,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class jd{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=Qs(this.cachedData,e),this.cachedData=null);let s=ul(e,0),r=s?s.length:0,a;const u=this._audioTrack,c=this._id3Track,h=s?Gd(s):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&Ee(h))&&(this.basePTS=vb(h,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:Ns.audioId3,duration:Number.POSITIVE_INFINITY});r<d;){if(this.canParse(e,r)){const g=this.appendFrame(u,e,r);g?(this.frameIndex++,this.lastPTS=g.sample.pts,r+=g.length,a=r):r=d}else rb(e,r)?(s=ul(e,r),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:Ns.audioId3,duration:Number.POSITIVE_INFINITY}),r+=s.length,a=r):r++;if(r===d&&a!==d){const g=e.slice(a);this.cachedData?this.cachedData=Qs(this.cachedData,g):this.cachedData=g}}return{audioTrack:u,videoTrack:yi(),id3Track:c,textTrack:yi()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:yi(),id3Track:this._id3Track,textTrack:yi()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const vb=(l,e,t)=>{if(Ee(l))return l*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let No=null;const Eb=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Tb=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Sb=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],xb=[0,1,1,4];function Qy(l,e,t,s,r){if(t+24>e.length)return;const a=Wy(e,t);if(a&&t+a.frameLength<=e.length){const u=a.samplesPerFrame*9e4/a.sampleRate,c=s+r*u,h={unit:e.subarray(t,t+a.frameLength),pts:c,dts:c};return l.config=[],l.channelCount=a.channelCount,l.samplerate=a.sampleRate,l.samples.push(h),{sample:h,length:a.frameLength,missing:0}}}function Wy(l,e){const t=l[e+1]>>3&3,s=l[e+1]>>1&3,r=l[e+2]>>4&15,a=l[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&a!==3){const u=l[e+2]>>1&1,c=l[e+3]>>6,h=t===3?3-s:s===3?3:4,d=Eb[h*14+r-1]*1e3,p=Tb[(t===3?0:t===2?1:2)*3+a],y=c===3?1:2,E=Sb[t][s],T=xb[s],x=E*8*T,S=Math.floor(E*d/p+u)*T;if(No===null){const A=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);No=A?parseInt(A[1]):0}return!!No&&No<=87&&s===2&&d>=224e3&&c===0&&(l[e+3]=l[e+3]|128),{sampleRate:p,channelCount:y,frameLength:S,samplesPerFrame:x}}}function Hd(l,e){return l[e]===255&&(l[e+1]&224)===224&&(l[e+1]&6)!==0}function Zy(l,e){return e+1<l.length&&Hd(l,e)}function bb(l,e){return Hd(l,e)&&4<=l.length-e}function Jy(l,e){if(e+1<l.length&&Hd(l,e)){const s=Wy(l,e);let r=4;s!=null&&s.frameLength&&(r=s.frameLength);const a=e+r;return a===l.length||Zy(l,a)}return!1}class Ab extends jd{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=ul(e,0);let r=(s==null?void 0:s.length)||0;if(Jy(e,r))return!1;for(let a=e.length;r<a;r++)if(ib(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return sb(e,t)}appendFrame(e,t,s){Ky(e,this.observer,t,s,e.manifestCodec);const r=Yy(e,t,s,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const ev=(l,e)=>{let t=0,s=5;e+=s;const r=new Uint32Array(1),a=new Uint32Array(1),u=new Uint8Array(1);for(;s>0;){u[0]=l[e];const c=Math.min(s,8),h=8-c;a[0]=4278190080>>>24+h<<h,r[0]=(u[0]&a[0])>>h,t=t?t<<c|r[0]:r[0],e+=1,s-=c}return t};class Lb extends jd{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const r=tv(e,t,s,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=ul(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&Gd(t)!==void 0&&ev(e,s)<16}}function tv(l,e,t,s,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const a=e[t+4]>>6;if(a>=3)return-1;const c=[48e3,44100,32e3][a],h=e[t+4]&63,g=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][h*3+a]*2;if(t+g>e.length)return-1;const p=e[t+6]>>5;let y=0;p===2?y+=2:(p&1&&p!==1&&(y+=2),p&4&&(y+=2));const E=(e[t+6]<<8|e[t+7])>>12-y&1,x=[2,1,2,3,3,4,4,5][p]+E,S=e[t+5]>>3,R=e[t+5]&7,_=new Uint8Array([a<<6|S<<1|R>>2,(R&3)<<6|p<<3|E<<2|h>>4,h<<4&224]),A=1536/c*9e4,C=s+r*A,k=e.subarray(t,t+g);return l.config=_,l.channelCount=x,l.samplerate=c,l.samples.push({unit:k,pts:C}),g}class Rb extends jd{resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=ul(e,0);let s=(t==null?void 0:t.length)||0;if(t&&e[s]===11&&e[s+1]===119&&Gd(t)!==void 0&&ev(e,s)<=16)return!1;for(let r=e.length;s<r;s++)if(Jy(e,s))return ot.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return bb(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return Qy(e,t,s,this.basePTS,this.frameIndex)}}const _b=/\/emsg[-/]ID3/i;class Ib{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,r){const a=this.videoTrack=yi("video",1),u=this.audioTrack=yi("audio",1),c=this.txtTrack=yi("text",1);if(this.id3Track=yi("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const h=gy(e);if(h.video){const{id:d,timescale:g,codec:p,supplemental:y}=h.video;a.id=d,a.timescale=c.timescale=g,a.codec=p,a.supplemental=y}if(h.audio){const{id:d,timescale:g,codec:p}=h.audio;u.id=d,u.timescale=g,u.codec=p}c.id=fy.text,a.sampleDuration=0,a.duration=u.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return LS(e)}demux(e,t){this.timeOffset=t;let s=e;const r=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=Qs(this.remainderData,e));const c=kS(s);this.remainderData=c.remainder,r.samples=c.valid||new Uint8Array}else r.samples=s;const u=this.extractID3Track(r,t);return a.samples=zm(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:u,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return s.samples=zm(e,t),{videoTrack:t,audioTrack:yi(),id3Track:r,textTrack:yi()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const r=je(e.samples,["emsg"]);r&&r.forEach(a=>{const u=OS(a);if(_b.test(u.schemeIdUri)){const c=Ip(u,t);let h=u.eventDuration===4294967295?Number.POSITIVE_INFINITY:u.eventDuration/u.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);const d=u.payload;s.samples.push({data:d,len:d.byteLength,dts:c,pts:c,type:Ns.emsg,duration:h})}else if(this.config.enableEmsgKLVMetadata&&u.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const c=Ip(u,t);s.samples.push({data:u.payload,len:u.payload.byteLength,dts:c,pts:c,type:Ns.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Ip(l,e){return Ee(l.presentationTime)?l.presentationTime/l.timeScale:e+l.presentationTimeDelta/l.timeScale}class Db{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new wd(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Ln.cbc)}decryptAacSample(e,t,s){const r=e[t].unit;if(r.length<=16)return;const a=r.subarray(16,r.length-r.length%16),u=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(u).then(c=>{const h=new Uint8Array(c);r.set(h,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let r=0;for(let a=32;a<e.length-16;a+=160,r+=16)s.set(e.subarray(a,a+16),r);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let r=0;for(let a=32;a<e.length-16;a+=160,r+=16)e.set(s.subarray(r,r+16),a);return e}decryptAvcSample(e,t,s,r,a){const u=py(a.data),c=this.getAvcEncryptedData(u);this.decryptBuffer(c.buffer).then(h=>{a.data=this.getAvcDecryptedUnit(u,h),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,r)}).catch(r)}decryptAvcSamples(e,t,s,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){r();return}const a=e[t].units;for(;!(s>=a.length);s++){const u=a[s];if(!(u.data.length<=48||u.type!==1&&u.type!==5)&&(this.decryptAvcSample(e,t,s,r,u),!this.decrypter.isSync()))return}}}}class sv{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,r;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const a=s.units;r=a[a.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,r=s.length;if(r){const a=s[r-1];e.pts=a.pts,e.dts=a.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const r=t.byteLength;let a=e.naluState||0;const u=a,c=[];let h=0,d,g,p,y=-1,E=0;for(a===-1&&(y=0,E=this.getNALuType(t,0),a=0,h=1);h<r;){if(d=t[h++],!a){a=d?0:1;continue}if(a===1){a=d?0:2;continue}if(!d)a=3;else if(d===1){if(g=h-a-1,y>=0){const T={data:t.subarray(y,g),type:E};c.push(T)}else{const T=this.getLastNalUnit(e.samples);T&&(u&&h<=4-u&&T.state&&(T.data=T.data.subarray(0,T.data.byteLength-u)),g>0&&(T.data=Qs(T.data,t.subarray(0,g)),T.state=0))}h<r?(p=this.getNALuType(t,h),y=h,E=p,a=0):a=-1}else a=0}if(y>=0&&a>=0){const T={data:t.subarray(y,r),type:E,state:a};c.push(T)}if(c.length===0){const T=this.getLastNalUnit(e.samples);T&&(T.data=Qs(T.data,t))}return e.naluState=a,c}}class tl{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,r=new Uint8Array(4),a=Math.min(4,t);if(a===0)throw new Error("no bytes available");r.set(e.subarray(s,s+a)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=a*8,this.bytesAvailable-=a}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&ot.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Cb extends sv{parsePES(e,t,s,r){const a=this.parseNALu(e,s.data,r);let u=this.VideoSample,c,h=!1;s.data=null,u&&a.length&&!e.audFound&&(this.pushAccessUnit(u,e),u=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.forEach(d=>{var g,p;switch(d.type){case 1:{let x=!1;c=!0;const S=d.data;if(h&&S.length>4){const R=this.readSliceType(S);(R===2||R===4||R===7||R===9)&&(x=!0)}if(x){var y;(y=u)!=null&&y.frame&&!u.key&&(this.pushAccessUnit(u,e),u=this.VideoSample=null)}u||(u=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),u.frame=!0,u.key=x;break}case 5:c=!0,(g=u)!=null&&g.frame&&!u.key&&(this.pushAccessUnit(u,e),u=this.VideoSample=null),u||(u=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),u.key=!0,u.frame=!0;break;case 6:{c=!0,Id(d.data,1,s.pts,t.samples);break}case 7:{var E,T;c=!0,h=!0;const x=d.data,S=this.readSPS(x);if(!e.sps||e.width!==S.width||e.height!==S.height||((E=e.pixelRatio)==null?void 0:E[0])!==S.pixelRatio[0]||((T=e.pixelRatio)==null?void 0:T[1])!==S.pixelRatio[1]){e.width=S.width,e.height=S.height,e.pixelRatio=S.pixelRatio,e.sps=[x];const R=x.subarray(1,4);let _="avc1.";for(let A=0;A<3;A++){let C=R[A].toString(16);C.length<2&&(C="0"+C),_+=C}e.codec=_}break}case 8:c=!0,e.pps=[d.data];break;case 9:c=!0,e.audFound=!0,(p=u)!=null&&p.frame&&(this.pushAccessUnit(u,e),u=null),u||(u=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:c=!0;break;default:c=!1;break}u&&c&&u.units.push(d)}),r&&u&&(this.pushAccessUnit(u,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new tl(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,r=8,a;for(let u=0;u<e;u++)r!==0&&(a=t.readEG(),r=(s+a+256)%256),s=r===0?s:r}readSPS(e){const t=new tl(e);let s=0,r=0,a=0,u=0,c,h,d;const g=t.readUByte.bind(t),p=t.readBits.bind(t),y=t.readUEG.bind(t),E=t.readBoolean.bind(t),T=t.skipBits.bind(t),x=t.skipEG.bind(t),S=t.skipUEG.bind(t),R=this.skipScalingList.bind(this);g();const _=g();if(p(5),T(3),g(),S(),_===100||_===110||_===122||_===244||_===44||_===83||_===86||_===118||_===128){const P=y();if(P===3&&T(1),S(),S(),T(1),E())for(h=P!==3?8:12,d=0;d<h;d++)E()&&(d<6?R(16,t):R(64,t))}S();const A=y();if(A===0)y();else if(A===1)for(T(1),x(),x(),c=y(),d=0;d<c;d++)x();S(),T(1);const C=y(),k=y(),G=p(1);G===0&&T(1),T(1),E()&&(s=y(),r=y(),a=y(),u=y());let w=[1,1];if(E()&&E())switch(g()){case 1:w=[1,1];break;case 2:w=[12,11];break;case 3:w=[10,11];break;case 4:w=[16,11];break;case 5:w=[40,33];break;case 6:w=[24,11];break;case 7:w=[20,11];break;case 8:w=[32,11];break;case 9:w=[80,33];break;case 10:w=[18,11];break;case 11:w=[15,11];break;case 12:w=[64,33];break;case 13:w=[160,99];break;case 14:w=[4,3];break;case 15:w=[3,2];break;case 16:w=[2,1];break;case 255:{w=[g()<<8|g(),g()<<8|g()];break}}return{width:Math.ceil((C+1)*16-s*2-r*2),height:(2-G)*(k+1)*16-(G?2:4)*(a+u),pixelRatio:w}}}class kb extends sv{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,r){const a=this.parseNALu(e,s.data,r);let u=this.VideoSample,c,h=!1;s.data=null,u&&a.length&&!e.audFound&&(this.pushAccessUnit(u,e),u=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.forEach(d=>{var g,p;switch(d.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:u||(u=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),u.frame=!0,c=!0;break;case 16:case 17:case 18:case 21:if(c=!0,h){var y;(y=u)!=null&&y.frame&&!u.key&&(this.pushAccessUnit(u,e),u=this.VideoSample=null)}u||(u=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),u.key=!0,u.frame=!0;break;case 19:case 20:c=!0,(g=u)!=null&&g.frame&&!u.key&&(this.pushAccessUnit(u,e),u=this.VideoSample=null),u||(u=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),u.key=!0,u.frame=!0;break;case 39:c=!0,Id(d.data,2,s.pts,t.samples);break;case 32:c=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=dt(e.params,this.readVPS(d.data)),this.initVPS=d.data),e.vps=[d.data];break;case 33:if(c=!0,h=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],d.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const E=this.readSPS(d.data);e.width=E.width,e.height=E.height,e.pixelRatio=E.pixelRatio,e.codec=E.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const T in E.params)e.params[T]=E.params[T]}this.pushParameterSet(e.sps,d.data,e.vps),u||(u=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),u.key=!0;break;case 34:if(c=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const E=this.readPPS(d.data);for(const T in E)e.params[T]=E[T]}this.pushParameterSet(e.pps,d.data,e.vps)}break;case 35:c=!0,e.audFound=!0,(p=u)!=null&&p.frame&&(this.pushAccessUnit(u,e),u=null),u||(u=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:c=!1;break}u&&c&&u.units.push(d)}),r&&u&&(this.pushAccessUnit(u,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[s]=e[r],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new tl(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:r}}readSPS(e){const t=new tl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const r=t.readBits(2),a=t.readBoolean(),u=t.readBits(5),c=t.readUByte(),h=t.readUByte(),d=t.readUByte(),g=t.readUByte(),p=t.readUByte(),y=t.readUByte(),E=t.readUByte(),T=t.readUByte(),x=t.readUByte(),S=t.readUByte(),R=t.readUByte(),_=[],A=[];for(let Fe=0;Fe<s;Fe++)_.push(t.readBoolean()),A.push(t.readBoolean());if(s>0)for(let Fe=s;Fe<8;Fe++)t.readBits(2);for(let Fe=0;Fe<s;Fe++)_[Fe]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),A[Fe]&&t.readUByte();t.readUEG();const C=t.readUEG();C==3&&t.skipBits(1);const k=t.readUEG(),G=t.readUEG(),w=t.readBoolean();let P=0,B=0,M=0,j=0;w&&(P+=t.readUEG(),B+=t.readUEG(),M+=t.readUEG(),j+=t.readUEG());const ee=t.readUEG(),oe=t.readUEG(),de=t.readUEG(),ce=t.readBoolean();for(let Fe=ce?0:s;Fe<=s;Fe++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let We=0;We<4;We++)for(let It=0;It<(We===3?2:6);It++)if(!t.readBoolean())t.readUEG();else{const st=Math.min(64,1<<4+(We<<1));We>1&&t.readEG();for(let as=0;as<st;as++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const te=t.readUEG();let ue=0;for(let Fe=0;Fe<te;Fe++){let We=!1;if(Fe!==0&&(We=t.readBoolean()),We){Fe===te&&t.readUEG(),t.readBoolean(),t.readUEG();let It=0;for(let ss=0;ss<=ue;ss++){const st=t.readBoolean();let as=!1;st||(as=t.readBoolean()),(st||as)&&It++}ue=It}else{const It=t.readUEG(),ss=t.readUEG();ue=It+ss;for(let st=0;st<It;st++)t.readUEG(),t.readBoolean();for(let st=0;st<ss;st++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Fe=t.readUEG();for(let We=0;We<Fe;We++){for(let It=0;It<de+4;It++)t.readBits(1);t.readBits(1)}}let $=0,Y=1,ie=1,fe=!0,ge=1,he=0;t.readBoolean(),t.readBoolean();let Pe=!1;if(t.readBoolean()){if(t.readBoolean()){const Wt=t.readUByte(),bs=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],se=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Wt>0&&Wt<16?(Y=bs[Wt-1],ie=se[Wt-1]):Wt===255&&(Y=t.readBits(16),ie=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Pe=t.readBoolean(),Pe&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ge=t.readBits(32),he=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const se=t.readBoolean(),ye=t.readBoolean();let Ae=!1;(se||ye)&&(Ae=t.readBoolean(),Ae&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Ae&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let pe=0;pe<=s;pe++){fe=t.readBoolean();const _e=fe||t.readBoolean();let Oe=!1;_e?t.readEG():Oe=t.readBoolean();const Ze=Oe?1:t.readUEG()+1;if(se)for(let xt=0;xt<Ze;xt++)t.readUEG(),t.readUEG(),Ae&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(ye)for(let xt=0;xt<Ze;xt++)t.readUEG(),t.readUEG(),Ae&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),$=t.readUEG())}let ht=k,tt=G;if(w){let Fe=1,We=1;C===1?Fe=We=2:C==2&&(Fe=2),ht=k-Fe*B-Fe*P,tt=G-We*j-We*M}const Pt=r?["A","B","C"][r]:"",xs=c<<24|h<<16|d<<8|g;let fs=0;for(let Fe=0;Fe<32;Fe++)fs=(fs|(xs>>Fe&1)<<31-Fe)>>>0;let Ut=fs.toString(16);return u===1&&Ut==="2"&&(Ut="6"),{codecString:`hvc1.${Pt}${u}.${Ut}.${a?"H":"L"}${R}.B0`,params:{general_tier_flag:a,general_profile_idc:u,general_profile_space:r,general_profile_compatibility_flags:[c,h,d,g],general_constraint_indicator_flags:[p,y,E,T,x,S],general_level_idc:R,bit_depth:ee+8,bit_depth_luma_minus8:ee,bit_depth_chroma_minus8:oe,min_spatial_segmentation_idc:$,chroma_format_idc:C,frame_rate:{fixed:fe,fps:he/ge}},width:ht,height:tt,pixelRatio:[Y,ie]}}readPPS(e){const t=new tl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),a=t.readBoolean();let u=1;return a&&r?u=0:a?u=3:r&&(u=2),{parallelismType:u}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Xt=188;class xn{constructor(e,t,s,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=r,this.videoParser=null}static probe(e,t){const s=xn.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(Xt*5,t-Xt)+1,r=0;for(;r<s;){let a=!1,u=-1,c=0;for(let h=r;h<t;h+=Xt)if(e[h]===71&&(t-h===Xt||e[h+Xt]===71)){if(c++,u===-1&&(u=h,u!==0&&(s=Math.min(u+Xt*99,e.length-Xt)+1)),a||(a=hd(e,h)===0),a&&c>1&&(u===0&&c>2||h+Xt>s))return u}else{if(c)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:fy[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=xn.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=xn.createTrack("audio",r),this._id3Track=xn.createTrack("id3"),this._txtTrack=xn.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,r=!1){s||(this.sampleAes=null);let a;const u=this._videoTrack,c=this._audioTrack,h=this._id3Track,d=this._txtTrack;let g=u.pid,p=u.pesData,y=c.pid,E=h.pid,T=c.pesData,x=h.pesData,S=null,R=this.pmtParsed,_=this._pmtId,A=e.length;if(this.remainderData&&(e=Qs(this.remainderData,e),A=e.length,this.remainderData=null),A<Xt&&!r)return this.remainderData=e,{audioTrack:c,videoTrack:u,id3Track:h,textTrack:d};const C=Math.max(0,xn.syncOffset(e));A-=(A-C)%Xt,A<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,A,e.buffer.byteLength-A));let k=0;for(let w=C;w<A;w+=Xt)if(e[w]===71){const P=!!(e[w+1]&64),B=hd(e,w),M=(e[w+3]&48)>>4;let j;if(M>1){if(j=w+5+e[w+4],j===w+Xt)continue}else j=w+4;switch(B){case g:P&&(p&&(a=$r(p,this.logger))&&(this.readyVideoParser(u.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(u,d,a,!1)),p={data:[],size:0}),p&&(p.data.push(e.subarray(j,w+Xt)),p.size+=w+Xt-j);break;case y:if(P){if(T&&(a=$r(T,this.logger)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,a);break;case"mp3":this.parseMPEGPES(c,a);break;case"ac3":this.parseAC3PES(c,a);break}T={data:[],size:0}}T&&(T.data.push(e.subarray(j,w+Xt)),T.size+=w+Xt-j);break;case E:P&&(x&&(a=$r(x,this.logger))&&this.parseID3PES(h,a),x={data:[],size:0}),x&&(x.data.push(e.subarray(j,w+Xt)),x.size+=w+Xt-j);break;case 0:P&&(j+=e[j]+1),_=this._pmtId=wb(e,j);break;case _:{P&&(j+=e[j]+1);const ee=Ob(e,j,this.typeSupported,s,this.observer,this.logger);g=ee.videoPid,g>0&&(u.pid=g,u.segmentCodec=ee.segmentVideoCodec),y=ee.audioPid,y>0&&(c.pid=y,c.segmentCodec=ee.segmentAudioCodec),E=ee.id3Pid,E>0&&(h.pid=E),S!==null&&!R&&(this.logger.warn(`MPEG-TS PMT found at ${w} after unknown PID '${S}'. Backtracking to sync byte @${C} to parse all TS packets.`),S=null,w=C-188),R=this.pmtParsed=!0;break}case 17:case 8191:break;default:S=B;break}}else k++;k>0&&gd(this.observer,new Error(`Found ${k} TS packet/s that do not start with 0x47`),void 0,this.logger),u.pesData=p,c.pesData=T,h.pesData=x;const G={audioTrack:c,videoTrack:u,id3Track:h,textTrack:d};return r&&this.extractRemainingSamples(G),G}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:r,textTrack:a}=e,u=s.pesData,c=t.pesData,h=r.pesData;let d;if(u&&(d=$r(u,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,a,d,!0),s.pesData=null)):s.pesData=u,c&&(d=$r(c,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,d);break;case"mp3":this.parseMPEGPES(t,d);break;case"ac3":this.parseAC3PES(t,d);break}t.pesData=null}else c!=null&&c.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=c;h&&(d=$r(h,this.logger))?(this.parseID3PES(r,d),r.pesData=null):r.pesData=h}demuxSampleAes(e,t,s){const r=this.demux(e,s,!0,!this.config.progressive),a=this.sampleAes=new Db(this.observer,this.config,t);return this.decrypt(r,a)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new Cb:e==="hevc"&&(this.videoParser=new kb))}decrypt(e,t){return new Promise(s=>{const{audioTrack:r,videoTrack:a}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{a.samples?t.decryptAvcSamples(a.samples,0,0,()=>{s(e)}):s(e)}):a.samples&&t.decryptAvcSamples(a.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const r=this.aacOverFlow;let a=t.data;if(r){this.aacOverFlow=null;const p=r.missing,y=r.sample.unit.byteLength;if(p===-1)a=Qs(r.sample.unit,a);else{const E=y-p;r.sample.unit.set(a.subarray(0,p),E),e.samples.push(r.sample),s=r.missing}}let u,c;for(u=s,c=a.length;u<c-1&&!cu(a,u);u++);if(u!==s){let p;const y=u<c-1;if(y?p=`AAC PES did not start with ADTS header,offset:${u}`:p="No ADTS header found in AAC PES",gd(this.observer,new Error(p),y,this.logger),!y)return}Ky(e,this.observer,a,u,this.audioCodec);let h;if(t.pts!==void 0)h=t.pts;else if(r){const p=zy(e.samplerate);h=r.sample.pts+p}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0,g;for(;u<c;)if(g=Yy(e,a,u,h,d),u+=g.length,g.missing){this.aacOverFlow=g;break}else for(d++;u<c-1&&!cu(a,u);u++);}parseMPEGPES(e,t){const s=t.data,r=s.length;let a=0,u=0;const c=t.pts;if(c===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;u<r;)if(Zy(s,u)){const h=Qy(e,s,u,c,a);if(h)u+=h.length,a++;else break}else u++}parseAC3PES(e,t){{const s=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const a=s.length;let u=0,c=0,h;for(;c<a&&(h=tv(e,s,c,r,u++))>0;)c+=h}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=dt({},t,{type:this._videoTrack?Ns.emsg:Ns.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function hd(l,e){return((l[e+1]&31)<<8)+l[e+2]}function wb(l,e){return(l[e+10]&31)<<8|l[e+11]}function Ob(l,e,t,s,r,a){const u={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},c=(l[e+1]&15)<<8|l[e+2],h=e+3+c-4,d=(l[e+10]&15)<<8|l[e+11];for(e+=12+d;e<h;){const g=hd(l,e),p=(l[e+3]&15)<<8|l[e+4];switch(l[e]){case 207:if(!s){$f("ADTS AAC",a);break}case 15:u.audioPid===-1&&(u.audioPid=g);break;case 21:u.id3Pid===-1&&(u.id3Pid=g);break;case 219:if(!s){$f("H.264",a);break}case 27:u.videoPid===-1&&(u.videoPid=g);break;case 3:case 4:!t.mpeg&&!t.mp3?a.log("MPEG audio found, not supported in this browser"):u.audioPid===-1&&(u.audioPid=g,u.segmentAudioCodec="mp3");break;case 193:if(!s){$f("AC-3",a);break}case 129:t.ac3?u.audioPid===-1&&(u.audioPid=g,u.segmentAudioCodec="ac3"):a.log("AC-3 audio found, not supported in this browser");break;case 6:if(u.audioPid===-1&&p>0){let y=e+5,E=p;for(;E>2;){switch(l[y]){case 106:t.ac3!==!0?a.log("AC-3 audio found, not supported in this browser for now"):(u.audioPid=g,u.segmentAudioCodec="ac3");break}const x=l[y+1]+2;y+=x,E-=x}}break;case 194:case 135:return gd(r,new Error("Unsupported EC-3 in M2TS found"),void 0,a),u;case 36:u.videoPid===-1&&(u.videoPid=g,u.segmentVideoCodec="hevc",a.log("HEVC in M2TS found"));break}e+=p+5}return u}function gd(l,e,t,s){s.warn(`parsing error: ${e.message}`),l.emit(b.ERROR,b.ERROR,{type:Le.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function $f(l,e){e.log(`${l} with AES-128-CBC encryption found in unencrypted stream`)}function $r(l,e){let t=0,s,r,a,u,c;const h=l.data;if(!l||l.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=Qs(h[0],h[1]),h.splice(1,1);if(s=h[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(r=(s[4]<<8)+s[5],r&&r>l.size-6)return null;const g=s[7];g&192&&(u=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,g&64?(c=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,u-c>60*9e4&&(e.warn(`${Math.round((u-c)/9e4)}s delta between PTS and DTS, align them`),u=c)):c=u),a=s[8];let p=a+9;if(l.size<=p)return null;l.size-=p;const y=new Uint8Array(l.size);for(let E=0,T=h.length;E<T;E++){s=h[E];let x=s.byteLength;if(p)if(p>x){p-=x;continue}else s=s.subarray(p),x-=p,p=0;y.set(s,t),t+=x}return r&&(r-=a+3),{data:y,pts:u,dts:c,len:r}}return null}class Mb{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const En=Math.pow(2,32)-1;class V{static init(){V.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in V.types)V.types.hasOwnProperty(e)&&(V.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);V.HDLR_TYPES={video:t,audio:s};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);V.STTS=V.STSC=V.STCO=a,V.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),V.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),V.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),V.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const u=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);V.FTYP=V.box(V.types.ftyp,u,h,u,c),V.DINF=V.box(V.types.dinf,V.box(V.types.dref,r))}static box(e,...t){let s=8,r=t.length;const a=r;for(;r--;)s+=t[r].byteLength;const u=new Uint8Array(s);for(u[0]=s>>24&255,u[1]=s>>16&255,u[2]=s>>8&255,u[3]=s&255,u.set(e,4),r=0,s=8;r<a;r++)u.set(t[r],s),s+=t[r].byteLength;return u}static hdlr(e){return V.box(V.types.hdlr,V.HDLR_TYPES[e])}static mdat(e){return V.box(V.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(En+1)),r=Math.floor(t%(En+1));return V.box(V.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return V.box(V.types.mdia,V.mdhd(e.timescale||0,e.duration||0),V.hdlr(e.type),V.minf(e))}static mfhd(e){return V.box(V.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?V.box(V.types.minf,V.box(V.types.smhd,V.SMHD),V.DINF,V.stbl(e)):V.box(V.types.minf,V.box(V.types.vmhd,V.VMHD),V.DINF,V.stbl(e))}static moof(e,t,s){return V.box(V.types.moof,V.mfhd(e),V.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=V.trak(e[t]);return V.box.apply(null,[V.types.moov,V.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(V.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=V.trex(e[t]);return V.box.apply(null,[V.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(En+1)),r=Math.floor(t%(En+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return V.box(V.types.mvhd,a)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let r,a;for(r=0;r<t.length;r++)a=t[r].flags,s[r+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy;return V.box(V.types.sdtp,s)}static stbl(e){return V.box(V.types.stbl,V.stsd(e),V.box(V.types.stts,V.STTS),V.box(V.types.stsc,V.STSC),V.box(V.types.stsz,V.STSZ),V.box(V.types.stco,V.STCO))}static avc1(e){let t=[],s=[],r,a,u;for(r=0;r<e.sps.length;r++)a=e.sps[r],u=a.byteLength,t.push(u>>>8&255),t.push(u&255),t=t.concat(Array.prototype.slice.call(a));for(r=0;r<e.pps.length;r++)a=e.pps[r],u=a.byteLength,s.push(u>>>8&255),s.push(u&255),s=s.concat(Array.prototype.slice.call(a));const c=V.box(V.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),h=e.width,d=e.height,g=e.pixelRatio[0],p=e.pixelRatio[1];return V.box(V.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,V.box(V.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),V.box(V.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return V.box(V.types.mp4a,V.audioStsd(e),V.box(V.types.esds,V.esds(e)))}static mp3(e){return V.box(V.types[".mp3"],V.audioStsd(e))}static ac3(e){return V.box(V.types["ac-3"],V.audioStsd(e),V.box(V.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return V.box(V.types.stsd,V.STSD,V.mp4a(e));if(t==="ac3"&&e.config)return V.box(V.types.stsd,V.STSD,V.ac3(e));if(t==="mp3"&&e.codec==="mp3")return V.box(V.types.stsd,V.STSD,V.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return V.box(V.types.stsd,V.STSD,V.avc1(e));if(t==="hevc"&&e.vps)return V.box(V.types.stsd,V.STSD,V.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),r=e.width||0,a=e.height||0,u=Math.floor(s/(En+1)),c=Math.floor(s%(En+1));return V.box(V.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,u>>24,u>>16&255,u>>8&255,u&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,a>>8&255,a&255,0,0]))}static traf(e,t){const s=V.sdtp(e),r=e.id,a=Math.floor(t/(En+1)),u=Math.floor(t%(En+1));return V.box(V.types.traf,V.box(V.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),V.box(V.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,u>>24,u>>16&255,u>>8&255,u&255])),V.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,V.box(V.types.trak,V.tkhd(e),V.mdia(e))}static trex(e){const t=e.id;return V.box(V.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],r=s.length,a=12+16*r,u=new Uint8Array(a);let c,h,d,g,p,y;for(t+=8+a,u.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),c=0;c<r;c++)h=s[c],d=h.duration,g=h.size,p=h.flags,y=h.cts,u.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,y>>>24&255,y>>>16&255,y>>>8&255,y&255],12+16*c);return V.box(V.types.trun,u)}static initSegment(e){V.types||V.init();const t=V.moov(e);return Qs(V.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],r=4,a=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let u=a.length;for(let T=0;T<s.length;T+=1){u+=3;for(let x=0;x<s[T].length;x+=1)u+=2+s[T][x].length}const c=new Uint8Array(u);c.set(a,0),u=a.length;const h=s.length-1;for(let T=0;T<s.length;T+=1){c.set(new Uint8Array([32+T|(T===h?128:0),0,s[T].length]),u),u+=3;for(let x=0;x<s[T].length;x+=1)c.set(new Uint8Array([s[T][x].length>>8,s[T][x].length&255]),u),u+=2,c.set(s[T][x],u),u+=s[T][x].length}const d=V.box(V.types.hvcC,c),g=e.width,p=e.height,y=e.pixelRatio[0],E=e.pixelRatio[1];return V.box(V.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,g>>8&255,g&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,V.box(V.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),V.box(V.types.pasp,new Uint8Array([y>>24,y>>16&255,y>>8&255,y&255,E>>24,E>>16&255,E>>8&255,E&255])))}}V.types=void 0;V.HDLR_TYPES=void 0;V.STTS=void 0;V.STSC=void 0;V.STCO=void 0;V.STSZ=void 0;V.VMHD=void 0;V.SMHD=void 0;V.STSD=void 0;V.FTYP=void 0;V.DINF=void 0;const iv=9e4;function Vd(l,e,t=1,s=!1){const r=l*e*t;return s?Math.round(r):r}function Nb(l,e,t=1,s=!1){return Vd(l,e,1/t,s)}function Za(l,e=!1){return Vd(l,1e3,1/iv,e)}function Pb(l,e=1){return Vd(l,iv,1/e)}const Ub=10*1e3,Bb=1024,Fb=1152,$b=1536;let Gr=null,Gf=null;function Dp(l,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:l?2:1,isNonSync:l?0:1}}}class Qo extends Ws{constructor(e,t,s,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,Gr===null){const u=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Gr=u?parseInt(u[1]):0}if(Gf===null){const a=navigator.userAgent.match(/Safari\/(\d+)/i);Gf=a?parseInt(a[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,r=e.reduce((a,u)=>{let c=u.pts,h=c-a;return h<-4294967296&&(t=!0,c=Xs(c,s),h=c-a),h>0?a:c},s);return t&&this.debug("PTS rollover detected"),r}remux(e,t,s,r,a,u,c,h){let d,g,p,y,E,T,x=a,S=a;const R=e.pid>-1,_=t.pid>-1,A=t.samples.length,C=e.samples.length>0,k=c&&A>0||A>1;if((!R||C)&&(!_||k)||this.ISGenerated||c){if(this.ISGenerated){var w,P,B,M;const de=this.videoTrackConfig;(de&&(t.width!==de.width||t.height!==de.height||((w=t.pixelRatio)==null?void 0:w[0])!==((P=de.pixelRatio)==null?void 0:P[0])||((B=t.pixelRatio)==null?void 0:B[1])!==((M=de.pixelRatio)==null?void 0:M[1]))||!de&&k||this.nextAudioTs===null&&C)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(e,t,a,u));const j=this.isVideoContiguous;let ee=-1,oe;if(k&&(ee=Gb(t.samples),!j&&this.config.forceKeyFrameOnDiscontinuity))if(T=!0,ee>0){this.warn(`Dropped ${ee} out of ${A} video samples due to a missing keyframe`);const de=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(ee),t.dropped+=ee,S+=(t.samples[0].pts-de)/t.inputTimeScale,oe=S}else ee===-1&&(this.warn(`No keyframe found out of ${A} video samples`),T=!1);if(this.ISGenerated){if(C&&k){const de=this.getVideoStartPts(t.samples),U=(Xs(e.samples[0].pts,de)-de)/t.inputTimeScale;x+=Math.max(0,U),S+=Math.max(0,-U)}if(C){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),p=this.generateIS(e,t,a,u)),g=this.remuxAudio(e,x,this.isAudioContiguous,u,_||k||h===Te.AUDIO?S:void 0),k){const de=g?g.endPTS-g.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),p=this.generateIS(e,t,a,u)),d=this.remuxVideo(t,S,j,de)}}else k&&(d=this.remuxVideo(t,S,j,0));d&&(d.firstKeyFrame=ee,d.independent=ee!==-1,d.firstKeyFramePTS=oe)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(E=nv(s,a,this._initPTS,this._initDTS)),r.samples.length&&(y=rv(r,a,this._initPTS))),{audio:g,video:d,initSegment:p,independent:T,text:y,id3:E}}generateIS(e,t,s,r){const a=e.samples,u=t.samples,c=this.typeSupported,h={},d=this._initPTS;let g=!d||r,p="audio/mp4",y,E,T,x=-1;if(g&&(y=E=1/0),e.config&&a.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(p="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}h.audio={id:"audio",container:p,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):V.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(x=e.id,T=e.inputTimeScale,!d||T!==d.timescale?y=E=a[0].pts-Math.round(T*s):g=!1)}if(t.sps&&t.pps&&u.length){if(t.timescale=t.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:V.initSegment([t]),metadata:{width:t.width,height:t.height}},g)if(x=t.id,T=t.inputTimeScale,!d||T!==d.timescale){const S=this.getVideoStartPts(u),R=Math.round(T*s);E=Math.min(E,Xs(u[0].dts,S)-R),y=Math.min(y,S-R)}else g=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(h).length)return this.ISGenerated=!0,g?(d&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${s} ${y/T} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${y/T} (${y}/${T}) trackId: ${x}`),this._initPTS={baseTime:y,timescale:T,trackId:x},this._initDTS={baseTime:E,timescale:T,trackId:x}):y=T=void 0,{tracks:h,initPTS:y,timescale:T,trackId:x}}remuxVideo(e,t,s,r){const a=e.inputTimeScale,u=e.samples,c=[],h=u.length,d=this._initPTS,g=d.baseTime*a/d.timescale;let p=this.nextVideoTs,y=8,E=this.videoSampleDuration,T,x,S=Number.POSITIVE_INFINITY,R=Number.NEGATIVE_INFINITY,_=!1;if(!s||p===null){const $=g+t*a,Y=u[0].pts-Xs(u[0].dts,u[0].pts);Gr&&p!==null&&Math.abs($-Y-(p+g))<15e3?s=!0:p=$-Y-g}const A=p+g;for(let $=0;$<h;$++){const Y=u[$];Y.pts=Xs(Y.pts,A),Y.dts=Xs(Y.dts,A),Y.dts<u[$>0?$-1:$].dts&&(_=!0)}_&&u.sort(function($,Y){const ie=$.dts-Y.dts,fe=$.pts-Y.pts;return ie||fe}),T=u[0].dts,x=u[u.length-1].dts;const C=x-T,k=C?Math.round(C/(h-1)):E||e.inputTimeScale/30;if(s){const $=T-A,Y=$>k,ie=$<-1;if((Y||ie)&&(Y?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Za($,!0)} ms (${$}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Za(-$,!0)} ms (${$}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!ie||A>=u[0].pts||Gr)){T=A;const fe=u[0].pts-$;if(Y)u[0].dts=T,u[0].pts=fe;else{let ge=!0;for(let he=0;he<u.length&&!(u[he].dts>fe&&ge);he++){const Pe=u[he].pts;if(u[he].dts-=$,u[he].pts-=$,he<u.length-1){const be=u[he+1].pts,ht=u[he].pts,tt=be<=ht,Pt=be<=Pe;ge=tt==Pt}}}this.log(`Video: Initial PTS/DTS adjusted: ${Za(fe,!0)}/${Za(T,!0)}, delta: ${Za($,!0)} ms`)}}T=Math.max(0,T);let G=0,w=0,P=T;for(let $=0;$<h;$++){const Y=u[$],ie=Y.units,fe=ie.length;let ge=0;for(let he=0;he<fe;he++)ge+=ie[he].data.length;w+=ge,G+=fe,Y.length=ge,Y.dts<P?(Y.dts=P,P+=k/4|0||1):P=Y.dts,S=Math.min(Y.pts,S),R=Math.max(Y.pts,R)}x=u[h-1].dts;const B=w+4*G+8;let M;try{M=new Uint8Array(B)}catch($){this.observer.emit(b.ERROR,b.ERROR,{type:Le.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:$,bytes:B,reason:`fail allocating video mdat ${B}`});return}const j=new DataView(M.buffer);j.setUint32(0,B),M.set(V.types.mdat,4);let ee=!1,oe=Number.POSITIVE_INFINITY,de=Number.POSITIVE_INFINITY,ce=Number.NEGATIVE_INFINITY,U=Number.NEGATIVE_INFINITY;for(let $=0;$<h;$++){const Y=u[$],ie=Y.units;let fe=0;for(let Pe=0,be=ie.length;Pe<be;Pe++){const ht=ie[Pe],tt=ht.data,Pt=ht.data.byteLength;j.setUint32(y,Pt),y+=4,M.set(tt,y),y+=Pt,fe+=4+Pt}let ge;if($<h-1)E=u[$+1].dts-Y.dts,ge=u[$+1].pts-Y.pts;else{const Pe=this.config,be=$>0?Y.dts-u[$-1].dts:k;if(ge=$>0?Y.pts-u[$-1].pts:k,Pe.stretchShortVideoTrack&&this.nextAudioTs!==null){const ht=Math.floor(Pe.maxBufferHole*a),tt=(r?S+r*a:this.nextAudioTs+g)-Y.pts;tt>ht?(E=tt-be,E<0?E=be:ee=!0,this.log(`It is approximately ${tt/90} ms to the next segment; using duration ${E/90} ms for the last video frame.`)):E=be}else E=be}const he=Math.round(Y.pts-Y.dts);oe=Math.min(oe,E),ce=Math.max(ce,E),de=Math.min(de,ge),U=Math.max(U,ge),c.push(Dp(Y.key,E,fe,he))}if(c.length){if(Gr){if(Gr<70){const $=c[0].flags;$.dependsOn=2,$.isNonSync=0}}else if(Gf&&U-de<ce-oe&&k/ce<.025&&c[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let $=T;for(let Y=0,ie=c.length;Y<ie;Y++){const fe=$+c[Y].duration,ge=$+c[Y].cts;if(Y<ie-1){const he=fe+c[Y+1].cts;c[Y].duration=he-ge}else c[Y].duration=Y?c[Y-1].duration:k;c[Y].cts=0,$=fe}}}E=ee||!E?k:E;const X=x+E;this.nextVideoTs=p=X-g,this.videoSampleDuration=E,this.isVideoContiguous=!0;const O={data1:V.moof(e.sequenceNumber++,T,dt(e,{samples:c})),data2:M,startPTS:(S-g)/a,endPTS:(R+E-g)/a,startDTS:(T-g)/a,endDTS:p/a,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,O}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return Fb;case"ac3":return $b;default:return Bb}}remuxAudio(e,t,s,r,a){const u=e.inputTimeScale,c=e.samplerate?e.samplerate:u,h=u/c,d=this.getSamplesPerFrame(e),g=d*h,p=this._initPTS,y=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,E=[],T=a!==void 0;let x=e.samples,S=y?0:8,R=this.nextAudioTs||-1;const _=p.baseTime*u/p.timescale,A=_+t*u;if(this.isAudioContiguous=s=s||x.length&&R>0&&(r&&Math.abs(A-(R+_))<9e3||Math.abs(Xs(x[0].pts,A)-(R+_))<20*g),x.forEach(function(U){U.pts=Xs(U.pts,A)}),!s||R<0){if(x=x.filter(U=>U.pts>=0),!x.length)return;a===0?R=0:r&&!T?R=Math.max(0,A-_):R=x[0].pts-_}if(e.segmentCodec==="aac"){const U=this.config.maxAudioFramesDrift;for(let X=0,te=R+_;X<x.length;X++){const ue=x[X],O=ue.pts,$=O-te,Y=Math.abs(1e3*$/u);if($<=-U*g&&T)X===0&&(this.warn(`Audio frame @ ${(O/u).toFixed(3)}s overlaps marker by ${Math.round(1e3*$/u)} ms.`),this.nextAudioTs=R=O-_,te=O);else if($>=U*g&&Y<Ub&&T){let ie=Math.round($/g);for(te=O-ie*g;te<0&&ie&&g;)ie--,te+=g;X===0&&(this.nextAudioTs=R=te-_),this.warn(`Injecting ${ie} audio frames @ ${((te-_)/u).toFixed(3)}s due to ${Math.round(1e3*$/u)} ms gap.`);for(let fe=0;fe<ie;fe++){let ge=Mb.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ge||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ge=ue.unit.subarray()),x.splice(X,0,{unit:ge,pts:te}),te+=g,X++}}ue.pts=te,te+=g}}let C=null,k=null,G,w=0,P=x.length;for(;P--;)w+=x[P].unit.byteLength;for(let U=0,X=x.length;U<X;U++){const te=x[U],ue=te.unit;let O=te.pts;if(k!==null){const Y=E[U-1];Y.duration=Math.round((O-k)/h)}else if(s&&e.segmentCodec==="aac"&&(O=R+_),C=O,w>0){w+=S;try{G=new Uint8Array(w)}catch(Y){this.observer.emit(b.ERROR,b.ERROR,{type:Le.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:Y,bytes:w,reason:`fail allocating audio mdat ${w}`});return}y||(new DataView(G.buffer).setUint32(0,w),G.set(V.types.mdat,4))}else return;G.set(ue,S);const $=ue.byteLength;S+=$,E.push(Dp(!0,d,$,0)),k=O}const B=E.length;if(!B)return;const M=E[E.length-1];R=k-_,this.nextAudioTs=R+h*M.duration;const j=y?new Uint8Array(0):V.moof(e.sequenceNumber++,C/h,dt({},e,{samples:E}));e.samples=[];const ee=(C-_)/u,oe=R/u,ce={data1:j,data2:G,startPTS:ee,endPTS:oe,startDTS:ee,endDTS:oe,type:"audio",hasAudio:!0,hasVideo:!1,nb:B};return this.isAudioContiguous=!0,ce}}function Xs(l,e){let t;if(e===null)return l;for(e<l?t=-8589934592:t=8589934592;Math.abs(l-e)>4294967296;)l+=t;return l}function Gb(l){for(let e=0;e<l.length;e++)if(l[e].key)return e;return-1}function nv(l,e,t,s){const r=l.samples.length;if(!r)return;const a=l.inputTimeScale;for(let c=0;c<r;c++){const h=l.samples[c];h.pts=Xs(h.pts-t.baseTime*a/t.timescale,e*a)/a,h.dts=Xs(h.dts-s.baseTime*a/s.timescale,e*a)/a}const u=l.samples;return l.samples=[],{samples:u}}function rv(l,e,t){const s=l.samples.length;if(!s)return;const r=l.inputTimeScale;for(let u=0;u<s;u++){const c=l.samples[u];c.pts=Xs(c.pts-t.baseTime*r/t.timescale,e*r)/r}l.samples.sort((u,c)=>u.pts-c.pts);const a=l.samples;return l.samples=[],{samples:a}}class jb extends Ws{constructor(e,t,s,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,r){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:a,video:u}=this.initData=gy(e);if(t)DS(e,t);else{const h=a||u;h!=null&&h.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${h.codec}")!`)}a&&(s=Cp(a,yt.AUDIO,this)),u&&(r=Cp(u,yt.VIDEO,this));const c={};a&&u?c.audiovideo={container:"video/mp4",codec:s+","+r,supplemental:u.supplemental,encrypted:u.encrypted,initSegment:e,id:"main"}:a?c.audio={container:"audio/mp4",codec:s,encrypted:a.encrypted,initSegment:e,id:"audio"}:u?c.video={container:"video/mp4",codec:r,supplemental:u.supplemental,encrypted:u.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=c}remux(e,t,s,r,a,u){var c,h;let{initPTS:d,lastEndTime:g}=this;const p={audio:void 0,video:void 0,text:r,id3:s,initSegment:void 0};Ee(g)||(g=this.lastEndTime=a||0);const y=t.samples;if(!y.length)return p;const E={initPTS:void 0,timescale:void 0,trackId:void 0};let T=this.initData;if((c=T)!=null&&c.length||(this.generateInitSegment(y),T=this.initData),!((h=T)!=null&&h.length))return this.warn("Failed to generate initSegment."),p;this.emitInitSegment&&(E.tracks=this.initTracks,this.emitInitSegment=!1);const x=CS(y,T,this),S=T.audio?x[T.audio.id]:null,R=T.video?x[T.video.id]:null,_=Po(R,1/0),A=Po(S,1/0),C=Po(R,0,!0),k=Po(S,0,!0);let G=a,w=0;const P=S&&(!R||!d&&A<_||d&&d.trackId===T.audio.id),B=P?S:R;if(B){const te=B.timescale,ue=B.start-a*te,O=P?T.audio.id:T.video.id;G=B.start/te,w=P?k-A:C-_,(u||!d)&&(Hb(d,G,a,w)||te!==d.timescale)&&(d&&this.warn(`Timestamps at playlist time: ${u?"":"~"}${a} ${ue/te} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${a} offset: ${G-a} (${ue}/${te}) trackId: ${O}`),d=null,E.initPTS=ue,E.timescale=te,E.trackId=O)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${a}`);d?(E.initPTS=d.baseTime,E.timescale=d.timescale,E.trackId=d.trackId):((!E.timescale||E.trackId===void 0||E.initPTS===void 0)&&(this.warn("Could not set initPTS"),E.initPTS=G,E.timescale=1,E.trackId=-1),this.initPTS=d={baseTime:E.initPTS,timescale:E.timescale,trackId:E.trackId});const M=G-d.baseTime/d.timescale,j=M+w;w>0?this.lastEndTime=j:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const ee=!!T.audio,oe=!!T.video;let de="";ee&&(de+="audio"),oe&&(de+="video");const ce=(T.audio?T.audio.encrypted:!1)||(T.video?T.video.encrypted:!1),U={data1:y,startPTS:M,startDTS:M,endPTS:j,endDTS:j,type:de,hasAudio:ee,hasVideo:oe,nb:1,dropped:0,encrypted:ce};p.audio=ee&&!oe?U:void 0,p.video=oe?U:void 0;const X=R==null?void 0:R.sampleCount;if(X){const te=R.keyFrameIndex,ue=te!==-1;U.nb=X,U.dropped=te===0||this.isVideoContiguous?0:ue?te:X,U.independent=ue,U.firstKeyFrame=te,ue&&R.keyFrameStart&&(U.firstKeyFramePTS=(R.keyFrameStart-d.baseTime)/d.timescale),this.isVideoContiguous||(p.independent=ue),this.isVideoContiguous||(this.isVideoContiguous=ue),U.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${te}/${X} dropped: ${U.dropped} start: ${U.firstKeyFramePTS||"NA"}`)}return p.initSegment=E,p.id3=nv(s,a,d,d),r.samples.length&&(p.text=rv(r,a,d)),p}}function Po(l,e,t=!1){return(l==null?void 0:l.start)!==void 0?(l.start+(t?l.duration:0))/l.timescale:e}function Hb(l,e,t,s){if(l===null)return!0;const r=Math.max(s,1),a=e-l.baseTime/l.timescale;return Math.abs(a-t)>r}function Cp(l,e,t){const s=l.codec;return s&&s.length>4?s:e===yt.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?iu(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let Hi;try{Hi=self.performance.now.bind(self.performance)}catch(l){Hi=Date.now}const Wo=[{demux:Ib,remux:jb},{demux:xn,remux:Qo},{demux:Ab,remux:Qo},{demux:Rb,remux:Qo}];Wo.splice(2,0,{demux:Lb,remux:Qo});class kp{constructor(e,t,s,r,a,u){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=a,this.logger=u}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,r){const a=s.transmuxing;a.executeStart=Hi();let u=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:h}=this;r&&(this.currentTransmuxState=r);const{contiguous:d,discontinuity:g,trackSwitch:p,accurateTimeOffset:y,timeOffset:E,initSegmentChange:T}=r||c,{audioCodec:x,videoCodec:S,defaultInitPts:R,duration:_,initSegmentData:A}=h,C=Vb(u,t);if(C&&zr(C.method)){const P=this.getDecrypter(),B=Nd(C.method);if(P.isSync()){let M=P.softwareDecrypt(u,C.key.buffer,C.iv.buffer,B);if(s.part>-1){const ee=P.flush();M=ee&&ee.buffer}if(!M)return a.executeEnd=Hi(),jf(s);u=new Uint8Array(M)}else return this.asyncResult=!0,this.decryptionPromise=P.webCryptoDecrypt(u,C.key.buffer,C.iv.buffer,B).then(M=>{const j=this.push(M,null,s);return this.decryptionPromise=null,j}),this.decryptionPromise}const k=this.needsProbing(g,p);if(k){const P=this.configureTransmuxer(u);if(P)return this.logger.warn(`[transmuxer] ${P.message}`),this.observer.emit(b.ERROR,b.ERROR,{type:Le.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:P,reason:P.message}),a.executeEnd=Hi(),jf(s)}(g||p||T||k)&&this.resetInitSegment(A,x,S,_,t),(g||T||k)&&this.resetInitialTimestamp(R),d||this.resetContiguity();const G=this.transmux(u,C,E,y,s);this.asyncResult=cl(G);const w=this.currentTransmuxState;return w.contiguous=!0,w.discontinuity=!1,w.trackSwitch=!1,a.executeEnd=Hi(),G}flush(e){const t=e.transmuxing;t.executeStart=Hi();const{decrypter:s,currentTransmuxState:r,decryptionPromise:a}=this;if(a)return this.asyncResult=!0,a.then(()=>this.flush(e));const u=[],{timeOffset:c}=r;if(s){const p=s.flush();p&&u.push(this.push(p.buffer,null,e))}const{demuxer:h,remuxer:d}=this;if(!h||!d){t.executeEnd=Hi();const p=[jf(e)];return this.asyncResult?Promise.resolve(p):p}const g=h.flush(c);return cl(g)?(this.asyncResult=!0,g.then(p=>(this.flushRemux(u,p,e),u))):(this.flushRemux(u,g,e),this.asyncResult?Promise.resolve(u):u)}flushRemux(e,t,s){const{audioTrack:r,videoTrack:a,id3Track:u,textTrack:c}=t,{accurateTimeOffset:h,timeOffset:d}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===Te.MAIN?"level":"track"} ${s.level}`);const g=this.remuxer.remux(r,a,u,c,d,h,!0,this.id);e.push({remuxResult:g,chunkMeta:s}),s.transmuxing.executeEnd=Hi()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,r,a){const{demuxer:u,remuxer:c}=this;!u||!c||(u.resetInitSegment(e,t,s,r),c.resetInitSegment(e,t,s,a))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,r,a){let u;return t&&t.method==="SAMPLE-AES"?u=this.transmuxSampleAes(e,t,s,r,a):u=this.transmuxUnencrypted(e,s,r,a),u}transmuxUnencrypted(e,t,s,r){const{audioTrack:a,videoTrack:u,id3Track:c,textTrack:h}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(a,u,c,h,t,s,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,s,r,a){return this.demuxer.demuxSampleAes(e,t,s).then(u=>({remuxResult:this.remuxer.remux(u.audioTrack,u.videoTrack,u.id3Track,u.textTrack,s,r,!1,this.id),chunkMeta:a}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:r}=this;let a;for(let p=0,y=Wo.length;p<y;p++){var u;if((u=Wo[p].demux)!=null&&u.probe(e,this.logger)){a=Wo[p];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");const c=this.demuxer,h=this.remuxer,d=a.remux,g=a.demux;(!h||!(h instanceof d))&&(this.remuxer=new d(s,t,r,this.logger)),(!c||!(c instanceof g))&&(this.demuxer=new g(s,t,r,this.logger),this.probe=g.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new wd(this.config)),e}}function Vb(l,e){let t=null;return l.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const jf=l=>({remuxResult:{},chunkMeta:l});function cl(l){return"then"in l&&l.then instanceof Function}class Kb{constructor(e,t,s,r,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=r,this.defaultInitPts=a||null}}class zb{constructor(e,t,s,r,a,u){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=r,this.timeOffset=a,this.initSegmentChange=u}}let wp=0;class av{constructor(e,t,s,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=wp++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=h=>{const d=h.data,g=this.hls;if(!(!g||!(d!=null&&d.event)||d.instanceNo!==this.instanceNo))switch(d.event){case"init":{var p;const y=(p=this.workerContext)==null?void 0:p.objectURL;y&&self.URL.revokeObjectURL(y);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":{g.logger[d.data.logType]&&g.logger[d.data.logType](d.data.message);break}default:{d.data=d.data||{},d.data.frag=this.frag,d.data.part=this.part,d.data.id=this.id,g.trigger(d.event,d.data);break}}},this.onWorkerError=h=>{if(!this.hls)return;const d=new Error(`${h.message}  (${h.filename}:${h.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(b.ERROR,{type:Le.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})};const a=e.config;this.hls=e,this.id=t,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=s,this.onFlush=r;const u=(h,d)=>{d=d||{},d.frag=this.frag||void 0,h===b.ERROR&&(d=d,d.parent=this.id,d.part=this.part,this.error=d.error),this.hls.trigger(h,d)};this.observer=new Bd,this.observer.on(b.FRAG_DECRYPTED,u),this.observer.on(b.ERROR,u);const c=Xm(a.preferManagedMediaSource);if(this.useWorker&&typeof Worker!="undefined"){const h=this.hls.logger;if(a.workerPath||Qx()){try{a.workerPath?(h.log(`loading Web Worker ${a.workerPath} for "${t}"`),this.workerContext=Zx(a.workerPath)):(h.log(`injecting Web Worker for "${t}"`),this.workerContext=Wx());const{worker:g}=this.workerContext;g.addEventListener("message",this.onWorkerMessage),g.addEventListener("error",this.onWorkerError),g.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:c,id:t,config:vt(a)})}catch(g){h.warn(`Error setting up "${t}" Web Worker, fallback to inline`,g),this.terminateWorker(),this.error=null,this.transmuxer=new kp(this.observer,c,a,"",t,e.logger)}return}}this.transmuxer=new kp(this.observer,c,a,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=wp++;const t=this.hls.config,s=Xm(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:vt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Jx(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,r,a,u,c,h,d,g){var p,y;d.transmuxing.start=self.performance.now();const{instanceNo:E,transmuxer:T}=this,x=u?u.start:a.start,S=a.decryptdata,R=this.frag,_=!(R&&a.cc===R.cc),A=!(R&&d.level===R.level),C=R?d.sn-R.sn:-1,k=this.part?d.part-this.part.index:-1,G=C===0&&d.id>1&&d.id===(R==null?void 0:R.stats.chunkCount),w=!A&&(C===1||C===0&&(k===1||G&&k<=0)),P=self.performance.now();(A||C||a.stats.parsing.start===0)&&(a.stats.parsing.start=P),u&&(k||!w)&&(u.stats.parsing.start=P);const B=!(R&&((p=a.initSegment)==null?void 0:p.url)===((y=R.initSegment)==null?void 0:y.url)),M=new zb(_,w,h,A,x,B);if(!w||_||B){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${a.type} sn: ${d.sn}${d.part>-1?" part: "+d.part:""} ${this.id===Te.MAIN?"level":"track"}: ${d.level} id: ${d.id}
        discontinuity: ${_}
        trackSwitch: ${A}
        contiguous: ${w}
        accurateTimeOffset: ${h}
        timeOffset: ${x}
        initSegmentChange: ${B}`);const j=new Kb(s,r,t,c,g);this.configureTransmuxer(j)}if(this.frag=a,this.part=u,this.workerContext)this.workerContext.worker.postMessage({instanceNo:E,cmd:"demux",data:e,decryptdata:S,chunkMeta:d,state:M},e instanceof ArrayBuffer?[e]:[]);else if(T){const j=T.push(e,S,d,M);cl(j)?j.then(ee=>{this.handleTransmuxComplete(ee)}).catch(ee=>{this.transmuxerError(ee,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(j)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const r=s.flush(e);cl(r)?r.then(a=>{this.handleFlushResult(a,e)}).catch(a=>{this.transmuxerError(a,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(b.ERROR,{type:Le.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Op=100;class Yb extends Ud{constructor(e,t,s){super(e,t,s,"audio-stream-controller",Te.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(b.BUFFER_RESET,this.onBufferReset,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(b.BUFFER_RESET,this.onBufferReset,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:r,timescale:a,trackId:u}){if(s===Te.MAIN){const c=t.cc,h=this.fragCurrent;if(this.initPTS[c]={baseTime:r,timescale:a,trackId:u},this.log(`InitPTS for cc: ${c} found from main: ${r/a} (${r}/${a}) trackId: ${u}`),this.mainAnchor=t,this.state===re.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==c)&&this.syncWithAnchor(t,d==null?void 0:d.frag)}else!this.hls.hasEnoughToStart&&h&&h.cc!==c?(h.abortRequests(),this.syncWithAnchor(t,h)):this.state===re.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const r=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&(r==null?void 0:r.cc)===t.cc)return;const a=(r||e).cc,u=this.getLevelDetails(),c=this.getLoadPosition(),h=Ay(u,a,c);h&&(this.log(`Syncing with main frag at ${h.start} cc ${h.cc}`),this.startFragRequested=!1,this.nextLoadPosition=h.start,this.resetLoadingState(),this.state===re.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=re.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(Op),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=re.IDLE):this.state=re.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case re.IDLE:this.doTickIdle();break;case re.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=e==null?void 0:e[t],r=s==null?void 0:s.details;if(r&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(r))break;this.state=re.WAITING_INIT_PTS}break}case re.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case re.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:r,complete:a}=e,u=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=re.FRAG_LOADING;const c=r.flush().buffer,h={frag:t,part:s,payload:c,networkDetails:null};this._handleFragmentLoadProgress(h),a&&super._handleFragmentLoadComplete(h)}else u&&u.cc!==e.frag.cc&&this.syncWithAnchor(u,e.frag)}else this.state=re.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:r,trackId:a}=this,u=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!u.startFragPrefetch)||!(s!=null&&s[a]))return;const c=s[a],h=c.details;if(!h||this.waitForLive(c)||this.waitForCdnTuneIn(h)){this.state=re.WAITING_TRACK,this.startFragRequested=!1;return}const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,yt.AUDIO,Te.AUDIO));const g=this.getFwdBufferInfo(d,Te.AUDIO);if(g===null)return;if(!this.switchingTrack&&this._streamEnded(g,h)){t.trigger(b.BUFFER_EOS,{type:"audio"}),this.state=re.ENDED;return}const p=g.len,y=t.maxBufferLength,E=h.fragments,T=E[0].start,x=this.getLoadPosition(),S=this.flushing?x:g.end;if(this.switchingTrack&&r){const A=x;h.PTSKnown&&A<T&&(g.end>T||g.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=T+.05)}if(p>=y&&!this.switchingTrack&&S<E[E.length-1].start)return;let R=this.getNextFragment(S,h);if(R&&this.isLoopLoading(R,S)&&(R=this.getNextFragmentLoopLoading(R,h,g,Te.MAIN,y)),!R){this.bufferFlushed=!0;return}let _=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&_&&$t(R)&&!R.endList&&(!h.live||!this.loadingParts&&S<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(_)===Kt.OK&&(this.mainFragLoading=_=null),_&&$t(_))){if(R.start>_.end){const C=this.fragmentTracker.getFragAtPos(S,Te.MAIN);C&&C.end>_.end&&(_=C,this.mainFragLoading={frag:C,targetBufferTime:null})}if(R.start>_.end)return}this.loadFragment(R,c,S)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new al(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==re.STOPPED&&(this.setInterval(Op),this.state=re.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(b.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:r}=this,{details:a,id:u,groupId:c,track:h}=t;if(!r){this.warn(`Audio tracks reset while loading track ${u} "${h.name}" of "${c}"`);return}const d=this.mainDetails;if(!d||a.endCC>d.endCC||d.expired){this.cachedTrackLoadedData=t,this.state!==re.STOPPED&&(this.state=re.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${u} "${h.name}" of "${c}" loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`);const g=r[u];let p=0;if(a.live||(s=g.details)!=null&&s.live){if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;if(g.details){var y;p=this.alignPlaylists(a,g.details,(y=this.levelLastLoaded)==null?void 0:y.details)}a.alignedSliding||($y(a,d),a.alignedSliding||uu(a,d),p=a.fragmentStart)}g.details=a,this.levelLastLoaded=g,this.startFragRequested||this.setStartPosition(d,p),this.hls.trigger(b.AUDIO_TRACK_UPDATED,{details:a,id:u,groupId:t.groupId}),this.state===re.WAITING_TRACK&&!this.waitForCdnTuneIn(a)&&(this.state=re.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:r,payload:a}=e,{config:u,trackId:c,levels:h}=this;if(!h){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const d=h[c];if(!d){this.warn("Audio track is undefined on fragment load progress");return}const g=d.details;if(!g){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const p=u.defaultAudioCodec||d.audioCodec||"mp4a.40.2";let y=this.transmuxer;y||(y=this.transmuxer=new av(this.hls,Te.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const E=this.initPTS[s.cc],T=(t=s.initSegment)==null?void 0:t.data;if(E!==void 0){const S=r?r.index:-1,R=S!==-1,_=new Od(s.level,s.sn,s.stats.chunkCount,a.byteLength,S,R);y.push(a,T,p,"",s,r,g.totalduration,!1,_,E)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${g.startSN} ,${g.endSN}],track ${c}`);const{cache:x}=this.waitingData=this.waitingData||{frag:s,part:r,cache:new Gy,complete:!1};x.push(new Uint8Array(a)),this.state!==re.STOPPED&&(this.state=re.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Te.MAIN&&$t(t.frag)&&(this.mainFragLoading=t,this.state===re.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:r}=t;if(s.type!==Te.AUDIO){!this.audioOnly&&s.type===Te.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if($t(s)){this.fragPrevious=s;const a=this.switchingTrack;a&&(this.bufferedTrack=a,this.switchingTrack=null,this.hls.trigger(b.AUDIO_TRACK_SWITCHED,lt({},a)))}this.fragBufferedComplete(s,r),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=re.ERROR;return}switch(t.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Te.AUDIO,t);break;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===re.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===Ve.AUDIO_TRACK&&(this.state=re.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==yt.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==yt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===re.ENDED&&(this.state=re.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,Te.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:r}=this,{remuxResult:a,chunkMeta:u}=e,c=this.getCurrentContext(u);if(!c){this.resetWhenMissingContext(u);return}const{frag:h,part:d,level:g}=c,{details:p}=g,{audio:y,text:E,id3:T,initSegment:x}=a;if(this.fragContextChanged(h)||!p){this.fragmentTracker.removeFragment(h);return}if(this.state=re.PARSING,this.switchingTrack&&y&&this.completeAudioSwitch(this.switchingTrack),x!=null&&x.tracks){const S=h.initSegment||h;if(this.unhandledEncryptionError(x,h))return;this._bufferInitSegment(g,x.tracks,S,u),r.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:s,tracks:x.tracks})}if(y){const{startPTS:S,endPTS:R,startDTS:_,endDTS:A}=y;d&&(d.elementaryStreams[yt.AUDIO]={startPTS:S,endPTS:R,startDTS:_,endDTS:A}),h.setElementaryStreamInfo(yt.AUDIO,S,R,_,A),this.bufferFragmentData(y,h,d,u)}if(T!=null&&(t=T.samples)!=null&&t.length){const S=dt({id:s,frag:h,details:p},T);r.trigger(b.FRAG_PARSING_METADATA,S)}if(E){const S=dt({id:s,frag:h,details:p},E);r.trigger(b.FRAG_PARSING_USERDATA,S)}}_bufferInitSegment(e,t,s,r){if(this.state!==re.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const a=t.audio;a.id=Te.AUDIO;const u=e.audioCodec;this.log(`Init audio buffer, container:${a.container}, codecs[level/parsed]=[${u}/${a.codec}]`),u&&u.split(",").length===1&&(a.levelCodec=u),this.hls.trigger(b.BUFFER_CODECS,t);const c=a.initSegment;if(c!=null&&c.byteLength){const h={type:"audio",frag:s,part:null,chunkMeta:r,parent:s.type,data:c};this.hls.trigger(b.BUFFER_APPENDING,h)}this.tickImmediate()}loadFragment(e,t,s){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===Kt.NOT_LOADED||r===Kt.PARTIAL){var a;if(!$t(e))this._loadInitSegment(e,t);else if((a=t.details)!=null&&a.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=re.WAITING_INIT_PTS;const u=this.mainDetails;u&&u.fragmentStart!==t.details.fragmentStart&&uu(t.details,u)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:r,characteristics:a,audioCodec:u,channels:c}=this.bufferedTrack;qn({name:t,lang:s,assocLang:r,characteristics:a,audioCodec:u,channels:c},e,Yn)||(ru(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(b.AUDIO_TRACK_SWITCHED,lt({},e))}}class Kd extends Ws{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const r=t==null?void 0:t.renditionReports;if(r){let a=-1;for(let u=0;u<r.length;u++){const c=r[u];let h;try{h=new self.URL(c.URI,t.url).href}catch(d){this.warn(`Could not construct new URL for Rendition Report: ${d}`),h=c.URI||""}if(h===e){a=u;break}else h===e.substring(0,h.length)&&(a=u)}if(a!==-1){const u=r[a],c=parseInt(u["LAST-MSN"])||t.lastPartSn;let h=parseInt(u["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const g=Math.min(t.age-t.partTarget,t.targetduration);h>=0&&g>t.partTarget&&(h+=1)}const d=s&&Qm(s);return new Wm(c,h>=0?h:void 0,d)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:r,stats:a}=t,u=self.performance.now(),c=a.loading.first?Math.max(0,u-a.loading.first):0;r.advancedDateTime=Date.now()-c;const h=this.hls.config.timelineOffset;if(h!==r.appliedTimelineOffset){const g=Math.max(h||0,0);r.appliedTimelineOffset=g,r.fragments.forEach(p=>{p.setStart(p.playlistOffset+g)})}if(r.live||s!=null&&s.live){const g="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(s),s&&r.fragments.length>0){Fx(s,r,this);const _=r.playlistParsingError;if(_){this.warn(_);const A=this.hls;if(!A.config.ignorePlaylistParsingErrors){var d;const{networkDetails:C}=t;A.trigger(b.ERROR,{type:Le.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:_,reason:_.message,level:t.level||void 0,parent:(d=r.fragments[0])==null?void 0:d.type,networkDetails:C,stats:a});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=a.loading.start);const p=this.hls.mainForwardBufferInfo,y=p?p.end-p.len:0,E=(r.edge-y)*1e3,T=Ny(r,E);if(r.requestScheduled+T<u?r.requestScheduled=u:r.requestScheduled+=T,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let x,S,R;if(r.canBlockReload&&r.endSN&&r.advanced){const _=this.hls.config.lowLatencyMode,A=r.lastPartSn,C=r.endSN,k=r.lastPartIndex,G=k!==-1,w=A===C;G?w?(S=C+1,R=_?0:k):(S=A,R=_?k+1:r.maxPartIndex):S=C+1;const P=r.age,B=P+r.ageHeader;let M=Math.min(B-r.partTarget,r.targetduration*1.5);if(M>0){if(B>r.targetduration*3)this.log(`Playlist last advanced ${P.toFixed(2)}s ago. Omitting segment and part directives.`),S=void 0,R=void 0;else if(s!=null&&s.tuneInGoal&&B-r.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${M} with playlist age: ${r.age}`),M=0;else{const j=Math.floor(M/r.targetduration);if(S+=j,R!==void 0){const ee=Math.round(M%r.targetduration/r.partTarget);R+=ee}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${P.toFixed(2)}s goal: ${M} skip sn ${j} to part ${R}`)}r.tuneInGoal=M}if(x=this.getDeliveryDirectives(r,t.deliveryDirectives,S,R),_||!w){r.requestScheduled=u,this.loadingPlaylist(g,x);return}}else(r.canBlockReload||r.canSkipUntil)&&(x=this.getDeliveryDirectives(r,t.deliveryDirectives,S,R));x&&S!==void 0&&r.canBlockReload&&(r.requestScheduled=a.loading.first+Math.max(T-c*2,T/2)),this.scheduleLoading(g,x,r)}else this.clearTimer()}scheduleLoading(e,t,s){const r=s||e.details;if(!r){this.loadingPlaylist(e,t);return}const a=self.performance.now(),u=r.requestScheduled;if(a>=u){this.loadingPlaylist(e,t);return}const c=u-a;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(c)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),c)}getDeliveryDirectives(e,t,s,r){let a=Qm(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,r=t.part,a=qo.No),new Wm(s,r,a)}checkRetry(e){const t=e.details,s=au(e),r=e.errorAction,{action:a,retryCount:u=0,retryConfig:c}=r||{},h=!!r&&!!c&&(a===ts.RetryRequest||!r.resolved&&a===ts.SendAlternateToPenaltyBox);if(h){var d;if(u>=c.maxNumRetry)return!1;if(s&&(d=e.context)!=null&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${u+1}/${c.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const g=kd(c,u);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),g),this.warn(`Retrying playlist loading ${u+1}/${c.maxNumRetry} after "${t}" in ${g}ms`)}e.levelRetry=!0,r.resolved=!0}return h}}function lv(l,e){if(l.length!==e.length)return!1;for(let t=0;t<l.length;t++)if(!fl(l[t].attrs,e[t].attrs))return!1;return!0}function fl(l,e,t){const s=l["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>l[r]!==e[r])}function md(l,e){return e.label.toLowerCase()===l.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(l.lang||"").toLowerCase())}class qb extends Kd{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(b.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:r,details:a}=t,u=this.tracksInGroup[s];if(!u||u.groupId!==r){this.warn(`Audio track with id:${s} and group:${r} not found in active group ${u==null?void 0:u.groupId}`);return}const c=u.details;u.details=t.details,this.log(`Audio track ${s} "${u.name}" lang:${u.lang} group:${r} loaded [${a.startSN}-${a.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,r=this.groupIds;let a=this.currentTrack;if(!s||(r==null?void 0:r.length)!==(s==null?void 0:s.length)||s!=null&&s.some(c=>(r==null?void 0:r.indexOf(c))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(y=>!s||s.indexOf(y.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(y=>y.default)&&(this.selectDefaultTrack=!1),c.forEach((y,E)=>{y.id=E});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const h=this.hls.config.audioPreference;if(!a&&h){const y=vi(h,c,Yn);if(y>-1)a=c[y];else{const E=vi(h,this.tracks);a=this.tracks[E]}}let d=this.findTrackId(a);d===-1&&a&&(d=this.findTrackId(null));const g={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${s==null?void 0:s.join(",")}`),this.hls.trigger(b.AUDIO_TRACKS_UPDATED,g);const p=this.trackId;if(d!==-1&&p===-1)this.setAudioTrack(d);else if(c.length&&p===-1){var u;const y=new Error(`No audio track selected for current audio group-ID(s): ${(u=this.groupIds)==null?void 0:u.join(",")} track count: ${c.length}`);this.warn(y.message),this.hls.trigger(b.ERROR,{type:Le.MEDIA_ERROR,details:z.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:y})}}}onError(e,t){t.fatal||!t.context||t.context.type===Ve.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const r=this.currentTrack;if(r&&qn(e,r,Yn))return r;const a=vi(e,this.tracksInGroup,Yn);if(a>-1){const u=this.tracksInGroup[a];return this.setAudioTrack(a),u}else if(r){let u=t.loadLevel;u===-1&&(u=t.firstAutoLevel);const c=rx(e,t.levels,s,u,Yn);if(c===-1)return null;t.nextLoadLevel=c}if(e.channels||e.audioCodec){const u=vi(e,s);if(u>-1)return s[u]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=t[e],a=r.details&&!r.details.live;if(e===this.trackId&&r===s&&a||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(b.AUDIO_TRACK_SWITCHING,lt({},r)),a))return;const u=this.switchParams(r.url,s==null?void 0:s.details,r.details);this.loadPlaylist(u)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const r=t[s];if(!(this.selectDefaultTrack&&!r.default)&&(!e||qn(e,r,Yn)))return s}if(e){const{name:s,lang:r,assocLang:a,characteristics:u,audioCodec:c,channels:h}=e;for(let d=0;d<t.length;d++){const g=t[d];if(qn({name:s,lang:r,assocLang:a,characteristics:u,audioCodec:c,channels:h},g,Yn))return d}for(let d=0;d<t.length;d++){const g=t[d];if(fl(e.attrs,g.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(let d=0;d<t.length;d++){const g=t[d];if(fl(e.attrs,g.attrs,["LANGUAGE"]))return d}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&ru(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,r=e.groupId,a=this.getUrlWithDirectives(e.url,t),u=e.details,c=u==null?void 0:u.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&u.live?" age "+c.toFixed(1)+(u.type&&" "+u.type||""):""} ${a}`),this.hls.trigger(b.AUDIO_TRACK_LOADING,{url:a,id:s,groupId:r,deliveryDirectives:t||null,track:e})}}class Xb{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(a){var s;if(r.onError(a),this.queues===null||this.tracks===null)return;const u=(s=this.tracks[e])==null?void 0:s.buffer;u!=null&&u.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],r=s==null?void 0:s.buffer;return r?`SourceBuffer${r.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const Mp=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,ov="HlsJsTrackRemovedError";class Qb extends Error{constructor(e){super(e),this.name=ov}}class Wb extends Ws{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:r,mediaSource:a}=this;s&&this.log("Media source opened"),!(!r||!a)&&(a.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(b.MEDIA_ATTACHED,{media:r,mediaSource:a}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:r}=this;s!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=ES(An(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.BUFFER_RESET,this.onBufferReset,this),e.on(b.BUFFER_APPENDING,this.onBufferAppending,this),e.on(b.BUFFER_CODECS,this.onBufferCodecs,this),e.on(b.BUFFER_EOS,this.onBufferEos,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.FRAG_PARSED,this.onFragParsed,this),e.on(b.FRAG_CHANGED,this.onFragChanged,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.BUFFER_RESET,this.onBufferReset,this),e.off(b.BUFFER_APPENDING,this.onBufferAppending,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.BUFFER_EOS,this.onBufferEos,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.FRAG_PARSED,this.onFragParsed,this),e.off(b.FRAG_CHANGED,this.onFragChanged,this),e.off(b.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const a=this.isUpdating();a||this.operationQueue.removeBlockers();const u=this.isQueued();(a||u)&&this.warn(`Transfering MediaSource with${u?" operations in queue":""}${a?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?dt(s,r.tracks):this.sourceBuffers.forEach(a=>{const[u]=a;u&&(s[u]=dt({},this.tracks[u]),this.removeBuffer(u)),a[0]=a[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const r=An(this.appendSource);if(r){const a=!!t.mediaSource;(a||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const u=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(u),a)this._objectUrl=s.src,this.attachTransferred();else{const c=this._objectUrl=self.URL.createObjectURL(u);if(this.appendSource)try{s.removeAttribute("src");const h=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||h&&u instanceof h,Np(s),Zb(s,c),s.load()}catch(h){s.src=c}else s.src=c}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,r=t.tracks,a=r?Object.keys(r):null,u=a?a.length:0,c=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&a&&u){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${vt(s,(h,d)=>h==="initSegment"?void 0:d)};
transfer tracks: ${vt(r,(h,d)=>h==="initSegment"?void 0:d)}}`),!ly(r,s)){t.mediaSource=null,t.tracks=void 0;const h=e.currentTime,d=this.details,g=Math.max(h,(d==null?void 0:d.fragments[0].start)||0);if(g-h>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${h} -> ${g}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(s)}") start time: ${g} currentTime: ${h}`),this.onMediaDetaching(b.MEDIA_DETACHING,{}),this.onMediaAttaching(b.MEDIA_ATTACHING,t),e.currentTime=g;return}this.transferData=void 0,a.forEach(h=>{const d=h,g=r[d];if(g){const p=g.buffer;if(p){const y=this.fragmentTracker,E=g.id;if(y.hasFragments(E)||y.hasParts(E)){const S=Ne.getBuffered(p);y.detectEvictedFragments(d,S,E,null,!0)}const T=Hf(d),x=[d,p];this.sourceBuffers[T]=x,p.updating&&this.operationQueue&&this.operationQueue.prependBlocker(d),this.trackSourceBuffer(d,g)}}}),c(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),c()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:a,_objectUrl:u}=this;if(a){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([c])=>{c&&this.removeBuffer(c)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const c=a.readyState==="open";try{const h=a.sourceBuffers;for(let d=h.length;d--;)c&&h[d].abort(),a.removeSourceBuffer(h[d]);c&&a.endOfStream()}catch(h){this.warn(`onMediaDetaching: ${h.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.removeEventListener("startstreaming",this._onStartStreaming),a.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),s||(u&&self.URL.revokeObjectURL(u),this.mediaSrc===u?(r.removeAttribute("src"),this.appendSource&&Np(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(b.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(a){this.warn(`onBufferReset ${e}`,a)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Hf(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Xb(this.tracks)}onBufferCodecs(e,t){var s;const r=this.tracks,a=Object.keys(t);this.log(`BUFFER_CODECS: "${a}" (current SB count ${this.sourceBufferCount})`);const u="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),c=!u&&this.sourceBufferCount&&this.media&&a.some(h=>!r[h]);if(u||c){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${a}" SourceBuffers`);return}a.forEach(h=>{var d,g;const p=t[h],{id:y,codec:E,levelCodec:T,container:x,metadata:S,supplemental:R}=p;let _=r[h];const A=(d=this.transferData)==null||(d=d.tracks)==null?void 0:d[h],C=A!=null&&A.buffer?A:_,k=(C==null?void 0:C.pendingCodec)||(C==null?void 0:C.codec),G=C==null?void 0:C.levelCodec;_||(_=r[h]={buffer:void 0,listeners:[],codec:E,supplemental:R,container:x,levelCodec:T,metadata:S,id:y});const w=Yo(k,G),P=w==null?void 0:w.replace(Mp,"$1");let B=Yo(E,T);const M=(g=B)==null?void 0:g.replace(Mp,"$1");B&&w&&P!==M&&(h.slice(0,5)==="audio"&&(B=iu(B,this.appendSource)),this.log(`switching codec ${k} to ${B}`),B!==(_.pendingCodec||_.codec)&&(_.pendingCodec=B),_.container=x,this.appendChangeType(h,x,B))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((s=t.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const r=`${t};codecs=${s}`,a={label:`change-type=${r}`,execute:()=>{const u=this.tracks[e];if(u){const c=u.buffer;c!=null&&c.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),c.changeType(r),u.codec=s,u.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn(`Failed to change ${e} SourceBuffer type`,u)}};this.append(a,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,r=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,Te.MAIN))==null?void 0:t.gap)===!0)return;const u={label:"block-audio",execute:()=>{var c;const h=this.tracks.video;(this.lastVideoAppendEnd>r||h!=null&&h.buffer&&Ne.isBuffered(h.buffer,r)||((c=this.fragmentTracker.getAppendedFrag(r,Te.MAIN))==null?void 0:c.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn("Error executing block-audio operation",c)}};this.blockedAudioAppend={op:u,frag:e},this.append(u,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:r,type:a,parent:u,frag:c,part:h,chunkMeta:d,offset:g}=t,p=d.buffering[a],{sn:y,cc:E}=c,T=self.performance.now();p.start=T;const x=c.stats.buffering,S=h?h.stats.buffering:null;x.start===0&&(x.start=T),S&&S.start===0&&(S.start=T);const R=s.audio;let _=!1;a==="audio"&&(R==null?void 0:R.container)==="audio/mpeg"&&(_=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const A=s.video,C=A==null?void 0:A.buffer;if(C&&y!=="initSegment"){const w=h||c,P=this.blockedAudioAppend;if(a==="audio"&&u!=="main"&&!this.blockedAudioAppend&&!(A.ending||A.ended)){const M=w.start+w.duration*.05,j=C.buffered,ee=this.currentOp("video");!j.length&&!ee?this.blockAudio(w):!ee&&!Ne.isBuffered(C,M)&&this.lastVideoAppendEnd<M&&this.blockAudio(w)}else if(a==="video"){const B=w.end;if(P){const M=P.frag.start;(B>M||B<this.lastVideoAppendEnd||Ne.isBuffered(C,M))&&this.unblockAudio()}this.lastVideoAppendEnd=B}}const k=(h||c).start,G={label:`append-${a}`,execute:()=>{var w;p.executeStart=self.performance.now();const P=(w=this.tracks[a])==null?void 0:w.buffer;P&&(_?this.updateTimestampOffset(P,k,.1,a,y,E):g!==void 0&&Ee(g)&&this.updateTimestampOffset(P,g,1e-6,a,y,E)),this.appendExecutor(r,a)},onStart:()=>{},onComplete:()=>{const w=self.performance.now();p.executeEnd=p.end=w,x.first===0&&(x.first=w),S&&S.first===0&&(S.first=w);const P={};this.sourceBuffers.forEach(([B,M])=>{B&&(P[B]=Ne.getBuffered(M))}),this.appendErrors[a]=0,a==="audio"||a==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(b.BUFFER_APPENDED,{type:a,frag:c,part:h,chunkMeta:d,parent:c.type,timeRanges:P})},onError:w=>{var P;const B={type:Le.MEDIA_ERROR,parent:c.type,details:z.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:c,part:h,chunkMeta:d,error:w,err:w,fatal:!1},M=(P=this.media)==null?void 0:P.error;if(w.code===DOMException.QUOTA_EXCEEDED_ERR||w.name=="QuotaExceededError"||"quota"in w)B.details=z.BUFFER_FULL_ERROR;else if(w.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!M)B.errorAction=Kr(!0);else if(w.name===ov&&this.sourceBufferCount===0)B.errorAction=Kr(!0);else{const j=++this.appendErrors[a];this.warn(`Failed ${j}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer (${M||"no media error"})`),(j>=this.hls.config.appendErrorMaxRetry||M)&&(B.fatal=!0)}this.hls.trigger(b.ERROR,B)}};this.log(`queuing "${a}" append sn: ${y}${h?" p: "+h.index:""} of ${c.type===Te.MAIN?"level":"track"} ${c.level} cc: ${E}`),this.append(G,a,this.isPending(this.tracks[a]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(b.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:s,startOffset:r,endOffset:a}=t;s?this.append(this.getFlushOp(s,r,a),s):this.sourceBuffers.forEach(([u])=>{u&&this.append(this.getFlushOp(u,r,a),u)})}onFragParsed(e,t){const{frag:s,part:r}=t,a=[],u=r?r.elementaryStreams:s.elementaryStreams;u[yt.AUDIOVIDEO]?a.push("audiovideo"):(u[yt.AUDIO]&&a.push("audio"),u[yt.VIDEO]&&a.push("video"));const c=()=>{const h=self.performance.now();s.stats.buffering.end=h,r&&(r.stats.buffering.end=h);const d=r?r.stats:s.stats;this.hls.trigger(b.FRAG_BUFFERED,{frag:s,part:r,stats:d,id:s.type})};a.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(c,a).catch(h=>{this.warn(`Fragment buffered callback ${h}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([u])=>{if(u){const c=this.tracks[u];(!t.type||t.type===u)&&(c.ending=!0,c.ended||(c.ended=!0,this.log(`${u} buffer reached EOS`)))}});const r=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([u])=>{var c;return u&&!((c=this.tracks[u])!=null&&c.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:u}=this;if(!u||u.readyState!=="open"){u&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${u.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),u.endOfStream(),this.hls.trigger(b.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(b.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===z.BUFFER_APPEND_ERROR&&t.frag){var s;const r=(s=t.errorAction)==null?void 0:s.nextAutoLevel;Ee(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const r=e.config,a=s.currentTime,u=t.levelTargetDuration,c=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(Ee(c)&&c>=0){const d=Math.max(c,u),g=Math.floor(a/u)*u-d;this.flushBackBuffer(a,u,g)}const h=r.frontBufferFlushThreshold;if(Ee(h)&&h>0){const d=Math.max(r.maxBufferLength,h),g=Math.max(d,u),p=Math.floor(a/u)*u+g;this.flushFrontBuffer(a,u,p)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([r,a])=>{if(a){const c=Ne.getBuffered(a);if(c.length>0&&s>c.start(0)){var u;this.hls.trigger(b.BACK_BUFFER_REACHED,{bufferEnd:s});const h=this.tracks[r];if((u=this.details)!=null&&u.live)this.hls.trigger(b.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(h!=null&&h.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:r})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([r,a])=>{if(a){const u=Ne.getBuffered(a),c=u.length;if(c<2)return;const h=u.start(c-1),d=u.end(c-1);if(s>h||e>=h&&e<=d)return;this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||(s==null?void 0:s.readyState)!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const d=Math.max(0,t.fragmentStart),g=Math.max(d,r);return{duration:1/0,start:d,end:g}}return{duration:1/0}}const a=(e=this.overrides)==null?void 0:e.duration;if(a)return Ee(a)?{duration:a}:null;const u=this.media.duration,c=Ee(s.duration)?s.duration:0;return r>c&&r>u||!Ee(u)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:s}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(Ee(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${s}.`),r.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${vt(s)}`),this.tracksReady){var r;const a=(r=this.transferData)==null?void 0:r.tracks;a&&Object.keys(a).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const r=this.tracks[t];e[t]={buffer:s,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(b.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(b.ERROR,{type:Le.MEDIA_ERROR,details:z.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const a in e){const u=a,c=e[u];if(this.isPending(c)){const h=this.getTrackCodec(c,u),d=`${c.container};codecs=${h}`;c.codec=h,this.log(`creating sourceBuffer(${d})${this.currentOp(u)?" Queued":""} ${vt(c)}`);try{const g=s.addSourceBuffer(d),p=Hf(u),y=[u,g];t[p]=y,c.buffer=g}catch(g){var r;this.error(`error while trying to add sourceBuffer: ${g.message}`),this.shiftAndExecuteNext(u),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[u],this.hls.trigger(b.ERROR,{type:Le.MEDIA_ERROR,details:z.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:g,sourceBufferName:u,mimeType:d,parent:c.id});return}this.trackSourceBuffer(u,c)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let r=e.codec;s&&(t==="video"||t==="audiovideo")&&nl(s,"video")&&(r=$S(r,s));const a=Yo(r,e.levelCodec);return a?t.slice(0,5)==="audio"?iu(a,this.appendSource):a:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(a,u)=>{const c=u.removedRanges;c!=null&&c.length&&this.hls.trigger(b.BUFFER_FLUSHED,{type:a})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s==null?void 0:s.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${r}`,t),this.hls.trigger(b.ERROR,{type:Le.MEDIA_ERROR,details:z.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const a=this.currentOp(e);a&&a.onError(r)}updateTimestampOffset(e,t,s,r,a,u){const c=t-e.timestampOffset;Math.abs(c)>=s&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${a} cc: ${u})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:r,mediaSource:a}=this,u=this.tracks[e],c=u==null?void 0:u.buffer;if(!r||!a||!c){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const h=Ee(r.duration)?r.duration:1/0,d=Ee(a.duration)?a.duration:1/0,g=Math.max(0,t),p=Math.min(s,h,d);p>g&&(!u.ending||u.ended)?(u.ended=!1,this.log(`Removing [${g},${p}] from the ${e} SourceBuffer`),c.remove(g,p)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],r=s==null?void 0:s.buffer;if(!r)throw new Qb(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,r=t.map(u=>this.appendBlocker(u));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(u=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const r=(s=this.tracks[t])==null?void 0:s.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const r=this.tracks[e];if(!r)return;const a=r.buffer;if(!a)return;const u=s.bind(this,e);r.listeners.push({event:t,listener:u}),a.addEventListener(t,u)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(r=>{s.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function Np(l){const e=l.querySelectorAll("source");[].slice.call(e).forEach(t=>{l.removeChild(t)})}function Zb(l,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,l.appendChild(t)}function Hf(l){return l==="audio"?1:0}class zd{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.BUFFER_CODECS,this.onBufferCodecs,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Ee(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((r,a)=>this.isLevelAllowed(r)&&a<=e);return this.clientRect=null,zd.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const r=(c,h)=>h?c.width!==h.width||c.height!==h.height:!0;let a=e.length-1;const u=Math.max(t,s);for(let c=0;c<e.length;c+=1){const h=e[c];if((h.width>=u||h.height>=u)&&r(h,e[c+1])){a=c;break}}return a}}const Jb={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Es=Jb,e1={HLS:"h"},t1=e1;class Ti{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof Ti?s:new Ti(s))),this.value=e,this.params=t}}const s1="Dict";function i1(l){return Array.isArray(l)?JSON.stringify(l):l instanceof Map?"Map{}":l instanceof Set?"Set{}":typeof l=="object"?JSON.stringify(l):String(l)}function n1(l,e,t,s){return new Error(`failed to ${l} "${i1(e)}" as ${t}`,{cause:s})}function Si(l,e,t){return n1("serialize",l,e,t)}class uv{constructor(e){this.description=e}}const Pp="Bare Item",r1="Boolean";function a1(l){if(typeof l!="boolean")throw Si(l,r1);return l?"?1":"?0"}function l1(l){return btoa(String.fromCharCode(...l))}const o1="Byte Sequence";function u1(l){if(ArrayBuffer.isView(l)===!1)throw Si(l,o1);return`:${l1(l)}:`}const c1="Integer";function f1(l){return l<-999999999999999||999999999999999<l}function cv(l){if(f1(l))throw Si(l,c1);return l.toString()}function d1(l){return`@${cv(l.getTime()/1e3)}`}function fv(l,e){if(l<0)return-fv(-l,e);const t=Math.pow(10,e);if(Math.abs(l*t%1-.5)<Number.EPSILON){const r=Math.floor(l*t);return(r%2===0?r:r+1)/t}else return Math.round(l*t)/t}const h1="Decimal";function g1(l){const e=fv(l,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Si(l,h1);const t=e.toString();return t.includes(".")?t:`${t}.0`}const m1="String",p1=/[\x00-\x1f\x7f]+/;function y1(l){if(p1.test(l))throw Si(l,m1);return`"${l.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function v1(l){return l.description||l.toString().slice(7,-1)}const E1="Token";function Up(l){const e=v1(l);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Si(e,E1);return e}function pd(l){switch(typeof l){case"number":if(!Ee(l))throw Si(l,Pp);return Number.isInteger(l)?cv(l):g1(l);case"string":return y1(l);case"symbol":return Up(l);case"boolean":return a1(l);case"object":if(l instanceof Date)return d1(l);if(l instanceof Uint8Array)return u1(l);if(l instanceof uv)return Up(l);default:throw Si(l,Pp)}}const T1="Key";function yd(l){if(/^[a-z*][a-z0-9\-_.*]*$/.test(l)===!1)throw Si(l,T1);return l}function Yd(l){return l==null?"":Object.entries(l).map(([e,t])=>t===!0?`;${yd(e)}`:`;${yd(e)}=${pd(t)}`).join("")}function dv(l){return l instanceof Ti?`${pd(l.value)}${Yd(l.params)}`:pd(l)}function S1(l){return`(${l.value.map(dv).join(" ")})${Yd(l.params)}`}function x1(l,e={whitespace:!0}){if(typeof l!="object"||l==null)throw Si(l,s1);const t=l instanceof Map?l.entries():Object.entries(l),s=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([r,a])=>{a instanceof Ti||(a=new Ti(a));let u=yd(r);return a.value===!0?u+=Yd(a.params):(u+="=",Array.isArray(a.value)?u+=S1(a):u+=dv(a)),u}).join(`,${s}`)}function hv(l,e){return x1(l,e)}const mi="CMCD-Object",kt="CMCD-Request",Kn="CMCD-Session",Tn="CMCD-Status",b1={br:mi,ab:mi,d:mi,ot:mi,tb:mi,tpb:mi,lb:mi,tab:mi,lab:mi,url:mi,pb:kt,bl:kt,tbl:kt,dl:kt,ltc:kt,mtp:kt,nor:kt,nrr:kt,rc:kt,sn:kt,sta:kt,su:kt,ttfb:kt,ttfbb:kt,ttlb:kt,cmsdd:kt,cmsds:kt,smrt:kt,df:kt,cs:kt,ts:kt,cid:Kn,pr:Kn,sf:Kn,sid:Kn,st:Kn,v:Kn,msd:Kn,bs:Tn,bsd:Tn,cdn:Tn,rtp:Tn,bg:Tn,pt:Tn,ec:Tn,e:Tn},A1={REQUEST:kt};function L1(l){return Object.keys(l).reduce((e,t)=>{var s;return(s=l[t])===null||s===void 0||s.forEach(r=>e[r]=t),e},{})}function R1(l,e){const t={};if(!l)return t;const s=Object.keys(l),r=e?L1(e):{};return s.reduce((a,u)=>{var c;const h=b1[u]||r[u]||A1.REQUEST,d=(c=a[h])!==null&&c!==void 0?c:a[h]={};return d[u]=l[u],a},t)}function _1(l){return["ot","sf","st","e","sta"].includes(l)}function I1(l){return typeof l=="number"?Ee(l):l!=null&&l!==""&&l!==!1}const gv="event";function D1(l,e){const t=new URL(l),s=new URL(e);if(t.origin!==s.origin)return l;const r=t.pathname.split("/").slice(1),a=s.pathname.split("/").slice(1,-1);for(;r[0]===a[0];)r.shift(),a.shift();for(;a.length;)a.shift(),r.unshift("..");return r.join("/")+t.search+t.hash}const Zo=l=>Math.round(l),vd=(l,e)=>Array.isArray(l)?l.map(t=>vd(t,e)):l instanceof Ti&&typeof l.value=="string"?new Ti(vd(l.value,e),l.params):(e.baseUrl&&(l=D1(l,e.baseUrl)),e.version===1?encodeURIComponent(l):l),Uo=l=>Zo(l/100)*100,C1=(l,e)=>{let t=l;return e.version>=2&&(l instanceof Ti&&typeof l.value=="string"?t=new Ti([l]):typeof l=="string"&&(t=[l])),vd(t,e)},k1={br:Zo,d:Zo,bl:Uo,dl:Uo,mtp:Uo,nor:C1,rtp:Uo,tb:Zo},mv="request",pv="response",qd=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],w1=["e"],O1=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function mu(l){return O1.test(l)}function M1(l){return qd.includes(l)||w1.includes(l)||mu(l)}const yv=["d","dl","nor","ot","rtp","su"];function N1(l){return qd.includes(l)||yv.includes(l)||mu(l)}const P1=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function U1(l){return qd.includes(l)||yv.includes(l)||P1.includes(l)||mu(l)}const B1=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function F1(l){return B1.includes(l)||mu(l)}const $1={[pv]:U1,[gv]:M1,[mv]:N1};function vv(l,e={}){const t={};if(l==null||typeof l!="object")return t;const s=e.version||l.v||1,r=e.reportingMode||mv,a=s===1?F1:$1[r];let u=Object.keys(l).filter(a);const c=e.filter;typeof c=="function"&&(u=u.filter(c));const h=r===pv||r===gv;h&&!u.includes("ts")&&u.push("ts"),s>1&&!u.includes("v")&&u.push("v");const d=dt({},k1,e.formatters),g={version:s,reportingMode:r,baseUrl:e.baseUrl};return u.sort().forEach(p=>{let y=l[p];const E=d[p];if(typeof E=="function"&&(y=E(y,g)),p==="v"){if(s===1)return;y=s}p=="pr"&&y===1||(h&&p==="ts"&&!Ee(y)&&(y=Date.now()),I1(y)&&(_1(p)&&typeof y=="string"&&(y=new uv(y)),t[p]=y))}),t}function G1(l,e={}){const t={};if(!l)return t;const s=vv(l,e),r=R1(s,e==null?void 0:e.customHeaderMap);return Object.entries(r).reduce((a,[u,c])=>{const h=hv(c,{whitespace:!1});return h&&(a[u]=h),a},t)}function j1(l,e,t){return dt(l,G1(e,t))}const H1="CMCD";function V1(l,e={}){return l?hv(vv(l,e),{whitespace:!1}):""}function K1(l,e={}){if(!l)return"";const t=V1(l,e);return encodeURIComponent(t)}function z1(l,e={}){if(!l)return"";const t=K1(l,e);return`${H1}=${t}`}const Bp=/CMCD=[^&#]+/;function Y1(l,e,t){const s=z1(e,t);if(!s)return l;if(Bp.test(l))return l.replace(Bp,s);const r=l.includes("?")?"&":"?";return`${l}${r}${s}`}class q1{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:Es.MANIFEST,su:!this.initialized})}catch(a){this.hls.logger.warn("Could not generate manifest CMCD data.",a)}},this.applyFragmentData=r=>{try{const{frag:a,part:u}=r,c=this.hls.levels[a.level],h=this.getObjectType(a),d={d:(u||a).duration*1e3,ot:h};(h===Es.VIDEO||h===Es.AUDIO||h==Es.MUXED)&&(d.br=c.bitrate/1e3,d.tb=this.getTopBandwidth(h)/1e3,d.bl=this.getBufferLength(h));const g=u?this.getNextPart(u):this.getNextFrag(a);g!=null&&g.url&&g.url!==a.url&&(d.nor=g.url),this.apply(r,d)}catch(a){this.hls.logger.warn("Could not generate segment CMCD data.",a)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHED,this.onMediaDetached,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHED,this.onMediaDetached,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,r;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:t1.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){dt(t,this.createData());const s=t.ot===Es.INIT||t.ot===Es.VIDEO||t.ot===Es.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((u,c)=>(r.includes(c)&&(u[c]=t[c]),u),{}));const a={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),j1(e.headers,t,a)):e.url=Y1(e.url,t,a)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const r=e.sn-s.startSN;return s.fragments[r+1]}}getNextPart(e){var t;const{index:s,fragment:r}=e,a=(t=this.hls.levels[r.level])==null||(t=t.details)==null?void 0:t.partList;if(a){const{sn:u}=r;for(let c=a.length-1;c>=0;c--){const h=a[c];if(h.index===s&&h.fragment.sn===u)return a[c+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Es.TIMED_TEXT;if(e.sn==="initSegment")return Es.INIT;if(t==="audio")return Es.AUDIO;if(t==="main")return this.hls.audioTracks.length?Es.VIDEO:Es.MUXED}getTopBandwidth(e){let t=0,s;const r=this.hls;if(e===Es.AUDIO)s=r.audioTracks;else{const a=r.maxAutoLevel,u=a>-1?a+1:r.levels.length;s=r.levels.slice(0,u)}return s.forEach(a=>{a.bitrate>t&&(t=a.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===Es.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:Ne.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new s(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,u,c){t(a),this.loader.load(a,u,c)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new s(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,u,c){t(a),this.loader.load(a,u,c)}}}}const X1=3e5;class Q1 extends Ws{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if((s==null?void 0:s.action)===ts.SendAlternateToPenaltyBox&&s.flags===Ms.MoveAllAlternatesMatchingHost){const r=this.levels;let a=this._pathwayPriority,u=this.pathwayId;if(t.context){const{groupId:c,pathwayId:h,type:d}=t.context;c&&r?u=this.getPathwayForGroupId(c,d,u):h&&(u=h)}u in this.penalizedPathways||(this.penalizedPathways[u]=performance.now()),!a&&r&&(a=this.pathways()),a&&a.length>1&&(this.updatePathwayPriority(a),s.resolved=this.pathwayId!==u),t.details===z.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${u} levels: ${r&&r.length} priorities: ${vt(a)} penalized: ${vt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,r=performance.now();Object.keys(s).forEach(a=>{r-s[a]>X1&&delete s[a]});for(let a=0;a<e.length;a++){const u=e[a];if(u in s)continue;if(u===this.pathwayId)return;const c=this.hls.nextLoadLevel,h=this.hls.levels[c];if(t=this.getLevelsForPathway(u),t.length>0){this.log(`Setting Pathway to "${u}"`),this.pathwayId=u,By(t),this.hls.trigger(b.LEVELS_UPDATED,{levels:t});const d=this.hls.levels[c];h&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==h.bitrate&&this.log(`Unstable Pathways change from bitrate ${h.bitrate} to ${d.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(e,t,s){const r=this.getLevelsForPathway(s).concat(this.levels||[]);for(let a=0;a<r.length;a++)if(t===Ve.AUDIO_TRACK&&r[a].hasAudioGroup(e)||t===Ve.SUBTITLE_TRACK&&r[a].hasSubtitleGroup(e))return r[a].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},r={};e.forEach(a=>{const{ID:u,"BASE-ID":c,"URI-REPLACEMENT":h}=a;if(t.some(g=>g.pathwayId===u))return;const d=this.getLevelsForPathway(c).map(g=>{const p=new Rt(g.attrs);p["PATHWAY-ID"]=u;const y=p.AUDIO&&`${p.AUDIO}_clone_${u}`,E=p.SUBTITLES&&`${p.SUBTITLES}_clone_${u}`;y&&(s[p.AUDIO]=y,p.AUDIO=y),E&&(r[p.SUBTITLES]=E,p.SUBTITLES=E);const T=Ev(g.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),x=new al({attrs:p,audioCodec:g.audioCodec,bitrate:g.bitrate,height:g.height,name:g.name,url:T,videoCodec:g.videoCodec,width:g.width});if(g.audioGroups)for(let S=1;S<g.audioGroups.length;S++)x.addGroupId("audio",`${g.audioGroups[S]}_clone_${u}`);if(g.subtitleGroups)for(let S=1;S<g.subtitleGroups.length;S++)x.addGroupId("text",`${g.subtitleGroups[S]}_clone_${u}`);return x});t.push(...d),Fp(this.audioTracks,s,h,u),Fp(this.subtitleTracks,r,h,u)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let r;try{r=new self.URL(e)}catch(g){this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const g=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+g)}const a={responseType:"json",url:r.href},u=t.steeringManifestLoadPolicy.default,c=u.errorRetry||u.timeoutRetry||{},h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},d={onSuccess:(g,p,y,E)=>{this.log(`Loaded steering manifest: "${r}"`);const T=g.data;if((T==null?void 0:T.VERSION)!==1){this.log(`Steering VERSION ${T.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=T.TTL;const{"RELOAD-URI":x,"PATHWAY-CLONES":S,"PATHWAY-PRIORITY":R}=T;if(x)try{this.uri=new self.URL(x,r).href}catch(A){this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${x}`);return}this.scheduleRefresh(this.uri||y.url),S&&this.clonePathways(S);const _={steeringManifest:T,url:r.toString()};this.hls.trigger(b.STEERING_MANIFEST_LOADED,_),R&&this.updatePathwayPriority(R)},onError:(g,p,y,E)=>{if(this.log(`Error loading steering manifest: ${g.code} ${g.text} (${p.url})`),this.stopLoad(),g.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let T=this.timeToLoad*1e3;if(g.code===429){const x=this.loader;if(typeof(x==null?void 0:x.getResponseHeader)=="function"){const S=x.getResponseHeader("Retry-After");S&&(T=parseFloat(S)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,T)},onTimeout:(g,p,y)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(a,h,d)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const r=(s=this.hls)==null?void 0:s.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Fp(l,e,t,s){l&&Object.keys(e).forEach(r=>{const a=l.filter(u=>u.groupId===r).map(u=>{const c=dt({},u);return c.details=void 0,c.attrs=new Rt(c.attrs),c.url=c.attrs.URI=Ev(u.url,u.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),c.groupId=c.attrs["GROUP-ID"]=e[r],c.attrs["PATHWAY-ID"]=s,c});l.push(...a)})}function Ev(l,e,t,s){const{HOST:r,PARAMS:a,[t]:u}=s;let c;e&&(c=u==null?void 0:u[e],c&&(l=c));const h=new self.URL(l);return r&&!c&&(h.host=r),a&&Object.keys(a).sort().forEach(d=>{d&&h.searchParams.set(d,a[d])}),h.href}class Yr extends Ws{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Yr.CDMCleanupPromise?[Yr.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:s,initData:r}=t,a=`"${t.type}" event: init data type: "${s}"`;if(this.debug(a),r!==null){if(!this.keyFormatPromise){let u=Object.keys(this.keySystemAccessPromises);u.length||(u=Ja(this.config));const c=u.map(Nf).filter(h=>!!h);this.keyFormatPromise=this.getKeyFormatPromise(c)}this.keyFormatPromise.then(u=>{const c=Xo(u);if(s!=="sinf"||c!==_t.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${c}`);return}let h;try{const E=Vt(new Uint8Array(r)),T=Pd(JSON.parse(E).sinf),x=my(T);if(!x)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");h=new Uint8Array(x.subarray(8,24))}catch(E){this.warn(`${a} Failed to parse sinf: ${E}`);return}const d=Ts(h),{keyIdToKeySessionPromise:g,mediaKeySessions:p}=this;let y=g[d];for(let E=0;E<p.length;E++){const T=p[E],x=T.decryptdata;if(!x.keyId)continue;const S=Ts(x.keyId);if(Md(h,x.keyId)||x.uri.replace(/-/g,"").indexOf(d)!==-1){if(y=g[S],!y)continue;if(x.pssh)break;delete g[S],x.pssh=new Uint8Array(r),x.keyId=h,y=g[d]=y.then(()=>this.generateRequestWithPreferredKeySession(T,s,r,"encrypted-event-key-match")),y.catch(R=>this.handleError(R));break}}y||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${p.length}.`))}).catch(u=>this.handleError(u))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(b.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(b.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,r=t==null?void 0:t[e];if(r)return r.licenseUrl;if(e===_t.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t==null?void 0:t[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(u,c,h)=>!!u&&h.indexOf(u)===c,r=t.map(u=>u.audioCodec).filter(s),a=t.map(u=>u.videoCodec).filter(s);return r.length+a.length===0&&a.push("avc1.42e01e"),new Promise((u,c)=>{const h=d=>{const g=d.shift();this.getMediaKeysPromise(g,r,a).then(p=>u({keySystem:g,mediaKeys:p})).catch(p=>{d.length?h(d):p instanceof Os?c(p):c(new Os({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};h(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${s}`;return ky===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return s(e,t)}getMediaKeysPromise(e,t,s){var r;const a=Cx(e,t,s,this.config.drmSystemOptions||{});let u=this.keySystemAccessPromises[e],c=(r=u)==null?void 0:r.keySystemAccess;if(!c){this.log(`Requesting encrypted media "${e}" key-system access with config: ${vt(a)}`),c=this.requestMediaKeySystemAccess(e,a);const h=u=this.keySystemAccessPromises[e]={keySystemAccess:c};return c.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),c.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const g=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const p=h.mediaKeys=d.createMediaKeys().then(y=>(this.log(`Media-keys created for "${e}"`),h.hasMediaKeys=!0,g.then(E=>E?this.setMediaKeysServerCertificate(y,e,E):y)));return p.catch(y=>{this.error(`Failed to create media-keys for "${e}"}: ${y}`)}),p})}return c.then(()=>u.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${Ts(e.keyId||[])} keyUri: ${e.uri}`);const r=s.createSession(),a={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),r=Bo(t),a="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(s,a,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${Ts(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Nf(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const a=Nf(r);a?t(a):s(new Error(`Unable to find format for key-system "${r}"`))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Ja(this.config),s=e.map(Xo).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const r=W1(e,t[s]);if(r)return r}}loadKey(e){const t=e.keyInfo.decryptdata,s=Bo(t),r=this.bannedKeyIds[s];if(r||this.getKeyStatus(t)==="internal-error"){const c=$p(r||"internal-error",t);return this.handleError(c,e.frag),Promise.reject(c)}const a=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${a}`);const u=this.keyIdToKeySessionPromise[s];if(!u){const c=this.getKeySystemForKeyPromise(t).then(({keySystem:h,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${a}`),this.attemptSetMediaKeys(h,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:h,mediaKeys:d,decryptdata:t}))))).then(h=>{const d="cenc",g=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(h,d,g,"playlist-key")});return c.catch(h=>this.handleError(h,e.frag)),this.keyIdToKeySessionPromise[s]=c,c}return u.catch(c=>{if(c instanceof Os){const h=lt({},c.data);this.getKeyStatus(t)==="internal-error"&&(h.decryptdata=t);const d=new Os(h,c.message);this.handleError(d,e.frag)}}),u}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Os){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error(`${e.message}${s?` (${Ts(s.keyId||[])})`:""}`),this.hls.trigger(b.ERROR,e.data)}else this.error(e.message),this.hls.trigger(b.ERROR,{type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Bo(e),s=this.keyIdToKeySessionPromise[t];if(!s){const r=Xo(e.keyFormat),a=r?[r]:Ja(this.config);return this.attemptKeySystemAccess(a)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=Ja(this.config)),e.length===0)throw new Os({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${vt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(s).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(a=>s.indexOf(a)===-1)})}generateRequestWithPreferredKeySession(e,t,s,r){var a;const u=(a=this.config.drmSystems)==null||(a=a[e.keySystem])==null?void 0:a.generateRequest;if(u)try{const T=u.call(this.hls,t,s,e);if(!T)throw new Error("Invalid response from configured generateRequest filter");t=T.initDataType,s=T.initData?T.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(T){if(this.warn(T.message),this.hls&&this.hls.config.debug)throw T}if(s===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const c=Bo(e.decryptdata),h=e.decryptdata.uri;this.log(`Generating key-session request for "${r}" keyId: ${c} URI: ${h} (init data type: ${t} length: ${s.byteLength})`);const d=new Bd,g=e._onmessage=T=>{const x=e.mediaKeysSession;if(!x){d.emit("error",new Error("invalid state"));return}const{messageType:S,message:R}=T;this.log(`"${S}" message event for session "${x.sessionId}" message size: ${R.byteLength}`),S==="license-request"||S==="license-renewal"?this.renewLicense(e,R).catch(_=>{d.eventNames().length?d.emit("error",_):this.handleError(_)}):S==="license-release"?e.keySystem===_t.FAIRPLAY&&this.updateKeySession(e,cd("acknowledged")).then(()=>this.removeSession(e)).catch(_=>this.handleError(_)):this.warn(`unhandled media key message type "${S}"`)},p=(T,x)=>{x.keyStatus=T;let S;T.startsWith("usable")?d.emit("resolved"):T==="internal-error"||T==="output-restricted"||T==="output-downscaled"?S=$p(T,x.decryptdata):T==="expired"?S=new Error(`key expired (keyId: ${c})`):T==="released"?S=new Error("key released"):T==="status-pending"||this.warn(`unhandled key status change "${T}" (keyId: ${c})`),S&&(d.eventNames().length?d.emit("error",S):this.handleError(S))},y=e._onkeystatuseschange=T=>{if(!e.mediaKeysSession){d.emit("error",new Error("invalid state"));return}const S=this.getKeyStatuses(e);if(!Object.keys(S).some(C=>S[C]!=="status-pending"))return;if(S[c]==="expired"){this.log(`Expired key ${vt(S)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let _=S[c];if(_)p(_,e);else{var A;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(A=e.keyStatusTimeouts)[c]||(A[c]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const k=this.getKeyStatus(e.decryptdata);if(k&&k!=="status-pending")return this.log(`No status for keyId ${c} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${k} from other session.`),p(k,e);this.log(`key status for ${c} in key-session "${e.mediaKeysSession.sessionId}" timed out after 0ms`),_="internal-error",p(_,e)},0)),this.log(`No status for keyId ${c} (${vt(S)}).`)}};cs(e.mediaKeysSession,"message",g),cs(e.mediaKeysSession,"keystatuseschange",y);const E=new Promise((T,x)=>{d.on("error",x),d.on("resolved",T)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${c} URI: ${h}`)}).catch(T=>{throw new Os({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_SESSION,error:T,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${T}`)}).then(()=>E).catch(T=>(d.removeAllListeners(),this.removeSession(e).then(()=>{throw T}))).then(()=>(d.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,r)=>{if(typeof r=="string"&&typeof s=="object"){const c=r;r=s,s=c}const a="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);e.keySystem===_t.PLAYREADY&&a.length===16&&Cy(a);const u=Ts(a);s==="internal-error"&&(this.bannedKeyIds[u]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${u} key-session "${e.mediaKeysSession.sessionId}"`),t[u]=s}),t}fetchServerCertificate(e){const t=this.config,s=t.loader,r=new s(t),a=this.getServerCertificateUrl(e);return a?(this.log(`Fetching server certificate for "${e}"`),new Promise((u,c)=>{const h={responseType:"arraybuffer",url:a},d=t.certLoadPolicy.default,g={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(y,E,T,x)=>{u(y.data)},onError:(y,E,T,x)=>{c(new Os({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:T,response:lt({url:h.url,data:void 0},y)},`"${e}" certificate request failed (${a}). Status: ${y.code} (${y.text})`))},onTimeout:(y,E,T)=>{c(new Os({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:T,response:{url:h.url,data:void 0}},`"${e}" certificate request timed out (${a})`))},onAbort:(y,E,T)=>{c(new Error("aborted"))}};r.load(h,g,p)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((r,a)=>{e.setServerCertificate(s).then(u=>{this.log(`setServerCertificate ${u?"success":"not supported by CDM"} (${s.byteLength}) on "${t}"`),r(e)}).catch(u=>{a(new Os({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:u,fatal:!0},u.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(r=>{throw new Os({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:r,fatal:!1},r.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(s,"application/xml"),a=r.querySelectorAll("HttpHeader");if(a.length>0){let g;for(let p=0,y=a.length;p<y;p++){var u,c;g=a[p];const E=(u=g.querySelector("name"))==null?void 0:u.textContent,T=(c=g.querySelector("value"))==null?void 0:c.textContent;E&&T&&e.setRequestHeader(E,T)}}const h=r.querySelector("Challenge"),d=h==null?void 0:h.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return cd(atob(d))}setupLicenseXHR(e,t,s,r){const a=this.config.licenseXhrSetup;return a?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return a.call(this.hls,e,t,s,r)}).catch(u=>{if(!s.decryptdata)throw u;return e.open("POST",t,!0),a.call(this.hls,e,t,s,r)}).then(u=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:u||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((r,a)=>{const u=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${u}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return a(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let h=c.response;this.log(`License received ${h instanceof ArrayBuffer?h.byteLength:h}`);const d=this.config.licenseResponseCallback;if(d)try{h=d.call(this.hls,c,u,e)}catch(g){this.error(g)}r(h)}else{const h=s.errorRetry,d=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||c.status>=400&&c.status<500)a(new Os({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:c,response:{url:u,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${u}). Status: ${c.status} (${c.statusText})`));else{const g=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${g} attempts left`),this.requestLicense(e,t).then(r,a)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=c,this.setupLicenseXHR(c,u,e,t).then(({xhr:h,licenseChallenge:d})=>{e.keySystem==_t.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(h,d)),h.send(d)}).catch(a)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,cs(s,"encrypted",this.onMediaEncrypted),cs(s,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(Ss(e,"encrypted",this.onMediaEncrypted),Ss(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,ll.clearKeyUriToKeyIdMap();const r=s.length;Yr.CDMCleanupPromise=Promise.all(s.map(a=>this.removeSession(a)).concat((t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(b.ERROR,{type:Le.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(b.ERROR,{type:Le.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null,this.bannedKeyIds={}}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((r,a)=>(r.indexOf(a.keyFormat)===-1&&r.push(a.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:r}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Ts((r==null?void 0:r.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const a=this.mediaKeySessions.indexOf(e);a>-1&&this.mediaKeySessions.splice(a,1);const{keyStatusTimeouts:u}=e;u&&Object.keys(u).forEach(d=>self.clearTimeout(u[d]));const{drmSystemOptions:c}=this.config;return(wx(c)?new Promise((d,g)=>{self.setTimeout(()=>g(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(d).catch(g)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(b.ERROR,{type:Le.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>t.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(b.ERROR,{type:Le.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}Yr.CDMCleanupPromise=void 0;function Bo(l){if(!l)throw new Error("Could not read keyId of undefined decryptdata");if(l.keyId===null)throw new Error("keyId is null");return Ts(l.keyId)}function W1(l,e){if(l.keyId&&e.mediaKeysSession.keyStatuses.has(l.keyId))return e.mediaKeysSession.keyStatuses.get(l.keyId);if(l.matches(e.decryptdata))return e.keyStatus}class Os extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function $p(l,e){const t=l==="output-restricted",s=t?z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:z.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Os({type:Le.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${l}"`)}class Z1{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(b.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(b.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const r=performance.now();if(t){if(this.lastTime){const a=r-this.lastTime,u=s-this.lastDroppedFrames,c=t-this.lastDecodedFrames,h=1e3*u/a,d=this.hls;if(d.trigger(b.FPS_DROP,{currentDropped:u,currentDecoded:c,totalDroppedFrames:s}),h>0&&u>d.config.fpsDroppedMonitoringThreshold*c){let g=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+g),g>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=g)&&(g=g-1,d.trigger(b.FPS_DROP_LEVEL_CAPPING,{level:g,droppedLevel:d.currentLevel}),d.autoLevelCapping=g,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function Tv(l,e){let t;try{t=new Event("addtrack")}catch(s){t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=l,e.dispatchEvent(t)}function Sv(l,e){const t=l.mode;if(t==="disabled"&&(l.mode="hidden"),l.cues&&!l.cues.getCueById(e.id))try{if(l.addCue(e),!l.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){ot.debug(`[texttrack-utils]: ${s}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,l.addCue(r)}catch(r){ot.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(l.mode=t)}function Vr(l,e){const t=l.mode;if(t==="disabled"&&(l.mode="hidden"),l.cues)for(let s=l.cues.length;s--;)e&&l.cues[s].removeEventListener("enter",e),l.removeCue(l.cues[s]);t==="disabled"&&(l.mode=t)}function Ed(l,e,t,s){const r=l.mode;if(r==="disabled"&&(l.mode="hidden"),l.cues&&l.cues.length>0){const a=eA(l.cues,e,t);for(let u=0;u<a.length;u++)(!s||s(a[u]))&&l.removeCue(a[u])}r==="disabled"&&(l.mode=r)}function J1(l,e){if(e<=l[0].startTime)return 0;const t=l.length-1;if(e>l[t].endTime)return-1;let s=0,r=t,a;for(;s<=r;)if(a=Math.floor((r+s)/2),e<l[a].startTime)r=a-1;else if(e>l[a].startTime&&s<t)s=a+1;else return a;return l[s].startTime-e<e-l[r].startTime?s:r}function eA(l,e,t){const s=[],r=J1(l,e);if(r>-1)for(let a=r,u=l.length;a<u;a++){const c=l[a];if(c.startTime>=e&&c.endTime<=t)s.push(c);else if(c.startTime>t)return s}return s}function Jo(l){const e=[];for(let t=0;t<l.length;t++){const s=l[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(l[t])}return e}class tA extends Kd{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=Jo(this.media.textTracks);for(let a=0;a<s.length;a++)if(s[a].mode==="hidden")t=s[a];else if(s[a].mode==="showing"){t=s[a];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(b.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;Jo(s.textTracks).forEach(u=>{Vr(u)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:r,details:a}=t,u=this.tracksInGroup[s];if(!u||u.groupId!==r){this.warn(`Subtitle track with id:${s} and group:${r} not found in active group ${u==null?void 0:u.groupId}`);return}const c=u.details;u.details=t.details,this.log(`Subtitle track ${s} "${u.name}" lang:${u.lang} group:${r} loaded [${a.startSN}-${a.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,r=this.groupIds;let a=this.currentTrack;if(!s||(r==null?void 0:r.length)!==(s==null?void 0:s.length)||s!=null&&s.some(u=>(r==null?void 0:r.indexOf(u))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(g=>!s||s.indexOf(g.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(g=>g.default)&&(this.selectDefaultTrack=!1),u.forEach((g,p)=>{g.id=p});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const c=this.hls.config.subtitlePreference;if(!a&&c){this.selectDefaultTrack=!1;const g=vi(c,u);if(g>-1)a=u[g];else{const p=vi(c,this.tracks);a=this.tracks[p]}}let h=this.findTrackId(a);h===-1&&a&&(h=this.findTrackId(null));const d={subtitleTracks:u};this.log(`Updating subtitle tracks, ${u.length} track(s) found in "${s==null?void 0:s.join(",")}" group-id`),this.hls.trigger(b.SUBTITLE_TRACKS_UPDATED,d),h!==-1&&this.trackId===-1&&this.setSubtitleTrack(h)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const a=t[r];if(!(s&&!a.default||!s&&!e)&&(!e||qn(a,e)))return r}if(e){for(let r=0;r<t.length;r++){const a=t[r];if(fl(e.attrs,a.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const a=t[r];if(fl(e.attrs,a.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const r=t[s];if(md(r,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Ve.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&qn(e,s))return s;const r=vi(e,this.tracksInGroup);if(r>-1){const a=this.tracksInGroup[r];return this.setSubtitleTrack(r),a}else{if(s)return null;{const a=vi(e,t);if(a>-1)return t[a]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,r=e.groupId,a=this.getUrlWithDirectives(e.url,t),u=e.details,c=u==null?void 0:u.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&u.live?" age "+c.toFixed(1)+(u.type&&" "+u.type||""):""} ${a}`),this.hls.trigger(b.SUBTITLE_TRACK_LOADING,{url:a,id:s,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Jo(e.textTracks),s=this.currentTrack;let r;if(s&&(r=t.filter(a=>md(s,a))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(a=>{a.mode!=="disabled"&&a!==r&&(a.mode="disabled")}),r){const a=this.subtitleDisplay?"showing":"hidden";r.mode!==a&&(r.mode=a)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Ee(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:e});return}const a=!!r.details&&!r.details.live;if(e===this.trackId&&r===s&&a)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:u,groupId:c="",name:h,type:d,url:g}=r;this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:u,groupId:c,name:h,type:d,url:g});const p=this.switchParams(r.url,s==null?void 0:s.details,r.details);this.loadPlaylist(p)}}function sA(){try{return crypto.randomUUID()}catch(l){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const a=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?a:a&3|8).toString(16)})}}}function sl(l){let e=5381,t=l.length;for(;t;)e=e*33^l.charCodeAt(--t);return(e>>>0).toString()}const qr=.025;let fu=(function(l){return l[l.Point=0]="Point",l[l.Range=1]="Range",l})({});function iA(l,e,t){return`${l.identifier}-${t+1}-${sl(e)}`}class nA{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Vf(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=Vf(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Ee(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Vf(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<qr))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?fu.Range:fu.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return rA(this)}}function Vf(l,e){return l-e.start<e.duration/2&&!(Math.abs(l-(e.start+e.duration))<qr)?e.start:e.start+e.duration}function xv(l,e,t){const s=new self.URL(l,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function Kf(l,e){for(;(t=l.assetList[++e])!=null&&t.error;)var t;return e}function rA(l){return`["${l.identifier}" ${l.cue.pre?"<pre>":l.cue.post?"<post>":""}${l.timelineStart.toFixed(2)}-${l.resumeTime.toFixed(2)}]`}function jr(l){const e=l.timelineStart,t=l.duration||0;return`["${l.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class aA{constructor(e,t,s,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(b.PLAYOUT_LIMIT_REACHED,{})};const a=this.hls=new e(t);this.interstitial=s,this.assetItem=r;const u=()=>{this.hasDetails=!0};a.once(b.LEVEL_LOADED,u),a.once(b.AUDIO_TRACK_LOADED,u),a.once(b.SUBTITLE_TRACK_LOADED,u),a.on(b.MEDIA_ATTACHING,(c,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&a.on(b.BUFFER_APPENDED,()=>{const g=this.bufferedEnd;this.reachedPlayout(g)&&(this._bufferedEosTime=g,a.trigger(b.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=xv(t,e.config.primarySessionId||"").href}catch(s){}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,a=Ne.bufferInfo(e,r,0);return this.getAssetTime(a.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Ne.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var r;(r=this.hls)==null||r.on(e,t)}once(e,t,s){var r;(r=this.hls)==null||r.once(e,t)}off(e,t,s){var r;(r=this.hls)==null||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${jr(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Gp=.033;class lA extends Ws{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(a=r[s])!=null&&a.event;){var a;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let r=0;r<s.length;r++){let a=s[r];if(t&&t!=="primary"&&(a=a[t]),e===a.start||e>a.start&&e<a.end)return r}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let r=e;r<=t&&s[r];r++){const a=s[r].event;if(a!=null&&a.restrictions.jump&&!a.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var s;if(((s=t[r].event)==null?void 0:s.identifier)===e)return r}return-1}findAssetIndex(e,t){const s=e.assetList,r=s.length;if(r>1)for(let a=0;a<r;a++){const u=s[a];if(!u.error){const c=u.timelineStart;if(t===c||t>c&&(t<c+(u.duration||0)||a===r-1))return a}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,r=s[s.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:r}=s,a=this.events,u=this.parseDateRanges(r,{url:s.url},t),c=Object.keys(r),h=a?a.filter(d=>!c.includes(d.identifier)):[];u.length&&u.sort((d,g)=>{const p=d.cue.pre,y=d.cue.post,E=g.cue.pre,T=g.cue.post;if(p&&!E)return-1;if(E&&!p||y&&!T)return 1;if(T&&!y)return-1;if(!p&&!E&&!y&&!T){const x=d.startTime,S=g.startTime;if(x!==S)return x-S}return d.dateRange.tagOrder-g.dateRange.tagOrder}),this.events=u,h.forEach(d=>{this.removeEvent(d)}),this.updateSchedule(e,h)}updateSchedule(e,t=[],s=!1){const r=this.events||[];if(r.length||t.length||this.length<2){const a=this.items,u=this.parseSchedule(r,e);(s||t.length||(a==null?void 0:a.length)!==u.length||u.some((h,d)=>Math.abs(h.playout.start-a[d].playout.start)>.005||Math.abs(h.playout.end-a[d].playout.end)>.005))&&(this.items=u,this.onScheduleUpdate(t,a))}}parseDateRanges(e,t,s){const r=[],a=Object.keys(e);for(let u=0;u<a.length;u++){const c=a[u],h=e[c];if(h.isInterstitial){let d=this.eventMap[c];d?d.setDateRange(h):(d=new nA(h,t),this.eventMap[c]=d,s===!1&&(d.appendInPlace=s)),r.push(d)}}return r}parseSchedule(e,t){const s=[],r=t.main.details,a=r.live?1/0:r.edge;let u=0;if(e=e.filter(h=>!h.error&&!(h.cue.once&&h.hasPlayed)),e.length){this.resolveOffsets(e,t);let h=0,d=0;if(e.forEach((g,p)=>{const y=g.cue.pre,E=g.cue.post,T=e[p-1]||null,x=g.appendInPlace,S=E?a:g.startOffset,R=g.duration,_=g.timelineOccupancy===fu.Range?R:0,A=g.resumptionOffset,C=(T==null?void 0:T.startTime)===S,k=S+g.cumulativeDuration;let G=x?k+R:S+A;if(y||!E&&S<=0){const P=d;d+=_,g.timelineStart=k;const B=u;u+=R,s.push({event:g,start:k,end:G,playout:{start:B,end:u},integrated:{start:P,end:d}})}else if(S<=a){if(!C){const M=S-h;if(M>Gp){const j=h,ee=d;d+=M;const oe=u;u+=M;const de={previousEvent:e[p-1]||null,nextEvent:g,start:j,end:j+M,playout:{start:oe,end:u},integrated:{start:ee,end:d}};s.push(de)}else M>0&&T&&(T.cumulativeDuration+=M,s[s.length-1].end=S)}E&&(G=k),g.timelineStart=k;const P=d;d+=_;const B=u;u+=R,s.push({event:g,start:k,end:G,playout:{start:B,end:u},integrated:{start:P,end:d}})}else return;const w=g.resumeTime;E||w>a?h=a:h=w}),h<a){var c;const g=h,p=d,y=a-h;d+=y;const E=u;u+=y,s.push({previousEvent:((c=s[s.length-1])==null?void 0:c.event)||null,nextEvent:null,start:h,end:g+y,playout:{start:E,end:u},integrated:{start:p,end:d}})}this.setDurations(a,u,d)}else s.push({previousEvent:null,nextEvent:null,start:0,end:a,playout:{start:0,end:a},integrated:{start:0,end:a}}),this.setDurations(a,a,a);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,r=s.live?1/0:s.edge;let a=0,u=-1;e.forEach((c,h)=>{const d=c.cue.pre,g=c.cue.post,p=d?0:g?r:c.startTime;this.updateAssetDurations(c),u===p?c.cumulativeDuration=a:(a=0,u=p),!g&&c.snapOptions.in&&(c.resumeAnchor=Qn(null,s.fragments,c.startOffset+c.resumptionOffset,0,0)||void 0),c.appendInPlace&&!c.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(c,t)||(c.appendInPlace=!1)),!c.appendInPlace&&h+1<e.length&&e[h+1].startTime-e[h].resumeTime<Gp&&(e[h+1].appendInPlace=!1,e[h+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${c}`));const E=Ee(c.resumeOffset)?c.resumeOffset:c.duration;a+=E})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(s-r)>qr?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${r}`),!1):!Object.keys(t).some(u=>{const c=t[u].details,h=c.edge;if(s>=h)return this.log(`"${e.identifier}" resumption ${s} past ${u} playlist end ${h}`),!1;const d=Qn(null,c.fragments,s);if(!d)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${u} playlist (${c.fragStart}-${c.fragmentEnd})`),!0;const g=u==="audio"?.175:0;return Math.abs(d.start-s)<qr+g||Math.abs(d.end-s)<qr+g?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${u} fragment bounds (${d.start}-${d.end} sn: ${d.sn} cc: ${d.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,r=!1,a=!1;for(let u=0;u<e.assetList.length;u++){const c=e.assetList[u],h=t+s;c.startOffset=s,c.timelineStart=h,r||(r=c.duration===null),a||(a=!!c.error);const d=c.error?0:c.duration||0;s+=d}r&&!a?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function si(l){return`[${l.event?'"'+l.event.identifier+'"':"primary"}: ${l.start.toFixed(2)}-${l.end.toFixed(2)}]`}class oA{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let r;try{r=xv(s,this.hls.sessionId,e.baseUrl)}catch(y){const E=this.assignAssetListError(e,z.ASSET_LIST_LOAD_ERROR,y,s);this.hls.trigger(b.ERROR,E);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const a=this.hls.config,u=a.loader,c=new u(a),h={responseType:"json",url:r.href},d=a.interstitialAssetListLoadPolicy.default,g={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(y,E,T,x)=>{const S=y.data,R=S==null?void 0:S.ASSETS;if(!Array.isArray(R)){const _=this.assignAssetListError(e,z.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),T.url,E,x);this.hls.trigger(b.ERROR,_);return}e.assetListResponse=S,this.hls.trigger(b.ASSET_LIST_LOADED,{event:e,assetListResponse:S,networkDetails:x})},onError:(y,E,T,x)=>{const S=this.assignAssetListError(e,z.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${y.code} ${y.text} (${E.url})`),E.url,x,T);this.hls.trigger(b.ERROR,S)},onTimeout:(y,E,T)=>{const x=this.assignAssetListError(e,z.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${E.url})`),E.url,y,T);this.hls.trigger(b.ERROR,x)}};return c.load(h,g,p),this.hls.trigger(b.ASSET_LIST_LOADING,{event:e}),c}assignAssetListError(e,t,s,r,a,u){return e.error=s,{type:Le.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:s,networkDetails:u,stats:a}}}function jp(l){l==null||l.play().catch(()=>{})}function Fo(l,e){return`[${l}] Advancing timeline position to ${e}`}class uA extends Ws{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const r=s-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const u=r<=-.01;this.timelinePos=s,this.bufferedPos=s;const c=this.playingItem;if(!c){this.checkBuffer();return}if(u&&this.schedule.resetErrorsInRange(s,s-r)&&this.updateSchedule(!0),this.checkBuffer(),u&&s<c.start||s>=c.end){var h;const E=this.findItemIndex(c);let T=this.schedule.findItemIndexAtTime(s);if(T===-1&&(T=E+(u?-1:1),this.log(`seeked ${u?"back ":""}to position not covered by schedule ${s} (resolving from ${E} to ${T})`)),!this.isInterstitial(c)&&(h=this.media)!=null&&h.paused&&(this.shouldPlay=!1),!u&&T>E){const x=this.schedule.findJumpRestrictedIndex(E+1,T);if(x>E){this.setSchedulePosition(x);return}}this.setSchedulePosition(T);return}const d=this.playingAsset;if(!d){if(this.playingLastItem&&this.isInterstitial(c)){const E=c.event.assetList[0];E&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,E))}return}const g=d.timelineStart,p=d.duration||0;if(u&&s<g||s>=g+p){var y;(y=c.event)!=null&&y.appendInPlace&&(this.clearInterstitial(c.event,c),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,d)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(s>=r.end){this.timelinePos=r.end;const c=this.findItemIndex(r);this.setSchedulePosition(c+1)}const a=this.playingAsset;if(!a)return;const u=a.timelineStart+(a.duration||0);s>=u&&this.setScheduleToAssetAtTime(s,a)},this.onScheduleUpdate=(s,r)=>{const a=this.schedule;if(!a)return;const u=this.playingItem,c=a.events||[],h=a.items||[],d=a.durations,g=s.map(x=>x.identifier),p=!!(c.length||g.length);(p||r)&&this.log(`INTERSTITIALS_UPDATED (${c.length}): ${c}
Schedule: ${h.map(x=>si(x))} pos: ${this.timelinePos}`),g.length&&this.log(`Removed events ${g}`);let y=null,E=null;u&&(y=this.updateItem(u,this.timelinePos),this.itemsMatch(u,y)?this.playingItem=y:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const T=this.bufferingItem;if(T&&(E=this.updateItem(T,this.bufferedPos),this.itemsMatch(T,E)?this.bufferingItem=E:T.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(T.event,null))),s.forEach(x=>{x.assetList.forEach(S=>{this.clearAssetPlayer(S.identifier,null)})}),this.playerQueue.forEach(x=>{if(x.interstitial.appendInPlace){const S=x.assetItem.timelineStart,R=x.timelineOffset-S;if(R)try{x.timelineOffset=S}catch(_){Math.abs(R)>qr&&this.warn(`${_} ("${x.assetId}" ${x.timelineOffset}->${S})`)}}}),p||r){if(this.hls.trigger(b.INTERSTITIALS_UPDATED,{events:c.slice(0),schedule:h.slice(0),durations:d,removedIds:g}),this.isInterstitial(u)&&g.includes(u.event.identifier)){this.warn(`Interstitial "${u.event.identifier}" removed while playing`),this.primaryFallback(u.event);return}u&&this.trimInPlace(y,u),T&&E!==y&&this.trimInPlace(E,T),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new oA(e),this.schedule=new lA(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(b.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(b.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(b.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(b.BUFFER_APPENDED,this.onBufferAppended,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(b.MEDIA_ENDED,this.onMediaEnded,this),e.on(b.ERROR,this.onError,this),e.on(b.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(b.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(b.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(b.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.BUFFER_APPENDED,this.onBufferAppended,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(b.MEDIA_ENDED,this.onMediaEnded,this),e.off(b.ERROR,this.onError,this),e.off(b.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Ss(e,"play",this.onPlay),Ss(e,"pause",this.onPause),Ss(e,"seeking",this.onSeeking),Ss(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;cs(s,"seeking",this.onSeeking),cs(s,"timeupdate",this.onTimeupdate),cs(s,"play",this.onPlay),cs(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!r){this.clearScheduleState();const a=this.findItemIndex(s);this.setSchedulePosition(a)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,r=this.media;if(this.media=null,!s&&(r&&this.removeMediaListeners(r),this.detachedData)){const a=this.getBufferingPlayer();a&&(this.log(`Removing schedule state for detachedData and ${a}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,a.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=p=>p&&e.getAssetPlayer(p.identifier),r=(p,y,E,T,x)=>{if(p){let S=p[y].start;const R=p.event;if(R){if(y==="playout"||R.timelineOccupancy!==fu.Point){const _=s(E);(_==null?void 0:_.interstitial)===R&&(S+=_.assetItem.startOffset+_[x])}}else{const _=T==="bufferedPos"?u():e[T];S+=_-p.start}return S}return 0},a=(p,y)=>{var E;if(p!==0&&y!=="primary"&&(E=e.schedule)!=null&&E.length){var T;const x=e.schedule.findItemIndexAtTime(p),S=(T=e.schedule.items)==null?void 0:T[x];if(S){const R=S[y].start-S.start;return p+R}}return p},u=()=>{const p=e.bufferedPos;return p===Number.MAX_VALUE?c("primary"):Math.max(p,0)},c=p=>{var y,E;return(y=e.primaryDetails)!=null&&y.live?e.primaryDetails.edge:((E=e.schedule)==null?void 0:E.durations[p])||0},h=(p,y)=>{var E,T;const x=e.effectivePlayingItem;if(x!=null&&(E=x.event)!=null&&E.restrictions.skip||!e.schedule)return;e.log(`seek to ${p} "${y}"`);const S=e.effectivePlayingItem,R=e.schedule.findItemIndexAtTime(p,y),_=(T=e.schedule.items)==null?void 0:T[R],A=e.getBufferingPlayer(),C=A==null?void 0:A.interstitial,k=C==null?void 0:C.appendInPlace,G=S&&e.itemsMatch(S,_);if(S&&(k||G)){const w=s(e.playingAsset),P=(w==null?void 0:w.media)||e.primaryMedia;if(P){const B=y==="primary"?P.currentTime:r(S,y,e.playingAsset,"timelinePos","currentTime"),M=p-B,j=(k?B:P.currentTime)+M;if(j>=0&&(!w||k||j<=w.duration)){P.currentTime=j;return}}}if(_){let w=p;if(y!=="primary"){const B=_[y].start,M=p-B;w=_.start+M}const P=!e.isInterstitial(_);if((!e.isInterstitial(S)||S.event.appendInPlace)&&(P||_.event.appendInPlace)){const B=e.media||(k?A==null?void 0:A.media:null);B&&(B.currentTime=w)}else if(S){const B=e.findItemIndex(S);if(R>B){const j=e.schedule.findJumpRestrictedIndex(B+1,R);if(j>B){e.setSchedulePosition(j);return}}let M=0;if(P)e.timelinePos=w,e.checkBuffer();else{const j=_.event.assetList,ee=p-(_[y]||_).start;for(let oe=j.length;oe--;){const de=j[oe];if(de.duration&&ee>=de.startOffset&&ee<de.startOffset+de.duration){M=oe;break}}}e.setSchedulePosition(R,M)}}},d=()=>{const p=e.effectivePlayingItem;if(e.isInterstitial(p))return p;const y=t();return e.isInterstitial(y)?y:null},g={get bufferedEnd(){const p=t(),y=e.bufferingItem;if(y&&y===p){var E;return r(y,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-y.playout.start||((E=e.bufferingAsset)==null?void 0:E.startOffset)||0}return 0},get currentTime(){const p=d(),y=e.effectivePlayingItem;return y&&y===p?r(y,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-y.playout.start:0},set currentTime(p){const y=d(),E=e.effectivePlayingItem;E&&E===y&&h(p+E.playout.start,"playout")},get duration(){const p=d();return p?p.playout.end-p.playout.start:0},get assetPlayers(){var p;const y=(p=d())==null?void 0:p.event.assetList;return y?y.map(E=>e.getAssetPlayer(E.identifier)):[]},get playingIndex(){var p;const y=(p=d())==null?void 0:p.event;return y&&e.effectivePlayingAsset?y.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return d()}};return this.manager={get events(){var p;return((p=e.schedule)==null||(p=p.events)==null?void 0:p.slice(0))||[]},get schedule(){var p;return((p=e.schedule)==null||(p=p.items)==null?void 0:p.slice(0))||[]},get interstitialPlayer(){return d()?g:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const p=t();return e.findItemIndex(p)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const p=e.effectivePlayingItem;return e.findItemIndex(p)},primary:{get bufferedEnd(){return u()},get currentTime(){const p=e.timelinePos;return p>0?p:0},set currentTime(p){h(p,"primary")},get duration(){return c("primary")},get seekableStart(){var p;return((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(p){h(p,"integrated")},get duration(){return c("integrated")},get seekableStart(){var p;return a(((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0,"integrated")}},skip:()=>{const p=e.effectivePlayingItem,y=p==null?void 0:p.event;if(y&&!y.restrictions.skip){const E=e.findItemIndex(p);if(y.appendInPlace){const T=p.playout.start+p.event.duration;h(T+.001,"playout")}else e.advanceAfterAssetEnded(y,E,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);const a=(t=r)==null?void 0:t.currentTime;if(!(a===void 0||!Ee(a)))return a}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,r=e.media;if(s&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const a=e.transferMedia();this.log(`transfer MediaSource from ${e} ${vt(a)}`),this.detachedData=a}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var s,r;if(e.media===t)return;let a=null;const u=this.hls,c=e!==u,h=c&&e.interstitial.appendInPlace,d=(s=this.detachedData)==null?void 0:s.mediaSource;let g;if(u.media)h&&(a=u.transferMedia(),this.detachedData=a),g="Primary";else if(d){const T=this.getBufferingPlayer();T?(a=T.transferMedia(),g=`${T}`):g="detached MediaSource"}else g="detached media";if(!a){if(d)a=this.detachedData,this.log(`using detachedData: MediaSource ${vt(a)}`);else if(!this.detachedData||u.media===t){const T=this.playerQueue;T.length>1&&T.forEach(x=>{if(c&&x.interstitial.appendInPlace!==h){const S=x.interstitial;this.clearInterstitial(x.interstitial,null),S.appendInPlace=!1,S.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${S}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const p=a&&"mediaSource"in a&&((r=a.mediaSource)==null?void 0:r.readyState)!=="closed",y=p&&a?a:t;this.log(`${p?"transfering MediaSource":"attaching media"} to ${c?e:"Primary"} from ${g} (media.currentTime: ${t.currentTime})`);const E=this.schedule;if(y===a&&E){const T=c&&e.assetId===E.assetIdAtEnd;y.overrides={duration:E.duration,endOfStream:!c||T,cueRemoval:!c}}e.attachMedia(y)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,r=this.effectivePlayingItem;if(s===-1){const a=this.hls.startPosition;if(this.log(Fo("checkStart",a)),this.timelinePos=a,t.length&&t[0].cue.pre){const u=e.findEventIndex(t[0].identifier);this.setSchedulePosition(u)}else if(a>=0||!this.primaryLive){const u=this.timelinePos=a>0?a:0,c=e.findItemIndexAtTime(u);this.setSchedulePosition(c)}}else if(r&&!this.playingItem){const a=e.findItemIndex(r);this.setSchedulePosition(a)}}advanceAssetBuffering(e,t){const s=e.event,r=s.findAssetIndex(t),a=Kf(s,r);if(!s.isAssetPastPlayoutLimit(a))this.bufferedToEvent(e,a);else if(this.schedule){var u;const c=(u=this.schedule.items)==null?void 0:u[this.findItemIndex(e)+1];c&&this.bufferedToItem(c)}}advanceAfterAssetEnded(e,t,s){const r=Kf(e,s);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const a=this.schedule.items;if(a){const u=t+1,c=a.length;if(u>=c){this.setSchedulePosition(-1);return}const h=e.resumeTime;this.timelinePos<h&&(this.log(Fo("advanceAfterAssetEnded",h)),this.timelinePos=h,e.appendInPlace&&this.advanceInPlace(h),this.checkBuffer(this.bufferedPos<h)),this.setSchedulePosition(u)}}}else{if(e.appendInPlace){const a=e.assetList[r];a&&this.advanceInPlace(a.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const r=t.parentIdentifier,a=s.getEvent(r);if(a){const u=s.findEventIndex(r),c=s.findAssetIndex(a,e);this.advanceAfterAssetEnded(a,u,c-1)}}setSchedulePosition(e,t){var s;const r=(s=this.schedule)==null?void 0:s.items;if(!r||this.playbackDisabled)return;const a=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${a&&si(a)}) pos: ${this.timelinePos}`);const u=this.waitingItem||this.playingItem,c=this.playingLastItem;if(this.isInterstitial(u)){const g=u.event,p=this.playingAsset,y=p==null?void 0:p.identifier,E=y?this.getAssetPlayer(y):null;if(E&&y&&(!this.eventItemsMatch(u,a)||t!==void 0&&y!==g.assetList[t].identifier)){var h;const T=g.findAssetIndex(p);if(this.log(`INTERSTITIAL_ASSET_ENDED ${T+1}/${g.assetList.length} ${jr(p)}`),this.endedAsset=p,this.playingAsset=null,this.hls.trigger(b.INTERSTITIAL_ASSET_ENDED,{asset:p,assetListIndex:T,event:g,schedule:r.slice(0),scheduleIndex:e,player:E}),u!==this.playingItem){this.itemsMatch(u,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(g,this.findItemIndex(this.playingItem),T);return}this.retreiveMediaSource(y,a),E.media&&!((h=this.detachedData)!=null&&h.mediaSource)&&E.detachMedia()}if(!this.eventItemsMatch(u,a)&&(this.endedItem=u,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${g} ${si(u)}`),g.hasPlayed=!0,this.hls.trigger(b.INTERSTITIAL_ENDED,{event:g,schedule:r.slice(0),scheduleIndex:e}),g.cue.once)){var d;this.updateSchedule();const T=(d=this.schedule)==null?void 0:d.items;if(a&&T){const x=this.findItemIndex(a);this.advanceSchedule(x,T,t,u,c)}return}}this.advanceSchedule(e,r,t,u,c)}advanceSchedule(e,t,s,r,a){const u=this.schedule;if(!u)return;const c=t[e]||null,h=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(g=>{const p=g.interstitial,y=u.findEventIndex(p.identifier);(y<e||y>e+1)&&this.clearInterstitial(p,c)}),this.isInterstitial(c)){this.timelinePos=Math.min(Math.max(this.timelinePos,c.start),c.end);const g=c.event;if(s===void 0){s=u.findAssetIndex(g,this.timelinePos);const T=Kf(g,s-1);if(g.isAssetPastPlayoutLimit(T)||g.appendInPlace&&this.timelinePos===c.end){this.advanceAfterAssetEnded(g,e,s);return}s=T}const p=this.waitingItem;this.assetsBuffered(c,h)||this.setBufferingItem(c);let y=this.preloadAssets(g,s);if(this.eventItemsMatch(c,p||r)||(this.waitingItem=c,this.log(`INTERSTITIAL_STARTED ${si(c)} ${g.appendInPlace?"append in place":""}`),this.hls.trigger(b.INTERSTITIAL_STARTED,{event:g,schedule:t.slice(0),scheduleIndex:e})),!g.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${g}`);return}if(g.assetListLoader&&(g.assetListLoader.destroy(),g.assetListLoader=void 0),!h){this.log(`Waiting for attachMedia to start Interstitial ${g}`);return}this.waitingItem=this.endedItem=null,this.playingItem=c;const E=g.assetList[s];if(!E){this.advanceAfterAssetEnded(g,e,s||0);return}if(y||(y=this.getAssetPlayer(E.identifier)),y===null||y.destroyed){const T=g.assetList.length;this.warn(`asset ${s+1}/${T} player destroyed ${g}`),y=this.createAssetPlayer(g,E,s),y.loadSource()}if(!this.eventItemsMatch(c,this.bufferingItem)&&g.appendInPlace&&this.isAssetBuffered(E))return;this.startAssetPlayer(y,s,t,e,h),this.shouldPlay&&jp(y.media)}else c?(this.resumePrimary(c,e,r),this.shouldPlay&&jp(this.hls.media)):a&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(u.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var r,a;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${si(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let c=this.timelinePos;(c<e.start||c>=e.end)&&(c=this.getPrimaryResumption(e,t),this.log(Fo("resumePrimary",c)),this.timelinePos=c),this.attachPrimary(c,e)}if(!s)return;const u=(a=this.schedule)==null?void 0:a.items;u&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${si(e)}`),this.hls.trigger(b.INTERSTITIALS_PRIMARY_RESUMED,{schedule:u.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(s<r.fragmentStart||s>r.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Ne.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const a=this.hls;a.media?this.checkBuffer():(this.transferMediaTo(a,r),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(Fo("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((s=r.mainForwardBufferInfo)==null?void 0:s.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(b.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(b.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const r=lt(lt({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=lt(lt({},this.altSelection),{},{audio:s});return}const a=lt(lt({},r),{},{audio:s});this.mediaSelection=a}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=lt(lt({},this.altSelection),{},{subtitles:s});return}const a=lt(lt({},r),{},{subtitles:s});this.mediaSelection=a}onAudioTrackSwitching(e,t){const s=Jm(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(t)||r.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=Jm(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(t)||t.id!==-1&&r.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const a=t[r];if(a.cue.post){var s;const u=this.schedule.findEventIndex(a.identifier),c=(s=this.schedule.items)==null?void 0:s[u];this.isInterstitial(c)&&this.eventItemsMatch(c,this.bufferingItem)&&this.bufferedToItem(c,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const r=(s=this.schedule)==null?void 0:s.items;if(e&&r){const a=this.findItemIndex(e,t);return r[a]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((a,u)=>{e.event.isAssetPastPlayoutLimit(u)&&this.clearAssetPlayer(a.identifier,null)});const s=e.end+.25,r=Ne.bufferInfo(this.primaryMedia,s,0);(r.end>s||(r.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${si(e)} (was ${si(t)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const s=this.mediaSelection;s&&((t=this.schedule)==null||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const r=Ne.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,s,e)}updateBufferedPos(e,t,s){const r=this.schedule,a=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(t.length===1&&this.itemsMatch(t[0],a)){this.bufferedPos=e;return}const u=this.playingItem,c=this.findItemIndex(u);let h=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var d;const g=this.findItemIndex(a),p=Math.min(g+1,t.length-1),y=t[p];if((h===-1&&a&&e>=a.end||(d=y.event)!=null&&d.appendInPlace&&e+.01>=y.start)&&(h=p),this.isInterstitial(a)){const E=a.event;if(p-c>1&&E.appendInPlace===!1||E.assetList.length===0&&E.assetListLoader)return}if(this.bufferedPos=e,h>g&&h>c)this.bufferedToItem(y);else{const E=this.primaryDetails;this.primaryLive&&E&&e>E.edge-E.targetduration&&y.start<E.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(y)&&this.preloadAssets(y.event,0)}}else s&&u&&!this.itemsMatch(u,a)&&(h===c?this.bufferedToItem(u):h===c+1&&this.bufferedToItem(t[h]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const a=this.getAssetPlayer(r.identifier);return!(a!=null&&a.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:r,events:a}=s;if(!r||!a)return t;const u=this.isInterstitial(e),c=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const h=c?c.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${si(e)}`+(t?` (${h.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(u){const d=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((g,p)=>{const y=this.getAssetPlayer(g.identifier);y&&(p===d&&y.loadSource(),y.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(d=>d.pauseBuffering());this.hls.trigger(b.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:a.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,r=s.assetList.length===0&&!s.assetListLoader,a=s.cue.once;if(r||!a){const u=this.preloadAssets(s,t);if(u!=null&&u.interstitial.appendInPlace){const c=this.primaryMedia;c&&this.bufferAssetPlayer(u,c)}}}preloadAssets(e,t){const s=e.assetUrl,r=e.assetList.length,a=r===0&&!e.assetListLoader,u=e.cue.once;if(a){const h=e.timelineStart;if(e.appendInPlace){var c;const y=this.playingItem;!this.isInterstitial(y)&&(y==null||(c=y.nextEvent)==null?void 0:c.identifier)===e.identifier&&this.flushFrontBuffer(h+.25)}let d,g=0;if(!this.playingItem&&this.primaryLive&&(g=this.hls.startPosition,g===-1&&(g=this.hls.liveSyncPosition||0)),g&&!(e.cue.pre||e.cue.post)){const y=g-h;y>0&&(d=Math.round(y*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:r} ${e}${d?` live-start: ${g} start-offset: ${d}`:""}`),s)return this.createAsset(e,0,0,h,e.duration,s);const p=this.assetListLoader.loadAssetList(e,d);p&&(e.assetListLoader=p)}else if(!u&&r){for(let d=t;d<r;d++){const g=e.assetList[d],p=this.getAssetPlayerQueueIndex(g.identifier);(p===-1||this.playerQueue[p].destroyed)&&!g.error&&this.createAssetPlayer(e,g,d)}const h=e.assetList[t];if(h){const d=this.getAssetPlayer(h.identifier);return d&&d.loadSource(),d}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,r,a,u){const c={parentIdentifier:e.identifier,identifier:iA(e,u,t),duration:a,startOffset:s,timelineStart:r,uri:u};return this.createAssetPlayer(e,c,t)}createAssetPlayer(e,t,s){const r=this.hls,a=r.userConfig;let u=a.videoPreference;const c=r.loadLevelObj||r.levels[r.currentLevel];(u||c)&&(u=dt({},u),c.videoCodec&&(u.videoCodec=c.videoCodec),c.videoRange&&(u.allowedVideoRanges=[c.videoRange]));const h=r.audioTracks[r.audioTrack],d=r.subtitleTracks[r.subtitleTrack];let g=0;if(this.primaryLive||e.appendInPlace){const C=this.timelinePos-t.timelineStart;if(C>1){const k=t.duration;k&&C<k&&(g=C)}}const p=t.identifier,y=lt(lt({},a),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:g,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:u,audioPreference:h||a.audioPreference,subtitlePreference:d||a.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(y.timelineOffset=t.timelineStart));const E=y.cmcd;E!=null&&E.sessionId&&E.contentId&&(y.cmcd=dt({},E,{contentId:sl(t.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${e} and asset ${p}`);const T=new aA(this.HlsPlayerClass,y,e,t);this.playerQueue.push(T),e.assetList[s]=t;let x=!0;const S=C=>{if(C.live){var k;const P=new Error(`Interstitials MUST be VOD assets ${e}`),B={fatal:!0,type:Le.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:P},M=((k=this.schedule)==null?void 0:k.findEventIndex(e.identifier))||-1;this.handleAssetItemError(B,e,M,s,P.message);return}const G=C.edge-C.fragmentStart,w=t.duration;(x||w===null||G>w)&&(x=!1,this.log(`Interstitial asset "${p}" duration change ${w} > ${G}`),t.duration=G,this.updateSchedule())};T.on(b.LEVEL_UPDATED,(C,{details:k})=>S(k)),T.on(b.LEVEL_PTS_UPDATED,(C,{details:k})=>S(k)),T.on(b.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const R=(C,k)=>{const G=this.getAssetPlayer(p);if(G&&k.tracks){G.off(b.BUFFER_CODECS,R),G.tracks=k.tracks;const w=this.primaryMedia;this.bufferingAsset===G.assetItem&&w&&!G.media&&this.bufferAssetPlayer(G,w)}};T.on(b.BUFFER_CODECS,R);const _=()=>{var C;const k=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${k}`),!k||!this.schedule)return;const G=this.schedule.findEventIndex(e.identifier),w=(C=this.schedule.items)==null?void 0:C[G];this.isInterstitial(w)&&this.advanceAssetBuffering(w,t)};T.on(b.BUFFERED_TO_END,_);const A=C=>()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;this.shouldPlay=!0;const G=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,G,C)};return T.once(b.MEDIA_ENDED,A(s)),T.once(b.PLAYOUT_LIMIT_REACHED,A(1/0)),T.on(b.ERROR,(C,k)=>{if(!this.schedule)return;const G=this.getAssetPlayer(p);if(k.details===z.BUFFER_STALLED_ERROR){if(G!=null&&G.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(k,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${k.error} ${e}`)}),T.on(b.DESTROYING,()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;const k=new Error(`Asset player destroyed unexpectedly ${p}`),G={fatal:!0,type:Le.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:k};this.handleAssetItemError(G,e,this.schedule.findEventIndex(e.identifier),s,k.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${jr(t)}`),this.hls.trigger(b.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:T}),T}clearInterstitial(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){const r=this.playerQueue[s];this.log(`clear ${r} toSegment: ${t&&si(t)}`),this.transferMediaFromPlayer(r,t),this.playerQueue.splice(s,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,r,a){const{interstitial:u,assetItem:c,assetId:h}=e,d=u.assetList.length,g=this.playingAsset;this.endedAsset=null,this.playingAsset=c,(!g||g.identifier!==h)&&(g&&(this.clearAssetPlayer(g.identifier,s[r]),delete g.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${d} ${jr(c)}`),this.hls.trigger(b.INTERSTITIAL_ASSET_STARTED,{asset:c,assetListIndex:t,event:u,schedule:s.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,a)}bufferAssetPlayer(e,t){var s,r;if(!this.schedule)return;const{interstitial:a,assetItem:u}=e,c=this.schedule.findEventIndex(a.identifier),h=(s=this.schedule.items)==null?void 0:s[c];if(!h)return;e.loadSource(),this.setBufferingItem(h),this.bufferingAsset=u;const d=this.getBufferingPlayer();if(d===e)return;const g=a.appendInPlace;if(g&&(d==null?void 0:d.interstitial.appendInPlace)===!1)return;const p=(d==null?void 0:d.tracks)||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(g&&u!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(p&&!ly(p,e.tracks)){const y=new Error(`Asset ${jr(u)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),E={fatal:!0,type:Le.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:y},T=a.findAssetIndex(u);this.handleAssetItemError(E,a,c,T,y.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const r=s.currentTime,a=t.findAssetIndex(e,r),u=e.assetList[a];if(u){const c=this.getAssetPlayer(u.identifier);if(c){const h=c.currentTime||r-u.timelineStart,d=c.duration-h;if(this.warn(`Stalled at ${h} of ${h+d} in ${c} ${e} (media.currentTime: ${r})`),h&&(d/s.playbackRate<.5||c.bufferedInPlaceToEnd(s))&&c.hls){const g=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,g,a)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,r,a){if(e.details===z.BUFFER_STALLED_ERROR)return;const u=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${u&&jr(u)} ${e.error}`),!this.schedule)return;const c=(u==null?void 0:u.identifier)||"",h=this.getAssetPlayerQueueIndex(c),d=this.playerQueue[h]||null,g=this.schedule.items,p=dt({},e,{fatal:!1,errorAction:Kr(!0),asset:u,assetListIndex:r,event:t,schedule:g,scheduleIndex:s,player:d});if(this.hls.trigger(b.INTERSTITIAL_ASSET_ERROR,p),!e.fatal)return;const y=this.playingAsset,E=this.bufferingAsset,T=new Error(a);if(u&&(this.clearAssetPlayer(c,null),u.error=T),!t.assetList.some(x=>!x.error))t.error=T;else for(let x=r;x<t.assetList.length;x++)this.resetAssetPlayer(t.assetList[x].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):y&&y.identifier===c?this.advanceAfterAssetEnded(t,s,r):E&&E.identifier===c&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,E)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;if(s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${si(s)} error: ${e.error}`);let r=this.timelinePos;r===-1&&(r=this.hls.startPosition);const a=this.updateItem(s,r);if(this.itemsMatch(s,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const u=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(u)}else this.checkStart()}onAssetListLoaded(e,t){var s,r;const a=t.event,u=a.identifier,c=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(u)))return;const h=a.timelineStart,d=a.duration;let g=0;c.forEach((x,S)=>{const R=parseFloat(x.DURATION);this.createAsset(a,S,g,h+g,R,x.URI),g+=R}),a.duration=g,this.log(`Loaded asset-list with duration: ${g} (was: ${d}) ${a}`);const p=this.waitingItem,y=(p==null?void 0:p.event.identifier)===u;this.updateSchedule();const E=(r=this.bufferingItem)==null?void 0:r.event;if(y){var T;const x=this.schedule.findEventIndex(u),S=(T=this.schedule.items)==null?void 0:T[x];if(S){if(!this.playingItem&&this.timelinePos>S.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==x){a.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${a}`),this.updateSchedule(!0),this.primaryFallback(a);return}this.setBufferingItem(S)}this.setSchedulePosition(x)}else if((E==null?void 0:E.identifier)===u){const x=a.assetList[0];if(x){const S=this.getAssetPlayer(x.identifier);if(E.appendInPlace){const R=this.primaryMedia;S&&R&&this.bufferAssetPlayer(S,R)}else S&&S.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case z.ASSET_LIST_PARSING_ERROR:case z.ASSET_LIST_LOAD_ERROR:case z.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case z.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Hp=500;class cA extends Ud{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",Te.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=re.IDLE,this.setInterval(Hp),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:r}=t;if(this.fragContextChanged(s)||($t(s)&&(this.fragPrevious=s),this.state=re.IDLE),!r)return;const a=this.tracksBuffered[this.currentTrackId];if(!a)return;let u;const c=s.start;for(let d=0;d<a.length;d++)if(c>=a[d].start&&c<=a[d].end){u=a[d];break}const h=s.start+s.duration;u?u.end=h:(u={start:c,end:h},a.push(u)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:r}=t;if(s===0&&r!==Number.POSITIVE_INFINITY){const a=r-1;if(a<=0)return;t.endOffsetSubtitles=Math.max(0,a),this.tracksBuffered.forEach(u=>{for(let c=0;c<u.length;){if(u[c].end<=a){u.shift();continue}else if(u[c].start<a)u[c].start=a;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(s,a,Te.SUBTITLE)}}onError(e,t){const s=t.frag;(s==null?void 0:s.type)===Te.SUBTITLE&&(t.details===z.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==re.STOPPED&&(this.state=re.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&lv(this.levels,t)){this.levels=t.map(s=>new al(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const r=new al(s);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Te.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==re.STOPPED&&this.setInterval(Hp)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:r,levels:a}=this,{details:u,id:c}=t;if(!a){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const h=a[c];if(c>=a.length||!h)return;this.log(`Subtitle track ${c} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""},duration:${u.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(u.live||(s=h.details)!=null&&s.live){if(u.deltaUpdateFailed)return;const p=this.mainDetails;if(!p){this.startFragRequested=!1;return}const y=p.fragments[0];if(!h.details)u.hasProgramDateTime&&p.hasProgramDateTime?(uu(u,p),d=u.fragmentStart):y&&(d=y.start,dd(u,d));else{var g;d=this.alignPlaylists(u,h.details,(g=this.levelLastLoaded)==null?void 0:g.details),d===0&&y&&(d=y.start,dd(u,d))}p&&!this.startFragRequested&&this.setStartPosition(p,d)}h.details=u,this.levelLastLoaded=h,c===r&&(this.hls.trigger(b.SUBTITLE_TRACK_UPDATED,{details:u,id:c,groupId:t.groupId}),this.tick(),u.live&&!this.fragCurrent&&this.media&&this.state===re.IDLE&&(Qn(null,u.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,r=t.decryptdata,a=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&r!=null&&r.key&&r.iv&&zr(r.method)){const u=performance.now();this.decrypter.decrypt(new Uint8Array(s),r.key.buffer,r.iv.buffer,Nd(r.method)).catch(c=>{throw a.trigger(b.ERROR,{type:Le.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(c=>{const h=performance.now();a.trigger(b.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:u,tdecrypt:h}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=re.IDLE})}}doTick(){if(!this.media){this.state=re.IDLE;return}if(this.state===re.IDLE){const{currentTrackId:e,levels:t}=this,s=t==null?void 0:t[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:r}=this,a=this.getLoadPosition(),u=Ne.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],a,r.maxBufferHole),{end:c,len:h}=u,d=s.details,g=this.hls.maxBufferLength+d.levelTargetDuration;if(h>g)return;const p=d.fragments,y=p.length,E=d.edge;let T=null;const x=this.fragPrevious;if(c<E){const _=r.maxFragLookUpTolerance,A=c>E-_?0:_;T=Qn(x,p,Math.max(p[0].start,c),A),!T&&x&&x.start<p[0].start&&(T=p[0])}else T=p[y-1];if(T=this.filterReplacedPrimary(T,s.details),!T)return;const S=T.sn-d.startSN,R=p[S-1];if(R&&R.cc===T.cc&&this.fragmentTracker.getState(R)===Kt.NOT_LOADED&&(T=R),this.fragmentTracker.getState(T)===Kt.NOT_LOADED){const _=this.mapToInitFragWhenRequired(T);_&&this.loadFragment(_,s,c)}}}loadFragment(e,t,s){$t(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new fA(this.tracksBuffered[this.currentTrackId]||[])}}class fA{constructor(e){this.buffered=void 0;const t=(s,r,a)=>{if(r=r>>>0,r>a-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${a})`);return e[r][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const dA={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},bv=l=>String.fromCharCode(dA[l]||l),ii=15,$i=100,hA={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},gA={17:2,18:4,21:6,22:8,23:10,19:13,20:15},mA={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},pA={25:2,26:4,29:6,30:8,31:10,27:13,28:15},yA=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class vA{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;ot.log(`${this.time} [${e}] ${s}`)}}}const zn=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class Av{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const r=t[s];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class EA{constructor(){this.uchar=" ",this.penState=new Av}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class TA{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Av,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<$i;t++)this.chars.push(new EA);this.logger=e}equals(e){for(let t=0;t<$i;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<$i;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<$i;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>$i&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=$i)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=bv(e);if(this.pos>=$i){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<$i;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<$i;s++){const r=this.chars[s].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class zf{constructor(e){this.rows=[],this.currRow=ii-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<ii;t++)this.rows.push(new TA(e));this.logger=e}reset(){for(let e=0;e<ii;e++)this.rows[e].clear();this.currRow=ii-1}equals(e){let t=!0;for(let s=0;s<ii;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<ii;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<ii;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+vt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let c=0;c<ii;c++)this.rows[c].clear();const a=this.currRow+1-this.nrRollUpRows,u=this.lastOutputScreen;if(u){const c=u.rows[a].cueStartTime,h=this.logger.time;if(c!==null&&h!==null&&c<h)for(let d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(u.rows[a+d])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const a=e.indent,u=Math.max(a-1,0);s.setCursor(e.indent),e.color=s.chars[u].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+vt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",r=-1;for(let a=0;a<ii;a++){const u=this.rows[a].getTextString();u&&(r=a+1,e?t.push("Row "+r+": '"+u+"'"):t.push(u.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class Vp{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new zf(s),this.nonDisplayedMemory=new zf(s),this.lastOutputScreen=new zf(s),this.currRollUpRow=this.displayedMemory.rows[ii-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[ii-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[s]}this.logger.log(2,"MIDROW: "+vt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Kp{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=xA(),this.logger=void 0;const r=this.logger=new vA;this.channels=[null,new Vp(e,t,r),new Vp(e+1,s,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const r=t[s]&127,a=t[s+1]&127;let u=!1,c=null;if(r===0&&a===0)continue;this.logger.log(3,()=>"["+zn([t[s],t[s+1]])+"] -> ("+zn([r,a])+")");const h=this.cmdHistory;if(r>=16&&r<=31){if(SA(r,a,h)){$o(null,null,h),this.logger.log(3,()=>"Repeated command ("+zn([r,a])+") is dropped");continue}$o(r,a,this.cmdHistory),u=this.parseCmd(r,a),u||(u=this.parseMidrow(r,a)),u||(u=this.parsePAC(r,a)),u||(u=this.parseBackgroundAttributes(r,a))}else $o(null,null,h);if(!u&&(c=this.parseChars(r,a),c)){const g=this.currentChannel;g&&g>0?this.channels[g].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!u&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+zn([r,a])+" orig: "+zn([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(s||r))return!1;const a=e===20||e===21||e===23?1:2,u=this.channels[a];return e===20||e===21||e===28||e===29?t===32?u.ccRCL():t===33?u.ccBS():t===34?u.ccAOF():t===35?u.ccAON():t===36?u.ccDER():t===37?u.ccRU(2):t===38?u.ccRU(3):t===39?u.ccRU(4):t===40?u.ccFON():t===41?u.ccRDC():t===42?u.ccTR():t===43?u.ccRTD():t===44?u.ccEDM():t===45?u.ccCR():t===46?u.ccENM():t===47&&u.ccEOC():u.ccTO(t-32),this.currentChannel=a,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[s];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+zn([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,a=(e===16||e===24)&&t>=64&&t<=95;if(!(r||a))return!1;const u=e<=23?1:2;t>=64&&t<=95?s=u===1?hA[e]:mA[e]:s=u===1?gA[e]:pA[e];const c=this.channels[u];return c?(c.setPAC(this.interpretPAC(s,t)),this.currentChannel=u,!0):!1}interpretPAC(e,t){let s;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,r.underline=(s&1)===1,s<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((s-16)/2)*4,r}parseChars(e,t){let s,r=null,a=null;if(e>=25?(s=2,a=e-8):(s=1,a=e),a>=17&&a<=19){let u;a===17?u=t+80:a===18?u=t+112:u=t+144,this.logger.log(2,()=>"Special char '"+bv(u)+"' in channel "+s),r=[u]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+zn(r).join(",")),r}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(s||r))return!1;let a;const u={};e===16||e===24?(a=Math.floor((t-32)/2),u.background=yA[a],t%2===1&&(u.background=u.background+"_semi")):t===45?u.background="transparent":(u.foreground="black",t===47&&(u.underline=!0));const c=e<=23?1:2;return this.channels[c].setBkgData(u),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}$o(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function $o(l,e,t){t.a=l,t.b=e}function SA(l,e,t){return t.a===l&&t.b===e}function xA(){return{a:null,b:null}}var Xd=(function(){if(ou!=null&&ou.VTTCue)return self.VTTCue;const l=["","lr","rl"],e=["start","middle","end","left","right"];function t(c,h){if(typeof h!="string"||!Array.isArray(c))return!1;const d=h.toLowerCase();return~c.indexOf(d)?d:!1}function s(c){return t(l,c)}function r(c){return t(e,c)}function a(c,...h){let d=1;for(;d<arguments.length;d++){const g=arguments[d];for(const p in g)c[p]=g[p]}return c}function u(c,h,d){const g=this,p={enumerable:!0};g.hasBeenReset=!1;let y="",E=!1,T=c,x=h,S=d,R=null,_="",A=!0,C="auto",k="start",G=50,w="middle",P=50,B="middle";Object.defineProperty(g,"id",a({},p,{get:function(){return y},set:function(M){y=""+M}})),Object.defineProperty(g,"pauseOnExit",a({},p,{get:function(){return E},set:function(M){E=!!M}})),Object.defineProperty(g,"startTime",a({},p,{get:function(){return T},set:function(M){if(typeof M!="number")throw new TypeError("Start time must be set to a number.");T=M,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",a({},p,{get:function(){return x},set:function(M){if(typeof M!="number")throw new TypeError("End time must be set to a number.");x=M,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",a({},p,{get:function(){return S},set:function(M){S=""+M,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",a({},p,{get:function(){return R},set:function(M){R=M,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",a({},p,{get:function(){return _},set:function(M){const j=s(M);if(j===!1)throw new SyntaxError("An invalid or illegal string was specified.");_=j,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",a({},p,{get:function(){return A},set:function(M){A=!!M,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",a({},p,{get:function(){return C},set:function(M){if(typeof M!="number"&&M!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");C=M,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",a({},p,{get:function(){return k},set:function(M){const j=r(M);if(!j)throw new SyntaxError("An invalid or illegal string was specified.");k=j,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",a({},p,{get:function(){return G},set:function(M){if(M<0||M>100)throw new Error("Position must be between 0 and 100.");G=M,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",a({},p,{get:function(){return w},set:function(M){const j=r(M);if(!j)throw new SyntaxError("An invalid or illegal string was specified.");w=j,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",a({},p,{get:function(){return P},set:function(M){if(M<0||M>100)throw new Error("Size must be between 0 and 100.");P=M,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",a({},p,{get:function(){return B},set:function(M){const j=r(M);if(!j)throw new SyntaxError("An invalid or illegal string was specified.");B=j,this.hasBeenReset=!0}})),g.displayState=void 0}return u.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},u})();class bA{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Lv(l){function e(s,r,a,u){return(s|0)*3600+(r|0)*60+(a|0)+parseFloat(u||0)}const t=l.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class AA{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let r=0;r<s.length;++r)if(t===s[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function Rv(l,e,t,s){const r=s?l.split(s):[l];for(const a in r){if(typeof r[a]!="string")continue;const u=r[a].split(t);if(u.length!==2)continue;const c=u[0],h=u[1];e(c,h)}}const Td=new Xd(0,0,""),Go=Td.align==="middle"?"middle":"center";function LA(l,e,t){const s=l;function r(){const c=Lv(l);if(c===null)throw new Error("Malformed timestamp: "+s);return l=l.replace(/^[^\sa-zA-Z-]+/,""),c}function a(c,h){const d=new AA;Rv(c,function(y,E){let T;switch(y){case"region":for(let x=t.length-1;x>=0;x--)if(t[x].id===E){d.set(y,t[x].region);break}break;case"vertical":d.alt(y,E,["rl","lr"]);break;case"line":T=E.split(","),d.integer(y,T[0]),d.percent(y,T[0])&&d.set("snapToLines",!1),d.alt(y,T[0],["auto"]),T.length===2&&d.alt("lineAlign",T[1],["start",Go,"end"]);break;case"position":T=E.split(","),d.percent(y,T[0]),T.length===2&&d.alt("positionAlign",T[1],["start",Go,"end","line-left","line-right","auto"]);break;case"size":d.percent(y,E);break;case"align":d.alt(y,E,["start",Go,"end","left","right"]);break}},/:/,/\s/),h.region=d.get("region",null),h.vertical=d.get("vertical","");let g=d.get("line","auto");g==="auto"&&Td.line===-1&&(g=-1),h.line=g,h.lineAlign=d.get("lineAlign","start"),h.snapToLines=d.get("snapToLines",!0),h.size=d.get("size",100),h.align=d.get("align",Go);let p=d.get("position","auto");p==="auto"&&Td.position===50&&(p=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=p}function u(){l=l.replace(/^\s+/,"")}if(u(),e.startTime=r(),u(),l.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);l=l.slice(3),u(),e.endTime=r(),u(),a(l,e)}function _v(l){return l.replace(/<br(?: \/)?>/gi,`
`)}class RA{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new bA,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let a=t.buffer,u=0;for(a=_v(a);u<a.length&&a[u]!=="\r"&&a[u]!==`
`;)++u;const c=a.slice(0,u);return a[u]==="\r"&&++u,a[u]===`
`&&++u,t.buffer=a.slice(u),c}function r(a){Rv(a,function(u,c){},/:/)}try{let a="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;a=s();const c=a.match(/^()?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let u=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(u?u=!1:a=s(),t.state){case"HEADER":/:/.test(a)?r(a):a||(t.state="ID");continue;case"NOTE":a||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){t.state="NOTE";break}if(!a)continue;if(t.cue=new Xd(0,0,""),t.state="CUE",a.indexOf("-->")===-1){t.cue.id=a;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{LA(a,t.cue,t.regionList)}catch(c){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const c=a.indexOf("-->")!==-1;if(!a||c&&(u=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=a}continue;case"BADCUE":a||(t.state="ID")}}}catch(a){t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const _A=/\r\n|\n\r|\n|\r/g,Yf=function(e,t,s=0){return e.slice(s,s+t.length)===t},IA=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),a=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Ee(t)||!Ee(s)||!Ee(r)||!Ee(a))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*r,t+=3600*1e3*a,t};function Qd(l,e,t){return sl(l.toString())+sl(e.toString())+sl(t)}const DA=function(e,t,s){let r=e[t],a=e[r.prevCC];if(!a||!a.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(u=a)!=null&&u.new;){var u;e.ccOffset+=r.start-a.start,r.new=!1,r=a,a=e[r.prevCC]}e.presentationOffset=s};function CA(l,e,t,s,r,a,u){const c=new RA,h=Us(new Uint8Array(l)).trim().replace(_A,`
`).split(`
`),d=[],g=e?Pb(e.baseTime,e.timescale):0;let p="00:00.000",y=0,E=0,T,x=!0;c.oncue=function(S){const R=t[s];let _=t.ccOffset;const A=(y-g)/9e4;if(R!=null&&R.new&&(E!==void 0?_=t.ccOffset=R.start:DA(t,s,A)),A){if(!e){T=new Error("Missing initPTS for VTT MPEGTS");return}_=A-t.presentationOffset}const C=S.endTime-S.startTime,k=Xs((S.startTime+_-E)*9e4,r*9e4)/9e4;S.startTime=Math.max(k,0),S.endTime=Math.max(k+C,0);const G=S.text.trim();S.text=decodeURIComponent(encodeURIComponent(G)),S.id||(S.id=Qd(S.startTime,S.endTime,G)),S.endTime>0&&d.push(S)},c.onparsingerror=function(S){T=S},c.onflush=function(){if(T){u(T);return}a(d)},h.forEach(S=>{if(x)if(Yf(S,"X-TIMESTAMP-MAP=")){x=!1,S.slice(16).split(",").forEach(R=>{Yf(R,"LOCAL:")?p=R.slice(6):Yf(R,"MPEGTS:")&&(y=parseInt(R.slice(7)))});try{E=IA(p)/1e3}catch(R){T=R}return}else S===""&&(x=!1);c.parse(S+`
`)}),c.flush()}const qf="stpp.ttml.im1t",Iv=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Dv=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,kA={left:"start",center:"center",right:"end",start:"start",end:"end"};function zp(l,e,t,s){const r=je(new Uint8Array(l),["mdat"]);if(r.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const a=r.map(c=>Us(c)),u=Nb(e.baseTime,1,e.timescale);try{a.forEach(c=>t(wA(c,u)))}catch(c){s(c)}}function wA(l,e){const r=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const a={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},u=Object.keys(a).reduce((p,y)=>(p[y]=r.getAttribute(`ttp:${y}`)||a[y],p),{}),c=r.getAttribute("xml:space")!=="preserve",h=Yp(Xf(r,"styling","style")),d=Yp(Xf(r,"layout","region")),g=Xf(r,"body","[begin]");return[].map.call(g,p=>{const y=Cv(p,c);if(!y||!p.hasAttribute("begin"))return null;const E=Wf(p.getAttribute("begin"),u),T=Wf(p.getAttribute("dur"),u);let x=Wf(p.getAttribute("end"),u);if(E===null)throw qp(p);if(x===null){if(T===null)throw qp(p);x=E+T}const S=new Xd(E-e,x-e,y);S.id=Qd(S.startTime,S.endTime,S.text);const R=d[p.getAttribute("region")],_=h[p.getAttribute("style")],A=OA(R,_,h),{textAlign:C}=A;if(C){const k=kA[C];k&&(S.lineAlign=k),S.align=C}return dt(S,A),S}).filter(p=>p!==null)}function Xf(l,e,t){const s=l.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function Yp(l){return l.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function Cv(l,e){return[].slice.call(l.childNodes).reduce((t,s,r)=>{var a;return s.nodeName==="br"&&r?t+`
`:(a=s.childNodes)!=null&&a.length?Cv(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function OA(l,e,t){const s="http://www.w3.org/ns/ttml#styling";let r=null;const a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],u=l!=null&&l.hasAttribute("style")?l.getAttribute("style"):null;return u&&t.hasOwnProperty(u)&&(r=t[u]),a.reduce((c,h)=>{const d=Qf(e,s,h)||Qf(l,s,h)||Qf(r,s,h);return d&&(c[h]=d),c},{})}function Qf(l,e,t){return l&&l.hasAttributeNS(e,t)?l.getAttributeNS(e,t):null}function qp(l){return new Error(`Could not parse ttml timestamp ${l}`)}function Wf(l,e){if(!l)return null;let t=Lv(l);return t===null&&(Iv.test(l)?t=MA(l,e):Dv.test(l)&&(t=NA(l,e))),t}function MA(l,e){const t=Iv.exec(l),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function NA(l,e){const t=Dv.exec(l),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class jo{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class PA{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Qp(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(b.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(b.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new jo(this,"textTrack1"),t=new jo(this,"textTrack2"),s=new jo(this,"textTrack3"),r=new jo(this,"textTrack4");this.cea608Parser1=new Kp(1,e,t),this.cea608Parser2=new Kp(3,s,r)}addCues(e,t,s,r,a){let u=!1;for(let c=a.length;c--;){const h=a[c],d=UA(h[0],h[1],t,s);if(d>=0&&(h[0]=Math.min(h[0],t),h[1]=Math.max(h[1],s),u=!0,d/(s-t)>.5))return}if(u||a.push([t,s]),this.config.renderTextTracksNatively){const c=this.captionsTracks[e];this.Cues.newCue(c,t,s,r)}else{const c=this.Cues.newCue(null,t,s,r);this.hls.trigger(b.CUES_PARSED,{type:"captions",cues:c,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:r,timescale:a,trackId:u}){const{unparsedVttFrags:c}=this;s===Te.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:a,trackId:u}),c.length&&(this.unparsedVttFrags=[],c.forEach(h=>{this.initPTS[h.frag.cc]?this.onFragLoaded(b.FRAG_LOADED,h):this.hls.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let r=0;r<s.textTracks.length;r++){const a=s.textTracks[r];if(Xp(a,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return a}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:r}=this,{label:a,languageCode:u}=t[e],c=this.getExistingTrack(a,u);if(c)s[e]=c,Vr(s[e]),Tv(s[e],r);else{const h=this.createTextTrack("captions",a,u);h&&(h[e]=!0,s[e]=h)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,r={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,s){const r=this.media;if(r)return r.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:r}=this;Object.keys(r).forEach(a=>{Vr(r[a]),delete r[a]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Qp(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)Vr(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],r=s.some(a=>a.textCodec===qf);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(lv(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const u=this.media,c=u?Jo(u.textTracks):null;if(this.tracks.forEach((h,d)=>{let g;if(c){let p=null;for(let y=0;y<c.length;y++)if(c[y]&&Xp(c[y],h)){p=c[y],c[y]=null;break}p&&(g=p)}if(g)Vr(g);else{const p=kv(h);g=this.createTextTrack(p,h.name,h.lang),g&&(g.mode="disabled")}g&&this.textTracks.push(g)}),c!=null&&c.length){const h=c.filter(d=>d!==null).map(d=>d.label);h.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${h.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const u=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const r=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!r)return;const a=`textTrack${r[1]}`,u=this.captionsProperties[a];u&&(u.label=s.name,s.lang&&(u.languageCode=s.lang),u.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Te.MAIN){var s,r;const{cea608Parser1:a,cea608Parser2:u,lastSn:c}=this,{cc:h,sn:d}=t.frag,g=(s=(r=t.part)==null?void 0:r.index)!=null?s:-1;a&&u&&(d!==c+1||d===c&&g!==this.lastPartIndex+1||h!==this.lastCc)&&(a.reset(),u.reset()),this.lastCc=h,this.lastSn=d,this.lastPartIndex=g}}onFragLoaded(e,t){const{frag:s,payload:r}=t;if(s.type===Te.SUBTITLE)if(r.byteLength){const a=s.decryptdata,u="stats"in t;if(a==null||!a.encrypted||u){const c=this.tracks[s.level],h=this.vttCCs;h[s.cc]||(h[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),c&&c.textCodec===qf?this._parseIMSC1(s,r):this._parseVTTs(t)}}else this.hls.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;zp(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),s.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{s.logger.log(`Failed to parse IMSC1: ${r}`),s.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:s,payload:r}=e,{initPTS:a,unparsedVttFrags:u}=this,c=a.length-1;if(!a[s.cc]&&c===-1){u.push(e);return}const h=this.hls,d=(t=s.initSegment)!=null&&t.data?Qs(s.initSegment.data,new Uint8Array(r)).buffer:r;CA(d,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,g=>{this._appendCues(g,s.level),h.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},g=>{const p=g.message==="Missing initPTS for VTT MPEGTS";p?u.push(e):this._fallbackToIMSC1(s,r),h.logger.log(`Failed to parse VTT cue: ${g}`),!(p&&c>s.cc)&&h.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:g})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||zp(t,this.initPTS[e.cc],()=>{s.textCodec=qf,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(a=>Sv(r,a))}else{const r=this.tracks[t];if(!r)return;const a=r.default?"default":"subtitles"+t;s.trigger(b.CUES_PARSED,{type:"subtitles",cues:e,track:a})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===Te.SUBTITLE&&this.onFragLoaded(b.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:r}=t;if(!(s.type===Te.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let a=0;a<r.length;a++){const u=r[a].bytes;if(u){this.cea608Parser1||this.initCea608Parsers();const c=this.extractCea608Data(u);this.cea608Parser1.addData(r[a].pts,c[0]),this.cea608Parser2.addData(r[a].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:r,type:a}){const{media:u}=this;if(!(!u||u.currentTime<s)){if(!a||a==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(h=>Ed(c[h],t,s))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(h=>Ed(c[h],t,r))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let r=2;for(let a=0;a<s;a++){const u=e[r++],c=127&e[r++],h=127&e[r++];if(c===0&&h===0)continue;if((4&u)!==0){const g=3&u;(g===0||g===1)&&(t[g].push(c),t[g].push(h))}}return t}}function kv(l){return l.characteristics&&/transcribes-spoken-dialog/gi.test(l.characteristics)&&/describes-music-and-sound/gi.test(l.characteristics)?"captions":"subtitles"}function Xp(l,e){return!!l&&l.kind===kv(e)&&md(e,l)}function UA(l,e,t,s){return Math.min(e,s)-Math.max(l,t)}function Qp(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const BA=/\s/,FA={newCue(l,e,t,s){const r=[];let a,u,c,h,d;const g=self.VTTCue||self.TextTrackCue;for(let y=0;y<s.rows.length;y++)if(a=s.rows[y],c=!0,h=0,d="",!a.isEmpty()){var p;for(let x=0;x<a.chars.length;x++)BA.test(a.chars[x].uchar)&&c?h++:(d+=a.chars[x].uchar,c=!1);a.cueStartTime=e,e===t&&(t+=1e-4),h>=16?h--:h++;const E=_v(d.trim()),T=Qd(e,t,E);l!=null&&(p=l.cues)!=null&&p.getCueById(T)||(u=new g(e,t,E),u.id=T,u.line=y+1,u.align="left",u.position=10+Math.min(80,Math.floor(h*8/32)*10),r.push(u))}return l&&r.length&&(r.sort((y,E)=>y.line==="auto"||E.line==="auto"?0:y.line>8&&E.line>8?E.line-y.line:y.line-E.line),r.forEach(y=>Sv(l,y))),r}};function $A(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(l){}return!1}const GA=/(\d+)-(\d+)\/(\d+)/;class Wp{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||KA,this.controller=new self.AbortController,this.stats=new _d}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const a=jA(e,this.controller.signal),u=e.responseType==="arraybuffer",c=u?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),t.timeout=h&&Ee(h)?h:d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(cl(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(p=>{var y;this.response=this.loader=p;const E=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},d-(E-r.loading.start)),!p.ok){const{status:x,statusText:S}=p;throw new zA(S||"fetch, bad network response",x,p)}r.loading.first=E,r.total=VA(p.headers)||r.total;const T=(y=this.callbacks)==null?void 0:y.onProgress;return T&&Ee(t.highWaterMark)?this.loadProgressively(p,r,e,t.highWaterMark,T):u?p.arrayBuffer():e.responseType==="json"?p.json():p.text()}).then(p=>{var y,E;const T=this.response;if(!T)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const x=p[c];x&&(r.loaded=r.total=x);const S={url:T.url,data:p,code:T.status},R=(y=this.callbacks)==null?void 0:y.onProgress;R&&!Ee(t.highWaterMark)&&R(r,e,p,T),(E=this.callbacks)==null||E.onSuccess(S,r,e,T)}).catch(p=>{var y;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const E=p&&p.code||0,T=p?p.message:null;(y=this.callbacks)==null||y.onError({code:E,text:T},e,p?p.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,r=0,a){const u=new Gy,c=e.body.getReader(),h=()=>c.read().then(d=>{if(d.done)return u.dataLength&&a(t,s,u.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const g=d.value,p=g.length;return t.loaded+=p,p<r||u.dataLength?(u.push(g),u.dataLength>=r&&a(t,s,u.flush().buffer,e)):a(t,s,g.buffer,e),h()}).catch(()=>Promise.reject());return h()}}function jA(l,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(dt({},l.headers))};return l.rangeEnd&&t.headers.set("Range","bytes="+l.rangeStart+"-"+String(l.rangeEnd-1)),t}function HA(l){const e=GA.exec(l);if(e)return parseInt(e[2])-parseInt(e[1])+1}function VA(l){const e=l.get("Content-Range");if(e){const s=HA(e);if(Ee(s))return s}const t=l.get("Content-Length");if(t)return parseInt(t)}function KA(l,e){return new self.Request(l.url,e)}class zA extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const YA=/^age:\s*[\d.]+\s*$/im;class wv{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new _d,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const a=this.xhrSetup;a?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return a(s,t.url)}).catch(u=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),a(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(u=>{var c;(c=this.callbacks)==null||c.onError({code:s.status,text:u.message},t,s,r)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:a,maxLoadTimeMs:u}=s.loadPolicy;if(r)for(const c in r)e.setRequestHeader(c,r[c]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=a&&Ee(a)?a:u,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const r=t.readyState,a=this.config;if(!s.aborted&&r>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const d=t.status,g=t.responseType==="text"?t.responseText:null;if(d>=200&&d<300){const T=g!=null?g:t.response;if(T!=null){var u,c;s.loading.end=Math.max(self.performance.now(),s.loading.first);const x=t.responseType==="arraybuffer"?T.byteLength:T.length;s.loaded=s.total=x,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const S=(u=this.callbacks)==null?void 0:u.onProgress;S&&S(s,e,T,t);const R={url:t.responseURL,data:T,code:d};(c=this.callbacks)==null||c.onSuccess(R,s,e,t);return}}const p=a.loadPolicy.errorRetry,y=s.retry,E={url:e.url,data:void 0,code:d};if(lu(p,y,!1,E))this.retry(p);else{var h;ot.error(`${d} while loading ${e.url}`),(h=this.callbacks)==null||h.onError({code:d,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(lu(e,t,!0))this.retry(e);else{var s;ot.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=kd(e,s.retry),s.retry++,ot.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&YA.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const qA={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},XA=lt(lt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:wv,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ax,bufferController:Wb,capLevelController:zd,errorController:fx,fpsController:Z1,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ky,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:qA},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},QA()),{},{subtitleStreamController:cA,subtitleTrackController:tA,timelineController:PA,audioStreamController:Yb,audioTrackController:qb,emeController:Yr,cmcdController:q1,contentSteeringController:Q1,interstitialsController:uA});function QA(){return{cueHandler:FA,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function WA(l,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=Sd(l),r=["manifest","level","frag"],a=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(u=>{const c=`${u==="level"?"playlist":u}LoadPolicy`,h=e[c]===void 0,d=[];a.forEach(g=>{const p=`${u}Loading${g}`,y=e[p];if(y!==void 0&&h){d.push(p);const E=s[c].default;switch(e[c]={default:E},g){case"TimeOut":E.maxLoadTimeMs=y,E.maxTimeToFirstByteMs=y;break;case"MaxRetry":E.errorRetry.maxNumRetry=y,E.timeoutRetry.maxNumRetry=y;break;case"RetryDelay":E.errorRetry.retryDelayMs=y,E.timeoutRetry.retryDelayMs=y;break;case"MaxRetryTimeout":E.errorRetry.maxRetryDelayMs=y,E.timeoutRetry.maxRetryDelayMs=y;break}}}),d.length&&t.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${c}": ${vt(e[c])}`)}),lt(lt({},s),e)}function Sd(l){return l&&typeof l=="object"?Array.isArray(l)?l.map(Sd):Object.keys(l).reduce((e,t)=>(e[t]=Sd(l[t]),e),{}):l}function ZA(l,e){const t=l.loader;t!==Wp&&t!==wv?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),l.progressive=!1):$A()&&(l.loader=Wp,l.progressive=!0,l.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const eu=2,JA=.1,eL=.05,tL=100;class sL extends _y{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(b.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(tL),this.mediaSource=t.mediaSource;const s=this.media=t.media;cs(s,"playing",this.onMediaPlaying),cs(s,"waiting",this.onMediaWaiting),cs(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(Ss(s,"playing",this.onMediaPlaying),Ss(s,"waiting",this.onMediaWaiting),Ss(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,r;const a=(s=this.hls)==null?void 0:s.config;if(!a)return;const u=this.media;if(!u)return;const{seeking:c}=u,h=this.seeking&&!c,d=!this.seeking&&c,g=u.paused&&!c||u.ended||u.playbackRate===0;if(this.seeking=c,e!==t){t&&(this.ended=0),this.moved=!0,c||(this.nudgeRetry=0,a.nudgeOnVideoHole&&!g&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(d||h){h&&this.stallResolved(e);return}if(g){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&u.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(b.MEDIA_ENDED,{stalled:!1}));return}if(!Ne.getBuffered(u).length){this.nudgeRetry=0;return}const p=Ne.bufferInfo(u,e,0),y=p.nextStart||0,E=this.fragmentTracker;if(c&&E&&this.hls){const G=Zp(this.hls.inFlightFragments,e),w=p.len>eu,P=!y||G||y-e>eu&&!E.getPartialFragment(e);if(w||P)return;this.moved=!1}const T=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&E){if(!(p.len>0)&&!y)return;const w=Math.max(y,p.start||0)-e,B=!!(T!=null&&T.live)?T.targetduration*2:eu,M=Ho(e,E);if(w>0&&(w<=B||M)){u.paused||this._trySkipBufferHole(M);return}}const x=a.detectStallWithCurrentTimeMs,S=self.performance.now(),R=this.waiting;let _=this.stalled;if(_===null)if(R>0&&S-R<x)_=this.stalled=R;else{this.stalled=S;return}const A=S-_;if(!c&&(A>=x||R)&&this.hls){var C;if(((C=this.mediaSource)==null?void 0:C.readyState)==="ended"&&!(T!=null&&T.live)&&Math.abs(e-((T==null?void 0:T.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(b.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(p),!this.media||!this.hls)return}const k=Ne.bufferInfo(u,e,a.maxBufferHole);this._tryFixBufferStall(k,A,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(b.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&r&&r.length>1&&e>r.end(0)){const a=Ne.bufferedInfo(Ne.timeRangesToArray(this.buffered.audio),e,0);if(a.len>1&&t>=a.start){const u=Ne.timeRangesToArray(r),c=Ne.bufferedInfo(u,t,0).bufferedIndex;if(c>-1&&c<u.length-1){const h=Ne.bufferedInfo(u,e,0).bufferedIndex,d=u[c].end,g=u[c+1].start;if((h===-1||h>c)&&g-d<1&&e-d<2){const p=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${d} -> ${g} buffered index: ${h}`);this.warn(p.message),this.media.currentTime+=1e-6;let y=Ho(e,this.fragmentTracker);y&&"fragment"in y?y=y.fragment:y||(y=void 0);const E=Ne.bufferInfo(this.media,e,0);this.hls.trigger(b.ERROR,{type:Le.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:y,buffer:E.len,bufferInfo:E})}}}}}_tryFixBufferStall(e,t,s){var r,a;const{fragmentTracker:u,media:c}=this,h=(r=this.hls)==null?void 0:r.config;if(!c||!u||!h)return;const d=(a=this.hls)==null?void 0:a.latestLevelDetails,g=Ho(s,u);if((g||d!=null&&d.live&&s<d.fragmentStart)&&(this._trySkipBufferHole(g)||!this.media))return;const p=e.buffered,y=this.adjacentTraversal(e,s);(p&&p.length>1&&e.len>h.maxBufferHole||e.nextStart&&(e.nextStart-s<h.maxBufferHole||y))&&(t>h.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,r=e.nextStart;if(s&&r){const a=s.getFragAtPos(t,Te.MAIN),u=s.getFragAtPos(r,Te.MAIN);if(a&&u)return u.sn-a.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:r,stalled:a}=this;if(!r&&a!==null&&s&&t){this.stallReported=!0;const u=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${vt(e)})`);this.warn(u.message),t.trigger(b.ERROR,{type:Le.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,fatal:!1,error:u,buffer:e.len,bufferInfo:e,stalled:{start:a}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:r}=this,a=(t=this.hls)==null?void 0:t.config;if(!r||!s||!a)return 0;const u=r.currentTime,c=Ne.bufferInfo(r,u,0),h=u<c.start?c.start:c.nextStart;if(h&&this.hls){const g=c.len<=a.maxBufferHole,p=c.len>0&&c.len<1&&r.readyState<3,y=h-u;if(y>0&&(g||p)){if(y>a.maxBufferHole){let T=!1;if(u===0){const x=s.getAppendedFrag(0,Te.MAIN);x&&h<x.end&&(T=!0)}if(!T&&e){var d;if(!((d=this.hls.loadLevelObj)!=null&&d.details)||Zp(this.hls.inFlightFragments,h))return 0;let S=!1,R=e.end;for(;R<h;){const _=Ho(R,s);if(_)R+=_.duration;else{S=!0;break}}if(S)return 0}}const E=Math.max(h+eL,u+JA);if(this.warn(`skipping hole, adjusting currentTime from ${u} to ${E}`),this.moved=!0,r.currentTime=E,!(e!=null&&e.gap)){const T=new Error(`fragment loaded with buffer holes, seeking from ${u} to ${E}`),x={type:Le.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:T,reason:T.message,buffer:c.len,bufferInfo:c};e&&("fragment"in e?x.part=e:x.frag=e),this.hls.trigger(b.ERROR,x)}return E}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:r}=this,a=t==null?void 0:t.config;if(!s||!a)return 0;const u=s.currentTime;if(this.nudgeRetry++,r<a.nudgeMaxRetry){const c=u+(r+1)*a.nudgeOffset,h=new Error(`Nudging 'currentTime' from ${u} to ${c}`);this.warn(h.message),s.currentTime=c,t.trigger(b.ERROR,{type:Le.MEDIA_ERROR,details:z.BUFFER_NUDGE_ON_STALL,error:h,fatal:!1,buffer:e.len,bufferInfo:e})}else{const c=new Error(`Playhead still not moving while enough data buffered @${u} after ${a.nudgeMaxRetry} nudges`);this.error(c.message),t.trigger(b.ERROR,{type:Le.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,error:c,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Zp(l,e){const t=Jp(l.main);if(t&&t.start<=e)return t;const s=Jp(l.audio);return s&&s.start<=e?s:null}function Jp(l){if(!l)return null;switch(l.state){case re.IDLE:case re.STOPPED:case re.ENDED:case re.ERROR:return null}return l.frag}function Ho(l,e){return e.getAppendedFrag(l,Te.MAIN)||e.getPartialFragment(l)}const iL=.25;function xd(){if(typeof self!="undefined")return self.VTTCue||self.TextTrackCue}function Zf(l,e,t,s,r){let a=new l(e,t,"");try{a.value=s,r&&(a.type=r)}catch(u){a=new l(e,t,vt(r?lt({type:r},s):s))}return a}const Vo=(()=>{const l=xd();try{l&&new l(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class nL{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(b.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Vr(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return Tv(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:r}=this.hls.config;if(!s&&!r)return;const{samples:a}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const u=xd();if(u)for(let c=0;c<a.length;c++){const h=a[c].type;if(h===Ns.emsg&&!s||!r)continue;const d=qy(a[c].data),g=a[c].pts;let p=g+a[c].duration;p>Vo&&(p=Vo),p-g<=0&&(p=g+iL);for(let E=0;E<d.length;E++){const T=d[E];if(!Xy(T)){this.updateId3CueEnds(g,h);const x=Zf(u,g,p,T,h);x&&this.id3Track.addCue(x)}}}}updateId3CueEnds(e,t){var s;const r=(s=this.id3Track)==null?void 0:s.cues;if(r)for(let a=r.length;a--;){const u=r[a];u.type===t&&u.startTime<e&&u.endTime===Vo&&(u.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:r}){const{id3Track:a,hls:u}=this;if(!u)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:h}}=u;if(a&&(c||h)){let d;r==="audio"?d=g=>g.type===Ns.audioId3&&h:r==="video"?d=g=>g.type===Ns.emsg&&c:d=g=>g.type===Ns.audioId3&&h||g.type===Ns.emsg&&c,Ed(a,t,s,d)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:r,enableDateRangeMetadataCues:a,interstitialsController:u}=this.hls.config;if(!a)return;const c=xd();if(s&&r&&!u){const{fragmentStart:x,fragmentEnd:S}=e;let R=this.assetCue;R?(R.startTime=x,R.endTime=S):c&&(R=this.assetCue=Zf(c,x,S,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),R&&(R.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(R),R.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:h}=this,{dateRanges:d}=e,g=Object.keys(d);let p=this.dateRangeCuesAppended;if(h&&t){var y;if((y=h.cues)!=null&&y.length){const x=Object.keys(p).filter(S=>!g.includes(S));for(let S=x.length;S--;){var E;const R=x[S],_=(E=p[R])==null?void 0:E.cues;delete p[R],_&&Object.keys(_).forEach(A=>{const C=_[A];if(C){C.removeEventListener("enter",this.onEventCueEnter);try{h.removeCue(C)}catch(k){}}})}}else p=this.dateRangeCuesAppended={}}const T=e.fragments[e.fragments.length-1];if(!(g.length===0||!Ee(T==null?void 0:T.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let x=0;x<g.length;x++){const S=g[x],R=d[S],_=R.startTime,A=p[S],C=(A==null?void 0:A.cues)||{};let k=(A==null?void 0:A.durationKnown)||!1,G=Vo;const{duration:w,endDate:P}=R;if(P&&w!==null)G=_+w,k=!0;else if(R.endOnNext&&!k){const M=g.reduce((j,ee)=>{if(ee!==R.id){const oe=d[ee];if(oe.class===R.class&&oe.startDate>R.startDate&&(!j||R.startDate<j.startDate))return oe}return j},null);M&&(G=M.startTime,k=!0)}const B=Object.keys(R.attr);for(let M=0;M<B.length;M++){const j=B[M];if(!Ax(j))continue;const ee=C[j];if(ee)k&&!(A!=null&&A.durationKnown)?ee.endTime=G:Math.abs(ee.startTime-_)>.01&&(ee.startTime=_,ee.endTime=G);else if(c){let oe=R.attr[j];Lx(j)&&(oe=oy(oe));const ce=Zf(c,_,G,{key:j,data:oe},Ns.dateRange);ce&&(ce.id=S,this.id3Track.addCue(ce),C[j]=ce,u&&(j==="X-ASSET-LIST"||j==="X-ASSET-URL")&&ce.addEventListener("enter",this.onEventCueEnter))}}p[S]={cues:C,dateRange:R,durationKnown:k}}}}}class rL{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:a,maxLiveSyncPlaybackRate:u}=this.config;if(!a||u===1||!s.live)return;const c=this.targetLatency;if(c===null)return;const h=r-c,d=Math.min(this.maxLatency,c+s.targetduration);if(h<d&&h>.05&&this.forwardBufferLength>1){const p=Math.min(2,Math.max(1,u)),y=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20,E=Math.min(p,Math.max(1,y));this.changeMediaPlaybackRate(t,E)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:r}=e,{liveSyncDuration:a,liveSyncDurationCount:u,lowLatencyMode:c}=this.config,h=this.hls.userConfig;let d=c&&s||t;(this._targetLatencyUpdated||h.liveSyncDuration||h.liveSyncDurationCount||d===0)&&(d=a!==void 0?a:u*r);const g=r;return d+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,g)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const r=s.edge,a=e-t-this.edgeStalled,u=r-s.totalduration,c=r-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(u,a),c)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===z.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,r;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class aL extends Kd{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,r=[],a={},u={};let c=!1,h=!1,d=!1;t.levels.forEach(g=>{const p=g.attrs;let{audioCodec:y,videoCodec:E}=g;y&&(g.audioCodec=y=iu(y,s)||void 0),E&&(E=g.videoCodec=GS(E));const{width:T,height:x,unknownCodecs:S}=g,R=(S==null?void 0:S.length)||0;if(c||(c=!!(T&&x)),h||(h=!!E),d||(d=!!y),R||y&&!this.isAudioSupported(y)||E&&!this.isVideoSupported(E)){this.log(`Some or all CODECS not supported "${p.CODECS}"`);return}const{CODECS:_,"FRAME-RATE":A,"HDCP-LEVEL":C,"PATHWAY-ID":k,RESOLUTION:G,"VIDEO-RANGE":w}=p,B=`${`${k||"."}-`}${g.bitrate}-${G}-${A}-${_}-${w}-${C}`;if(a[B])if(a[B].uri!==g.url&&!g.attrs["PATHWAY-ID"]){const M=u[B]+=1;g.attrs["PATHWAY-ID"]=new Array(M+1).join(".");const j=this.createLevel(g);a[B]=j,r.push(j)}else a[B].addGroupId("audio",p.AUDIO),a[B].addGroupId("text",p.SUBTITLES);else{const M=this.createLevel(g);a[B]=M,u[B]=1,r.push(M)}}),this.filterAndSortMediaOptions(r,t,c,h,d)}createLevel(e){const t=new al(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(r.message),t.supportedResult=Ey(r,[])}return t}isAudioSupported(e){return nl(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return nl(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,r,a){var u;let c=[],h=[],d=e;const g=((u=t.stats)==null?void 0:u.parsing)||{};if((s||r)&&a&&(d=d.filter(({videoCodec:_,videoRange:A,width:C,height:k})=>(!!_||!!(C&&k))&&WS(A))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let _="no level with compatible codecs found in manifest",A=_;t.levels.length&&(A=`one or more CODECS in variant not supported: ${vt(t.levels.map(k=>k.attrs.CODECS).filter((k,G,w)=>w.indexOf(k)===G))}`,this.warn(A),_+=` (${A})`);const C=new Error(_);this.hls.trigger(b.ERROR,{type:Le.MEDIA_ERROR,details:z.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:C,reason:A})}}),g.end=performance.now();return}t.audioTracks&&(c=t.audioTracks.filter(_=>!_.audioCodec||this.isAudioSupported(_.audioCodec)),ey(c)),t.subtitles&&(h=t.subtitles,ey(h));const p=d.slice(0);d.sort((_,A)=>{if(_.attrs["HDCP-LEVEL"]!==A.attrs["HDCP-LEVEL"])return(_.attrs["HDCP-LEVEL"]||"")>(A.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&_.height!==A.height)return _.height-A.height;if(_.frameRate!==A.frameRate)return _.frameRate-A.frameRate;if(_.videoRange!==A.videoRange)return nu.indexOf(_.videoRange)-nu.indexOf(A.videoRange);if(_.videoCodec!==A.videoCodec){const C=Ym(_.videoCodec),k=Ym(A.videoCodec);if(C!==k)return k-C}if(_.uri===A.uri&&_.codecSet!==A.codecSet){const C=su(_.codecSet),k=su(A.codecSet);if(C!==k)return k-C}return _.averageBitrate!==A.averageBitrate?_.averageBitrate-A.averageBitrate:0});let y=p[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==p.length)){for(let _=0;_<p.length;_++)if(p[_].pathwayId===d[0].pathwayId){y=p[_];break}}this._levels=d;for(let _=0;_<d.length;_++)if(d[_]===y){var E;this._firstLevel=_;const A=y.bitrate,C=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${A}`),((E=this.hls.userConfig)==null?void 0:E.abrEwmaDefaultEstimate)===void 0){const k=Math.min(A,this.hls.config.abrEwmaDefaultEstimateMax);k>C&&C===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=k)}break}const T=a&&!r,x=this.hls.config,S=!!(x.audioStreamController&&x.audioTrackController),R={levels:d,audioTracks:c,subtitleTracks:h,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:a,video:r,altAudio:S&&!T&&c.some(_=>!!_.url)};g.end=performance.now(),this.hls.trigger(b.MANIFEST_PARSED,R)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const g=new Error("invalid level idx"),p=e<0;if(this.hls.trigger(b.ERROR,{type:Le.OTHER_ERROR,details:z.LEVEL_SWITCH_ERROR,level:e,fatal:p,error:g,reason:g.message}),p)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,r=this.currentLevel,a=r?r.attrs["PATHWAY-ID"]:void 0,u=t[e],c=u.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=u,s===e&&r&&a===c)return;this.log(`Switching to level ${e} (${u.height?u.height+"p ":""}${u.videoRange?u.videoRange+" ":""}${u.codecSet?u.codecSet+" ":""}@${u.bitrate})${c?" with Pathway "+c:""} from level ${s}${a?" with Pathway "+a:""}`);const h={level:e,attrs:u.attrs,details:u.details,bitrate:u.bitrate,averageBitrate:u.averageBitrate,maxBitrate:u.maxBitrate,realBitrate:u.realBitrate,width:u.width,height:u.height,codecSet:u.codecSet,audioCodec:u.audioCodec,videoCodec:u.videoCodec,audioGroups:u.audioGroups,subtitleGroups:u.subtitleGroups,loaded:u.loaded,loadError:u.loadError,fragmentError:u.fragmentError,name:u.name,id:u.id,uri:u.uri,url:u.url,urlId:0,audioGroupIds:u.audioGroupIds,textGroupIds:u.textGroupIds};this.hls.trigger(b.LEVEL_SWITCHING,h);const d=u.details;if(!d||d.live){const g=this.switchParams(u.uri,r==null?void 0:r.details,d);this.loadPlaylist(g)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===Ve.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Te.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(a=>!!s[a]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var s;const{level:r,details:a}=t,u=t.levelInfo;if(!u){var c;this.warn(`Invalid level index ${r}`),(c=t.deliveryDirectives)!=null&&c.skip&&(a.deltaUpdateFailed=!0);return}if(u===this.currentLevel||t.withoutMultiVariant){u.fragmentError===0&&(u.loadError=0);let h=u.details;h===t.details&&h.advanced&&(h=void 0),this.playlistLoaded(r,t,h)}else(s=t.deliveryDirectives)!=null&&s.skip&&(a.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,a=e.attrs["PATHWAY-ID"],u=e.details,c=u==null?void 0:u.age;this.log(`Loading level index ${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a?" Pathway "+a:""}${c&&u.live?" age "+c.toFixed(1)+(u.type&&" "+u.type||""):""} ${s}`),this.hls.trigger(b.LEVEL_LOADING,{url:s,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((a,u)=>u!==e?!0:(this.steering&&this.steering.removeLevel(a),a===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,a.details&&a.details.fragments.forEach(c=>c.level=-1)),!1));By(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=s.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(b.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(b.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function ey(l){const e={};l.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function Ov(){return self.SourceBuffer||self.WebKitSourceBuffer}function Mv(){if(!An())return!1;const e=Ov();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function lL(){if(!Mv())return!1;const l=An();return typeof(l==null?void 0:l.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>l.isTypeSupported(rl(e,"video")))||["mp4a.40.2","fLaC"].some(e=>l.isTypeSupported(rl(e,"audio"))))}function oL(){var l;const e=Ov();return typeof(e==null||(l=e.prototype)==null?void 0:l.changeType)=="function"}const uL=100;class cL extends Ud{constructor(e,t,s){super(e,t,s,"stream-controller",Te.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,a=r?r.currentTime:null;if(a===null||!Ee(a)||(this.log(`Media seeked to ${a.toFixed(3)}`),!this.getBufferedFrag(a)))return;const u=this.getFwdBufferInfoAtPos(r,a,Te.MAIN,0);if(u===null||u.len===0){this.warn(`Main forward buffer length at ${a} on "seeked" event ${u?u.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:r}=this;if(this.stopLoad(),this.setInterval(uL),this.level=-1,!this.startFragRequested){let a=r.startLevel;a===-1&&(r.config.testBandwidth&&this.levels.length>1?(a=0,this.bitrateTest=!0):a=r.firstAutoLevel),r.nextLoadLevel=a,this.level=r.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=re.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=re.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case re.WAITING_LEVEL:{const{levels:e,level:t}=this,s=e==null?void 0:e[t],r=s==null?void 0:s.details;if(r&&(!r.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(r))break;this.state=re.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=re.IDLE;break}break}case re.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===re.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const a=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[a]))return;const u=s[a],c=this.getMainFwdBufferInfo();if(c===null)return;const h=this.getLevelDetails();if(h&&this._streamEnded(c,h)){const x={};this.altAudio===2&&(x.type="video"),this.hls.trigger(b.BUFFER_EOS,x),this.state=re.ENDED;return}if(!this.buffering)return;e.loadLevel!==a&&e.manualLevel===-1&&this.log(`Adapting to level ${a} from level ${this.level}`),this.level=e.nextLoadLevel=a;const d=u.details;if(!d||this.state===re.WAITING_LEVEL||this.waitForLive(u)){this.level=a,this.state=re.WAITING_LEVEL,this.startFragRequested=!1;return}const g=c.len,p=this.getMaxBufferLength(u.maxBitrate);if(g>=p)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const y=this.backtrackFragment?this.backtrackFragment.start:c.end;let E=this.getNextFragment(y,d);if(this.couldBacktrack&&!this.fragPrevious&&E&&$t(E)&&this.fragmentTracker.getState(E)!==Kt.OK){var T;const S=((T=this.backtrackFragment)!=null?T:E).sn-d.startSN,R=d.fragments[S-1];R&&E.cc===R.cc&&(E=R,this.fragmentTracker.removeFragment(R))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(E&&this.isLoopLoading(E,y)){if(!E.gap){const S=this.audioOnly&&!this.altAudio?yt.AUDIO:yt.VIDEO,R=(S===yt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;R&&this.afterBufferFlushed(R,S,Te.MAIN)}E=this.getNextFragmentLoopLoading(E,d,c,Te.MAIN,p)}E&&(E.initSegment&&!E.initSegment.data&&!this.bitrateTest&&(E=E.initSegment),this.loadFragment(E,u,y))}loadFragment(e,t,s){const r=this.fragmentTracker.getState(e);r===Kt.NOT_LOADED||r===Kt.PARTIAL?$t(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Te.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const a=this.getLevelDetails();if(a!=null&&a.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<a.targetduration*2)return}if(!t.paused&&e){const c=this.hls.nextLoadLevel,h=e[c],d=this.fragLastKbps;d&&this.fragCurrent?s=this.fragCurrent.duration*h.maxBitrate/(1e3*d)+1:s=0}else s=0;const u=this.getBufferedFrag(t.currentTime+s);if(u){const c=this.followingBufferedFrag(u);if(c){this.abortCurrentFrag();const h=c.maxStartPTS?c.maxStartPTS:c.start,d=c.duration,g=Math.max(u.end,h+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*(this.couldBacktrack?.5:.125)),d*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(g,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case re.KEY_LOADING:case re.FRAG_LOADING:case re.FRAG_LOADING_WAITING_RETRY:case re.PARSING:case re.PARSED:this.state=re.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;cs(s,"playing",this.onMediaPlaying),cs(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(Ss(s,"playing",this.onMediaPlaying),Ss(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,r=!1;for(let a=0;a<t.levels.length;a++){const u=t.levels[a].audioCodec;u&&(s=s||u.indexOf("mp4a.40.2")!==-1,r=r||u.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&r&&!oL(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==re.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=re.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:r,startFragRequested:a}=this,u=t.level,c=t.details,h=c.totalduration;if(!r){this.warn(`Levels were reset while loading level ${u}`);return}this.log(`Level ${u} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""}, cc [${c.startCC}, ${c.endCC}] duration:${h}`);const d=t.levelInfo,g=this.fragCurrent;g&&(this.state===re.FRAG_LOADING||this.state===re.FRAG_LOADING_WAITING_RETRY)&&g.level!==t.level&&g.loader&&this.abortCurrentFrag();let p=0;if(c.live||(s=d.details)!=null&&s.live){var y;if(this.checkLiveUpdate(c),c.deltaUpdateFailed)return;p=this.alignPlaylists(c,d.details,(y=this.levelLastLoaded)==null?void 0:y.details)}if(d.details=c,this.levelLastLoaded=d,a||this.setStartPosition(c,p),this.hls.trigger(b.LEVEL_UPDATED,{details:c,level:u}),this.state===re.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=re.IDLE}a&&c.live&&this.synchronizeToLiveEdge(c),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const r=this.hls.liveSyncPosition,a=this.getLoadPosition(),u=e.fragmentStart,c=e.edge,h=a>=u-t.maxFragLookUpTolerance&&a<=c;if(r!==null&&s.duration>r&&(a<r||!h)){const g=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!h&&s.readyState<4||a<c-g)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),s.readyState))if(this.warn(`Playback: ${a.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var d;const p=Ne.bufferInfo(s,r,0);if(!((d=p.buffered)!=null&&d.length)){s.currentTime=r;return}if(p.start<=a){s.currentTime=r;return}const{nextStart:E}=Ne.bufferedInfo(p.buffered,a,0);E&&(s.currentTime=E)}else s.currentTime=r}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:r,payload:a}=e,{levels:u}=this;if(!u){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const c=u[s.level];if(!c){this.warn(`Level ${s.level} not found on progress`);return}const h=c.details;if(!h){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const d=c.videoCodec,g=h.PTSKnown||!h.live,p=(t=s.initSegment)==null?void 0:t.data,y=this._getAudioCodec(c),E=this.transmuxer=this.transmuxer||new av(this.hls,Te.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),T=r?r.index:-1,x=T!==-1,S=new Od(s.level,s.sn,s.stats.chunkCount,a.byteLength,T,x),R=this.initPTS[s.cc];E.push(a,p,y,d,s,r,h.totalduration,g,S,R)}onAudioTrackSwitching(e,t){const s=this.hls,r=this.altAudio===2;if(ru(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const u=this.fragCurrent;u&&(this.log("Switching to main audio track, cancel main fragment load"),u.abortRequests(),this.fragmentTracker.removeFragment(u)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.fragmentTracker.removeAllFragments(),s.once(b.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(b.AUDIO_TRACK_SWITCHED,t)}),s.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(b.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=ru(t.url,this.hls);if(s){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let r,a,u=!1;for(const c in s){const h=s[c];if(h.id==="main"){if(a=c,r=h,c==="video"){const d=s[c];d&&(this.videoBuffer=d.buffer)}}else u=!0}u&&r?(this.log(`Alternate track found, use ${a}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:r}=t,a=s.type===Te.MAIN;if(a){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===re.PARSED&&(this.state=re.IDLE);return}const c=r?r.stats:s.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),$t(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,r)}const u=this.media;u&&(!this._hasEnoughToStart&&Ne.getBuffered(u).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),a&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=re.ERROR;return}switch(t.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Te.MAIN,t);break;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===re.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===Ve.LEVEL&&(this.state=re.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=re.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==yt.AUDIO||!this.altAudio){const s=(t===yt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,Te.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&s&&(s+=r);const a=this.getLevelDetails(),u=Ne.getBuffered(e),c=u.length?u.start(0):0,h=c-s,d=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||h>0&&(h<d||this.loadingParts&&h<2*((a==null?void 0:a.partTarget)||0)))&&(this.log(`adjusting start position by ${h} to match buffer start`),s+=h,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${c}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:r}=this,a=s==null?void 0:s.frag;if(!a||this.fragContextChanged(a))return;t.fragmentError=0,this.state=re.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const u=a.stats;u.parsing.start=u.parsing.end=u.buffering.start=u.buffering.end=self.performance.now(),r.trigger(b.FRAG_LOADED,s),a.bitrateTest=!1}).catch(s=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:r,chunkMeta:a}=e,u=this.getCurrentContext(a);if(!u){this.resetWhenMissingContext(a);return}const{frag:c,part:h,level:d}=u,{video:g,text:p,id3:y,initSegment:E}=r,{details:T}=d,x=this.altAudio?void 0:r.audio;if(this.fragContextChanged(c)){this.fragmentTracker.removeFragment(c);return}if(this.state=re.PARSING,E){const S=E.tracks;if(S){const C=c.initSegment||c;if(this.unhandledEncryptionError(E,c))return;this._bufferInitSegment(d,S,C,a),s.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:t,tracks:S})}const R=E.initPTS,_=E.timescale,A=this.initPTS[c.cc];if(Ee(R)&&(!A||A.baseTime!==R||A.timescale!==_)){const C=E.trackId;this.initPTS[c.cc]={baseTime:R,timescale:_,trackId:C},s.trigger(b.INIT_PTS_FOUND,{frag:c,id:t,initPTS:R,timescale:_,trackId:C})}}if(g&&T){x&&g.type==="audiovideo"&&this.logMuxedErr(c);const S=T.fragments[c.sn-1-T.startSN],R=c.sn===T.startSN,_=!S||c.cc>S.cc;if(r.independent!==!1){const{startPTS:A,endPTS:C,startDTS:k,endDTS:G}=g;if(h)h.elementaryStreams[g.type]={startPTS:A,endPTS:C,startDTS:k,endDTS:G};else if(g.firstKeyFrame&&g.independent&&a.id===1&&!_&&(this.couldBacktrack=!0),g.dropped&&g.independent){const w=this.getMainFwdBufferInfo(),P=(w?w.end:this.getLoadPosition())+this.config.maxBufferHole,B=g.firstKeyFramePTS?g.firstKeyFramePTS:A;if(!R&&P<B-this.config.maxBufferHole&&!_){this.backtrack(c);return}else _&&(c.gap=!0);c.setElementaryStreamInfo(g.type,c.start,C,c.start,G,!0)}else R&&A-(T.appliedTimelineOffset||0)>eu&&(c.gap=!0);c.setElementaryStreamInfo(g.type,A,C,k,G),this.backtrackFragment&&(this.backtrackFragment=c),this.bufferFragmentData(g,c,h,a,R||_)}else if(R||_)c.gap=!0;else{this.backtrack(c);return}}if(x){const{startPTS:S,endPTS:R,startDTS:_,endDTS:A}=x;h&&(h.elementaryStreams[yt.AUDIO]={startPTS:S,endPTS:R,startDTS:_,endDTS:A}),c.setElementaryStreamInfo(yt.AUDIO,S,R,_,A),this.bufferFragmentData(x,c,h,a)}if(T&&y!=null&&y.samples.length){const S={id:t,frag:c,details:T,samples:y.samples};s.trigger(b.FRAG_PARSING_METADATA,S)}if(T&&p){const S={id:t,frag:c,details:T,samples:p.samples};s.trigger(b.FRAG_PARSING_USERDATA,S)}}logMuxedErr(e){this.warn(`${$t(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,r){if(this.state!==re.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:a,video:u,audiovideo:c}=t;if(a){const d=e.audioCodec;let g=Yo(a.codec,d);g==="mp4a"&&(g="mp4a.40.5");const p=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){g&&(g.indexOf("mp4a.40.5")!==-1?g="mp4a.40.2":g="mp4a.40.5");const y=a.metadata;y&&"channelCount"in y&&(y.channelCount||1)!==1&&p.indexOf("firefox")===-1&&(g="mp4a.40.5")}g&&g.indexOf("mp4a.40.5")!==-1&&p.indexOf("android")!==-1&&a.container!=="audio/mpeg"&&(g="mp4a.40.2",this.log(`Android: force audio codec to ${g}`)),d&&d!==g&&this.log(`Swapping manifest audio codec "${d}" for "${g}"`),a.levelCodec=g,a.id=Te.MAIN,this.log(`Init audio buffer, container:${a.container}, codecs[selected/level/parsed]=[${g||""}/${d||""}/${a.codec}]`),delete t.audiovideo}if(u){u.levelCodec=e.videoCodec,u.id=Te.MAIN;const d=u.codec;if((d==null?void 0:d.length)===4)switch(d){case"hvc1":case"hev1":u.codec="hvc1.1.6.L120.90";break;case"av01":u.codec="av01.0.04M.08";break;case"avc1":u.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${u.container}, codecs[level/parsed]=[${e.videoCodec||""}/${d}]${u.codec!==d?" parsed-corrected="+u.codec:""}${u.supplemental?" supplemental="+u.supplemental:""}`),delete t.audiovideo}c&&(this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${e.codecs}/${c.codec}]`),delete t.video,delete t.audio);const h=Object.keys(t);if(h.length){if(this.hls.trigger(b.BUFFER_CODECS,t),!this.hls)return;h.forEach(d=>{const p=t[d].initSegment;p!=null&&p.byteLength&&this.hls.trigger(b.BUFFER_APPENDING,{type:d,data:p,frag:s,part:null,chunkMeta:r,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Te.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e==null?void 0:e[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=re.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(Ne.isBuffered(e,s)?t=this.getAppendedFrag(s):Ne.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,a=t.level;(!r||t.sn!==r.sn||r.level!==a)&&(this.fragPlaying=t,this.hls.trigger(b.FRAG_CHANGED,{frag:t}),(!r||r.level!==a)&&this.hls.trigger(b.LEVEL_SWITCHED,{level:a}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Ee(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Ee(t)){const s=this.getLevelDetails(),r=this.currentFrag||(s?Qn(null,s.fragments,t):null);if(r){const a=r.programDateTime;if(a!==null){const u=a+(t-r.start)*1e3;return new Date(u)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class fL extends Ws{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[s].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=z.KEY_LOAD_ERROR,s,r,a){return new ji({type:Le.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:a,error:s,networkDetails:r})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,a=t.length;r<a;r++){const u=t[r];if(e.cc<=u.cc&&(!$t(e)||!$t(u)||e.sn<u.sn)||!s&&r==a-1)return this.emeController.selectKeySystemFormat(u).then(c=>{if(!this.emeController)return;u.setKeyFormat(c);const h=Xo(c);if(h)return this.emeController.getKeySystemAccess([h])})}if(this.config.requireKeySystemAccessOnStart){const r=Ja(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,r;t&&e.setKeyFormat(t);const a=e.decryptdata;if(!a){const d=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,d))}const u=a.uri;if(!u)return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${u}"`)));const c=Jf(a);let h=this.keyIdToKeyInfo[c];if((s=h)!=null&&s.decryptdata.key)return a.key=h.decryptdata.key,Promise.resolve({frag:e,keyInfo:h});if(this.emeController&&(r=h)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(h.decryptdata)){case"usable":case"usable-in-future":return h.keyLoadPromise.then(g=>{const{keyInfo:p}=g;return a.key=p.decryptdata.key,{frag:e,keyInfo:p}})}switch(this.log(`${this.keyIdToKeyInfo[c]?"Rel":"L"}oading${a.keyId?" keyId: "+Ts(a.keyId):""} URI: ${a.uri} from ${e.type} ${e.level}`),h=this.keyIdToKeyInfo[c]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return a.keyFormat==="identity"?this.loadKeyHTTP(h,e):this.loadKeyEME(h,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(h,e);default:return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${a.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const r=this.emeController.loadKey(s);return(e.keyLoadPromise=r.then(a=>(e.mediaKeySessionContext=a,s))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,r=s.loader,a=new r(s);return t.keyLoader=e.loader=a,e.keyLoadPromise=new Promise((u,c)=>{const h={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=s.keyLoadPolicy.default,g={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(y,E,T,x)=>{const{frag:S,keyInfo:R}=T,_=Jf(R.decryptdata);if(!S.decryptdata||R!==this.keyIdToKeyInfo[_])return c(this.createKeyLoadError(S,z.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),x));R.decryptdata.key=S.decryptdata.key=new Uint8Array(y.data),S.keyLoader=null,R.loader=null,u({frag:S,keyInfo:R})},onError:(y,E,T,x)=>{this.resetLoader(E),c(this.createKeyLoadError(t,z.KEY_LOAD_ERROR,new Error(`HTTP Error ${y.code} loading key ${y.text}`),T,lt({url:h.url,data:void 0},y)))},onTimeout:(y,E,T)=>{this.resetLoader(E),c(this.createKeyLoadError(t,z.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),T))},onAbort:(y,E,T)=>{this.resetLoader(E),c(this.createKeyLoadError(t,z.INTERNAL_ABORTED,new Error("key loading aborted"),T))}};a.load(h,g,p)})}resetLoader(e){const{frag:t,keyInfo:s,url:r}=e,a=s.loader;t.keyLoader===a&&(t.keyLoader=null,s.loader=null);const u=Jf(s.decryptdata)||r;delete this.keyIdToKeyInfo[u],a&&a.destroy()}}function Jf(l){if(l.keyFormat!==os.FAIRPLAY){const e=l.keyId;if(e)return Ts(e)}return l.uri}function ty(l){const{type:e}=l;switch(e){case Ve.AUDIO_TRACK:return Te.AUDIO;case Ve.SUBTITLE_TRACK:return Te.SUBTITLE;default:return Te.MAIN}}function ed(l,e){let t=l.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class dL{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,r=t.loader,a=s||r,u=new a(t);return this.loaders[e.type]=u,u}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ve.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:r,pathwayId:a,url:u,deliveryDirectives:c,levelInfo:h}=t;this.load({id:s,level:r,pathwayId:a,responseType:"text",type:Ve.LEVEL,url:u,deliveryDirectives:c,levelOrTrack:h})}onAudioTrackLoading(e,t){const{id:s,groupId:r,url:a,deliveryDirectives:u,track:c}=t;this.load({id:s,groupId:r,level:null,responseType:"text",type:Ve.AUDIO_TRACK,url:a,deliveryDirectives:u,levelOrTrack:c})}onSubtitleTrackLoading(e,t){const{id:s,groupId:r,url:a,deliveryDirectives:u,track:c}=t;this.load({id:s,groupId:r,level:null,responseType:"text",type:Ve.SUBTITLE_TRACK,url:a,deliveryDirectives:u,levelOrTrack:c})}onLevelsUpdated(e,t){const s=this.loaders[Ve.LEVEL];if(s){const r=s.context;r&&!t.levels.some(a=>a===r.levelOrTrack)&&(s.abort(),delete this.loaders[Ve.LEVEL])}}load(e){var t;const s=this.hls.config;let r=this.getInternalLoader(e);if(r){const d=this.hls.logger,g=r.context;if(g&&g.levelOrTrack===e.levelOrTrack&&(g.url===e.url||g.deliveryDirectives&&!e.deliveryDirectives)){g.url===e.url?d.log(`[playlist-loader]: ignore ${e.url} ongoing request`):d.log(`[playlist-loader]: ignore ${e.url} in favor of ${g.url}`);return}d.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let a;if(e.type===Ve.MANIFEST?a=s.manifestLoadPolicy.default:a=dt({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),Ee((t=e.deliveryDirectives)==null?void 0:t.part)){let d;if(e.type===Ve.LEVEL&&e.level!==null?d=this.hls.levels[e.level].details:e.type===Ve.AUDIO_TRACK&&e.id!==null?d=this.hls.audioTracks[e.id].details:e.type===Ve.SUBTITLE_TRACK&&e.id!==null&&(d=this.hls.subtitleTracks[e.id].details),d){const g=d.partTarget,p=d.targetduration;if(g&&p){const y=Math.max(g*3,p*.8)*1e3;a=dt({},a,{maxTimeToFirstByteMs:Math.min(y,a.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(y,a.maxTimeToFirstByteMs)})}}}const u=a.errorRetry||a.timeoutRetry||{},c={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},h={onSuccess:(d,g,p,y)=>{const E=this.getInternalLoader(p);this.resetInternalLoader(p.type);const T=d.data;g.parsing.start=performance.now(),Ei.isMediaPlaylist(T)||p.type!==Ve.MANIFEST?this.handleTrackOrLevelPlaylist(d,g,p,y||null,E):this.handleMasterPlaylist(d,g,p,y)},onError:(d,g,p,y)=>{this.handleNetworkError(g,p,!1,d,y)},onTimeout:(d,g,p)=>{this.handleNetworkError(g,p,!0,void 0,d)}};r.load(e,c,h)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,r){const a=this.hls,u=e.data,c=ed(e,s),h=Ei.parseMasterPlaylist(u,c);if(h.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,s,h.playlistParsingError,r,t);return}const{contentSteering:d,levels:g,sessionData:p,sessionKeys:y,startTimeOffset:E,variableList:T}=h;this.variableList=T,g.forEach(_=>{const{unknownCodecs:A}=_;if(A){const{preferManagedMediaSource:C}=this.hls.config;let{audioCodec:k,videoCodec:G}=_;for(let w=A.length;w--;){const P=A[w];nl(P,"audio",C)?(_.audioCodec=k=k?`${k},${P}`:P,Xr.audio[k.substring(0,4)]=2,A.splice(w,1)):nl(P,"video",C)&&(_.videoCodec=G=G?`${G},${P}`:P,Xr.video[G.substring(0,4)]=2,A.splice(w,1))}}});const{AUDIO:x=[],SUBTITLES:S,"CLOSED-CAPTIONS":R}=Ei.parseMasterPlaylistMedia(u,c,h);x.length&&!x.some(A=>!A.url)&&g[0].audioCodec&&!g[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),x.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Rt({}),bitrate:0,url:""})),a.trigger(b.MANIFEST_LOADED,{levels:g,audioTracks:x,subtitles:S,captions:R,contentSteering:d,url:c,stats:t,networkDetails:r,sessionData:p,sessionKeys:y,startTimeOffset:E,variableList:T})}handleTrackOrLevelPlaylist(e,t,s,r,a){const u=this.hls,{id:c,level:h,type:d}=s,g=ed(e,s),p=Ee(h)?h:Ee(c)?c:0,y=ty(s),E=Ei.parseLevelPlaylist(e.data,g,p,y,0,this.variableList);if(d===Ve.MANIFEST){const T={attrs:new Rt({}),bitrate:0,details:E,name:"",url:g};E.requestScheduled=t.loading.start+Ny(E,0),u.trigger(b.MANIFEST_LOADED,{levels:[T],audioTracks:[],url:g,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=E,this.handlePlaylistLoaded(E,e,t,s,r,a)}handleManifestParsingError(e,t,s,r,a){this.hls.trigger(b.ERROR,{type:Le.NETWORK_ERROR,details:z.MANIFEST_PARSING_ERROR,fatal:t.type===Ve.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:r,stats:a})}handleNetworkError(e,t,s=!1,r,a){let u=`A network ${s?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===Ve.LEVEL?u+=`: ${e.level} id: ${e.id}`:(e.type===Ve.AUDIO_TRACK||e.type===Ve.SUBTITLE_TRACK)&&(u+=` id: ${e.id} group-id: "${e.groupId}"`);const c=new Error(u);this.hls.logger.warn(`[playlist-loader]: ${u}`);let h=z.UNKNOWN,d=!1;const g=this.getInternalLoader(e);switch(e.type){case Ve.MANIFEST:h=s?z.MANIFEST_LOAD_TIMEOUT:z.MANIFEST_LOAD_ERROR,d=!0;break;case Ve.LEVEL:h=s?z.LEVEL_LOAD_TIMEOUT:z.LEVEL_LOAD_ERROR,d=!1;break;case Ve.AUDIO_TRACK:h=s?z.AUDIO_TRACK_LOAD_TIMEOUT:z.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case Ve.SUBTITLE_TRACK:h=s?z.SUBTITLE_TRACK_LOAD_TIMEOUT:z.SUBTITLE_LOAD_ERROR,d=!1;break}g&&this.resetInternalLoader(e.type);const p={type:Le.NETWORK_ERROR,details:h,fatal:d,url:e.url,loader:g,context:e,error:c,networkDetails:t,stats:a};if(r){const y=(t==null?void 0:t.url)||e.url;p.response=lt({url:y,data:void 0},r)}this.hls.trigger(b.ERROR,p)}handlePlaylistLoaded(e,t,s,r,a,u){const c=this.hls,{type:h,level:d,levelOrTrack:g,id:p,groupId:y,deliveryDirectives:E}=r,T=ed(t,r),x=ty(r);let S=typeof r.level=="number"&&x===Te.MAIN?d:void 0;const R=e.playlistParsingError;if(R){if(this.hls.logger.warn(`${R} ${e.url}`),!c.config.ignorePlaylistParsingErrors){c.trigger(b.ERROR,{type:Le.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:T,error:R,reason:R.message,response:t,context:r,level:S,parent:x,networkDetails:a,stats:s});return}e.playlistParsingError=null}if(!e.fragments.length){const _=e.playlistParsingError=new Error("No Segments found in Playlist");c.trigger(b.ERROR,{type:Le.NETWORK_ERROR,details:z.LEVEL_EMPTY_ERROR,fatal:!1,url:T,error:_,reason:_.message,response:t,context:r,level:S,parent:x,networkDetails:a,stats:s});return}switch(e.live&&u&&(u.getCacheAge&&(e.ageHeader=u.getCacheAge()||0),(!u.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),h){case Ve.MANIFEST:case Ve.LEVEL:if(S){if(!g)S=0;else if(g!==c.levels[S]){const _=c.levels.indexOf(g);_>-1&&(S=_)}}c.trigger(b.LEVEL_LOADED,{details:e,levelInfo:g||c.levels[0],level:S||0,id:p||0,stats:s,networkDetails:a,deliveryDirectives:E,withoutMultiVariant:h===Ve.MANIFEST});break;case Ve.AUDIO_TRACK:c.trigger(b.AUDIO_TRACK_LOADED,{details:e,track:g,id:p||0,groupId:y||"",stats:s,networkDetails:a,deliveryDirectives:E});break;case Ve.SUBTITLE_TRACK:c.trigger(b.SUBTITLE_TRACK_LOADED,{details:e,track:g,id:p||0,groupId:y||"",stats:s,networkDetails:a,deliveryDirectives:E});break}}}class Qt{static get version(){return ol}static isMSESupported(){return Mv()}static isSupported(){return lL()}static getMediaSource(){return An()}static get Events(){return b}static get MetadataSchema(){return Ns}static get ErrorTypes(){return Le}static get ErrorDetails(){return z}static get DefaultConfig(){return Qt.defaultConfig?Qt.defaultConfig:XA}static set DefaultConfig(e){Qt.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Bd,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=vS(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=WA(Qt.DefaultConfig,e,t);this.userConfig=e,s.progressive&&ZA(s,t);const{abrController:r,bufferController:a,capLevelController:u,errorController:c,fpsController:h}=s,d=new c(this),g=this.abrController=new r(this),p=new dx(this),y=s.interstitialsController,E=y?this.interstitialsController=new y(this,Qt):null,T=this.bufferController=new a(this,p),x=this.capLevelController=new u(this),S=new h(this),R=new dL(this),_=s.contentSteeringController,A=_?new _(this):null,C=this.levelController=new aL(this,A),k=new nL(this),G=new fL(this.config,this.logger),w=this.streamController=new cL(this,p,G),P=this.gapController=new sL(this,p);x.setStreamController(w),S.setStreamController(w);const B=[R,C,w];E&&B.splice(1,0,E),A&&B.splice(1,0,A),this.networkControllers=B;const M=[g,T,P,x,S,k,p];this.audioTrackController=this.createController(s.audioTrackController,B);const j=s.audioStreamController;j&&B.push(this.audioStreamController=new j(this,p,G)),this.subtitleTrackController=this.createController(s.subtitleTrackController,B);const ee=s.subtitleStreamController;ee&&B.push(this.subtititleStreamController=new ee(this,p,G)),this.createController(s.timelineController,M),G.emeController=this.emeController=this.createController(s.emeController,M),this.cmcdController=this.createController(s.cmcdController,M),this.latencyController=this.createController(rL,M),this.coreComponents=M,B.push(d);const oe=d.onErrorOut;typeof oe=="function"&&this.on(b.ERROR,oe,d),this.on(b.MANIFEST_LOADED,R.onManifestLoaded,R)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,r){this._emitter.off(e,t,s,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const r=e===b.ERROR;this.trigger(b.ERROR,{type:Le.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:r,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(b.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const a=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(b.ERROR,{type:Le.OTHER_ERROR,details:z.ATTACH_MEDIA_ERROR,fatal:!0,error:a});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,r=t?e:{media:s};this._media=s,this.trigger(b.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(b.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(b.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,r=this._url=Rd.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&s&&(s!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(b.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Te.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Te.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Te.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=sA()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){QS(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let r=0;r<s;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,s)for(let a=r;a--;){const u=e[a].attrs["HDCP-LEVEL"];if(u&&u<=s)return a}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=xy(t);return Ty(e,s,navigator.mediaCapabilities)}}Qt.defaultConfig=void 0;function Nv(l){var e,t,s="";if(typeof l=="string"||typeof l=="number")s+=l;else if(typeof l=="object")if(Array.isArray(l)){var r=l.length;for(e=0;e<r;e++)l[e]&&(t=Nv(l[e]))&&(s&&(s+=" "),s+=t)}else for(t in l)l[t]&&(s&&(s+=" "),s+=t);return s}function bn(){for(var l,e,t=0,s="",r=arguments.length;t<r;t++)(l=arguments[t])&&(e=Nv(l))&&(s&&(s+=" "),s+=e);return s}const dl=l=>typeof l=="number"&&!isNaN(l),Xn=l=>typeof l=="string",Ps=l=>typeof l=="function",tu=l=>Xn(l)||Ps(l)?l:null,bd=l=>K.isValidElement(l)||Xn(l)||Ps(l)||dl(l);function hL(l,e,t){t===void 0&&(t=300);const{scrollHeight:s,style:r}=l;requestAnimationFrame(()=>{r.minHeight="initial",r.height=s+"px",r.transition=`all ${t}ms`,requestAnimationFrame(()=>{r.height="0",r.padding="0",r.margin="0",setTimeout(e,t)})})}function pu(l){let{enter:e,exit:t,appendPosition:s=!1,collapse:r=!0,collapseDuration:a=300}=l;return function(u){let{children:c,position:h,preventExitTransition:d,done:g,nodeRef:p,isIn:y,playToast:E}=u;const T=s?`${e}--${h}`:e,x=s?`${t}--${h}`:t,S=K.useRef(0);return K.useLayoutEffect(()=>{const R=p.current,_=T.split(" "),A=C=>{C.target===p.current&&(E(),R.removeEventListener("animationend",A),R.removeEventListener("animationcancel",A),S.current===0&&C.type!=="animationcancel"&&R.classList.remove(..._))};R.classList.add(..._),R.addEventListener("animationend",A),R.addEventListener("animationcancel",A)},[]),K.useEffect(()=>{const R=p.current,_=()=>{R.removeEventListener("animationend",_),r?hL(R,g,a):g()};y||(d?_():(S.current=1,R.className+=` ${x}`,R.addEventListener("animationend",_)))},[y]),pt.createElement(pt.Fragment,null,c)}}function sy(l,e){return l!=null?{content:l.content,containerId:l.props.containerId,id:l.props.toastId,theme:l.props.theme,type:l.props.type,data:l.props.data||{},isLoading:l.props.isLoading,icon:l.props.icon,status:e}:{}}const us=new Map;let hl=[];const Ad=new Set,gL=l=>Ad.forEach(e=>e(l)),Pv=()=>us.size>0;function Uv(l,e){var t;if(e)return!((t=us.get(e))==null||!t.isToastActive(l));let s=!1;return us.forEach(r=>{r.isToastActive(l)&&(s=!0)}),s}function Bv(l,e){bd(l)&&(Pv()||hl.push({content:l,options:e}),us.forEach(t=>{t.buildToast(l,e)}))}function iy(l,e){us.forEach(t=>{e!=null&&e!=null&&e.containerId?(e==null?void 0:e.containerId)===t.id&&t.toggle(l,e==null?void 0:e.id):t.toggle(l,e==null?void 0:e.id)})}function mL(l){const{subscribe:e,getSnapshot:t,setProps:s}=K.useRef((function(a){const u=a.containerId||1;return{subscribe(c){const h=(function(g,p,y){let E=1,T=0,x=[],S=[],R=[],_=p;const A=new Map,C=new Set,k=()=>{R=Array.from(A.values()),C.forEach(P=>P())},G=P=>{S=P==null?[]:S.filter(B=>B!==P),k()},w=P=>{const{toastId:B,onOpen:M,updateId:j,children:ee}=P.props,oe=j==null;P.staleId&&A.delete(P.staleId),A.set(B,P),S=[...S,P.props.toastId].filter(de=>de!==P.staleId),k(),y(sy(P,oe?"added":"updated")),oe&&Ps(M)&&M(K.isValidElement(ee)&&ee.props)};return{id:g,props:_,observe:P=>(C.add(P),()=>C.delete(P)),toggle:(P,B)=>{A.forEach(M=>{B!=null&&B!==M.props.toastId||Ps(M.toggle)&&M.toggle(P)})},removeToast:G,toasts:A,clearQueue:()=>{T-=x.length,x=[]},buildToast:(P,B)=>{if((Y=>{let{containerId:ie,toastId:fe,updateId:ge}=Y;const he=ie?ie!==g:g!==1,Pe=A.has(fe)&&ge==null;return he||Pe})(B))return;const{toastId:M,updateId:j,data:ee,staleId:oe,delay:de}=B,ce=()=>{G(M)},U=j==null;U&&T++;const X=St(ke(St(ke({},_),{style:_.toastStyle,key:E++}),Object.fromEntries(Object.entries(B).filter(Y=>{let[ie,fe]=Y;return fe!=null}))),{toastId:M,updateId:j,data:ee,closeToast:ce,isIn:!1,className:tu(B.className||_.toastClassName),bodyClassName:tu(B.bodyClassName||_.bodyClassName),progressClassName:tu(B.progressClassName||_.progressClassName),autoClose:!B.isLoading&&(te=B.autoClose,ue=_.autoClose,te===!1||dl(te)&&te>0?te:ue),deleteToast(){const Y=A.get(M),{onClose:ie,children:fe}=Y.props;Ps(ie)&&ie(K.isValidElement(fe)&&fe.props),y(sy(Y,"removed")),A.delete(M),T--,T<0&&(T=0),x.length>0?w(x.shift()):k()}});var te,ue;X.closeButton=_.closeButton,B.closeButton===!1||bd(B.closeButton)?X.closeButton=B.closeButton:B.closeButton===!0&&(X.closeButton=!bd(_.closeButton)||_.closeButton);let O=P;K.isValidElement(P)&&!Xn(P.type)?O=K.cloneElement(P,{closeToast:ce,toastProps:X,data:ee}):Ps(P)&&(O=P({closeToast:ce,toastProps:X,data:ee}));const $={content:O,props:X,staleId:oe};_.limit&&_.limit>0&&T>_.limit&&U?x.push($):dl(de)?setTimeout(()=>{w($)},de):w($)},setProps(P){_=P},setToggle:(P,B)=>{A.get(P).toggle=B},isToastActive:P=>S.some(B=>B===P),getSnapshot:()=>R}})(u,a,gL);us.set(u,h);const d=h.observe(c);return hl.forEach(g=>Bv(g.content,g.options)),hl=[],()=>{d(),us.delete(u)}},setProps(c){var h;(h=us.get(u))==null||h.setProps(c)},getSnapshot(){var c;return(c=us.get(u))==null?void 0:c.getSnapshot()}}})(l)).current;s(l);const r=K.useSyncExternalStore(e,t,t);return{getToastToRender:function(a){if(!r)return[];const u=new Map;return l.newestOnTop&&r.reverse(),r.forEach(c=>{const{position:h}=c.props;u.has(h)||u.set(h,[]),u.get(h).push(c)}),Array.from(u,c=>a(c[0],c[1]))},isToastActive:Uv,count:r==null?void 0:r.length}}function pL(l){const[e,t]=K.useState(!1),[s,r]=K.useState(!1),a=K.useRef(null),u=K.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:c,pauseOnHover:h,closeToast:d,onClick:g,closeOnClick:p}=l;var y,E;function T(){t(!0)}function x(){t(!1)}function S(A){const C=a.current;u.canDrag&&C&&(u.didMove=!0,e&&x(),u.delta=l.draggableDirection==="x"?A.clientX-u.start:A.clientY-u.start,u.start!==A.clientX&&(u.canCloseOnClick=!1),C.style.transform=`translate3d(${l.draggableDirection==="x"?`${u.delta}px, var(--y)`:`0, calc(${u.delta}px + var(--y))`},0)`,C.style.opacity=""+(1-Math.abs(u.delta/u.removalDistance)))}function R(){document.removeEventListener("pointermove",S),document.removeEventListener("pointerup",R);const A=a.current;if(u.canDrag&&u.didMove&&A){if(u.canDrag=!1,Math.abs(u.delta)>u.removalDistance)return r(!0),l.closeToast(),void l.collapseAll();A.style.transition="transform 0.2s, opacity 0.2s",A.style.removeProperty("transform"),A.style.removeProperty("opacity")}}(E=us.get((y={id:l.toastId,containerId:l.containerId,fn:t}).containerId||1))==null||E.setToggle(y.id,y.fn),K.useEffect(()=>{if(l.pauseOnFocusLoss)return document.hasFocus()||x(),window.addEventListener("focus",T),window.addEventListener("blur",x),()=>{window.removeEventListener("focus",T),window.removeEventListener("blur",x)}},[l.pauseOnFocusLoss]);const _={onPointerDown:function(A){if(l.draggable===!0||l.draggable===A.pointerType){u.didMove=!1,document.addEventListener("pointermove",S),document.addEventListener("pointerup",R);const C=a.current;u.canCloseOnClick=!0,u.canDrag=!0,C.style.transition="none",l.draggableDirection==="x"?(u.start=A.clientX,u.removalDistance=C.offsetWidth*(l.draggablePercent/100)):(u.start=A.clientY,u.removalDistance=C.offsetHeight*(l.draggablePercent===80?1.5*l.draggablePercent:l.draggablePercent)/100)}},onPointerUp:function(A){const{top:C,bottom:k,left:G,right:w}=a.current.getBoundingClientRect();A.nativeEvent.type!=="touchend"&&l.pauseOnHover&&A.clientX>=G&&A.clientX<=w&&A.clientY>=C&&A.clientY<=k?x():T()}};return c&&h&&(_.onMouseEnter=x,l.stacked||(_.onMouseLeave=T)),p&&(_.onClick=A=>{g&&g(A),u.canCloseOnClick&&d()}),{playToast:T,pauseToast:x,isRunning:e,preventExitTransition:s,toastRef:a,eventHandlers:_}}function yL(l){let{delay:e,isRunning:t,closeToast:s,type:r="default",hide:a,className:u,style:c,controlledProgress:h,progress:d,rtl:g,isIn:p,theme:y}=l;const E=a||h&&d===0,T=St(ke({},c),{animationDuration:`${e}ms`,animationPlayState:t?"running":"paused"});h&&(T.transform=`scaleX(${d})`);const x=bn("Toastify__progress-bar",h?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${y}`,`Toastify__progress-bar--${r}`,{"Toastify__progress-bar--rtl":g}),S=Ps(u)?u({rtl:g,type:r,defaultClassName:x}):bn(x,u),R={[h&&d>=1?"onTransitionEnd":"onAnimationEnd"]:h&&d<1?null:()=>{p&&s()}};return pt.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":E},pt.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${y} Toastify__progress-bar--${r}`}),pt.createElement("div",ke({role:"progressbar","aria-hidden":E?"true":"false","aria-label":"notification timer",className:S,style:T},R)))}let vL=1;const Fv=()=>""+vL++;function EL(l){return l&&(Xn(l.toastId)||dl(l.toastId))?l.toastId:Fv()}function il(l,e){return Bv(l,e),e.toastId}function du(l,e){return St(ke({},e),{type:e&&e.type||l,toastId:EL(e)})}function Ko(l){return(e,t)=>il(e,du(l,t))}function ve(l,e){return il(l,du("default",e))}ve.loading=(l,e)=>il(l,du("default",ke({isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1},e))),ve.promise=function(l,e,t){let s,{pending:r,error:a,success:u}=e;r&&(s=Xn(r)?ve.loading(r,t):ve.loading(r.render,ke(ke({},t),r)));const c={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},h=(g,p,y)=>{if(p==null)return void ve.dismiss(s);const E=St(ke(ke({type:g},c),t),{data:y}),T=Xn(p)?{render:p}:p;return s?ve.update(s,ke(ke({},E),T)):ve(T.render,ke(ke({},E),T)),y},d=Ps(l)?l():l;return d.then(g=>h("success",u,g)).catch(g=>h("error",a,g)),d},ve.success=Ko("success"),ve.info=Ko("info"),ve.error=Ko("error"),ve.warning=Ko("warning"),ve.warn=ve.warning,ve.dark=(l,e)=>il(l,du("default",ke({theme:"dark"},e))),ve.dismiss=function(l){(function(e){var t;if(Pv()){if(e==null||Xn(t=e)||dl(t))us.forEach(s=>{s.removeToast(e)});else if(e&&("containerId"in e||"id"in e)){const s=us.get(e.containerId);s?s.removeToast(e.id):us.forEach(r=>{r.removeToast(e.id)})}}else hl=hl.filter(s=>e!=null&&s.options.toastId!==e)})(l)},ve.clearWaitingQueue=function(l){l===void 0&&(l={}),us.forEach(e=>{!e.props.limit||l.containerId&&e.id!==l.containerId||e.clearQueue()})},ve.isActive=Uv,ve.update=function(l,e){e===void 0&&(e={});const t=((s,r)=>{var a;let{containerId:u}=r;return(a=us.get(u||1))==null?void 0:a.toasts.get(s)})(l,e);if(t){const{props:s,content:r}=t,a=St(ke(ke({delay:100},s),e),{toastId:e.toastId||l,updateId:Fv()});a.toastId!==l&&(a.staleId=l);const u=a.render||r;delete a.render,il(u,a)}},ve.done=l=>{ve.update(l,{progress:1})},ve.onChange=function(l){return Ad.add(l),()=>{Ad.delete(l)}},ve.play=l=>iy(!0,l),ve.pause=l=>iy(!1,l);const TL=typeof window!="undefined"?K.useLayoutEffect:K.useEffect,zo=l=>{let a=l,{theme:e,type:t,isLoading:s}=a,r=Im(a,["theme","type","isLoading"]);return pt.createElement("svg",ke({viewBox:"0 0 24 24",width:"100%",height:"100%",fill:e==="colored"?"currentColor":`var(--toastify-icon-color-${t})`},r))},td={info:function(l){return pt.createElement(zo,ke({},l),pt.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(l){return pt.createElement(zo,ke({},l),pt.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(l){return pt.createElement(zo,ke({},l),pt.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(l){return pt.createElement(zo,ke({},l),pt.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return pt.createElement("div",{className:"Toastify__spinner"})}},SL=l=>{const{isRunning:e,preventExitTransition:t,toastRef:s,eventHandlers:r,playToast:a}=pL(l),{closeButton:u,children:c,autoClose:h,onClick:d,type:g,hideProgressBar:p,closeToast:y,transition:E,position:T,className:x,style:S,bodyClassName:R,bodyStyle:_,progressClassName:A,progressStyle:C,updateId:k,role:G,progress:w,rtl:P,toastId:B,deleteToast:M,isIn:j,isLoading:ee,closeOnClick:oe,theme:de}=l,ce=bn("Toastify__toast",`Toastify__toast-theme--${de}`,`Toastify__toast--${g}`,{"Toastify__toast--rtl":P},{"Toastify__toast--close-on-click":oe}),U=Ps(x)?x({rtl:P,position:T,type:g,defaultClassName:ce}):bn(ce,x),X=(function($){let{theme:Y,type:ie,isLoading:fe,icon:ge}=$,he=null;const Pe={theme:Y,type:ie};return ge===!1||(Ps(ge)?he=ge(St(ke({},Pe),{isLoading:fe})):K.isValidElement(ge)?he=K.cloneElement(ge,Pe):fe?he=td.spinner():(be=>be in td)(ie)&&(he=td[ie](Pe))),he})(l),te=!!w||!h,ue={closeToast:y,type:g,theme:de};let O=null;return u===!1||(O=Ps(u)?u(ue):K.isValidElement(u)?K.cloneElement(u,ue):(function($){let{closeToast:Y,theme:ie,ariaLabel:fe="close"}=$;return pt.createElement("button",{className:`Toastify__close-button Toastify__close-button--${ie}`,type:"button",onClick:ge=>{ge.stopPropagation(),Y(ge)},"aria-label":fe},pt.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},pt.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))})(ue)),pt.createElement(E,{isIn:j,done:M,position:T,preventExitTransition:t,nodeRef:s,playToast:a},pt.createElement("div",St(ke({id:B,onClick:d,"data-in":j,className:U},r),{style:S,ref:s}),pt.createElement("div",St(ke({},j&&{role:G}),{className:Ps(R)?R({type:g}):bn("Toastify__toast-body",R),style:_}),X!=null&&pt.createElement("div",{className:bn("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!ee})},X),pt.createElement("div",null,c)),O,pt.createElement(yL,St(ke({},k&&!te?{key:`pb-${k}`}:{}),{rtl:P,theme:de,delay:h,isRunning:e,isIn:j,closeToast:y,hide:p,type:g,style:C,className:A,controlledProgress:te,progress:w||0}))))},yu=function(l,e){return e===void 0&&(e=!1),{enter:`Toastify--animate Toastify__${l}-enter`,exit:`Toastify--animate Toastify__${l}-exit`,appendPosition:e}},xL=pu(yu("bounce",!0));pu(yu("slide",!0));pu(yu("zoom"));pu(yu("flip"));const bL={position:"top-right",transition:xL,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};function AL(l){let e=ke(ke({},bL),l);const t=l.stacked,[s,r]=K.useState(!0),a=K.useRef(null),{getToastToRender:u,isToastActive:c,count:h}=mL(e),{className:d,style:g,rtl:p,containerId:y}=e;function E(x){const S=bn("Toastify__toast-container",`Toastify__toast-container--${x}`,{"Toastify__toast-container--rtl":p});return Ps(d)?d({position:x,rtl:p,defaultClassName:S}):bn(S,tu(d))}function T(){t&&(r(!0),ve.play())}return TL(()=>{if(t){var x;const S=a.current.querySelectorAll('[data-in="true"]'),R=12,_=(x=e.position)==null?void 0:x.includes("top");let A=0,C=0;Array.from(S).reverse().forEach((k,G)=>{const w=k;w.classList.add("Toastify__toast--stacked"),G>0&&(w.dataset.collapsed=`${s}`),w.dataset.pos||(w.dataset.pos=_?"top":"bot");const P=A*(s?.2:1)+(s?0:R*G);w.style.setProperty("--y",`${_?P:-1*P}px`),w.style.setProperty("--g",`${R}`),w.style.setProperty("--s",""+(1-(s?C:0))),A+=w.offsetHeight,C+=.025})}},[s,h,t]),pt.createElement("div",{ref:a,className:"Toastify",id:y,onMouseEnter:()=>{t&&(r(!1),ve.pause())},onMouseLeave:T},u((x,S)=>{const R=S.length?ke({},g):St(ke({},g),{pointerEvents:"none"});return pt.createElement("div",{className:E(x),style:R,key:`container-${x}`},S.map(_=>{let{content:A,props:C}=_;return pt.createElement(SL,St(ke({},C),{stacked:t,collapseAll:T,isIn:c(C.toastId,C.containerId),style:C.style,key:`toast-${C.key}`}),A)}))}))}const $v=({item:l,onClick:e,isFocused:t})=>{const s=l.name||l.title||"Unknown Channel",r=l.screenshot_uri?l.screenshot_uri.startsWith("http")?l.screenshot_uri:`${Wr.HOST}/api/images${l.screenshot_uri}`:null;return I.jsxs("div",{className:`flex items-center p-2 transition-colors duration-150 rounded-md ${t?"bg-blue-600/50":"bg-transparent hover:bg-white/10"}`,onClick:()=>e(l),"data-focusable":"true",tabIndex:-1,children:[I.jsx("span",{className:"w-12 pr-2 text-left text-sm font-medium text-gray-400",children:l.number}),I.jsx("div",{className:"mr-3 flex h-12 w-16 flex-shrink-0 items-center justify-center overflow-hidden rounded-sm bg-gray-700",children:r?I.jsx("img",{src:r,alt:s,className:"h-full w-full object-contain"}):I.jsx("span",{className:"text-xs text-gray-500",children:"No Logo"})}),I.jsx("h3",{className:"truncate text-base font-semibold text-white",children:s})]})},LL=({channels:l,channelGroups:e,onChannelSelect:t,onBack:s,currentItemId:r})=>{const u=(()=>{if(!r)return{groupIdx:0,channelIdx:0};const A=l.find(G=>G.id===r);if(!A)return{groupIdx:0,channelIdx:0};const C=e.findIndex(G=>G.id===A.tv_genre_id);if(C>-1){const w=l.filter(P=>P.tv_genre_id===e[C].id).findIndex(P=>P.id===r);return{groupIdx:C,channelIdx:Math.max(0,w)}}const k=l.findIndex(G=>G.id===r);return{groupIdx:0,channelIdx:Math.max(0,k)}})(),[c,h]=K.useState("channels"),[d,g]=K.useState(e[u.groupIdx]||e[0]),[p,y]=K.useState(u.groupIdx),[E,T]=K.useState(u.channelIdx),x=K.useRef(null),S=K.useRef(null),R=K.useMemo(()=>{if(!d||d.id==="all")return l;if(d.id==="fav")try{const A=localStorage.getItem("favorite_channels"),C=A?JSON.parse(A):[],k=new Set(C);return l.filter(G=>k.has(G.id))}catch(A){return console.error("Failed to parse favorites",A),[]}return l.filter(A=>A.tv_genre_id===d.id)},[l,d]),_=K.useCallback((A,C)=>{g(A),y(C),T(0),h("channels")},[]);return K.useEffect(()=>{const A=C=>{switch(C.preventDefault(),C.stopPropagation(),C.keyCode){case 37:h("groups");break;case 39:h("channels");break;case 38:c==="groups"?y(k=>k>0?k-1:0):T(k=>k>0?k-1:0);break;case 40:c==="groups"?y(k=>k<e.length-1?k+1:e.length-1):T(k=>k<R.length-1?k+1:R.length-1);break;case 13:c==="groups"?_(e[p],p):t(R[E]);break;case 0:case 10009:case 8:s();break}};return document.addEventListener("keydown",A),()=>{document.removeEventListener("keydown",A)}},[c,p,E,e,R,t,s,_]),K.useEffect(()=>{if(x.current){const A=x.current.children[p];A&&A.scrollIntoView({behavior:"instant",block:"nearest"})}},[p]),K.useEffect(()=>{if(S.current){const A=S.current.children[E];A&&A.scrollIntoView({behavior:"instant",block:"nearest"})}},[E,R]),I.jsxs("div",{className:"absolute left-0 top-0 z-40 flex h-full w-full max-w-xl flex-row bg-gray-900 bg-opacity-80 backdrop-blur-md",tabIndex:-1,children:[I.jsx("div",{ref:x,className:"h-full w-1/3 overflow-y-auto p-2",children:e.map((A,C)=>I.jsx("div",{"data-focusable":"true",onClick:()=>_(A,C),className:`p-3 text-left text-lg font-semibold text-white transition-colors duration-150 ${c==="groups"&&p===C?"bg-blue-600":d.id===A.id?"bg-gray-700":"hover:bg-gray-700/50"}`,children:A.title},A.id))}),I.jsx("div",{ref:S,className:"h-full w-2/3 overflow-y-auto border-l border-gray-700",children:R.map((A,C)=>I.jsx($v,{item:A,onClick:t,isFocused:c==="channels"&&E===C},A.id))})]})},sd=["contain","cover","fill"],RL=()=>{const[l,e]=K.useState(new Date);return K.useEffect(()=>{const t=setInterval(()=>e(new Date),1e3);return()=>clearInterval(t)},[]),new Intl.DateTimeFormat("en-US",{weekday:"short",day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit",hour12:!0}).format(l)},id=l=>isNaN(l)?"...":new Date(l*1e3).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),ny=({streamUrl:l,rawStreamUrl:e,onBack:t,itemId:s,contentType:r,mediaId:a,item:u,seriesItem:c,channels:h,previewChannelInfo:d,channelInfo:g,onNextChannel:p,onPrevChannel:y,onChannelSelect:E,epgData:T,channelGroups:x,favorites:S,toggleFavorite:R})=>{var El,ia;const _=!!window.tizen,A=K.useRef(null),C=K.useRef(null),k=K.useRef(null),G=K.useRef(null),w=K.useRef(null),P=K.useRef(null),B=K.useRef(null),M=K.useRef(0),[j,ee]=K.useState(!0),[oe,de]=K.useState(!1),[ce,U]=K.useState(1),[X,te]=K.useState(0),[ue,O]=K.useState(0),[$,Y]=K.useState(0),[ie,fe]=K.useState(!0),[ge,he]=K.useState(!1),[Pe,be]=K.useState(!1),[ht,tt]=K.useState(!1),[Pt,xs]=K.useState(!1),[fs,Ut]=K.useState(!window.tizen),[Wn,Fe]=K.useState(0),[We,It]=K.useState(0),[ss,st]=K.useState(!1),[as,Wt]=K.useState(!0),bs=K.useRef(null),[se,ye]=K.useState(null),Ae=K.useRef(0),pe=K.useRef(null),_e=K.useRef(null),Oe=K.useRef(0),[Ze,xt]=K.useState(!1),[ni,Zn]=K.useState([]),[ri,xi]=K.useState([]),[ai,Rn]=K.useState([]),[Jn,Jr]=K.useState(-1),[ea,er]=K.useState(-1),[li,gl]=K.useState(-1),[Bs,Vi]=K.useState(!1),[ds,hs]=K.useState("main"),[Ki,tr]=K.useState(null),[As,wt]=K.useState(null),[is,Fs]=K.useState(0),[gs,vu]=K.useState(()=>localStorage.getItem("videoFitMode")||"contain"),Eu=RL(),ml=g?S.includes(g.id):!1,zi=ni.length>1||ri.length>1||ai.length>0;K.useEffect(()=>{localStorage.setItem("videoFitMode",gs),A.current&&(A.current.style.objectFit=gs)},[gs]),K.useEffect(()=>{const J=A.current,Se=fs?l:e;return!J||!Se?void 0:(Oe.current=0,B.current&&(clearTimeout(B.current),B.current=null),(()=>{if(r!=="tv"){const me=localStorage.getItem(`video-progress-${s}`);me&&(J.currentTime=parseFloat(me))}if(Qt.isSupported()){w.current&&w.current.destroy();const me=new Qt(ke({enableWorker:!0,lowLatencyMode:!0,maxBufferLength:15,maxMaxBufferLength:30,abrEwmaDefaultEstimate:5e5,manifestLoadingMaxRetry:3,manifestLoadingRetryDelay:1e3},r==="tv"&&{liveSyncDuration:10,liveMaxLatencyDuration:20,maxBufferLength:10,maxMaxBufferLength:20}));w.current=me,me.loadSource(Se),me.attachMedia(J),me.on(Qt.Events.MANIFEST_PARSED,(Ue,Ie)=>{J.play(),Zn(Ie.levels),Jr(me.currentLevel)}),me.on(Qt.Events.AUDIO_TRACKS_UPDATED,(Ue,Ie)=>{xi(Ie.audioTracks),er(me.audioTrack)}),me.on(Qt.Events.SUBTITLE_TRACKS_UPDATED,(Ue,Ie)=>{Rn(Ie.subtitleTracks),gl(me.subtitleTrack)}),me.on(Qt.Events.LEVEL_SWITCHED,(Ue,Ie)=>{Jr(Ie.level)}),me.on(Qt.Events.AUDIO_TRACK_SWITCHED,(Ue,Ie)=>{er(Ie.id)}),me.on(Qt.Events.SUBTITLE_TRACK_SWITCH,(Ue,Ie)=>{gl(Ie.id)}),me.on(Qt.Events.ERROR,(Ue,Ie)=>{if(console.error(Ie),Ie.fatal){let qe=`An error occurred: ${Ie.details}`;if(Oe.current>=5){ve.error("Failed to play after 5 attempts. Returning to list.");return}switch(Ie.type){case Qt.ErrorTypes.NETWORK_ERROR:if(B.current)return;Oe.current++,qe=`A network error occurred: ${Ie.details}. Retrying in 3 seconds (Attempt ${Oe.current}/5)...`,ve.warn(qe),B.current=setTimeout(()=>{B.current=null,w.current&&w.current.startLoad()},3e3);break;case Qt.ErrorTypes.MEDIA_ERROR:qe=`A media error occurred: ${Ie.details}`,Ie.details==="bufferAppendError"&&l&&e?(qe="Buffer append error. Trying the other stream source...",ve.warn(qe),Ut(Ke=>!Ke)):(Oe.current++,ve.error(qe),me.recoverMediaError());break;default:qe=`An unrecoverable error occurred: ${Ie.details}`,me.destroy(),ve.error(qe),t();break}}})}else J.canPlayType("application/vnd.apple.mpegurl")&&(J.src=Se,J.addEventListener("loadedmetadata",()=>{if(r!=="tv"){const me=localStorage.getItem(`video-progress-${s}`);me&&(J.currentTime=parseFloat(me))}J.play()}))})(),()=>{w.current&&w.current.destroy(),B.current&&(clearTimeout(B.current),B.current=null)})},[l,e,fs,s,r,t]),K.useEffect(()=>{const J=A.current;if(!J)return;const Se=()=>{const it=A.current;if(it){if(r==="tv"?(te(0),O(0)):Pt||(it.duration&&it.duration>0?te(it.currentTime/it.duration*100):te(0)),r!=="tv"&&Y(it.currentTime),r!=="tv"&&it.duration>0&&a&&s){const nt=it.currentTime/it.duration*100,Et=c||u,rr=JSON.stringify({mediaId:a,fileId:s,type:r,title:Et==null?void 0:Et.title,name:(Et==null?void 0:Et.name)||(Et==null?void 0:Et.title),screenshot_uri:Et==null?void 0:Et.screenshot_uri,is_series:Et==null?void 0:Et.is_series});nt>95?c?(localStorage.setItem(`video-completed-${s}`,"true"),localStorage.removeItem(`video-in-progress-${s}`),localStorage.setItem(`video-in-progress-${a}`,rr),localStorage.removeItem(`video-completed-${a}`)):(localStorage.setItem(`video-completed-${a}`,rr),localStorage.removeItem(`video-in-progress-${a}`)):nt>2&&(localStorage.setItem(`video-in-progress-${a}`,rr),localStorage.removeItem(`video-completed-${a}`),c&&(localStorage.setItem(`video-in-progress-${s}`,"true"),localStorage.removeItem(`video-completed-${s}`)))}if(r!=="tv"){const nt=Date.now();nt-M.current>5e3&&(localStorage.setItem(`video-progress-${s}`,String(it.currentTime)),M.current=nt)}}},$e=()=>O(J.duration),me=()=>ee(!0),Ue=()=>ee(!1),Ie=()=>{de(J.muted),U(J.volume)},qe=()=>tt(!0),Ke=()=>{tt(!1),ee(!0)},Gs=()=>{const it=A.current;if(it&&it.error){if(console.error(`Video Error (code ${it.error.code}): ${it.error.message}`),Oe.current>=5){ve.error("Failed to play after 5 attempts. Returning to list.");return}let nt=`An error occurred (Code: ${it.error.code})`;switch(it.error.code){case it.error.MEDIA_ERR_ABORTED:nt="Video playback aborted.",ve.info(nt),t();break;case it.error.MEDIA_ERR_NETWORK:nt="A network error caused the video download to fail. Retrying...",ve.warn(nt),w.current&&w.current.startLoad();break;case it.error.MEDIA_ERR_DECODE:nt="The video playback was aborted due to a corruption problem.",l&&e?(nt+=" Attempting to recover by switching source...",ve.warn(nt),Ut(Et=>!Et)):w.current?(nt+=" Attempting to recover...",Oe.current++,ve.warn(nt),w.current.recoverMediaError()):(ve.error(nt),t());break;case it.error.MEDIA_ERR_SRC_NOT_SUPPORTED:nt="The video format is not supported.",l&&e?(nt+=" Trying the other stream source...",ve.warn(nt),Ut(Et=>!Et)):(nt="The video could not be loaded because the format is not supported.",ve.error(nt),t());break;default:nt=`An unknown error occurred. (Code: ${it.error.code})`,ve.error(nt),t();break}}};return J.addEventListener("timeupdate",Se),J.addEventListener("durationchange",$e),J.addEventListener("play",me),J.addEventListener("pause",Ue),J.addEventListener("volumechange",Ie),J.addEventListener("waiting",qe),J.addEventListener("playing",Ke),J.addEventListener("error",Gs),()=>{J.removeEventListener("timeupdate",Se),J.removeEventListener("durationchange",$e),J.removeEventListener("play",me),J.removeEventListener("pause",Ue),J.removeEventListener("volumechange",Ie),J.removeEventListener("waiting",qe),J.removeEventListener("playing",Ke),J.removeEventListener("error",Gs)}},[Pt,s,l,e,r,a,u,c,t]),K.useEffect(()=>{const J=()=>{const $e=d||g;if(!$e||!T){tr(null),wt(null),Fs(0);return}const me=T[$e.id];if(!me||me.length===0){tr(null),wt(null),Fs(0);return}const Ue=Date.now()/1e3,Ie=me.findIndex(qe=>Ue>=parseInt(qe.start_timestamp)&&Ue<parseInt(qe.stop_timestamp));if(Ie!==-1){const qe=me[Ie];tr(qe),wt(me[Ie+1]||null);const Ke=parseInt(qe.start_timestamp),it=parseInt(qe.stop_timestamp)-Ke;if(it>0){const nt=Ue-Ke;Fs(Math.min(100,nt/it*100))}else Fs(0)}else{tr(null);const qe=me.findIndex(Ke=>parseInt(Ke.start_timestamp)>Ue);wt(me[qe]||null),Fs(0)}};J();const Se=setInterval(J,3e4);return()=>clearInterval(Se)},[g,d,T]);const Yi=K.useCallback(()=>{document.fullscreenElement?document.exitFullscreen():t()},[t]),Ls=K.useCallback(()=>{const J=A.current;J&&(J.paused?J.play():J.pause())},[]),$s=K.useCallback(J=>{const Se=A.current;Se&&(Se.currentTime+=J)},[]),Gt=K.useCallback(()=>{fe(!0),Wt(!0),P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{fe(!1)},3e3),bs.current&&clearTimeout(bs.current),bs.current=setTimeout(()=>{Wt(!1)},3e3)},[]),oi=K.useCallback(J=>{pe.current&&clearTimeout(pe.current),Ae.current+=J;const Se=A.current,$e=G.current;if(Se&&isFinite(Se.duration)&&$e){const me=Math.max(0,Math.min(Se.duration,Se.currentTime+Ae.current)),Ie=me/Se.duration*100/100*$e.offsetWidth;Fe(me),It(Ie),st(!0)}pe.current=setTimeout(()=>{$s(Ae.current),Ae.current=0,setTimeout(()=>st(!1),500)},500)},[$s]),bt=K.useCallback(J=>{const Se=A.current,$e=G.current;if(Se&&isFinite(Se.duration)&&$e){const me=Math.max(0,Math.min(Se.duration,Se.currentTime+J)),Ie=me/Se.duration*100/100*$e.offsetWidth;Fe(me),It(Ie),st(!0),$s(J),setTimeout(()=>{st(!1)},500)}},[$s]);K.useEffect(()=>{const J=me=>{var Ke;const Ue=Array.from(((Ke=C.current)==null?void 0:Ke.querySelectorAll('[data-focusable="true"]'))||[]);if(Ue.length===0)return;const Ie=se===null?0:se,qe=Ue[Ie];switch(me.keyCode){case 37:me.preventDefault(),r==="tv"&&qe&&qe.getAttribute("data-control")!=="seekbar"?(y==null||y(),Gt()):qe&&qe.getAttribute("data-control")==="seekbar"?oi(-10):Ie>0&&ye(Ie-1);break;case 39:me.preventDefault(),r==="tv"&&qe&&qe.getAttribute("data-control")!=="seekbar"?(p==null||p(),Gt()):qe&&qe.getAttribute("data-control")==="seekbar"?oi(10):Ie<Ue.length-1&&ye(Ie+1);break;case 38:me.preventDefault(),Ie>0&&ye(Ie-1);break;case 40:me.preventDefault(),Ie<Ue.length-1&&ye(Ie+1);break;case 13:me.preventDefault(),qe&&qe.click();break;case 415:case 19:case 10252:me.preventDefault(),Ls();break;case 412:me.preventDefault(),r==="tv"?y==null||y():bt(-30);break;case 417:me.preventDefault(),r==="tv"?p==null||p():bt(30);break;case 427:me.preventDefault(),r==="tv"&&(y==null||y());break;case 428:me.preventDefault(),r==="tv"&&(p==null||p());break;case 405:me.preventDefault(),r==="tv"&&g&&R(g);break;case 0:case 10009:case 8:{const Gs=document.activeElement;if(Gs&&(Gs.tagName==="INPUT"||Gs.tagName==="TEXTAREA"))return;me.preventDefault(),Yi();break}}},Se=me=>{var qe;const Ue=Array.from(((qe=k.current)==null?void 0:qe.querySelectorAll('[data-focusable="true"]'))||[]);if(Ue.length===0)return;let Ie=se===null?0:se;switch(Ie<0&&(Ie=0),me.keyCode){case 38:me.preventDefault(),ye(Ke=>Ke!==null&&Ke>0?Ke-1:Ue.length-1);break;case 40:me.preventDefault(),ye(Ke=>Ke!==null&&Ke<Ue.length-1?Ke+1:0);break;case 13:me.preventDefault(),Ue[Ie]&&Ue[Ie].click();break;case 0:case 10009:case 8:{const Ke=document.activeElement;if(Ke&&(Ke.tagName==="INPUT"||Ke.tagName==="TEXTAREA"))return;me.preventDefault(),Yi();break}}},$e=me=>{if(Ze){me.stopPropagation();return}const Ue=!ie;Gt(),me.stopPropagation(),!(Ue&&me.keyCode!==405)&&(Bs?Se(me):J(me))};return document.addEventListener("keydown",$e),()=>{document.removeEventListener("keydown",$e)}},[se,Bs,ds,Ze,$s,Ls,Gt,oi,bt,Yi,r,y,p,ie,g,R]),K.useEffect(()=>{var $e;if(Ze||Bs)return;const J=Array.from((($e=C.current)==null?void 0:$e.querySelectorAll('[data-focusable="true"]'))||[]);if(J.length===0)return;const Se=se===null?0:se;if(Se>=J.length){ye(J.length-1);return}se===null&&ye(0),J.forEach((me,Ue)=>{Ue===Se?(me.classList.add("focused"),me.focus()):me.classList.remove("focused")})},[se,Bs,Ze]),K.useEffect(()=>{var $e;if(!Bs||Ze)return;const J=Array.from((($e=k.current)==null?void 0:$e.querySelectorAll('[data-focusable="true"]'))||[]);if(J.length===0)return;const Se=se===null?0:se;if(Se>=J.length){ye(J.length-1);return}J.forEach((me,Ue)=>{Ue===Se?(me.classList.add("focused"),me.focus()):me.classList.remove("focused")})},[se,Bs,ds,Ze]),K.useEffect(()=>{const J=()=>{var $e;const Se=!!document.fullscreenElement;if(be(Se),!Se&&se!==null){const Ue=Array.from((($e=C.current)==null?void 0:$e.querySelectorAll('[data-focusable="true"]'))||[])[se];Ue&&Ue.focus()}};return document.addEventListener("fullscreenchange",J),()=>document.removeEventListener("fullscreenchange",J)},[se]),K.useEffect(()=>{d&&Gt()},[d,Gt]);const pl=()=>{r!=="tv"&&xs(!0)},yl=J=>{if(r==="tv")return;xs(!1);const Se=A.current;if(Se&&isFinite(Se.duration)){const $e=Number(J.target.value)/100*Se.duration;Se.currentTime=$e}},bi=J=>{r!=="tv"&&te(Number(J.target.value))},qi=J=>{if(r==="tv")return;const Se=A.current;if(Se&&isFinite(Se.duration)){const $e=J.currentTarget.getBoundingClientRect(),me=J.clientX-$e.left,Ie=me/$e.width*Se.duration;Fe(Ie),It(me)}},Tu=J=>{const Se=A.current;if(Se){const $e=parseFloat(J.target.value);Se.volume=$e,Se.muted=$e===0}},ta=()=>{const J=A.current;J&&(J.muted=!J.muted)},vl=()=>{Gt()},sr=K.useCallback(()=>{const J=C.current;J&&(document.fullscreenElement?document.exitFullscreen():J.requestFullscreen().catch(Se=>{console.error(`Error attempting to enable full-screen mode: ${Se.message}`)}))},[]);K.useEffect(()=>{Gt(),setTimeout(()=>{var $e,me;const Se=Array.from((($e=C.current)==null?void 0:$e.querySelectorAll('[data-focusable="true"]'))||[]).findIndex(Ue=>Ue.getAttribute("data-control")==="play-pause");Se!==-1?ye(Se):(me=C.current)==null||me.focus()},100)},[Gt,sr]);const _n=()=>{vu(J=>{const $e=(sd.indexOf(J)+1)%sd.length;return sd[$e]})},ir=K.useCallback(()=>{const J=!ie;Gt(),J||Ls()},[ie,Gt,Ls]),Zs=K.useCallback(()=>{const J=!ie;Gt(),J||xt(!0)},[ie,Gt]),nr=()=>{Bs?(Vi(!1),hs("main")):Vi(!0)},In=J=>{w.current&&(w.current.nextLevel=J),hs("main"),Vi(!1)},Ai=J=>{w.current&&(w.current.audioTrack=J),hs("main"),Vi(!1)},Xi=J=>{w.current&&(w.current.subtitleTrack=J),hs("main"),Vi(!1)},sa=()=>{if(e){const J=document.createElement("textarea");J.value=e,document.body.appendChild(J),J.select(),document.execCommand("copy"),document.body.removeChild(J),he(!0),setTimeout(()=>he(!1),2e3)}};return I.jsx("div",{className:"h-screen w-full bg-black","data-focusable":"true",tabIndex:-1,children:I.jsxs("div",{ref:C,onMouseMove:vl,onMouseLeave:()=>{st(!1),fe(!1),Wt(!1),bs.current&&clearTimeout(bs.current)},className:`group relative h-full w-full overflow-hidden ${!as&&!ie?"cursor-none":""}`,children:[Ze&&r==="tv"&&h&&E&&I.jsx(LL,{channels:h,channelGroups:x||[],onChannelSelect:J=>{E&&E(J),xt(!1)},onBack:()=>xt(!1),currentItemId:s}),I.jsx("video",{ref:A,style:{objectFit:gs},crossOrigin:"anonymous",autoPlay:!0,playsInline:!0,className:"h-full w-full",onClick:ir,onDoubleClick:sr}),d&&I.jsx("div",{className:"pointer-events-none absolute inset-0 z-30 flex items-center justify-center",children:I.jsxs("div",{className:"rounded-lg bg-black bg-opacity-75 p-6 shadow-xl",children:[I.jsx("h2",{className:"text-center text-5xl font-bold text-white",children:d.number}),I.jsx("h3",{className:"mt-2 text-center text-2xl text-gray-200",children:d.name})]})}),ht&&I.jsx("div",{className:"pointer-events-none absolute inset-0 z-10 flex items-center justify-center",children:I.jsxs("div",{className:"relative h-16 w-16",children:[I.jsx("div",{className:"absolute h-full w-full animate-ping rounded-full bg-blue-400 opacity-75"}),I.jsx("div",{className:"relative h-full w-full rounded-full bg-blue-500"})]})}),I.jsxs("div",{className:`pointer-events-none absolute inset-0 z-20 transition-opacity duration-300 ${ie||ht?"opacity-100":"opacity-0"}`,children:[I.jsx("div",{className:"pointer-events-auto absolute left-0 right-0 top-0 p-4",children:I.jsxs("div",{className:"flex items-center space-x-4",children:[I.jsxs("button",{"data-focusable":"true",onClick:Yi,className:"flex items-center rounded-lg bg-gray-700 bg-opacity-70 px-4 py-2 text-white transition-colors hover:bg-gray-600",children:[I.jsx("svg",{className:"mr-2 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:I.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back"]}),!_&&I.jsxs("button",{"data-focusable":"true",onClick:sa,className:"relative flex items-center rounded-lg bg-gray-700 bg-opacity-70 px-4 py-2 text-white transition-colors hover:bg-gray-600",children:[I.jsx("svg",{className:"mr-2 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:I.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),ge?"Copied!":"Copy Link"]}),I.jsxs("label",{htmlFor:"proxy-switch",className:"flex cursor-pointer items-center","data-focusable":"true",children:[I.jsx("span",{className:"mr-2 text-white",children:"Use Proxy"}),I.jsxs("div",{className:"relative",children:[I.jsx("input",{id:"proxy-switch",type:"checkbox",className:"peer sr-only",checked:fs,onChange:()=>Ut(!fs)}),I.jsx("div",{className:"h-6 w-10 rounded-full bg-gray-600 peer-checked:bg-blue-500"}),I.jsx("div",{className:"absolute left-1 top-1 h-4 w-4 rounded-full bg-white transition-transform peer-checked:translate-x-full"})]})]})]})}),r==="tv"?I.jsx("div",{className:"pointer-events-auto absolute bottom-4 left-4 right-4 p-2.5 text-white",children:I.jsxs("div",{className:"rounded-lg border border-gray-700/80 bg-gray-800 bg-opacity-60 p-2.5 shadow-2xl",children:[I.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[I.jsxs("div",{className:"flex min-w-0 items-center",children:[((El=d||g)==null?void 0:El.screenshot_uri)&&I.jsx("img",{src:(ia=(d||g).screenshot_uri)!=null&&ia.startsWith("http")?(d||g).screenshot_uri:`${Wr.HOST}/api/images${(d||g).screenshot_uri}`,alt:(d||g).name,className:"mr-3 h-10 w-12 flex-shrink-0 rounded-sm bg-black object-contain p-0.5"}),I.jsx("span",{className:"text-2xl font-bold",children:d?d.number:g==null?void 0:g.number}),I.jsx("span",{className:"ml-4 truncate text-xl font-semibold",children:d?d.name:g==null?void 0:g.name})]}),I.jsx("div",{className:"ml-4 flex-shrink-0 text-lg text-gray-200",children:Eu})]}),I.jsxs("div",{className:"ml-16",children:[I.jsxs("div",{className:"flex items-center justify-between rounded-sm bg-red-700 bg-opacity-80 p-1.5 px-3",children:[I.jsx("span",{className:"truncate font-semibold",children:Ki?Ki.name:d?d.name:(g==null?void 0:g.name)||"Current Program"}),I.jsx("span",{className:"ml-2 flex-shrink-0 text-sm",children:Ki?`${id(parseInt(Ki.start_timestamp))} - ${id(parseInt(Ki.stop_timestamp))}`:d?"...":"Now"})]}),I.jsxs("div",{className:"flex items-center justify-between p-1.5 px-3",children:[I.jsx("span",{className:"text-gray-200",children:As?As.name:d?"...":"Next Program"}),I.jsx("span",{className:"text-sm text-gray-300",children:As?id(parseInt(As.start_timestamp)):"..."})]})]}),I.jsx("div",{className:"mt-2 h-1.5 w-full rounded-full bg-gray-600",children:I.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${is}%`}})}),I.jsxs("div",{className:"mt-2 flex items-center justify-between px-1 text-sm text-gray-200",children:[I.jsxs("div",{className:"flex items-center space-x-4",children:[I.jsx("button",{"data-focusable":"true","data-control":"play-pause",onClick:Ls,ref:_e,className:"text-white hover:text-blue-400",children:j?I.jsx("svg",{className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 20 20",children:I.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):I.jsx("svg",{className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 20 20",children:I.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),I.jsx("button",{"data-focusable":"true",onClick:Zs,className:"text-white hover:text-blue-400",children:I.jsx("svg",{className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 20 20",children:I.jsx("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd",fillRule:"evenodd"})})})]}),I.jsxs("div",{className:"flex items-center space-x-4",children:[I.jsxs("button",{"data-focusable":"true",onClick:_n,className:"w-16 text-center text-xs font-semibold uppercase text-white hover:text-blue-400",children:[gs==="contain"&&"Fit",gs==="cover"&&"Fill",gs==="fill"&&"Stretch"]}),I.jsxs("div",{className:"relative",children:[zi&&I.jsx("button",{"data-focusable":"true",onClick:nr,className:"text-white hover:text-blue-400",children:I.jsx("svg",{className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 20 20",children:I.jsx("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01-.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106A1.532 1.532 0 0111.49 3.17zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})})}),Bs&&I.jsxs("div",{ref:k,className:"absolute bottom-full right-0 mb-2 w-48 rounded-lg bg-gray-800 bg-opacity-90 py-1 text-sm text-white",children:[ds==="main"&&I.jsxs(I.Fragment,{children:[ni.length>1&&I.jsx("button",{onClick:()=>hs("quality"),className:"block w-full px-4 py-2 text-left hover:bg-gray-700","data-focusable":"true",children:"Quality"}),ri.length>1&&I.jsx("button",{onClick:()=>hs("audio"),className:"block w-full px-4 py-2 text-left hover:bg-gray-700","data-focusable":"true",children:"Audio"}),ai.length>0&&I.jsx("button",{onClick:()=>hs("subtitles"),className:"block w-full px-4 py-2 text-left hover:bg-gray-700","data-focusable":"true",children:"Subtitles"})]}),ds==="quality"&&I.jsxs(I.Fragment,{children:[I.jsx("button",{onClick:()=>In(-1),className:`block w-full px-4 py-2 text-left hover:bg-gray-700 ${Jn===-1?"bg-blue-500":""}`,"data-focusable":"true",children:"Auto"}),ni.map((J,Se)=>I.jsxs("button",{onClick:()=>In(Se),"data-focusable":"true",className:`block w-full px-4 py-2 text-left hover:bg-gray-700 ${Jn===Se?"bg-blue-500":""}`,children:[J.height,"p"," ",J.bitrate>0&&`(${(J.bitrate/1e6).toFixed(1)} Mbps)`]},String(J.url)+Se))]}),ds==="audio"&&I.jsx(I.Fragment,{children:ri.map(J=>I.jsxs("button",{"data-focusable":"true",onClick:()=>Ai(J.id),className:`block w-full px-4 py-2 text-left hover:bg-gray-700 ${ea===J.id?"bg-blue-500":""}`,children:[J.name," ",J.lang&&`(${J.lang})`]},J.id))}),ds==="subtitles"&&I.jsxs(I.Fragment,{children:[I.jsx("button",{onClick:()=>Xi(-1),"data-focusable":"true",className:`block w-full px-4 py-2 text-left hover:bg-gray-700 ${li===-1?"bg-blue-500":""}`,children:"Off"}),ai.map(J=>I.jsxs("button",{"data-focusable":"true",onClick:()=>Xi(J.id),className:`block w-full px-4 py-2 text-left hover:bg-gray-700 ${li===J.id?"bg-blue-500":""}`,children:[J.name," ",J.lang&&`(${J.lang})`]},J.id))]})]})]}),I.jsx("button",{"data-focusable":"true",onClick:()=>g&&R(g),className:"text-white hover:text-yellow-400",children:ml?I.jsx("svg",{className:"h-6 w-6 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:I.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}):I.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:I.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.539 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.539-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})}),!_&&I.jsxs(I.Fragment,{children:[I.jsx("button",{"data-focusable":"true",onClick:ta,className:"text-white hover:text-blue-400",children:oe||ce===0?I.jsx("svg",{className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 20 20",children:I.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z",clipRule:"evenodd"})}):I.jsx("svg",{className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 20 20",children:I.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})})}),I.jsx("button",{"data-focusable":"true",onClick:sr,className:"text-white hover:text-blue-400",children:Pe?I.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:I.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 4H4v6m10 10h6v-6M4 20l6-6m4-4l6-6"})}):I.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:I.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 1v4m0 0h-4m4 0l-5-5"})})})]})]})]})]})}):I.jsxs("div",{className:"pointer-events-auto absolute bottom-0 left-0 right-0 p-4",style:{background:"linear-gradient(to top, rgba(0,0,0,1) 0%, rgba(0,0,0,0.9) 70%, rgba(0,0,0,0) 100%)"},children:[I.jsxs("div",{className:"relative w-full",children:[ss&&I.jsx("div",{className:"absolute bottom-full mb-2 rounded bg-black bg-opacity-75 px-2 py-1 text-xs text-white",style:{left:`${We}px`,transform:"translateX(-50%)"},children:Cf(Wn)}),I.jsx("input",{ref:G,type:"range",min:"0",max:"100",value:X,onMouseDown:pl,onMouseUp:yl,onChange:bi,onMouseMove:qi,onMouseEnter:()=>st(!0),onMouseLeave:()=>st(!1),className:"range-sm h-1 w-full cursor-pointer appearance-none rounded-lg bg-gray-600",style:{accentColor:"#3b82f6"},"data-focusable":"true","data-control":"seekbar"})]}),I.jsxs("div",{className:"mt-2 flex items-center justify-between text-white",children:[I.jsxs("div",{className:"flex items-center space-x-4",children:[I.jsx("button",{"data-focusable":"true","data-control":"play-pause",onClick:Ls,ref:_e,className:"text-white hover:text-blue-400",children:j?I.jsx("svg",{className:"h-8 w-8",fill:"currentColor",viewBox:"0 0 20 20",children:I.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):I.jsx("svg",{className:"h-8 w-8",fill:"currentColor",viewBox:"0 0 20 20",children:I.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),I.jsxs("div",{className:"flex items-center space-x-2",children:[I.jsx("button",{"data-focusable":"true",onClick:()=>bt(-30),className:"text-white hover:text-blue-400",children:I.jsxs("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[I.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"}),I.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 19l-7-7 7-7"})]})}),I.jsx("button",{"data-focusable":"true",onClick:()=>bt(30),className:"text-white hover:text-blue-400",children:I.jsxs("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[I.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"}),I.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 5l7 7-7 7"})]})})]}),I.jsxs("span",{className:"font-mono text-sm",children:[Cf($)," / ",Cf(ue)]})]}),I.jsxs("div",{className:"flex items-center space-x-4",children:[!_&&I.jsx("button",{"data-focusable":"true",onClick:ta,className:"text-white hover:text-blue-400",children:oe||ce===0?I.jsx("svg",{className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 20 20",children:I.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z",clipRule:"evenodd"})}):I.jsx("svg",{className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 20 20",children:I.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})})}),I.jsxs("div",{className:"relative",children:[zi&&I.jsx("button",{"data-focusable":"true",onClick:nr,className:"text-white hover:text-blue-400",children:I.jsx("svg",{className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 20 20",children:I.jsx("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01-.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106A1.532 1.532 0 0111.49 3.17zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})})}),Bs&&I.jsxs("div",{ref:k,className:"absolute bottom-full right-0 mb-2 w-48 rounded-lg bg-gray-800 bg-opacity-90 py-1 text-sm text-white",children:[ds==="main"&&I.jsxs(I.Fragment,{children:[ni.length>1&&I.jsx("button",{onClick:()=>hs("quality"),className:"block w-full px-4 py-2 text-left hover:bg-gray-700","data-focusable":"true",children:"Quality"}),ri.length>1&&I.jsx("button",{onClick:()=>hs("audio"),className:"block w-full px-4 py-2 text-left hover:bg-gray-700","data-focusable":"true",children:"Audio"}),ai.length>0&&I.jsx("button",{onClick:()=>hs("subtitles"),className:"block w-full px-4 py-2 text-left hover:bg-gray-700","data-focusable":"true",children:"Subtitles"})]}),ds==="quality"&&I.jsxs(I.Fragment,{children:[I.jsx("button",{onClick:()=>In(-1),className:`block w-full px-4 py-2 text-left hover:bg-gray-700 ${Jn===-1?"bg-blue-500":""}`,"data-focusable":"true",children:"Auto"}),ni.map((J,Se)=>I.jsxs("button",{onClick:()=>In(Se),"data-focusable":"true",className:`block w-full px-4 py-2 text-left hover:bg-gray-700 ${Jn===Se?"bg-blue-500":""}`,children:[J.height,"p"," ",J.bitrate>0&&`(${(J.bitrate/1e6).toFixed(1)} Mbps)`]},String(J.url)+Se))]}),ds==="audio"&&I.jsx(I.Fragment,{children:ri.map(J=>I.jsxs("button",{"data-focusable":"true",onClick:()=>Ai(J.id),className:`block w-full px-4 py-2 text-left hover:bg-gray-700 ${ea===J.id?"bg-blue-500":""}`,children:[J.name," ",J.lang&&`(${J.lang})`]},J.id))}),ds==="subtitles"&&I.jsxs(I.Fragment,{children:[I.jsx("button",{onClick:()=>Xi(-1),"data-focusable":"true",className:`block w-full px-4 py-2 text-left hover:bg-gray-700 ${li===-1?"bg-blue-500":""}`,children:"Off"}),ai.map(J=>I.jsxs("button",{"data-focusable":"true",onClick:()=>Xi(J.id),className:`block w-full px-4 py-2 text-left hover:bg-gray-700 ${li===J.id?"bg-blue-500":""}`,children:[J.name," ",J.lang&&`(${J.lang})`]},J.id))]})]})]}),I.jsxs("button",{"data-focusable":"true",onClick:_n,className:"w-16 text-center text-xs font-semibold uppercase text-white hover:text-blue-400",children:[gs==="contain"&&"Fit",gs==="cover"&&"Fill",gs==="fill"&&"Stretch"]}),!_&&I.jsxs(I.Fragment,{children:[I.jsx("input",{"data-focusable":"true","data-control":"volume",type:"range",min:"0",max:"1",step:"0.01",value:ce,onChange:Tu,className:"range-sm h-1 w-24 cursor-pointer appearance-none rounded-lg bg-gray-600",style:{accentColor:"#3b82f6"}}),I.jsx("button",{"data-focusable":"true",onClick:sr,className:"text-white hover:text-blue-400",children:Pe?I.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:I.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 4H4v6m10 10h6v-6M4 20l6-6m4-4l6-6"})}):I.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:I.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 1v4m0 0h-4m4 0l-5-5"})})})]})]})]})]})]})]})})},_L=({onClick:l,contentType:e})=>{const[t,s]=K.useState([]);return K.useEffect(()=>{const r=Object.keys(localStorage).filter(c=>c.startsWith("video-in-progress-")),a=[],u=new Set;for(const c of r){const h=localStorage.getItem(c);if(h)try{const d=JSON.parse(h);if(d.type!==e)continue;u.has(d.mediaId)||(a.push({id:d.mediaId,title:d.title,name:d.name,screenshot_uri:d.screenshot_uri,is_series:d.is_series,is_season:0,is_episode:0,is_playable_movie:d.type==="movie"&&d.is_series!=1}),u.add(d.mediaId))}catch(d){console.error(`Failed to parse in-progress item for key ${c}`,d)}}s(a)},[e]),t.length===0?null:I.jsxs("div",{className:"mb-8",children:[I.jsx("h2",{className:"mb-4 text-2xl font-bold text-white",children:"Continue Watching"}),I.jsx("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 md:gap-6 lg:grid-cols-5 xl:grid-cols-6",children:t.map(r=>I.jsx(ay,{item:r,onClick:l},r.id))})]})},IL=()=>{const[l,e]=K.useState([]),[t,s]=K.useState(!0),[r,a]=K.useState(!1),[u,c]=K.useState(""),[h,d]=K.useState("");K.useEffect(()=>{g()},[]);const g=()=>et(null,null,function*(){try{s(!0);const S=yield Nt.get("/profiles");e(S.data)}catch(S){ve.error("Failed to load profiles"),console.error("Error loading profiles:",S)}finally{s(!1)}}),p=S=>et(null,null,function*(){if(window.confirm("Activating this profile will restart the server. Continue?"))try{yield Nt.post(`/profiles/${S}/activate`),ve.success("Profile activated! Server is restarting..."),setTimeout(()=>{g()},2e3)}catch(R){ve.error("Failed to activate profile"),console.error("Error activating profile:",R)}}),y=S=>et(null,null,function*(){var _,A;const R=S.isEnabled?"disable":"enable";try{yield Nt.post(`/profiles/${S.id}/${R}`),ve.success(`Profile ${S.isEnabled?"disabled":"enabled"}`),g()}catch(C){ve.error(((A=(_=C.response)==null?void 0:_.data)==null?void 0:A.error)||"Failed to update profile"),console.error("Error toggling profile:",C)}}),E=S=>et(null,null,function*(){var R,_;if(window.confirm(`Are you sure you want to delete "${S.name}"?`))try{yield Nt.delete(`/profiles/${S.id}`),ve.success("Profile deleted"),g()}catch(A){ve.error(((_=(R=A.response)==null?void 0:R.data)==null?void 0:_.error)||"Failed to delete profile"),console.error("Error deleting profile:",A)}}),T=()=>et(null,null,function*(){var R,_;const S=u.trim();if(!S){ve.error("Profile name is required");return}try{const C=(yield Nt.get("/config")).data;yield Nt.post("/profiles",{name:S,description:h,config:C}),ve.success("Profile created successfully"),a(!1),c(""),d(""),g()}catch(A){ve.error(((_=(R=A.response)==null?void 0:R.data)==null?void 0:_.error)||"Failed to create profile")}}),x=S=>et(null,null,function*(){var A,C;const R=prompt("Enter name for duplicated profile:",`${S.name} (Copy)`);if(!R)return;const _=R.trim();if(_)try{yield Nt.post("/profiles",{name:_,description:S.description,config:S.config}),ve.success("Profile duplicated successfully"),g()}catch(k){ve.error(((C=(A=k.response)==null?void 0:A.data)==null?void 0:C.error)||"Failed to duplicate profile")}});return t?I.jsx("div",{className:"mx-auto my-5 max-w-6xl rounded-lg bg-gray-800 p-5 text-center text-white",children:I.jsx("div",{className:"text-lg",children:"Loading profiles..."})}):I.jsxs("div",{className:"font-sans text-white",children:[I.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[I.jsxs("div",{children:[I.jsx("h2",{className:"text-2xl font-bold",children:"Profiles"}),I.jsx("p",{className:"text-sm text-gray-400",children:"Manage your different server configurations"})]}),I.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 font-bold text-white transition-colors hover:bg-blue-700",children:[I.jsx("span",{children:"+"})," New Profile"]})]}),I.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:l.map(S=>I.jsxs("div",{className:`relative flex flex-col justify-between rounded-xl border p-5 shadow-lg transition-all ${S.isActive?"border-green-500 bg-gray-800 ring-1 ring-green-500/50":"border-gray-700 bg-gray-800/50 hover:bg-gray-800"} ${S.isEnabled?"":"opacity-75"}`,children:[I.jsxs("div",{children:[I.jsxs("div",{className:"flex items-start justify-between",children:[I.jsx("h3",{className:"truncate text-lg font-bold text-white",children:S.name}),S.isActive&&I.jsx("span",{className:"shrink-0 rounded-full border border-green-500/30 bg-green-500/20 px-2 py-0.5 text-xs font-bold text-green-400",children:"ACTIVE"})]}),I.jsx("p",{className:"mt-2 line-clamp-2 min-h-[2.5em] text-sm text-gray-400",children:S.description||"No description provided."}),I.jsxs("div",{className:"mt-4 flex flex-wrap gap-2 text-xs",children:[I.jsxs("span",{className:"rounded bg-gray-700 px-2 py-1 text-gray-300",children:["Host:"," ",I.jsx("span",{className:"text-blue-400",children:S.config.hostname})]}),I.jsxs("span",{className:"rounded bg-gray-700 px-2 py-1 text-gray-300",children:["Groups:"," ",I.jsx("span",{className:"text-blue-400",children:S.config.groups.length})]})]})]}),I.jsxs("div",{className:"mt-6 flex items-center justify-end gap-2 border-t border-gray-700 pt-4",children:[!S.isActive&&I.jsxs(I.Fragment,{children:[I.jsx("button",{onClick:()=>p(S.id),disabled:!S.isEnabled,className:"rounded-lg bg-green-600 px-3 py-1.5 text-xs font-bold text-white hover:bg-green-700 disabled:cursor-not-allowed disabled:bg-gray-600",children:"Activate"}),I.jsx("button",{onClick:()=>E(S),className:"rounded-lg bg-red-600/20 px-3 py-1.5 text-xs font-bold text-red-400 hover:bg-red-600/40",children:"Delete"})]}),I.jsx("button",{onClick:()=>y(S),disabled:S.isActive,className:`rounded-lg px-3 py-1.5 text-xs font-bold transition-colors ${S.isActive?"invisible":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:S.isEnabled?"Disable":"Enable"}),I.jsx("button",{onClick:()=>x(S),className:"rounded-lg bg-blue-600/20 px-3 py-1.5 text-xs font-bold text-blue-400 hover:bg-blue-600/40",children:"Clone"})]})]},S.id))}),r&&I.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:I.jsxs("div",{className:"w-full max-w-md rounded-2xl border border-gray-700 bg-gray-900 p-6 shadow-2xl",children:[I.jsx("h2",{className:"mb-4 text-xl font-bold text-white",children:"Create Profile"}),I.jsxs("div",{className:"space-y-4",children:[I.jsxs("div",{children:[I.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-400",children:"Name"}),I.jsx("input",{type:"text",className:"w-full rounded-lg border border-gray-700 bg-gray-800 p-2 text-white focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., Bedroom STB",value:u,onChange:S=>c(S.target.value),autoFocus:!0})]}),I.jsxs("div",{children:[I.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-400",children:"Description"}),I.jsx("textarea",{className:"w-full resize-none rounded-lg border border-gray-700 bg-gray-800 p-2 text-white focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",rows:3,value:h,onChange:S=>d(S.target.value)})]}),I.jsx("div",{className:"rounded bg-blue-900/20 p-3 text-xs text-blue-200",children:"This profile will inherit your current configuration settings."})]}),I.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[I.jsx("button",{onClick:()=>a(!1),className:"rounded-lg px-4 py-2 text-sm font-semibold text-gray-400 hover:text-white",children:"Cancel"}),I.jsx("button",{onClick:T,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-bold text-white hover:bg-blue-700",children:"Create"})]})]})})]})},DL=()=>{const[l,e]=K.useState({hostname:"",port:"",contextPath:"",mac:"",deviceId1:"",deviceId2:"",serialNumber:"",stbType:"",groups:[],proxy:!1,tokens:[],playCensored:!1}),[t,s]=K.useState("profiles"),[r,a]=K.useState([]),[u,c]=K.useState(!1),[h,d]=K.useState("");K.useEffect(()=>{et(null,null,function*(){yield E(),yield T()})},[]);const g=()=>{c(!0)},p=()=>{c(!1),d("")},y=()=>{const M=h.split(`
`),j={};M.forEach(ee=>{if(ee.includes("http"))try{const oe=new URL(ee.trim());j.hostname=oe.hostname,j.port=oe.port||"80";const de=oe.pathname.split("/").filter(ce=>ce!=="");j.contextPath=de.length>0?de[0]:""}catch(oe){console.error("Invalid URL in import text:",oe),ve.error("Invalid URL detected. Please check the input.")}else if(ee.toLowerCase().startsWith("mac-"))j.mac=ee.substring(ee.indexOf("-")+1).trim();else if(ee.toLowerCase().startsWith("sn-"))j.serialNumber=ee.substring(ee.indexOf("-")+1).trim();else if(ee.toLowerCase().startsWith("device id 1&2-")){const oe=ee.substring(ee.indexOf("-")+1).trim();j.deviceId1=oe,j.deviceId2=oe}}),e(ee=>ke(ke({},ee),j)),ve.success("Configuration imported successfully!"),p()},E=()=>et(null,null,function*(){try{const j=(yield ry(!0)).data;a(j)}catch(M){ve.error("Error loading groups")}}),T=()=>et(null,null,function*(){try{const j=(yield Nt.get("/config")).data;e(ee=>St(ke(ke({},ee),j),{groups:Array.isArray(j.groups)?j.groups:[],proxy:!!j.proxy,playCensored:!!j.playCensored,tokens:Array.isArray(j.tokens)?j.tokens:[]}))}catch(M){ve.error("Error loading configuration")}}),x=M=>{const j=M.target,{name:ee,value:oe,type:de}=j;e(ce=>St(ke({},ce),{[ee]:de==="checkbox"?j.checked:oe}))},S=M=>{const j=Array.from(M.target.selectedOptions).map(ee=>ee.value);e(ee=>St(ke({},ee),{groups:j}))},R=M=>et(null,null,function*(){M.preventDefault();try{const ee=(yield Nt.post("/config",l)).data;ve.success(ee.message||"Configuration updated successfully")}catch(j){ve.error("Error updating configuration")}}),_=()=>et(null,null,function*(){try{yield Nt.get("/v2/refresh-groups"),ve.success("Groups refreshed successfully")}catch(M){ve.error("Error refreshing groups")}yield E()}),A=()=>et(null,null,function*(){try{yield Nt.get("/v2/refresh-channels"),ve.success("Channels refreshed successfully")}catch(M){ve.error("Error refreshing channels")}}),C=()=>et(null,null,function*(){try{yield Nt.get("/v2/refresh-movie-groups"),ve.success("Movie groups refreshed successfully")}catch(M){ve.error("Error refreshing movie groups")}}),k=()=>et(null,null,function*(){try{yield Nt.get("/v2/refresh-series-groups"),ve.success("Series groups refreshed successfully")}catch(M){ve.error("Error refreshing Series groups")}}),G=()=>et(null,null,function*(){try{const j=(yield Nt.get("/v2/get-token")).data.token;j?(e(ee=>St(ke({},ee),{tokens:[...ee.tokens,j]})),ve.success("Token added successfully")):ve.error("Failed to add token")}catch(M){ve.error("Error adding token")}}),w=M=>{e(j=>{const ee=[...j.tokens];return ee.splice(M,1),St(ke({},j),{tokens:ee})})},P=()=>et(null,null,function*(){try{yield Nt.post("/v2/clear-tokens",{}),ve.success("All tokens cleared")}catch(M){ve.error("Error clearing tokens on server")}e(M=>St(ke({},M),{tokens:[]}))}),B=()=>{window.confirm("Are you sure you want to clear all watched and in-progress statuses?")&&(Object.keys(localStorage).forEach(M=>{(M.startsWith("video-completed-")||M.startsWith("video-in-progress-"))&&localStorage.removeItem(M)}),ve.success("All watched and in-progress statuses have been cleared."))};return I.jsxs("div",{className:"mx-auto my-6 max-w-7xl px-4",children:[I.jsxs("div",{className:"mb-6 flex border-b border-gray-700",children:[I.jsx("button",{onClick:()=>s("profiles"),className:`px-6 py-3 text-sm font-bold transition-colors ${t==="profiles"?"border-b-2 border-blue-500 text-blue-400":"text-gray-400 hover:text-white"}`,children:"Profiles"}),I.jsx("button",{onClick:()=>s("config"),className:`px-6 py-3 text-sm font-bold transition-colors ${t==="config"?"border-b-2 border-blue-500 text-blue-400":"text-gray-400 hover:text-white"}`,children:"Current Configuration"})]}),t==="profiles"?I.jsx(IL,{}):I.jsx("div",{className:"animate-fade-in space-y-6",children:I.jsxs("form",{onSubmit:R,className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[I.jsxs("div",{className:"space-y-6",children:[I.jsxs("div",{className:"rounded-xl border border-gray-700 bg-gray-800 p-5 shadow-sm",children:[I.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[I.jsx("h3",{className:"text-lg font-bold text-white",children:"Server Connection"}),I.jsx("button",{type:"button",onClick:g,className:"text-xs font-semibold text-blue-400 hover:text-blue-300",children:"Import Text"})]}),I.jsxs("div",{className:"space-y-4",children:[I.jsxs("div",{children:[I.jsx("label",{className:"mb-1 block text-xs font-medium uppercase text-gray-500",children:"Hostname / URL"}),I.jsx("input",{className:"w-full rounded-lg border border-gray-600 bg-gray-900/50 p-2.5 text-white focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",type:"text",name:"hostname",value:l.hostname,onChange:x,placeholder:"e.g. mag.iptv-provider.com"})]}),I.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[I.jsxs("div",{children:[I.jsx("label",{className:"mb-1 block text-xs font-medium uppercase text-gray-500",children:"Port"}),I.jsx("input",{className:"w-full rounded-lg border border-gray-600 bg-gray-900/50 p-2.5 text-white focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",type:"text",name:"port",value:l.port,onChange:x})]}),I.jsxs("div",{children:[I.jsx("label",{className:"mb-1 block text-xs font-medium uppercase text-gray-500",children:"Context Path"}),I.jsx("input",{className:"w-full rounded-lg border border-gray-600 bg-gray-900/50 p-2.5 text-white focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",type:"text",name:"contextPath",value:l.contextPath,onChange:x,placeholder:"e.g. stalker_portal"})]})]}),I.jsxs("div",{className:"flex items-center gap-6 pt-2",children:[I.jsxs("label",{className:"flex cursor-pointer items-center gap-2",children:[I.jsxs("div",{className:"relative",children:[I.jsx("input",{type:"checkbox",name:"proxy",checked:l.proxy,onChange:x,className:"peer sr-only"}),I.jsx("div",{className:"h-6 w-11 rounded-full bg-gray-700 peer-checked:bg-blue-600"}),I.jsx("div",{className:"absolute left-1 top-1 h-4 w-4 rounded-full bg-white transition-all peer-checked:translate-x-5"})]}),I.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Enable Proxy"})]}),I.jsxs("label",{className:"flex cursor-pointer items-center gap-2",children:[I.jsxs("div",{className:"relative",children:[I.jsx("input",{type:"checkbox",name:"playCensored",checked:l.playCensored,onChange:x,className:"peer sr-only"}),I.jsx("div",{className:"h-6 w-11 rounded-full bg-gray-700 peer-checked:bg-red-600"}),I.jsx("div",{className:"absolute left-1 top-1 h-4 w-4 rounded-full bg-white transition-all peer-checked:translate-x-5"})]}),I.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Uncensored"})]})]})]})]}),I.jsxs("div",{className:"rounded-xl border border-gray-700 bg-gray-800 p-5 shadow-sm",children:[I.jsx("h3",{className:"mb-4 text-lg font-bold text-white",children:"Device Identity"}),I.jsxs("div",{className:"space-y-4",children:[I.jsxs("div",{children:[I.jsx("label",{className:"mb-1 block text-xs font-medium uppercase text-gray-500",children:"MAC Address"}),I.jsx("input",{className:"w-full rounded-lg border border-gray-600 bg-gray-900/50 p-2.5 font-mono text-white focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",type:"text",name:"mac",value:l.mac,onChange:x,placeholder:"00:1A:79:..."})]}),I.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[I.jsxs("div",{children:[I.jsx("label",{className:"mb-1 block text-xs font-medium uppercase text-gray-500",children:"STB Model"}),I.jsx("input",{className:"w-full rounded-lg border border-gray-600 bg-gray-900/50 p-2.5 text-white focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",type:"text",name:"stbType",value:l.stbType,onChange:x,placeholder:"MAG250"})]}),I.jsxs("div",{children:[I.jsx("label",{className:"mb-1 block text-xs font-medium uppercase text-gray-500",children:"Serial Number"}),I.jsx("input",{className:"w-full rounded-lg border border-gray-600 bg-gray-900/50 p-2.5 text-white focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",type:"text",name:"serialNumber",value:l.serialNumber,onChange:x})]})]}),I.jsxs("div",{children:[I.jsx("label",{className:"mb-1 block text-xs font-medium uppercase text-gray-500",children:"Device ID"}),I.jsx("input",{className:"w-full rounded-lg border border-gray-600 bg-gray-900/50 p-2.5 text-xs text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",type:"text",name:"deviceId1",value:l.deviceId1,onChange:x}),I.jsx("input",{className:"mt-2 w-full rounded-lg border border-gray-600 bg-gray-900/50 p-2.5 text-xs text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",type:"text",name:"deviceId2",value:l.deviceId2,onChange:x})]})]})]})]}),I.jsxs("div",{className:"space-y-6",children:[I.jsxs("div",{className:"rounded-xl border border-gray-700 bg-gray-800 p-5 shadow-sm",children:[I.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[I.jsx("h3",{className:"text-lg font-bold text-white",children:"Content Groups"}),I.jsx("div",{className:"flex gap-2",children:I.jsx("button",{type:"button",onClick:_,className:"rounded bg-gray-700 px-2 py-1 text-xs hover:bg-gray-600",children:"Sync Groups"})})]}),I.jsx("select",{multiple:!0,className:"h-48 w-full rounded-lg border border-gray-600 bg-gray-900/50 p-2 text-sm text-white focus:border-blue-500 focus:outline-none",value:l.groups,onChange:S,children:r.map(M=>I.jsx("option",{value:M.title,children:M.title},M.title))}),I.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:["Hold Ctrl/Cmd to select multiple. ",l.groups.length," selected."]}),I.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[I.jsx("button",{type:"button",onClick:A,className:"rounded-lg bg-gray-700 px-3 py-2 text-xs font-bold hover:bg-gray-600",children:"Refresh Channels"}),I.jsx("button",{type:"button",onClick:C,className:"rounded-lg bg-gray-700 px-3 py-2 text-xs font-bold hover:bg-gray-600",children:"Refresh Movies"}),I.jsx("button",{type:"button",onClick:k,className:"rounded-lg bg-gray-700 px-3 py-2 text-xs font-bold hover:bg-gray-600",children:"Refresh Series"}),I.jsx("button",{type:"button",onClick:B,className:"rounded-lg bg-red-900/30 text-red-400 px-3 py-2 text-xs font-bold hover:bg-red-900/50",children:"Clear History"})]})]}),I.jsxs("div",{className:"rounded-xl border border-gray-700 bg-gray-800 p-5 shadow-sm",children:[I.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[I.jsx("h3",{className:"text-lg font-bold text-white",children:"Auth Tokens"}),I.jsx("div",{className:"flex gap-2",children:I.jsx("button",{type:"button",onClick:P,className:"text-xs text-red-400 hover:text-red-300",children:"Clear All"})})]}),I.jsx("div",{className:"max-h-48 overflow-y-auto rounded-lg bg-gray-900/50 p-2",children:l.tokens.length===0?I.jsx("p",{className:"py-4 text-center text-sm text-gray-500",children:"No tokens active."}):I.jsx("ul",{className:"space-y-2",children:l.tokens.map((M,j)=>I.jsxs("li",{className:"flex items-center justify-between rounded bg-gray-800 p-2 text-xs",children:[I.jsx("span",{className:"truncate pr-2 font-mono text-gray-400 w-full",children:M}),I.jsx("button",{type:"button",onClick:()=>w(j),className:"text-red-500 hover:text-red-300",children:""})]},j))})}),I.jsx("button",{type:"button",onClick:G,className:"mt-3 w-full rounded-lg border border-dashed border-gray-600 py-2 text-sm text-gray-400 hover:bg-gray-700/50 hover:text-white",children:"+ Request New Token"})]})]}),I.jsx("div",{className:"col-span-full sticky bottom-4 z-10 rounded-xl border border-blue-500/30 bg-gray-900/90 p-4 shadow-2xl backdrop-blur-md",children:I.jsxs("div",{className:"flex items-center justify-between",children:[I.jsxs("div",{className:"text-sm text-gray-400",children:["Updates to ",I.jsx("strong",{children:"Active Configuration"})," will require a server restart."]}),I.jsx("button",{type:"submit",className:"rounded-lg bg-blue-600 px-8 py-3 font-bold text-white shadow-lg shadow-blue-500/20 transition-all hover:scale-105 hover:bg-blue-500",children:"Save & Restart Server"})]})})]})}),u&&I.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:I.jsxs("div",{className:"w-full max-w-lg rounded-xl bg-gray-900 border border-gray-700 p-6 shadow-2xl",children:[I.jsx("h2",{className:"mb-4 text-xl font-bold text-white",children:"Import Config Text"}),I.jsx("textarea",{className:"h-48 w-full rounded-lg border border-gray-700 bg-gray-800 p-3 font-mono text-xs text-white focus:border-blue-500 focus:outline-none",placeholder:"Paste content with http://..., mac-..., sn-...",value:h,onChange:M=>d(M.target.value)}),I.jsxs("div",{className:"mt-4 flex justify-end gap-3",children:[I.jsx("button",{type:"button",onClick:p,className:"rounded-lg px-4 py-2 text-sm font-bold text-gray-400 hover:text-white",children:"Cancel"}),I.jsx("button",{type:"button",onClick:y,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-bold text-white hover:bg-blue-700",children:"Parse & Apply"})]})]})})]})},Gv="preferredContentType",CL=()=>{const l=localStorage.getItem(Gv);return l==="series"?{initialType:"series",initialTitle:"Series"}:l==="tv"?{initialType:"tv",initialTitle:"TV"}:{initialType:"movie",initialTitle:"Movies"}},{initialType:jv,initialTitle:kL}=CL(),Gi={page:1,pageAtaTime:1,search:"",category:null,movieId:null,seasonId:null,parentTitle:kL,focusedIndex:null,contentType:jv};function wL(){const l=!!window.tizen,[e,t]=K.useState(Gi),[s,r]=K.useState([]),[a,u]=K.useState([]),[c,h]=K.useState(null),[d,g]=K.useState(null),[p,y]=K.useState(!0),[E,T]=K.useState(null),[x,S]=K.useState(null),[R,_]=K.useState(0),[A,C]=K.useState(jv),[k,G]=K.useState(!1),[w,P]=K.useState(null),[B,M]=K.useState(null),[j,ee]=K.useState(!1),[oe,de]=K.useState(null),[ce,U]=K.useState(null),X=K.useRef(null),[te,ue]=K.useState(null),[O,$]=K.useState({}),[Y,ie]=K.useState([]),[fe,ge]=K.useState(()=>{try{const se=localStorage.getItem("favorite_channels");return se?JSON.parse(se):[]}catch(se){return console.error("Failed to parse favorites from localStorage",se),[]}}),he=K.useRef(!1),Pe=K.useCallback(()=>et(null,null,function*(){var se;try{const ye=yield oS();(se=ye.data)!=null&&se.data&&$(ye.data.data)}catch(ye){console.error("Failed to fetch EPG data:",ye),ve.warn("Could not load program guide.")}}),[]),be=K.useCallback((se,ye)=>et(null,null,function*(){const Ae=ye||A;y(!0),T(null),S(null),se.page===1&&(r([]),_(0));try{let pe;if(Ae==="movie"){const _e={page:se.page,search:se.search,pageAtaTime:1,category:se.category,movieId:se.movieId,seasonId:se.seasonId};pe=yield Df(_e),r(Oe=>se.page===1?pe.data:[...Oe,...pe.data]),pe.total_items&&_(pe.total_items)}else if(Ae==="series"){if(se.movieId)pe=yield Io({movieId:se.movieId});else if(se.seasonId)pe=yield Io({seasonId:se.seasonId,page:se.page,pageAtaTime:1});else{const _e={page:se.page,search:se.search,pageAtaTime:1,category:se.category};pe=yield Io(_e)}r(_e=>se.page===1?pe.data:[..._e,...pe.data]),pe.total_items&&_(pe.total_items)}else{const[_e,Oe]=yield Promise.all([lS(),ry()]),Ze=_e.data||[],xt=Oe.data||[];r(Ze),_(Ze.length),ie([{id:"fav",title:"Favorites"},{id:"all",title:"All Channels"},...xt])}t(se)}catch(pe){console.error("Failed to fetch data:",pe),se.page>1?S("Could not load more content. Please try again."):T("Could not load content. Please try again later.")}finally{y(!1),he.current=!1}}),[A]),ht=K.useCallback(se=>{!se||!se.id||ge(ye=>{const Ae=new Set(ye);Ae.has(se.id)?(Ae.delete(se.id),ve.info(`Removed ${se.name||"Channel"} from favorites`)):(Ae.add(se.id),ve.success(`Added ${se.name||"Channel"} to favorites`));const pe=Array.from(Ae);return localStorage.setItem("favorite_channels",JSON.stringify(pe)),pe})},[]);K.useEffect(()=>{if(be(Gi),Gi.contentType==="tv"){Pe();const se=localStorage.getItem("lastPlayedTvChannelId");U(se||"__play_first__")}},[be,Pe]);const tt=K.useCallback(se=>et(null,null,function*(){if(A==="tv"&&(w==null?void 0:w.id)===se.id)return;X.current&&(clearTimeout(X.current),X.current=null),ue(null),u(pe=>[...pe,St(ke({},e),{focusedIndex:oe!=null?oe:0})]);const ye=se.title||se.name||"",Ae=A==="movie"&&e.category!==null;if(se.is_series==1)M(se),be(St(ke({},Gi),{category:e.category||"*",movieId:se.id,parentTitle:ye}));else if(se.is_season)be(St(ke({},Gi),{category:e.category,movieId:e.movieId,seasonId:se.id,parentTitle:ye}));else if(se.is_episode){y(!0),P(se);try{let pe=[];if(A==="series"?pe=(yield Io({movieId:e.movieId,seasonId:e.seasonId,episodeId:se.id})).data:pe=(yield Df({movieId:e.movieId,seasonId:e.seasonId,episodeId:se.id,category:"*"})).data,pe&&pe.length>0){const _e=pe[0];if(_e.id!==void 0){const Oe={id:_e.id};se.series_number!==void 0&&(Oe.series=se.series_number);const Ze=yield Fm(Oe),xt=Ze&&Ze.js&&Ze.js.cmd||Ze&&Ze.cmd;if(typeof xt=="string")g(xt),h(`${Hr}/proxy?url=${btoa(xt)}`);else throw new Error("Episode stream URL (cmd) not found.")}else throw new Error("Episode details (id) missing.")}else throw new Error("Could not fetch episode details.")}catch(pe){console.error(pe),T("Could not fetch stream URL."),P(null),u(_e=>_e.slice(0,-1))}finally{y(!1)}}else if(Ae||se.is_playable_movie){y(!0),P(se);try{const _e=(yield Df({movieId:se.id,category:e.category||"*"})).data;if(_e&&_e.length>0){const Oe=_e[0],Ze=yield Fm({id:Oe.id});if(Ze&&Ze.js&&typeof Ze.js.cmd=="string"){const xt=Ze.js.cmd;g(xt),h(`${Hr}/proxy?url=${btoa(xt)}`)}else throw new Error("Movie stream URL not found.")}else throw new Error("Movie file could not be found.")}catch(pe){console.error(pe),T("Could not fetch stream URL."),P(null),u(_e=>_e.slice(0,-1))}finally{y(!1)}}else if(A==="tv"){if(X.current&&(clearTimeout(X.current),X.current=null),ue(null),!se.cmd){ve.error("Channel has no command to play.");return}const pe=`${Wr.HOST}/live.m3u8?cmd=${se.cmd}&id=${se.id}`;localStorage.setItem("lastPlayedTvChannelId",se.id),P(se),g(pe),h(pe)}else be(St(ke({},Gi),{category:se.id,parentTitle:ye}))}),[A,e,w,be,oe]),Pt=K.useCallback(se=>{X.current&&clearTimeout(X.current);const ye=te||w;if(!ye)return;const Ae=s.findIndex(Oe=>Oe.id===ye.id);if(Ae===-1)return;let pe=Ae;if(se==="next"&&Ae<s.length-1?pe=Ae+1:se==="prev"&&Ae>0&&(pe=Ae-1),pe===Ae)return;const _e=s[pe];ue(_e),X.current=setTimeout(()=>{tt(_e),ue(null),X.current=null},2e3)},[w,tt,s,te]),xs=K.useCallback(()=>{var se;if(X.current){clearTimeout(X.current),X.current=null,ue(null);return}if(c){h(null),g(null),P(null);return}if(a.length>0){const ye=a[a.length-1];ye.movieId||M(null),u(Ae=>Ae.slice(0,-1)),C(ye.contentType),be(ye),de((se=ye.focusedIndex)!=null?se:0)}},[c,a,be]),fs=K.useCallback(()=>{if(X.current){clearTimeout(X.current),X.current=null,ue(null);return}if(c){h(null),g(null),P(null);return}},[c]),Ut=K.useCallback(se=>{if(se<=0||A==="tv"||he.current||p||R>0&&s.length>=R)return;he.current=!0;const ye=e.page+se;if(ye<1){he.current=!1;return}be(St(ke({},e),{page:ye}))},[p,R,s==null?void 0:s.length,e,be,A]),Wn=K.useCallback(se=>{tt(se)},[tt]),Fe=K.useCallback(()=>{!w||A!=="tv"||Pt("next")},[w,A,Pt]),We=K.useCallback(()=>{!w||A!=="tv"||Pt("prev")},[w,A,Pt]),It=K.useCallback(()=>{window.confirm("Are you sure you want to clear all watched and in-progress statuses?")&&(Object.keys(localStorage).forEach(se=>{(se.startsWith("video-completed-")||se.startsWith("video-in-progress-")||se.startsWith("video-progress-"))&&localStorage.removeItem(se)}),ve.success("All watched and in-progress statuses have been cleared."),be(Gi,A))},[be,A]);K.useEffect(()=>{e.page===1&&de(null)},[s,k,c,e.page]),K.useEffect(()=>{if(c||l&&j)return;const se=Array.from(document.querySelectorAll('[data-focusable="true"]'));if(se.length===0)return;const ye=oe===null?0:oe;if(ye>=se.length){de(se.length-1);return}oe===null&&de(0),se.forEach((Ae,pe)=>{pe===ye?(Ae.classList.add("focused"),Ae.focus()):Ae.classList.remove("focused")})},[oe,j,l,s,k,c]);const ss=K.useCallback((se,ye)=>{if(A==="tv")return;const Ae=document.querySelector(".grid");let pe=2;Ae&&(pe=window.getComputedStyle(Ae).getPropertyValue("grid-template-columns").split(" ").length),se>=ye-pe&&Ut(1)},[Ut,A]);K.useEffect(()=>{if(l){const se=["MediaPlay","MediaPause","MediaPlayPause","MediaStop","MediaFastForward","MediaRewind","ChannelUp","ChannelDown","ColorF0Red","ColorF1Green","ColorF2Yellow","ColorF3Blue"];try{se.forEach(ye=>{try{window.tizen.tvinputdevice.registerKey(ye),console.log(`Key registered: ${ye}`)}catch(Ae){console.error(`Failed to register key "${ye}": ${Ae.message}`)}})}catch(ye){console.error("Error registering keys: "+ye.message)}return()=>{try{se.forEach(ye=>{window.tizen.tvinputdevice.unregisterKey(ye)}),console.log("Media and Color keys unregistered.")}catch(ye){console.error("Error unregistering keys: "+ye.message)}}}},[l]);const st=K.useCallback(se=>{if(se===A)return;const ye=se==="movie"?"Movies":se==="series"?"Series":"TV",Ae=St(ke({},Gi),{parentTitle:ye,category:null,contentType:se});if(se==="tv"&&ie([]),C(se),localStorage.setItem(Gv,se),u([]),h(null),g(null),be(Ae,se),se==="tv"){Pe();const pe=localStorage.getItem("lastPlayedTvChannelId");U(pe||"__play_first__")}else U(null)},[A,be,Pe]);K.useEffect(()=>{const se=ye=>{if(c)return;if(l&&j){if(ye.keyCode===13)return;if(ye.keyCode===0||ye.keyCode===10009||ye.keyCode===8){ye.preventDefault(),ee(!1);const Oe=Array.from(document.querySelectorAll('[data-focusable="true"]')).findIndex(Ze=>Ze.matches('input[type="search"]'));Oe!==-1&&de(Oe)}return}const Ae=Array.from(document.querySelectorAll('[data-focusable="true"]'));if(Ae.length===0)return;let pe=oe===null?0:oe;switch(pe>=Ae.length&&(pe=Ae.length-1),ye.keyCode){case 37:ye.preventDefault(),pe>0&&de(pe-1);break;case 39:if(ye.preventDefault(),pe<Ae.length-1){const _e=pe+1;de(_e),ss(_e,Ae.length)}break;case 38:{ye.preventDefault();const _e=document.querySelector(".grid, .channel-list");if(_e){const Ze=window.getComputedStyle(_e).getPropertyValue("grid-template-columns").split(" ").length,xt=pe-Ze;xt>=0&&de(xt)}else pe>0&&de(pe-1);break}case 40:{ye.preventDefault();const _e=document.querySelector(".grid, .channel-list");let Oe=-1;if(_e){const xt=window.getComputedStyle(_e).getPropertyValue("grid-template-columns").split(" ").length,ni=pe+xt;ni<Ae.length?Oe=ni:(Ut(1),de(pe))}else pe<Ae.length-1&&(Oe=pe+1);Oe!==-1&&(de(Oe),ss(Oe,Ae.length));break}case 13:if(ye.preventDefault(),oe!==null&&Ae[oe]){const _e=Ae[oe];l&&_e.matches('input[type="search"]')?(ee(!0),_e.focus()):_e.click()}break;case 0:case 10009:case 8:{const _e=document.activeElement;if(_e&&(_e.tagName==="INPUT"||_e.tagName==="TEXTAREA"))return;ye.preventDefault(),xs();break}case 403:It();break;case 404:st("movie");break;case 405:console.log("Yellow button pressed");break;case 406:console.log("Blue button pressed"),st("tv");break}};return document.addEventListener("keydown",se),()=>document.removeEventListener("keydown",se)},[oe,s,xs,k,c,l,j,e,Ut,ss,It,st]);const as=se=>{se.preventDefault();const ye=se.target.elements.search.value;l&&ee(!1),u([]);const Ae=ye?`Results for "${ye}"`:A==="movie"?"Movies":A==="series"?"Series":"TV";be(St(ke({},Gi),{search:ye,category:ye?"*":A==="tv"?null:"*",parentTitle:Ae}))};K.useEffect(()=>{if(ce&&s.length>0&&A==="tv"&&!p){const se=ce==="__play_first__"?s[0]:s.find(ye=>ye.id===ce);se?tt(se):s[0]&&tt(s[0]),U(null)}},[s,ce,A,p,tt]),K.useEffect(()=>{const se=()=>{if(!!window.tizen||A==="tv")return;window.innerHeight+document.documentElement.scrollTop>=document.documentElement.offsetHeight-200&&Ut(1)};return window.addEventListener("scroll",se),()=>{window.removeEventListener("scroll",se)}},[A,Ut]);const Wt=s&&s.length>0&&s[0].is_episode,bs=c?"Now Playing":e.parentTitle||"Browse";return I.jsxs(I.Fragment,{children:[c?I.jsx(ny,{streamUrl:c,rawStreamUrl:d,onBack:fs,itemId:(w==null?void 0:w.id)||null,context:e,contentType:A,mediaId:A==="series"?e.movieId:A==="movie"&&w?w.id:null,item:B||w,seriesItem:B,channels:A==="tv"?s:void 0,channelInfo:A==="tv"?w:null,previewChannelInfo:A==="tv"?te:null,onNextChannel:Fe,onPrevChannel:We,onChannelSelect:Wn,epgData:O,channelGroups:Y,favorites:fe,toggleFavorite:ht}):I.jsx("div",{className:"min-h-screen font-sans text-gray-200",children:I.jsxs("div",{className:"container mx-auto p-4 sm:p-6",children:[I.jsx("header",{className:"sticky top-4 z-10 mb-6 rounded-xl border border-gray-700/80 bg-gray-800/50 p-4 backdrop-blur-lg",children:I.jsxs("div",{className:"flex flex-col items-center justify-between gap-4 sm:flex-row",children:[I.jsxs("div",{className:"flex items-center self-start",children:[(a.length>0||c)&&!c&&I.jsx("button",{onClick:xs,className:"mr-2 text-2xl text-white transition-colors hover:text-blue-400","data-focusable":"true",tabIndex:-1,children:""}),I.jsx("img",{src:"stalker-logo.svg",width:180}),I.jsx("h1",{className:"sm:text-l md:text-l text-xl font-bold tracking-wider text-white",children:bs})]}),!c&&I.jsxs("div",{className:"flex w-full flex-col items-center gap-4 sm:w-auto sm:flex-row",children:[I.jsxs("div",{className:"flex w-full justify-center space-x-2 rounded-full bg-gray-900/60 p-1 sm:w-auto",children:[I.jsx("button",{onClick:()=>st("movie"),className:`w-full rounded-full px-4 py-2 text-sm font-semibold transition-colors duration-300 sm:px-6 ${A==="movie"?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-700/50"}`,"data-focusable":"true",tabIndex:-1,children:"Movies"}),I.jsx("button",{onClick:()=>st("series"),className:`w-full rounded-full px-4 py-2 text-sm font-semibold transition-colors duration-300 sm:px-6 ${A==="series"?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-700/50"}`,"data-focusable":"true",tabIndex:-1,children:"Series"}),I.jsx("button",{onClick:()=>st("tv"),className:`w-full rounded-full px-4 py-2 text-sm font-semibold transition-colors duration-300 sm:px-6 ${A==="tv"?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-700/50"}`,"data-focusable":"true",tabIndex:-1,children:"TV"})]}),I.jsx("form",{onSubmit:as,className:"w-full sm:w-auto",children:I.jsx("input",{type:"search",name:"search",defaultValue:e.search,placeholder:"Search titles...",className:"w-full rounded-full border border-gray-700/80 bg-gray-900/50 px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 sm:w-64","data-focusable":"true",readOnly:l&&!j,onClick:()=>{l&&ee(!0)},onBlur:()=>{l&&ee(!1)}},e.search)}),!l&&I.jsx("button",{onClick:()=>G(!k),className:"ml-4 rounded-lg bg-blue-600 px-4 py-2 font-bold text-white transition-colors hover:bg-blue-700","data-focusable":"true",tabIndex:-1,children:k?"Back to Content":"Admin"}),l&&!c&&I.jsx("button",{onClick:It,className:"ml-4 rounded-lg bg-red-600 px-4 py-2 font-bold text-white transition-colors hover:bg-red-700","data-focusable":"true",tabIndex:-1,children:"Clear History"})]})]})}),I.jsx("main",{children:k?I.jsx(DL,{}):I.jsxs(I.Fragment,{children:[p&&s.length===0&&I.jsx($m,{}),E&&I.jsxs("div",{className:"text-center",children:[I.jsx("p",{className:"text-red-500",children:E}),I.jsx("button",{onClick:()=>be(e),className:"mt-4 rounded-lg bg-blue-500 px-4 py-2 text-white transition-colors hover:bg-blue-600","data-focusable":"true",tabIndex:-1,children:"Reload"})]}),!E&&c?I.jsx(ny,{streamUrl:c,rawStreamUrl:d,onBack:xs,itemId:(w==null?void 0:w.id)||null,context:e,contentType:A,mediaId:A==="series"?e.movieId:A==="movie"&&w?w.id:null,item:B||w,seriesItem:B,epgData:O,channelGroups:Y,favorites:fe,toggleFavorite:ht}):!E&&I.jsxs(I.Fragment,{children:[A!=="tv"&&e.category===null&&!e.search&&I.jsx(_L,{onClick:tt,contentType:A}),I.jsx("div",{className:` ${A==="tv"?"channel-list flex flex-col gap-1":Wt&&!l?"flex flex-col gap-4":Wt?"grid grid-cols-1 gap-4 md:grid-cols-2":"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 md:gap-6 lg:grid-cols-5 xl:grid-cols-6"} ${p&&s.length>0&&e.page===1?"pointer-events-none opacity-50 transition-opacity duration-300":"opacity-100"} `,children:s==null?void 0:s.map(se=>A==="tv"?I.jsx($v,{item:se,onClick:tt,isFocused:!1},se.id):Wt?I.jsx(uS,{item:se,onClick:tt},se.id):I.jsx(ay,{item:se,onClick:tt},se.id))}),!(s!=null&&s.length)&&!p&&!e.search&&I.jsx("p",{className:"mt-10 text-center text-gray-400",children:"No content found."}),!(s!=null&&s.length)&&!p&&e.search&&I.jsxs("p",{className:"mt-10 text-center text-gray-400",children:['No results found for "',e.search,'".']}),(R===0||s.length<R)&&A!=="tv"&&I.jsxs("div",{className:"col-span-full",children:[p&&s.length>0&&I.jsx($m,{}),!p&&x&&I.jsxs("div",{className:"py-8 text-center",children:[I.jsx("p",{className:"text-red-500",children:x}),I.jsx("button",{onClick:()=>Ut(1),className:"mt-4 rounded-lg bg-blue-500 px-4 py-2 text-white transition-colors hover:bg-blue-600","data-focusable":"true",tabIndex:-1,children:"Retry"})]})]})]})]})})]})}),I.jsx(AL,{})]})}aS.createRoot(document.getElementById("root")).render(I.jsx(K.StrictMode,{children:I.jsx(wL,{})}))});export default OL();
